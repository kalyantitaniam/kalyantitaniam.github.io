<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>What’s New &mdash; Titaniam Server Installation Guide for AWS 1.00a documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Titaniam Server Installation Guide for AWS" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/Primary lockup red_white.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">What’s New</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-s-new-in-build-2-3-7">What’s New in Build 2.3.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-new-in-build-2-3-6">What’s New in Build 2.3.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-new-in-build-2-3-5">What’s New in Build 2.3.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-new-in-build-2-3-4">What’s New in Build 2.3.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-new-in-build-2-3-1">What’s New in Build 2.3.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-new-in-build-2-3-0">What’s New in Build 2.3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-new-in-build-2-2-1">What’s New in Build 2.2.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#upgrading-to-build-2-2-1">Upgrading to Build 2.2.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#related-topics">Related Topics</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#product-matrix">Product Matrix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#planning-your-installation">Planning your Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#layouts">Layouts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#poc-layout">POC Layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="#production-layout">Production Layout</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#platform-support-matrix">Platform Support Matrix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#software-requirements">Software Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hardware-requirements">Hardware Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#port-number-requirements">Port Number Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#roles">Roles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#poc-installation-with-secrets-in-local-file-system">POC Installation with Secrets in Local File System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#titaniam-server-artifacts">Titaniam Server Artifacts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-process">Install Process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#storing-titaniam-license-on-local-file-system">Storing Titaniam License on Local File System</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-titaniam-license">Example Titaniam License</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#storing-application-properties-and-service-definitions">Storing Application Properties and Service Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#storing-encryption-keys-in-local-file-system">Storing Encryption Keys in Local File System</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installing-titaniam-services">Installing Titaniam Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation-procedure">Installation Procedure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#advanced-configurations">Advanced Configurations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#poc-installation-with-aws-secrets-manager">POC Installation with AWS Secrets Manager</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">Titaniam Server Artifacts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">Install Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-1-supplying-configuration-values-and-keys-using-aws-secrets-manager">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-a-content-of-titaniam-license-secret">Step 1.a: Content of titaniam.license secret</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-1-b-store-encryption-keys">Step 1.b: Store Encryption Keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-1-c-create-configuration-settings">Step 1.c: Create Configuration Settings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#integrating-with-the-data-store">Integrating with the Data Store</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-2-configure-services">Step 2: Configure Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-2-configure-service-translation-service">Step 2: Configure Service: Translation Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-configure-service-configure-as-a-vault">Step 2: Configure Service: Configure as a Vault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configure-secure-search-index">Configure Secure Search Index</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-configure-service-proxy-for-the-s3-object-store">Step 2: Configure Service: Proxy for the S3 Object Store</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configure-your-application-to-route-traffic-to-titaniam-s3-proxy">Configure your Application to Route Traffic to Titaniam S3 Proxy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-configure-service-elastic-proxy">Step 2: Configure Service: Elastic Proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-configure-service-data-protection-service-for-object-store">Step 2: Configure Service: Data Protection Service for Object Store</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-compose-the-docker-compose-yml-file">Step 3: Compose the docker-compose.yml File</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-4-deploy-titaniam-server-using-docker">Step 4: Deploy Titaniam Server using Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-titaniam-server-without-bringing-up-the-titaniam-services">Install Titaniam Server without Bringing up the Titaniam Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-titaniam-server">Install Titaniam Server</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#post-installation-steps">Post-Installation Steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#logs">Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verifying-the-installation-for-vault-and-translation-services">Verifying the Installation for Vault and Translation Services</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#production-installation-using-kubernetes">Production Installation Using Kubernetes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#production-installation-instructions">Production Installation Instructions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">Titaniam Server Artifacts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Install Titaniam Server</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#lic-keys-aws-ec2">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">Step 1.a: Content of titaniam.license secret</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Step 1.b: Store Encryption Keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">Step 1.c: Create Configuration Settings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id12">Integrating with the Data Store</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id14">Step 2: Configure Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id16">Step 2: Configure Service: Translation Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-configure-service-configure-as-a-vault">Step 3: Configure Service: Configure as a Vault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id19">Configure Secure Search Index</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id20">Step 2: Configure Service: Proxy for the S3 Object Store</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id22">Configure your Application to Route Traffic to Titaniam S3 Proxy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id23">Step 2: Configure Service: Elastic Proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id25">Step 2: Configure Service: Data Protection Service for Object Store</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-configure-token-secret">Step 3: Configure Token Secret</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-4-configure-configmap">Step 4: Configure ConfigMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-5-make-service-available-outside-the-cluster">Step 5: Make Service Available Outside the Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-6-configure-kubernetes-deployment-file">Step 6: Configure Kubernetes Deployment File</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-7-deploy-titaniam-server-using-kubernetes">Step 7: Deploy Titaniam Server using Kubernetes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-kubernetes-cluster-on-eks">Creating Kubernetes Cluster on EKS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-kubernetes-cluster">Creating Kubernetes Cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verifying-cluster-using-kubectl">Verifying Cluster using kubectl</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deployment">Deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deployment-using-kubernetes-yaml-file">Deployment Using Kubernetes yaml File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#checking-whether-all-kubernetes-resources-in-the-cluster-are-up-available">Checking whether all kubernetes resources in the cluster are up/available</a></li>
<li class="toctree-l3"><a class="reference internal" href="#checking-the-log-of-a-running-pod">Checking the log of a running pod</a></li>
<li class="toctree-l3"><a class="reference internal" href="#removing-the-kubernetes-resources-using-kubectl">Removing the kubernetes resources using kubectl</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#removing-deployment">Removing deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#removing-service">Removing service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#removing-configmap">Removing configmap</a></li>
<li class="toctree-l4"><a class="reference internal" href="#removing-secret">Removing secret</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#zero-day-encryption-service">Zero-day Encryption Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id27">Post-Installation Steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id28">Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id29">Verifying the Installation for Vault and Translation Services</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#production-installation-using-docker-on-ec2-instances">Production Installation Using Docker on EC2 Instances</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id30">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id31">Production Installation Instructions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#artifacts">Artifacts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installation-process">Installation Process</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id33">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id35">Step 1.a: Content of titaniam.license secret</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id37">Step 1.b: Store Encryption Keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id39">Step 1.c: Create Configuration Settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-1-supplying-configuration-values-and-keys-using-local-file-system">Step 1: Supplying Configuration Values and Keys using Local File System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id41">Storing Titaniam License on Local File System</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id43">Example Titaniam License</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#local-properties-aws">Storing Application Properties and Service Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id45">Storing Encryption Keys in Local File System</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-2-installing-titaniam-plugin-and-kibana">Step 2: Installing Titaniam Plugin and Kibana</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-titaniam-plugin">Install Titaniam Plugin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-installing-postgresql-on-an-ec2-instance">Step 3: Installing PostgreSQL on an EC2 Instance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-postgresql">Install PostgreSQL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-4-installing-titaniam-server-and-configuring-as-a-vault">Step 4: Installing Titaniam Server and Configuring as a Vault</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id47">Install Titaniam Server</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-5-integrating-with-the-data-store">Step 5: Integrating with the Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-6-configure-load-balancer">Step 6: Configure Load Balancer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-a-target-group-for-titaniam-server">Create a Target Group for Titaniam Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-target-group-for-kibana">Create a Target Group for Kibana</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-load-balancer">Create Load Balancer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#appendix-titaniam-specific">Appendix: Titaniam-Specific</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id48">Zero-day Encryption Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-tls-and-mtls-authentication">Configure TLS and mTLS Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-single-sign-on">Configure Single-Sign On</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id50">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-sso">Configuring SSO</a></li>
<li class="toctree-l3"><a class="reference internal" href="#disabling-sso">Disabling SSO</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configure-authorization">Configure Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generate-keys">Generate Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="#keyring-json">Keyring.JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generate-an-encrypted-data-encryption-key-and-optionally-a-master-key">Generate an Encrypted Data Encryption Key and Optionally a Master Key</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#keygen-code">KeyGen Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rekeying">Rekeying</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rekeying-prerequisites">Rekeying Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-rekey">How to Rekey</a></li>
<li class="toctree-l3"><a class="reference internal" href="#validating-the-rekeying-process">Validating the Rekeying Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rekey-java-code">ReKey.Java Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bring-your-own-keys">Bring Your Own Keys</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup-byok-index-with-keys-in-aws-sm">Setup BYOK Index with Keys in AWS SM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-byok-keys-in-hashicorp-vault">Setup BYOK Keys in Hashicorp Vault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#refresh-the-seed-store">Refresh the Seed Store</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#create-index-and-ingest-data-in-the-elasticsearch-index">Create Index and Ingest Data in the Elasticsearch Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ingest-document">Ingest document</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-document-by-id">Get document by ID</a></li>
<li class="toctree-l3"><a class="reference internal" href="#search-term-search">Search (Term search)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rotating-vault-token-keys-using-krs">Rotating Vault Token Keys using KRS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-rotate-keys">How to Rotate Keys</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id64">Post-Installation Steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id65">Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id66">Verifying the Installation for Vault and Translation Services</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#appendix-example-docker-compose-yml-files-and-property-files">Appendix: Example Docker Compose YML Files and Property Files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example-docker-compose-yml-file-for-titaniam-plugin-using-aws">Example: Docker Compose YML File for Titaniam Plugin using AWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-docker-compose-yml-file-for-titaniam-plugin-using-local-file-system">Example: Docker Compose YML File for Titaniam Plugin Using Local File System</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-docker-compose-yml-file-for-titaniam-plugin-in-byok-mode">Example: Docker Compose YML File for Titaniam Plugin in BYOK Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-docker-compose-yml-file-for-postgresql">Example: Docker Compose YML File for PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-docker-compose-yml-file-for-titaniam-server-using-aws">Example: Docker Compose YML File for Titaniam Server using AWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-docker-compose-yml-file-for-titaniam-server">Example: Docker Compose YML File for Titaniam Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-docker-compose-yml-file-for-titaniam-server-in-byok-for-vault-and-elasticsearch-proxy">Example: Docker Compose YML File for Titaniam Server in BYOK for Vault and Elasticsearch Proxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-docker-compose-yml-file-for-enabling-all-titaniam-services-and-properties-in-local-file-system">Example: Docker Compose YML File for Enabling All Titaniam Services and Properties in Local File System</a></li>
<li class="toctree-l2"><a class="reference internal" href="#titaniam-properties-secret">titaniam.properties Secret</a></li>
<li class="toctree-l2"><a class="reference internal" href="#titaniam-properties-with-all-enabled-services">titaniam.properties with All Enabled Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-additional-properties-in-titaniam-properties">Configure Additional Properties in titaniam.properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#management-endpoints-for-health-and-version">Management Endpoints for Health and Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="#refresh-key-rate">Refresh Key Rate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enable-integrity-checks-on-encryption-key-table">Enable Integrity Checks on Encryption Key Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-elasticsearch-index-settings-for-vault">Configure Elasticsearch Index Settings for Vault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#property-description">Property Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configure-elasticsearch-reindex-settings-for-vault">Configure Elasticsearch ReIndex Settings for Vault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-to-specify-these-reindex-settings">How to specify these reindex settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#where-are-the-reindex-settings-picked-from">Where are the reindex settings picked from?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reindex-property-description">Reindex Property Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#include-time-taken-for-ingestion-in-api-response-headers">Include Time Taken for Ingestion in API Response Headers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#appendix-generic-concepts-and-tasks">Appendix: Generic Concepts and Tasks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#install-docker-and-docker-compose">Install Docker and Docker Compose</a></li>
<li class="toctree-l2"><a class="reference internal" href="#aws-secrets-manager-supplying-secrets">AWS Secrets Manager: Supplying Secrets</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Titaniam Server Installation Guide for AWS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>What’s New</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/hello_world_aws.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="what-s-new">
<h1>What’s New<a class="headerlink" href="#what-s-new" title="Permalink to this heading"></a></h1>
<p>This section describes the changes in the product for each release version.</p>
<section id="what-s-new-in-build-2-3-7">
<h2>What’s New in Build 2.3.7<a class="headerlink" href="#what-s-new-in-build-2-3-7" title="Permalink to this heading"></a></h2>
<ul>
<li><p><strong>Vault Tokens</strong>: Added the following fields in the <code class="docutils literal notranslate"><span class="pre">/v1/mgmt/key_rotation/latest/status</span></code> API response:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">elaped_time_secs</span></code> specifies in seconds since the master task (such as scheduling key rotation, or swapping of aliases ) was initiated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">records_per_sec</span></code> specifies the number of records that are processed per second.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">note</span></code> specifies the reason the <code class="docutils literal notranslate"><span class="pre">total</span></code> or <code class="docutils literal notranslate"><span class="pre">completed</span></code> fields read 0.</p></li>
</ul>
<p>These two fields let you estimate the progress in terms of time and number of records processed for each of the key rotation tasks.</p>
</li>
<li><p><strong>Vault Tokens</strong>: Updated the <code class="docutils literal notranslate"><span class="pre">success</span></code> and <code class="docutils literal notranslate"><span class="pre">created</span></code> fields to <code class="docutils literal notranslate"><span class="pre">processed</span></code> in the <code class="docutils literal notranslate"><span class="pre">/v1/mgmt/key_rotation/latest/status</span></code> API response.</p></li>
<li><p><strong>Vault Collections</strong>: The following release_name related endpoints are introduced.</p></li>
</ul>
<table class="docutils align-default" id="id71">
<caption><span class="caption-text">Refactored Endpoints</span><a class="headerlink" href="#id71" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>New Endpoint</strong></p></th>
<th class="head"><p><strong>Replaces</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/v2/release_schema/collections/{collection_name}/{release_name}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v2/collections/{collection_name}/{release_name}</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="what-s-new-in-build-2-3-6">
<h2>What’s New in Build 2.3.6<a class="headerlink" href="#what-s-new-in-build-2-3-6" title="Permalink to this heading"></a></h2>
<ul>
<li><p><strong>Data Protection Service</strong>: Enabled the Data Protection service for object stores. This data protection service lets you encrypt objects in place in the object store and also generates an encoded URI to the objects. You can use this URI to download the objects in clear text. In this release, the AWS S3 object store is supported.</p>
<blockquote>
<div><ul class="simple">
<li><p>Added the <code class="docutils literal notranslate"><span class="pre">sdss.data.protection.enabled</span></code> property to enable data protection on object stores. For more information, see <a class="reference internal" href="single_node.html#dp-service"><span class="std std-ref">Step 2: Configure Service: Data Protection Service for Object Store</span></a>.</p></li>
<li><p>The following endpoints are enabled with the data protection service:</p>
<ul>
<li><p><a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-data-protection-for-object-stores-encrypt-an-object-in-place">Encrypt an Object in-place in S3</a></p></li>
<li><p><a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-data-protection-for-object-stores-generate-an-uri-to-download-an-object">Generate an URI to Download an Object in S3</a></p></li>
</ul>
</li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Translation Service</strong>: The following Translation Service APIs are deprecated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">keyword</span><span class="o">/</span><span class="n">tangle</span>
<span class="o">/</span><span class="n">keyword</span><span class="o">/</span><span class="n">untangle</span>
<span class="o">/</span><span class="n">date</span><span class="o">/</span><span class="n">tangle</span>
<span class="o">/</span><span class="n">date</span><span class="o">/</span><span class="n">untangle</span>
<span class="o">/</span><span class="n">text</span><span class="o">/</span><span class="n">tangle</span>
<span class="o">/</span><span class="n">text</span><span class="o">/</span><span class="n">untangle</span>
<span class="o">/</span><span class="n">keyword2</span><span class="o">/</span><span class="n">tangle</span>
<span class="o">/</span><span class="n">keyword2</span><span class="o">/</span><span class="n">untangle</span>
<span class="o">/</span><span class="n">fpe</span><span class="o">/</span><span class="n">encrypt</span>
<span class="o">/</span><span class="n">fpenumber</span><span class="o">/</span><span class="n">encrypt</span>
<span class="o">/</span><span class="n">fpe</span><span class="o">/</span><span class="n">decrypt</span>
<span class="o">/</span><span class="n">fpenumber</span><span class="o">/</span><span class="n">decrypt</span>
<span class="o">/</span><span class="n">integer</span><span class="o">/</span><span class="n">tangle</span>
<span class="o">/</span><span class="n">integer</span><span class="o">/</span><span class="n">untangle</span>
<span class="o">/</span><span class="n">ip</span><span class="o">/</span><span class="n">tangle</span>
<span class="o">/</span><span class="n">ip</span><span class="o">/</span><span class="n">untangle</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="what-s-new-in-build-2-3-5">
<h2>What’s New in Build 2.3.5<a class="headerlink" href="#what-s-new-in-build-2-3-5" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Added the following body parameters to the <a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-key-rotation-endpoints-rerun-elastic">Continue Elasticsearch Tasks</a>, and <a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-key-rotation-endpoints-rerun-key-activation-on-failure">Rerun</a> endpoints:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">number_of_shards</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">number_of_replicas</span></code></p></li>
</ul>
</li>
</ul>
<blockquote>
<div><p>For more information, see <a class="reference internal" href="#static-index"><span class="std std-ref">Configure Elasticsearch Index Settings for Vault</span></a>.</p>
</div></blockquote>
</section>
<section id="what-s-new-in-build-2-3-4">
<h2>What’s New in Build 2.3.4<a class="headerlink" href="#what-s-new-in-build-2-3-4" title="Permalink to this heading"></a></h2>
<ul>
<li><p>Added the following body parameters to the <a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-key-rotation-endpoints-schedule-key-rotation">Schedule key rotation</a>, <a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-key-rotation-endpoints-rerun-elastic">Continue Elasticsearch Tasks</a>, and <a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-key-rotation-endpoints-rerun-key-activation-on-failure">Rerun</a> endpoints:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">reindex_slices</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reindex_batch_size</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reindex_scroll_timeout_mins</span></code></p></li>
</ul>
<p>For more information, see <a class="reference internal" href="#reindex-settings"><span class="std std-ref">Configure Elasticsearch ReIndex Settings for Vault</span></a>.</p>
</li>
<li><p>Added the following deployment-time Titaniam properties to support Elasticsearch reindex configuration settings:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;sdss.es.reindex.slices&quot;:</span> <span class="pre">“&lt;value&gt;”,</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;sdss.es.reindex.batch_size&quot;:</span> <span class="pre">&lt;value&gt;,</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;sdss.es.reindex.scroll_timeout_mins&quot;:</span> <span class="pre">&lt;value&gt;,</span></code></p></li>
</ul>
<p>For more information, see <a class="reference internal" href="#reindex-settings"><span class="std std-ref">Configure Elasticsearch ReIndex Settings for Vault</span></a>.</p>
</div></blockquote>
</li>
<li><p>The default value of the verbose query parameter is updated to <code class="docutils literal notranslate"><span class="pre">false</span></code> for the following Translation Service endpoints:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">v2/ff1_alphanumeric/encrypt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">v2/ff1_alphanumeric/decrypt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">v2/ff1_alphanumeric_no_tweak/encrypt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">v2/ff1_alphanumeric_no_tweak/decrypt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">v2/ff1_numeric/encrypt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">v2/ff1_numeric/decrypt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">v2/ff1_numeric_no_tweak/encrypt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">v2/ff1_numeric_no_tweak/decrypt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">v2/ff1_printable_ascii/encrypt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">v2/ff1_printable_ascii/decrypt</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="what-s-new-in-build-2-3-1">
<h2>What’s New in Build 2.3.1<a class="headerlink" href="#what-s-new-in-build-2-3-1" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>If the Titaniam Vault or database service is restarted during a database key rotation operation, you can now resume the database operations after the services are available. For more information, see <a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-key-rotation-endpoints-rerun-db">Continue Database Tasks</a>.</p></li>
<li><p>If any Elasticsearch errors occur during an Elasticsearch key rotation operation, you can now resume the Elasticsearch operations. For more information, see <a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-key-rotation-endpoints-rerun-elastic">Continue Elasticsearch Tasks</a>.</p></li>
</ul>
</section>
<section id="what-s-new-in-build-2-3-0">
<h2>What’s New in Build 2.3.0<a class="headerlink" href="#what-s-new-in-build-2-3-0" title="Permalink to this heading"></a></h2>
<ul>
<li><p>Added the following body parameters to the Schedule Key Rotation (Vault Token) endpoint:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">number_of_shards</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">number_of_replicas</span></code></p></li>
</ul>
</li>
<li><p>Added the following deployment-time Titaniam properties to support Elasticsearch index settings for shards and replicas:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;sdss.es.number_of_shards&quot;:</span> <span class="pre">&quot;2&quot;,</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;sdss.es.number_of_replicas&quot;:</span> <span class="pre">&quot;2&quot;,</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;sdss.store.elapsed.millis&quot;:</span> <span class="pre">&quot;true&quot;,</span></code></p>
<blockquote>
<div><p>For more information, see <a class="reference internal" href="#static-index"><span class="std std-ref">Configure Elasticsearch Index Settings for Vault</span></a>.</p>
</div></blockquote>
</li>
</ul>
</li>
<li><p>Improved the performance of the bulk store (<code class="docutils literal notranslate"><span class="pre">{{secureStoreURL}}/v2/secure/store/bulk</span></code>) and bulk retrieve (<code class="docutils literal notranslate"><span class="pre">{{secureStoreURL}}/v2/secure/retrieve/bulk</span></code>) endpoints. These endpoints now internally make a single request instead of multiple requests to the Elasticsearch.</p></li>
<li><p>Added the <code class="docutils literal notranslate"><span class="pre">sdss.store.elapsed.millis</span></code> property. When you use this property during Titaniam Server deployment, the API response for bulk store endpoint returns the following headers:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X-tn-es-lookup-millis</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-tn-db-millis</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-tn-es-millis</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-tn-total-time-millis</span></code></p></li>
</ul>
<p>For more information, see <a class="reference internal" href="#millisecs"><span class="std std-ref">Include Time Taken for Ingestion in API Response Headers</span></a>.</p>
</div></blockquote>
</li>
<li><p>Added the following endpoint to support UDT translation in Titaniam Translation Service:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-user-defined-types-modify-udt-definition">Modify UDT Definition</a></p></li>
</ul>
</li>
</ul>
</section>
<section id="what-s-new-in-build-2-2-1">
<h2>What’s New in Build 2.2.1<a class="headerlink" href="#what-s-new-in-build-2-2-1" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Added support for a prefix in AWS Secrets: You can now specify this property in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file. When you the <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> property, the secret name must be of the format <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code> for data encryption key, <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam.license</span></code> for the Titaniam license, and <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code> for the master key.</p></li>
<li><p>Added support for master keys in AWS. You can now add your master key as a secret in AWS. The master key must be of the format: <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code> or <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code>. When you use this feature, ensure that you also use an encrypted data encryption key in AWS.</p></li>
</ul>
<ul>
<li><p>Updates to Translation Service:</p>
<blockquote>
<div><ul class="simple">
<li><p>Added the following endpoints to support UDT translation in Titaniam Translation Service.</p>
<ul>
<li><p><a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-translate-user-defined-types-create-udt-definition">Create UDT Definition</a></p></li>
<li><p><a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-translate-user-defined-types-get-udt-definition">GET UDT Definition</a></p></li>
<li><p><a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-translate-user-defined-types-delete-udt-definition">Delete UDT Definition</a></p></li>
<li><p><a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-translate-user-defined-types-translate-data">Translate Tokens</a></p></li>
<li><p><a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-translate-user-defined-types-translate-data-using-pre-defined-transformations">Translate Tokens using Pre-defined UDT Transformations</a></p></li>
</ul>
</li>
<li><p>Added support for length validation in UDT endpoints. You must now pass <code class="docutils literal notranslate"><span class="pre">max_length</span></code> and <code class="docutils literal notranslate"><span class="pre">min_length</span></code> fields in the UDT definition.</p></li>
<li><p>Added support for the format type <code class="docutils literal notranslate"><span class="pre">ff1_printable_ascii_no_tweak</span></code> in the UDT definition.</p></li>
<li><p>When using the <code class="docutils literal notranslate"><span class="pre">printable_ascii</span></code> character set in an UDT defintion, the formatting_characters are stripped before encryption.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">end</span></code> fields in an UDT definition are now used after stripping the formatting characters.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Added integrity checks on the <code class="docutils literal notranslate"><span class="pre">encryption_key</span></code> tables in the datastores. This support is to prevent the following scenarios:</p>
<blockquote>
<div><ul class="simple">
<li><p>Changing the encryption key material for an active encryption key</p></li>
<li><p>Removing an encryption key from the key store</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Added an optional property <code class="docutils literal notranslate"><span class="pre">sdss.encryption-keys.check-integrity</span></code>. You must set this property to <code class="docutils literal notranslate"><span class="pre">true</span></code> to enable the integrity checks on <code class="docutils literal notranslate"><span class="pre">encryption_key</span></code> tables during Titaniam Server startup.</p></li>
</ul>
<section id="upgrading-to-build-2-2-1">
<h3>Upgrading to Build 2.2.1<a class="headerlink" href="#upgrading-to-build-2-2-1" title="Permalink to this heading"></a></h3>
<p>In build 2.2.1, integrity checks are added on <code class="docutils literal notranslate"><span class="pre">encryption_key</span></code> tables in the datastore. So, you must alter your tables in the datastore before upgrading your Titaniam Server installation to version 2.2.1.</p>
<p>Run the following commands on your datastore:</p>
<p>MariabDB:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alter</span> <span class="n">table</span> <span class="n">encryption_key</span> <span class="n">add</span> <span class="n">column</span> <span class="n">IF</span> <span class="n">NOT</span> <span class="n">EXISTS</span> <span class="n">digest</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="n">alter</span> <span class="n">table</span> <span class="n">encryption_key</span> <span class="n">add</span> <span class="n">column</span> <span class="n">disabled</span> <span class="n">boolean</span> <span class="n">default</span> <span class="n">false</span>
</pre></div>
</div>
<p>postgres:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alter</span> <span class="n">table</span> <span class="n">encryption_key</span> <span class="n">add</span> <span class="n">column</span> <span class="n">IF</span> <span class="n">NOT</span> <span class="n">EXISTS</span> <span class="n">digest</span> <span class="n">varchar</span> <span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="n">alter</span> <span class="n">table</span> <span class="n">encryption_key</span> <span class="n">add</span> <span class="n">column</span> <span class="n">disabled</span> <span class="n">boolean</span> <span class="n">default</span> <span class="n">false</span>
</pre></div>
</div>
</section>
<section id="related-topics">
<h3>Related Topics<a class="headerlink" href="#related-topics" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="single_node.html#license"><span class="std std-ref">Step 1.a: Content of titaniam.license secret</span></a></p></li>
<li><p><a class="reference internal" href="single_node.html#key-generation"><span class="std std-ref">Step 1.b: Store Encryption Keys</span></a></p></li>
<li><p><a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-translate-user-defined-types-create-udt-definition">Create UDT Definition</a></p></li>
<li><p><a class="reference internal" href="#configure-misc"><span class="std std-ref">Configure Additional Properties in titaniam.properties</span></a></p></li>
</ul>
</section>
</section>
</section>
<section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h1>
<p>Titaniam Server is a Java application that can be configured as one of the following modules:</p>
<ul class="simple">
<li><p>Titaniam Encrypted Analytical Vault (referred as Vault in this document) is a NoSQL datastore. Store your most valuable data and conduct full-featured search analytics while keeping the data encrypted at all times.</p></li>
<li><p>Titaniam Translation Service allows you to encrypt/ decrypt a variety of data (structured, unstructured, binaries). This product can be used to secure sensitive data or to translate data released from other Titaniam products.</p></li>
<li><p>Titaniam Proxy for Object store (referred to as Proxy in this document) allows you to protect an object store.</p></li>
<li><p>Titaniam Elasticsearch Proxy allows you to protect an Elasticsearch node.</p></li>
</ul>
<section id="product-matrix">
<h2>Product Matrix<a class="headerlink" href="#product-matrix" title="Permalink to this heading"></a></h2>
<p>The following table maps the installer components to Titaniam products. For your chosen product, you must install and configure the components marked as “Yes”.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><strong>Component</strong></p></td>
<td><p><strong>Vault</strong></p></td>
<td><p><strong>Proxy</strong></p></td>
<td><p><strong>Translation Service</strong></p></td>
<td><p><strong>Elasticsearch Proxy</strong></p></td>
</tr>
<tr class="row-even"><td><p>Titaniam Server</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>Relational Store</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>Titaniam Plugin (Secure Search Engine)</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>Key Store</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
</tbody>
</table>
<p>Where,</p>
<ul class="simple">
<li><p>Relational Store is a database that Titaniam Server uses to store metadata and data.</p></li>
<li><p>Titaniam Plugin helps secure sensitive data stored in Elasticsearch using a patent-pending proprietary Data Entangling algorithm.</p></li>
<li><p>Key Store is typically a cental key store. You can use the key store to manage license, encryption keys, and Titaniam Server properties.</p></li>
</ul>
</section>
</section>
<section id="planning-your-installation">
<h1>Planning your Installation<a class="headerlink" href="#planning-your-installation" title="Permalink to this heading"></a></h1>
<p>This section covers the following:</p>
<ul class="simple">
<li><p>Layouts: Install the Titaniam Server in a proof-of-concept (POC) layout or a production layout</p></li>
<li><p>Installation Methods: How the Titaniam Server and its components are packaged.</p></li>
</ul>
<section id="layouts">
<h2>Layouts<a class="headerlink" href="#layouts" title="Permalink to this heading"></a></h2>
<p>The Titaniam Server components can be installed in one of two layouts.</p>
<ul class="simple">
<li><p>POC Layout</p></li>
<li><p>Production Layout</p></li>
</ul>
<section id="poc-layout">
<h3>POC Layout<a class="headerlink" href="#poc-layout" title="Permalink to this heading"></a></h3>
<p>You must install all components to run Titaniam Server on a single machine or VM in a POC layout. However, only one instance of each component is installed; therefore, there is no built-in redundancy. The POC layout is suitable for development, functional evaluation, QA, and so on. However, this layout is not ideal for running production environments. And it is also not a realistic setup for performance testing or benchmarking. If the purpose of standing up this is to integrate with an external secret store, an external secret store is required. You do not have to integrate an external secret store for all other usages. A local solution is available.</p>
<blockquote>
<div><img alt="_images/single-node.drawio.png" src="_images/single-node.drawio.png" />
</div></blockquote>
</section>
<section id="production-layout">
<h3>Production Layout<a class="headerlink" href="#production-layout" title="Permalink to this heading"></a></h3>
<p>In this layout, each component is installed with a minimum redundancy of two nodes with a load balancer where necessary. The layout is suitable for production installation and performance
testing. Although an external secret management integration is still optional for performance testing, it is required for production usage. Both Vault nodes and Search nodes can scale horizontally. Vault nodes can be set up to scale automatically based on load characteristics (see <a class="reference external" href="https://aws.amazon.com/ec2/autoscaling/">here</a>. You have to scale up and down the Search nodes manually.</p>
<blockquote>
<div><img alt="_images/high_availability.png" src="_images/high_availability.png" />
</div></blockquote>
</section>
</section>
</section>
<section id="platform-support-matrix">
<span id="ps-matrix"></span><h1>Platform Support Matrix<a class="headerlink" href="#platform-support-matrix" title="Permalink to this heading"></a></h1>
<p>Titaniam server uses and integrates with several third-party products and offerings. This section outlines the supported distributions and versions of such third-party components.</p>
<section id="software-requirements">
<h2>Software Requirements<a class="headerlink" href="#software-requirements" title="Permalink to this heading"></a></h2>
<ul>
<li><p>Host Operating System (for Titaniam Server)</p>
<blockquote>
<div><ul class="simple">
<li><p>CentOS 8.x (Recommended)</p></li>
<li><p>Ubuntu 20.04 LTS+</p></li>
<li><p>RHEL</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Primary Relational Store (You could use an RDS service)</p>
<blockquote>
<div><ul class="simple">
<li><p>Postgres 13.4 (Recommended)</p></li>
<li><p>MySQL 8.0.22 or higher</p></li>
<li><p>MariaDB 10.7</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Titaniam Plugin (Secure Search Engine) for Advanced Analytical Vault installation</p>
<blockquote>
<div><ul class="simple">
<li><p>Elasticsearch 7.9.3+</p></li>
<li><p>OpenDistro for HTTPS</p></li>
<li><p>Kibana for querying Elasticsearch</p></li>
</ul>
</div></blockquote>
</li>
<li><p>External Key Store (for reading Encryption Keys)</p>
<blockquote>
<div><ul class="simple">
<li><p>AWS Secrets Manager</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Load Balancer</p>
<blockquote>
<div><blockquote>
<div><ul class="simple">
<li><p>Elastic network load balancer</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
<li><p>Docker and Docker compose for installing Titaniam Server (see <a class="reference internal" href="#install-docker-os"><span class="std std-ref">Install Docker and Docker Compose</span></a>)</p></li>
<li><p>If deploying on a Kubernetes cluster, you need <code class="docutils literal notranslate"><span class="pre">kubectl</span></code>. You must already have deployed a Kubernetes cluster.</p></li>
<li><p>Java version jdk-8u351 to compile keys and rekeying</p></li>
</ul>
</section>
<section id="hardware-requirements">
<span id="hw-matrix"></span><h2>Hardware Requirements<a class="headerlink" href="#hardware-requirements" title="Permalink to this heading"></a></h2>
<p>Titaniam Server Host Machine</p>
<blockquote>
<div><ul class="simple">
<li><p>t2.2xlarge with EBS GP SSD Volume</p></li>
</ul>
</div></blockquote>
<p>Primary Relational Store</p>
<blockquote>
<div><blockquote>
<div><ul class="simple">
<li><p>AWS db.t3.xlarge</p></li>
<li><p>RDS Provisioned IOPS as needed</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<p>Titaniam Plugin (Secure Search Engine) Host Machine</p>
<blockquote>
<div><ul class="simple">
<li><p>t2.2xlarge with EBS GP SSD Volume</p></li>
</ul>
</div></blockquote>
</section>
<section id="port-number-requirements">
<h2>Port Number Requirements<a class="headerlink" href="#port-number-requirements" title="Permalink to this heading"></a></h2>
<p>This section describes the ports that the Titaniam products use. You must ensure that these ports are available and opened before the installation.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Port Type</p></td>
<td><p>Port Number</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>Titaniam Server</p></td>
<td><p>80 or 443</p></td>
<td><p>Access Titaniam Server at this HTTPS port. You must expose this port to the internet</p></td>
</tr>
<tr class="row-odd"><td><p>Elasticsearch REST API</p></td>
<td><p>9200</p></td>
<td><p>Titaniam Server accesses the search engine on this HTTPS port. Need OpenDistro plugin to enable HTTPS.</p></td>
</tr>
<tr class="row-even"><td><p>Elastic transport port</p></td>
<td><p>9300</p></td>
<td><p>Elasticsearch inter-node communication happens on this port.</p></td>
</tr>
<tr class="row-odd"><td><p>Relational Database</p></td>
<td><p>3306 or 5432</p></td>
<td><p>Titaniam Server accesses the relational data store using secure JDBC. MariaDB uses 3306 and Postgres uses 5432</p></td>
</tr>
<tr class="row-even"><td><p>Encrypted key store</p></td>
<td><p>443</p></td>
<td><p>Titaniam Server accesses external keystore using HTTPS.</p></td>
</tr>
<tr class="row-odd"><td><p>Kibana</p></td>
<td><p>5601</p></td>
<td><p>Kibana is used to query Elasticsearch. This port is needed only if you are evaluating Vault or Elasticsearch Proxy.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="roles">
<h2>Roles<a class="headerlink" href="#roles" title="Permalink to this heading"></a></h2>
<p>The virtual machine where you run the Titaniam Server must have access to the Secrets Manager. Obtain an IAM Role with policy <strong>SecretsManagerReadWrite</strong>. This role allows the Titaniam Server to read and write to AWS Secrets Manager.</p>
<p>If you are using the Titaniam Proxy for the S3 object store, ensure that the virtual machine where you run the Titaniam Server has full access to the S3 object store.</p>
</section>
</section>
<section id="poc-installation-with-secrets-in-local-file-system">
<h1>POC Installation with Secrets in Local File System<a class="headerlink" href="#poc-installation-with-secrets-in-local-file-system" title="Permalink to this heading"></a></h1>
<p>You must install all components required to run Titaniam Server on a single machine or VM in a POC layout. However, only one instance of each component is installed, and therefore there is no built-in redundancy. The POC layout is suitable for development, functional evaluation, QA, and so on. However, this layout is not ideal for running production environments. And it is also not a realistic setup for performance testing or benchmarking. This POC layout includes:</p>
<ul class="simple">
<li><p>Supplying license, encryption keys, and application properties using a local file system.</p></li>
</ul>
<section id="titaniam-server-artifacts">
<h2>Titaniam Server Artifacts<a class="headerlink" href="#titaniam-server-artifacts" title="Permalink to this heading"></a></h2>
<p>You will need the following artifacts:</p>
<ul class="simple">
<li><p>Docker Compose template (Copy from <a class="reference internal" href="#titaniam-file-server"><span class="std std-ref">docker-compose.yml</span></a>)</p></li>
<li><p>Titaniam Properties File (Copy from <a class="reference internal" href="#titaniam-all-props"><span class="std std-ref">Titaniam Properties</span></a>)</p></li>
<li><p>Keyring.json (see <a class="reference internal" href="#keygen2"><span class="std std-ref">Generate an Encrypted Data Encryption Key and Optionally a Master Key</span></a>)</p></li>
</ul>
<p>You will need to obtain the following from Titaniam Support:</p>
<ul class="simple">
<li><p>License file and SHA Checksum</p></li>
<li><p>Titaniam docker images are available in a private repository in Docker Hub. You need an access token to download the images. Contact Titaniam support to get your access token.</p></li>
</ul>
</section>
<section id="install-process">
<h2>Install Process<a class="headerlink" href="#install-process" title="Permalink to this heading"></a></h2>
<ol class="arabic">
<li><p>Store the following files on the local file system:</p>
<ol class="loweralpha simple">
<li><p>License</p></li>
<li><p>Titaniam Server application properties</p></li>
<li><p>Encryption keys</p></li>
</ol>
</li>
<li><p>Install Titaniam Plugin, Kibana, Postgres, and Titaniam Server.</p></li>
<li><p>Configure Titaniam Server as one of the following services:</p>
<blockquote>
<div><ul class="simple">
<li><p>Translation Service</p></li>
<li><p>Vault</p></li>
<li><p>Proxy for the object store</p></li>
<li><p>Elastic Proxy</p></li>
<li><p>Data Protection Service</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Copy and modify the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p></li>
<li><p>Bring up the Titaniam Server service using <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code>.</p></li>
</ol>
<section id="storing-titaniam-license-on-local-file-system">
<span id="license-local"></span><h3>Storing Titaniam License on Local File System<a class="headerlink" href="#storing-titaniam-license-on-local-file-system" title="Permalink to this heading"></a></h3>
<p>Store the license with the value provided by Titaniam on your virtual machine, for example, <code class="docutils literal notranslate"><span class="pre">/home/centos/titaniam_config/license</span></code>.</p>
<section id="example-titaniam-license">
<h4>Example Titaniam License<a class="headerlink" href="#example-titaniam-license" title="Permalink to this heading"></a></h4>
<p>The values provided here are just examples. Edit it to reflect the
license file and SHA that you received from Titaniam Support. Occasionally the license file may include an expiry date. You can leave that in place. It does not affect the behavior.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="s2">&quot;digest&quot;</span><span class="p">:</span> <span class="s2">&quot;P9r7miQDNOf/0HWg8WQjBotJ79PP6WTw+0BQ9VT/fXQ=&quot;</span><span class="p">,</span>

<span class="s2">&quot;license&quot;</span><span class="p">:</span><span class="s2">&quot;vwOraInV23PJ2ePSqHmsnULtSfi98AYO2NHJDCv3f39INv4c9xIGiry3fyW19iZ3nOpIb3QI2akOSg0I6/CZvweoozFtZnP3xqWWXL6t4hhCBNuCdpWGh3XCAVN2xXb5u8S55GjTeWs3IZz5JnHOTSPUCBunicy2TSPNmo/4ScNM7fQagyrqxsiQphq9hnU8vmngQ4E3udqIh086S++2ERk+nki/TDpMWpOxCVcf3ZdnVo+Ra+Tw01MIOxeM3PuRzFMAVJNyGb7BumDfmN6wOlnzpXoVKkDSfQwD1pwkpJcMpKcX8uJMmPo0fJ022w3j0bjMsHy/buMeUybRSdjYUzrIrNosrjDJtoCgel8ygOrscUf9HnJFIziRSd2wCzNpyZyJFUKWhV7LHATPigmeXoHHqWlND0f5YECdvlqLdZXnZllYxuv/xOAIPKzjSyN+GeESmoQavFTNL14XGSKw6Xz825iBdyRJkGW/JsYClBemBRQelgkoxerBTyq80CcSmaie5UdblYuMwTXr13sySWJbX7VdKMKoReRGun+vphHBQnTDPIagb1AiYnsOjSMYdK03SZvGjuujzwRwgn23m9pBJL3iaGTP+1cTrqN/b6FijTsAzxU55Ny3YbQ54f4zM7g0lk0wZepPtPpTG3hx6D83StcNaXRxRx5u3YB5ET8=&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="storing-application-properties-and-service-definitions">
<span id="local-properties-all"></span><h3>Storing Application Properties and Service Definitions<a class="headerlink" href="#storing-application-properties-and-service-definitions" title="Permalink to this heading"></a></h3>
<p>Create a <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file with the <a class="reference internal" href="#titaniam-all-props"><span class="std std-ref">properties</span></a> and store it at a location on your EC2 instance.</p>
</section>
<section id="storing-encryption-keys-in-local-file-system">
<h3>Storing Encryption Keys in Local File System<a class="headerlink" href="#storing-encryption-keys-in-local-file-system" title="Permalink to this heading"></a></h3>
<p>Storing Encrypted Data Keys: Includes a master key (also called as Key Encryption Key, KEK) and one or more data encryption keys. The data encryption keys are encoded using the master key before adding them to the <code class="docutils literal notranslate"><span class="pre">keyring.json</span></code> file. You can select one of the data encryption keys as an active key.</p>
<p>Storing encryption keys involves the following steps:</p>
<ol class="arabic simple">
<li><p>Generate a master key and an encrypted data encryption key. See <a class="reference internal" href="#keygen2"><span class="std std-ref">Generate an Encrypted Data Encryption Key and Optionally a Master Key</span></a>.</p></li>
<li><p>Create a <a class="reference internal" href="#key-ring-json"><span class="std std-ref">Keyring.JSON</span></a> file and update the <code class="docutils literal notranslate"><span class="pre">keyring.json</span></code> file with the output of the previous step.</p></li>
<li><p>Store the <code class="docutils literal notranslate"><span class="pre">keyring.JSON</span></code> file on your EC2 instance.</p></li>
<li><p>Update the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file to mount the <code class="docutils literal notranslate"><span class="pre">keyring.JSON</span></code> file as a volume.</p></li>
</ol>
</section>
</section>
<section id="installing-titaniam-services">
<span id="install-vault-aws-localfile"></span><h2>Installing Titaniam Services<a class="headerlink" href="#installing-titaniam-services" title="Permalink to this heading"></a></h2>
<p>This section explains the overall process to install all Titaniam Server services, Titaniam plugin and Postgres.</p>
<section id="installation-procedure">
<h3>Installation Procedure<a class="headerlink" href="#installation-procedure" title="Permalink to this heading"></a></h3>
<p>Following is the process to install all Titaniam services and the datastore Postgres.</p>
<ol class="arabic">
<li><p>Install docker and docker-compose. See <a class="reference internal" href="#install-docker-os"><span class="std std-ref">Install Docker and Docker Compose</span></a>. Ignore this step if you have already installed docker and docker compose.</p></li>
<li><p>Create the following folders on your virtual machine. These folders are required by Postgres and Titaniam Plugin and Kibana to store data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">postgresql</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="n">main</span>
<span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">arcusdata</span>
<span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">kibanadata</span>
</pre></div>
</div>
</li>
<li><p>Ensure that that user that installs Titaniam Server has ownership and write access to the folders from the previous step. Do the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="mi">1000</span><span class="p">:</span><span class="mi">1000</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">postgresql</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="n">main</span>
<span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="mi">1000</span><span class="p">:</span><span class="mi">1000</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">arcusdata</span>
<span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="mi">1000</span><span class="p">:</span><span class="mi">1000</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">kibanadata</span>
</pre></div>
</div>
</li>
<li><p>Copy this <a class="reference internal" href="#titaniam-all-props"><span class="std std-ref">Titaniam Properties</span></a> file, and modify the following properties if you want to use the S3 proxy service and the data protection service. This example Titaniam.properties file enables all other Titaniam services.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">amazon</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">region</span><span class="o">=&lt;</span><span class="n">bucket</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
<span class="n">amazon</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">access</span><span class="o">-</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">encrypted_access_key_id</span><span class="o">&gt;</span>
<span class="n">amazon</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">secret</span><span class="o">-</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">encrypted_secret_access_key</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Where,</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">amazon.s3.access-key</span></code> and <code class="docutils literal notranslate"><span class="pre">amazon.s3.secret-key</span></code> are the access credentials for AWS S3. Ensure that you encrypt these using the zero-day encryption service. See <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amazon.s3.bucket-name</span></code> is the default S3 bucket name.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
<li><p>Copy this <a class="reference internal" href="#titaniam-file-server"><span class="std std-ref">docker-compose.yml</span></a> file, and modify the location of license and data encryption key.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">arcus</span></code> section</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Volumes</span><span class="p">:</span>

      <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">titaniam</span> <span class="n">licence</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">titaniam</span><span class="o">/</span><span class="n">license</span>
      <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">keyring</span><span class="o">.</span><span class="n">json</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">titaniam</span><span class="o">/</span><span class="n">keyring</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">spectra</span></code> section, specify the Titaniam Server image version and location of license, data encryption key, and properties file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image</span><span class="p">:</span> <span class="n">titaniam</span><span class="o">/</span><span class="n">spectra</span><span class="p">:</span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span>

<span class="n">Volumes</span><span class="p">:</span>

     <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">titaniam</span> <span class="n">licence</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">titaniam</span><span class="o">/</span><span class="n">license</span>
     <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">properties</span> <span class="n">file</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">granger</span><span class="o">/</span><span class="n">application</span><span class="o">.</span><span class="n">properties</span>
     <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">keyring</span><span class="o">.</span><span class="n">json</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">titaniam</span><span class="o">/</span><span class="n">keyring</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
</li>
<li><p>Login to the docker registry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">login</span>
</pre></div>
</div>
</li>
<li><p>At the password prompt, enter the username and personal access token you received.</p></li>
<li><p>Bring up the Titaniam services with the respective <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code>, run the following command with the Titaniam Server service:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</li>
<li><p>To troubleshoot the bring up, open a separate terminal, and run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">granger</span><span class="o">/</span><span class="n">server</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
</li>
<li><p>Create a security group the virtual machine hosting Titaniam Server and create inbound rules to allow traffic on the ports that you have assigned for Titaniam Server (8080). For more information, see <a class="reference external" href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#SecurityGroupRules">this document</a>.</p></li>
<li><p>Send the curl command from the terminal. This command retrieves the product version:</p>
<p>Request</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">location</span> <span class="o">--</span><span class="n">request</span> <span class="n">GET</span> <span class="s1">&#39;http://3.6.94.214:8080/v1/mgmt/version&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p>Response</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">2.3.6_103</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<section id="advanced-configurations">
<h4>Advanced Configurations<a class="headerlink" href="#advanced-configurations" title="Permalink to this heading"></a></h4>
<p>If needed, you can customize the following properties:</p>
<ul class="simple">
<li><p>Use a different datastore such as MariaDB or MYSQL or if you want to change the default username and password, see <a class="reference internal" href="single_node.html#integrate-data-store"><span class="std std-ref">Integrating with the Data Store</span></a>.</p></li>
<li><p>Disable or enable independent Titaniam Services, see <a class="reference internal" href="single_node.html#configure-server"><span class="std std-ref">Step 2: Configure Services</span></a></p></li>
<li><p>Configure additional properties related to Elasticsearch index, logging information, see <a class="reference internal" href="#configure-misc"><span class="std std-ref">Configure Additional Properties in titaniam.properties</span></a>.</p></li>
</ul>
</section>
</section>
</section>
</section>
<section id="poc-installation-with-aws-secrets-manager">
<h1>POC Installation with AWS Secrets Manager<a class="headerlink" href="#poc-installation-with-aws-secrets-manager" title="Permalink to this heading"></a></h1>
<p>This section describes how you can install all Titaniam Server components on a virtual machine.</p>
<section id="id1">
<h2>Titaniam Server Artifacts<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p>Obtain the following installation artifacts from Titaniam support:</p>
<ul>
<li><p>Images:</p>
<blockquote>
<div><ul class="simple">
<li><p>Titaniam-Server</p></li>
</ul>
<ul class="simple">
<li><p>Search Engine with the Titaniam Plugin pre-installed</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Docker Compose template</p></li>
<li><p>License file and SHA Checksum</p></li>
<li><p>Titaniam docker images are available in a private repository in Docker Hub. You need an access token to download the images. Contact Titaniam support to get your access token.</p></li>
</ul>
</section>
<section id="id2">
<h2>Install Process<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h2>
<ol class="arabic">
<li><p>Store the following as secrets:</p>
<ol class="loweralpha simple">
<li><p>License</p></li>
<li><p>Titaniam Server application properties</p></li>
<li><p>Encryption keys</p></li>
</ol>
</li>
<li><p>Configure Titaniam Server as one of the following services:</p>
<blockquote>
<div><ul class="simple">
<li><p>Translation Service</p></li>
<li><p>Vault</p></li>
<li><p>Proxy for the object store</p></li>
<li><p>Elastic Proxy</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Generate the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p></li>
<li><p>Bring up the Titaniam Server service using <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code>.</p></li>
</ol>
<blockquote>
<div></div></blockquote>
</section>
<section id="step-1-supplying-configuration-values-and-keys-using-aws-secrets-manager">
<span id="lic-keys-aws"></span><h2>Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager<a class="headerlink" href="#step-1-supplying-configuration-values-and-keys-using-aws-secrets-manager" title="Permalink to this heading"></a></h2>
<p>Titaniam supports supplying all the application properties, licenses, and encryption keys through a secret entry in AWS Secrets Manager. The advantage of doing this is that you can maintain the configuration settings centrally instead of storing the settings in each server node.</p>
<p>Use this procedure (<span class="xref std std-ref">supplying_secrets</span>) here to create the following new secrets:</p>
<ul class="simple">
<li><p>Titaniam License (see <a class="reference internal" href="single_node.html#license"><span class="std std-ref">Step 1.a: Content of titaniam.license secret</span></a>)</p></li>
<li><p>Data Encryption keys (see <a class="reference internal" href="single_node.html#key-generation"><span class="std std-ref">Step 1.b: Store Encryption Keys</span></a>)</p></li>
<li><p>Configuration properties (see <a class="reference internal" href="single_node.html#configuration-settings"><span class="std std-ref">Step 1.c: Create Configuration Settings</span></a>)</p></li>
</ul>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Next Step: <a class="reference internal" href="single_node.html#configure-server"><span class="std std-ref">Step 2: Configure Services</span></a></p></li>
</ul>
<section id="step-1-a-content-of-titaniam-license-secret">
<span id="license"></span><h3>Step 1.a: Content of titaniam.license secret<a class="headerlink" href="#step-1-a-content-of-titaniam-license-secret" title="Permalink to this heading"></a></h3>
<p>The following content can be copied and pasted as a secret named <code class="docutils literal notranslate"><span class="pre">titaniam.license</span></code> in the PlainText view.</p>
<p>The secret name can be of the following formats:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam.license</span></code>. <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;</span></code> is the value of the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> from the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.license</span></code> if you have not specified the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code>.</p></li>
</ul>
<p>The values provided here are just examples. Edit it to reflect the
license file and SHA that you received from Titaniam Support before you
save the secret. Occasionally the license file may include an expiry date. You can leave that in place. It does not affect the behavior.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="s2">&quot;digest&quot;</span><span class="p">:</span> <span class="s2">&quot;P9r7miQDNOf/0HWg8WQjBotJ79PP6WTw+0BQ9VT/fXQ=&quot;</span><span class="p">,</span>

<span class="s2">&quot;license&quot;</span><span class="p">:</span><span class="s2">&quot;vwOraInV23PJ2ePSqHmsnULtSfi98AYO2NHJDCv3f39INv4c9xIGiry3fyW19iZ3nOpIb3QI2akOSg0I6/CZvweoozFtZnP3xqWWXL6t4hhCBNuCdpWGh3XCAVN2xXb5u8S55GjTeWs3IZz5JnHOTSPUCBunicy2TSPNmo/4ScNM7fQagyrqxsiQphq9hnU8vmngQ4E3udqIh086S++2ERk+nki/TDpMWpOxCVcf3ZdnVo+Ra+Tw01MIOxeM3PuRzFMAVJNyGb7BumDfmN6wOlnzpXoVKkDSfQwD1pwkpJcMpKcX8uJMmPo0fJ022w3j0bjMsHy/buMeUybRSdjYUzrIrNosrjDJtoCgel8ygOrscUf9HnJFIziRSd2wCzNpyZyJFUKWhV7LHATPigmeXoHHqWlND0f5YECdvlqLdZXnZllYxuv/xOAIPKzjSyN+GeESmoQavFTNL14XGSKw6Xz825iBdyRJkGW/JsYClBemBRQelgkoxerBTyq80CcSmaie5UdblYuMwTXr13sySWJbX7VdKMKoReRGun+vphHBQnTDPIagb1AiYnsOjSMYdK03SZvGjuujzwRwgn23m9pBJL3iaGTP+1cTrqN/b6FijTsAzxU55Ny3YbQ54f4zM7g0lk0wZepPtPpTG3hx6D83StcNaXRxRx5u3YB5ET8=&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
</section>
<section id="step-1-b-store-encryption-keys">
<span id="key-generation"></span><h3>Step 1.b: Store Encryption Keys<a class="headerlink" href="#step-1-b-store-encryption-keys" title="Permalink to this heading"></a></h3>
<p>You have two options of using the data encryption keys.</p>
<ul>
<li><p>Option 1, Storing Encrypted Data Keys: Includes a master key (also called as Key Encryption Key, KEK) and one or more data encryption keys. The data encryption keys are encoded using the master key before adding them to the AWS Secrets Manager. You can select one of the data encryption keys as an active key.</p>
<blockquote>
<div><ol class="arabic">
<li><p>Generate an encrypted data encryption key and optionally a master key. If you have an existing master key, you can choose not to generate the master key. See <a class="reference internal" href="#keygen2"><span class="std std-ref">Generate an Encrypted Data Encryption Key and Optionally a Master Key</span></a>.</p></li>
<li><p>Store the master key as <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code> or <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code>. This key is the master encryption key.</p></li>
<li><p>Store the encrypted data key as a secret: <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code>.</p>
<p>Titaniam Server uses only keys that have the <code class="docutils literal notranslate"><span class="pre">Active</span></code> tag.</p>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Option 2, Storing Plain Data Keys: Generate a data encryption key and store it as a Secret in the AWS Secrets Manager. You are not encrypting the data encryption key with a master key in this case. See <a class="reference internal" href="#master-key"><span class="std std-ref">Generate Keys</span></a>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="lowerroman simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;</span></code> is the string from the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file. If you have not mentioned the <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> property, the secret name must be of the format <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code> for data encryption key and <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code> for master encryption key.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam_key_ring</span></code> must be entered <strong>as is</strong>. This is the namespace that Titaniam server looks for when loading the encryption keys.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;keyring_name&gt;</span></code> is the name of the keyring. This name distinguishes different Titaniam installations. Decide a name for the Titaniam Server installation (for example <cite>production_finance</cite>, <cite>dev_sandbox</cite>).</p></li>
</ol>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
</section>
<section id="step-1-c-create-configuration-settings">
<span id="configuration-settings"></span><h3>Step 1.c: Create Configuration Settings<a class="headerlink" href="#step-1-c-create-configuration-settings" title="Permalink to this heading"></a></h3>
<p>Populate the rest of the configuration settings in a secret.</p>
<ol class="arabic simple">
<li><p>Create a new secret called <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code>.</p></li>
<li><p>Copy and paste the <a class="reference internal" href="#sdss-properties"><span class="std std-ref">titaniam.properties Secret</span></a>
to the secret using PlainText view.</p></li>
<li><p>Edit the entries to reflect your installation reality. Pay attention
to these specifically:</p>
<ul class="simple">
<li><p><a class="reference internal" href="single_node.html#integrate-data-store"><span class="std std-ref">Integrating with the Data Store</span></a></p></li>
<li><p><a class="reference internal" href="#mtls"><span class="std std-ref">Configure TLS and mTLS Authentication</span></a></p></li>
<li><p><a class="reference internal" href="#auth-token"><span class="std std-ref">Configure Authorization</span></a></p></li>
<li><p><a class="reference internal" href="#configure-misc"><span class="std std-ref">Configure Additional Properties in titaniam.properties</span></a></p></li>
</ul>
</li>
<li><p>Save the secret.</p></li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
<blockquote>
<div></div></blockquote>
<section id="integrating-with-the-data-store">
<span id="integrate-data-store"></span><h4>Integrating with the Data Store<a class="headerlink" href="#integrating-with-the-data-store" title="Permalink to this heading"></a></h4>
<p>Titaniam Server uses a datastore to store the metadata and schema versions. After you install the Titaniam Server, you must ensure that the Titaniam Server can communicate with the data store.</p>
<ol class="arabic">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file and edit the sections corresponding to the database you are using.</p></li>
<li><p>(If using MySQL) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:mysql:&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.MySQL57InnoDBDialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
<li><p>(If using MariaDB) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:mariadb:&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;org.mariadb.jdbc.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.MariaDB53Dialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
<li><p>(If using PostgreSQL) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:postgresql&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;org.postgresql.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.PostgreSQL10Dialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
</ol>
<p>Where,</p>
<ul>
<li><p>&lt;database_URL&gt; is the URL (including the port) where you can access the database. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">PostgresSQL</span><span class="p">)</span><span class="c1">#spring.datasource.url=jdbc:postgresql://tlab1/titaniam_v1</span>
<span class="p">(</span><span class="n">MySQL</span><span class="p">)</span>      <span class="c1">#spring.datasource.url=jdbc:mysql://localhost:3306/testdb</span>
<span class="p">(</span><span class="n">MariaDB</span><span class="p">)</span>    <span class="c1">#spring.datasource.url=jdbc:mariadb://localhost:3306/testdb</span>
</pre></div>
</div>
</li>
<li><p>&lt;username&gt; is the username for accessing the database.</p></li>
<li><p>&lt;password&gt; is the password required to access the database.</p></li>
</ul>
</section>
</section>
</section>
<section id="step-2-configure-services">
<span id="configure-server"></span><h2>Step 2: Configure Services<a class="headerlink" href="#step-2-configure-services" title="Permalink to this heading"></a></h2>
<p>You can choose to configure Titaniam Server as one of the following services:</p>
<ul class="simple">
<li><p>Translation Service</p></li>
<li><p>Vault</p></li>
<li><p>Proxy for the object store</p></li>
<li><p>Elastic Proxy</p></li>
</ul>
<p>The following subsections describe the properties needed for each of the services:</p>
<ul class="simple">
<li><p><a class="reference internal" href="single_node.html#api-service"><span class="std std-ref">Step 2: Configure Service: Translation Service</span></a></p></li>
<li><p><a class="reference internal" href="single_node.html#sdss-vault"><span class="std std-ref">Step 2: Configure Service: Configure as a Vault</span></a></p></li>
<li><p><a class="reference internal" href="single_node.html#proxy-s3"><span class="std std-ref">Step 2: Configure Service: Proxy for the S3 Object Store</span></a></p></li>
<li><p><a class="reference internal" href="single_node.html#es-proxy"><span class="std std-ref">Step 2: Configure Service: Elastic Proxy</span></a></p></li>
<li><p><a class="reference internal" href="single_node.html#dp-service"><span class="std std-ref">Step 2: Configure Service: Data Protection Service for Object Store</span></a></p></li>
</ul>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#lic-keys-aws"><span class="std std-ref">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#compile-docker"><span class="std std-ref">Step 3: Compose the docker-compose.yml File</span></a></p></li>
</ul>
<section id="step-2-configure-service-translation-service">
<span id="api-service"></span><h3>Step 2: Configure Service: Translation Service<a class="headerlink" href="#step-2-configure-service-translation-service" title="Permalink to this heading"></a></h3>
<p>You must set the following property in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file and disable the other services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">panther</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#lic-keys-aws"><span class="std std-ref">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#compile-docker"><span class="std std-ref">Step 3: Compose the docker-compose.yml File</span></a></p></li>
</ul>
</section>
<section id="step-2-configure-service-configure-as-a-vault">
<span id="sdss-vault"></span><h3>Step 2: Configure Service: Configure as a Vault<a class="headerlink" href="#step-2-configure-service-configure-as-a-vault" title="Permalink to this heading"></a></h3>
<p>Enable the vault service. Set the following property in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">sdv</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<section id="configure-secure-search-index">
<h4>Configure Secure Search Index<a class="headerlink" href="#configure-secure-search-index" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>When you configure Titaniam Server as a vault, you must also configure a secure search index (Titaniam plugin integrated with Elasticsearch). You must configure the following:</p>
</div></blockquote>
<ol class="arabic">
<li><p>Configure the following properties in the <cite>arcus:</cite> section of the <cite>docker_compose_yml</cite> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">aws_region</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">2</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">keyring</span><span class="o">.</span><span class="n">name</span><span class="o">=&lt;</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">aws</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">access</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_ACCESS_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">secret</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_SECRET_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">arcus01</span>
<span class="o">-</span> <span class="n">http</span><span class="o">.</span><span class="n">port</span><span class="o">=</span><span class="mi">9200</span>
</pre></div>
</div>
</li>
<li><p>Configure the following property in the <code class="docutils literal notranslate"><span class="pre">spectra:</span></code> section of the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>- spring.elasticsearch.rest.uris`: this property must match the IP and port of the elastic configured in the `arcus` section.
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">spring</span><span class="o">.</span><span class="n">elasticsearch</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">uris</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">arcus</span><span class="p">:</span><span class="mi">9200</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#lic-keys-aws"><span class="std std-ref">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#compile-docker"><span class="std std-ref">Step 3: Compose the docker-compose.yml File</span></a></p></li>
</ul>
</section>
</section>
<section id="step-2-configure-service-proxy-for-the-s3-object-store">
<span id="proxy-s3"></span><h3>Step 2: Configure Service: Proxy for the S3 Object Store<a class="headerlink" href="#step-2-configure-service-proxy-for-the-s3-object-store" title="Permalink to this heading"></a></h3>
<p>You can use the Titaniam Server as an S3 proxy to protect any requests to an S3 bucket in the specified region. The following diagrams illustrate the configuration with and without the Titaniam Server as a proxy. When the Titaniam Server is configured as an proxy, it passes through the endpoint requests except the PUTObject and GETObject endpoints. These endpoints are intercepted by the Titaniam Proxy for S3 and the data is encrypted and decrypted.</p>
<img alt="_images/proxy.png" src="_images/proxy.png" />
<p>Enable the proxy service. You must set the following property and disable other services in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      - ripple.enabled=true
- amazon.s3.bucket-name=[bucket_name]
- amazon.s3.access-key=[access_key_id]
- amazon.s3.secret-key=[secret_access_key]

Where,

   * ``amazon.s3.access-key`` and ``amazon.s3.secret-key`` are the access credentials for AWS S3. Ensure that you encrypt these using the zero-day encryption service. See :ref:`zero-day-encrypt`.
   * ``amazon.s3.bucket-name``=&lt;bucket_name&gt; is the S3 bucket name.
</pre></div>
</div>
<section id="configure-your-application-to-route-traffic-to-titaniam-s3-proxy">
<h4>Configure your Application to Route Traffic to Titaniam S3 Proxy<a class="headerlink" href="#configure-your-application-to-route-traffic-to-titaniam-s3-proxy" title="Permalink to this heading"></a></h4>
<p>In your application, you must override the existing endpoint URL. You must now point the endpoint URL to the Titaniam S3 Proxy.</p>
<p><strong>If you are using AWS SDK V1</strong>, modify the endpoint URL as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AmazonS3</span> <span class="n">s3</span> <span class="o">=</span> <span class="n">AmazonS3ClientBuilder</span><span class="o">.</span><span class="n">standard</span><span class="p">()</span>
   <span class="o">.</span><span class="n">withEndpointConfiguration</span><span class="p">(</span><span class="n">new</span> <span class="n">EndpointConfiguration</span><span class="p">(</span>
        <span class="s2">&quot;{{secureStoreURL}}/v2/titaniam-s3-proxy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">))</span>
   <span class="o">.</span><span class="n">withCredentials</span><span class="p">(</span><span class="n">CREDENTIALS_PROVIDER</span><span class="p">)</span>
   <span class="o">.</span><span class="n">build</span><span class="p">();</span>
</pre></div>
</div>
<p>Where, you <code class="docutils literal notranslate"><span class="pre">{secureStoreURL}}/v2/titaniam-s3-proxy</span></code> points to the Titaniam S3 Proxy URL.</p>
<p><strong>If you are using AWS SDK V2</strong>, modify the endpoint URL as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">URI</span> <span class="n">endpointOverride</span> <span class="o">=</span> <span class="n">new</span> <span class="n">URI</span><span class="p">(</span><span class="s2">&quot;{{secureStoreURL}}/v2/titaniam-s3-proxy&quot;</span><span class="p">);</span>
<span class="n">S3Client</span><span class="o">.</span><span class="n">builder</span><span class="p">()</span>
<span class="o">.</span><span class="n">credentialsProvider</span><span class="p">(</span><span class="n">CREDENTIALS_PROVIDER</span><span class="p">)</span>
<span class="o">.</span><span class="n">endpointOverride</span><span class="p">(</span><span class="n">endpointOverride</span><span class="p">)</span>
<span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
<span class="o">.</span><span class="n">build</span><span class="p">();</span>
</pre></div>
</div>
<p>Where, you <code class="docutils literal notranslate"><span class="pre">{secureStoreURL}}/v2/titaniam-s3-proxy</span></code> points to the Titaniam S3 Proxy URL.</p>
<p><strong>If you are using boto3</strong>, modify the endpoint URL during client creation as described <a class="reference external" href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/core/session.html">here</a>.</p>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#lic-keys-aws"><span class="std std-ref">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#compile-docker"><span class="std std-ref">Step 3: Compose the docker-compose.yml File</span></a></p></li>
</ul>
</section>
</section>
<section id="step-2-configure-service-elastic-proxy">
<span id="es-proxy"></span><h3>Step 2: Configure Service: Elastic Proxy<a class="headerlink" href="#step-2-configure-service-elastic-proxy" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>When you configure Titaniam Server as an elastic proxy, you must configure the following properties:</p>
</div></blockquote>
<ol class="arabic">
<li><p>Create a folder on your virtual machine: <code class="docutils literal notranslate"><span class="pre">/var/lib/arcusdata</span></code>.</p></li>
<li><p>Enable the elastic proxy service. Disable the other services. Set the following property in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">esproxy</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Configure the location of the keys:</p>
<blockquote>
<div><ol class="loweralpha">
<li><p>(Optional) If you are using the active key from the AWS Secrets Manager, Configure the following properties in the <code class="docutils literal notranslate"><span class="pre">arcus:</span></code> section of the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">aws_region</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">2</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">keyring</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">vault</span><span class="o">-</span><span class="n">singlenode</span><span class="o">-</span><span class="n">byok</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">aws</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">access</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_ACCESS_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">secret</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_SECRET_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">arcus01</span>
<span class="o">-</span> <span class="n">http</span><span class="o">.</span><span class="n">port</span><span class="o">=</span><span class="mi">9200</span>
<span class="o">-</span> <span class="n">indices</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">bool</span><span class="o">.</span><span class="n">max_clause_count</span><span class="o">=</span><span class="mi">2000</span>
</pre></div>
</div>
</li>
<li><p>(Optional) If using byok (bring your own key) mode,</p>
<ol class="lowerroman">
<li><p>In your <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file, configure the following lines of code in the <cite>arcus</cite> section:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># byok configuration</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">byok</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">host</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">arcus</span><span class="p">:</span><span class="mi">9200</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">byok</span><span class="o">.</span><span class="n">refresh</span><span class="o">-</span><span class="n">secs</span><span class="o">=</span><span class="mi">30</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>In your <cite>docker-compose.yml</cite> file, configure the following lines of code in the <cite>spectra</cite> section:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># byok configuration</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">byok</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">byok</span><span class="o">.</span><span class="n">host</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">arcus</span><span class="p">:</span><span class="mi">9200</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">byok</span><span class="o">.</span><span class="n">refresh</span><span class="o">-</span><span class="n">secs</span><span class="o">=</span><span class="mi">30</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Configure the following property in the <code class="docutils literal notranslate"><span class="pre">spectra:</span></code> section of the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">spring.elasticsearch.rest.uris=http://arcus:9200</span></code> indicates the URL of the Titaniam plugin.</p></li>
<li><p>(Optional) <code class="docutils literal notranslate"><span class="pre">sdss.es.login=admin</span></code> indicates the admin login of the elastic node. This property is required only if you have installed Elasticsearch with authentication.</p></li>
<li><p>(Optional) <code class="docutils literal notranslate"><span class="pre">sdss.es.password</span></code> provide the password after encrypting it with the master encryption key. This property is required only if you have installed Elasticsearch with authentication.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.search.proxy.override.fields.&lt;INDEX_NAME&gt;.&lt;ABSOLUTE_FIELD_NAME&gt;=&lt;OVERRIDE_TYPE&gt;</span></code> specify any field properties in the elastic index that you want to override. For example, to return the values from the index as integers or boolean formats instead of strings. For example,</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sdss</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">proxy</span><span class="o">.</span><span class="n">override</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">example_index</span><span class="o">.</span><span class="n">days</span><span class="o">=</span><span class="n">integer</span>
<span class="n">sdss</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">proxy</span><span class="o">.</span><span class="n">override</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">example_index</span><span class="o">.</span><span class="n">hours</span><span class="o">=</span><span class="n">integer</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#byok-keys"><span class="std std-ref">Bring Your Own Keys</span></a></p></li>
<li><p>Previous Step: <a class="reference internal" href="#lic-keys-aws"><span class="std std-ref">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#compile-docker"><span class="std std-ref">Step 3: Compose the docker-compose.yml File</span></a></p></li>
</ul>
</section>
<section id="step-2-configure-service-data-protection-service-for-object-store">
<span id="dp-service"></span><h3>Step 2: Configure Service: Data Protection Service for Object Store<a class="headerlink" href="#step-2-configure-service-data-protection-service-for-object-store" title="Permalink to this heading"></a></h3>
<p>The Titaniam Server can be used as a data protection service for an object store. The data protection service for object stores lets you encrypt and decrypt objects in your object stores. Currently, AWS S3 is supported. This service lets you do the following operations:</p>
<ul class="simple">
<li><p>Encrypt an object in-place in the object store. You must pass on the object reference to the data protection service.</p></li>
<li><p>Generate an encoded URI to an object. You can use this URI to download the object in clear format.</p></li>
</ul>
<p>To enable the data-protection service, do the following:</p>
<ol class="arabic">
<li><p>(Configure at least one object store service) For example, If you are protecting objects in an AWS S3 object store, you must configure the Titaniam S3 proxy related properties (see <span class="xref std std-ref">_proxy_s3</span>).</p></li>
<li><p>Set the following property file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sdss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">protection</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#lic-keys-aws"><span class="std std-ref">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#compile-docker"><span class="std std-ref">Step 3: Compose the docker-compose.yml File</span></a></p></li>
</ul>
</section>
</section>
<section id="step-3-compose-the-docker-compose-yml-file">
<span id="compile-docker"></span><h2>Step 3: Compose the docker-compose.yml File<a class="headerlink" href="#step-3-compose-the-docker-compose-yml-file" title="Permalink to this heading"></a></h2>
<p>Specify the location of the encryption keys and <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> in the Secrets Manager in a <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p>
<p>For examples of the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> files, see <a class="reference internal" href="#example-compose"><span class="std std-ref">Appendix: Example Docker Compose YML Files and Property Files</span></a>.</p>
<ol class="arabic">
<li><p>Set the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">properties</span><span class="o">-</span><span class="n">source</span><span class="o">=</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">secretsmanager</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">keyname</span><span class="o">=</span><span class="n">titaniam</span><span class="o">.</span><span class="n">properties</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">region</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">2</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">=&lt;</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">aws</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">access</span><span class="o">-</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">AWS_ACCESS_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">secret</span><span class="o">-</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">AWS_SECRET_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span>
</pre></div>
</div>
</li>
</ol>
<p>Where,</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.properties-source</span></code> indicates that the configuration properties are stored in the AWS Secrets Manager.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.secretsmanager.properties.keyname</span></code> specifies the key name of the configuration properties file. This must be set to <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.region</span></code> indicates the region of the AWS machines.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.keyring-name</span></code> indicates the &lt;keyring_name&gt; from the Secrets Manager. Secret name is of the format - <cite>titaniam_key_ring/&lt;keyring_name&gt;/&lt;key_name&gt;</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.seed.store.type</span></code> specifies that the keystore is in AWS.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.access-key</span></code> specifies the encrypted access key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.secret-key</span></code> specifies the encrypted secret key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> specifies the prefix path to secrets in AWS Secrets Manager. For example if you have specify <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix=prefix1</span></code>, you must store the titaniam.license in AWS Secrets as <code class="docutils literal notranslate"><span class="pre">&lt;prefix1&gt;titaniam.licence</span></code>. Encryptions keys as <code class="docutils literal notranslate"><span class="pre">&lt;prefix1&gt;titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code>.</p></li>
</ul>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="single_node.html#configure-server"><span class="std std-ref">Step 2: Configure Services</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#install-docker"><span class="std std-ref">Step 4: Deploy Titaniam Server using Docker</span></a></p></li>
</ul>
</section>
<section id="step-4-deploy-titaniam-server-using-docker">
<span id="install-docker"></span><h2>Step 4: Deploy Titaniam Server using Docker<a class="headerlink" href="#step-4-deploy-titaniam-server-using-docker" title="Permalink to this heading"></a></h2>
<p>This section explains how to bring up the Titanaim Server service using docker.</p>
<section id="install-titaniam-server-without-bringing-up-the-titaniam-services">
<h3>Install Titaniam Server without Bringing up the Titaniam Services<a class="headerlink" href="#install-titaniam-server-without-bringing-up-the-titaniam-services" title="Permalink to this heading"></a></h3>
<p>If you are interested in pulling in the Titaniam Server docker image but not bringing up Titaniam Server, do the following as a root user:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">titaniam</span><span class="o">/</span><span class="n">spectra</span><span class="p">:</span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>You must replace <em>version</em> with the actual version number. Contact Titaniam Support if needed.</p>
</section>
<section id="install-titaniam-server">
<h3>Install Titaniam Server<a class="headerlink" href="#install-titaniam-server" title="Permalink to this heading"></a></h3>
<p>As a root user, run the docker-compose image:</p>
<ol class="arabic">
<li><p>Login to the docker registry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">login</span>
</pre></div>
</div>
</li>
<li><p>At the password prompt, enter the username and personal access token you received.</p></li>
<li><p>(Only if you are running the services as Vault or Elasticsearch proxy), bring up the Titaniam service with the plugin <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file. Use the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</li>
<li><p>Bring up the Titaniam Server service with the respective <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code>, run the following command with the Titaniam Server service:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="post-installation-steps">
<h2>Post-Installation Steps<a class="headerlink" href="#post-installation-steps" title="Permalink to this heading"></a></h2>
<p>This chapter describes the following:</p>
<ul class="simple">
<li><p>Accessing the Logs</p></li>
<li><p>Verifying the Installation</p></li>
</ul>
<section id="logs">
<h3>Logs<a class="headerlink" href="#logs" title="Permalink to this heading"></a></h3>
<p>All logs are handled by the docker logs. See <a class="reference external" href="https://docs.docker.com/config/containers/logging/">docker log documentation</a>.</p>
<p>Run the following command tocheck logs for your container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">logs</span> <span class="o">-</span><span class="n">f</span> <span class="o">&lt;</span><span class="n">container_name</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="verifying-the-installation-for-vault-and-translation-services">
<h3>Verifying the Installation for Vault and Translation Services<a class="headerlink" href="#verifying-the-installation-for-vault-and-translation-services" title="Permalink to this heading"></a></h3>
<p>Perform the following steps to verify that the installation is successful, send the following CURL request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">location</span> <span class="o">--</span><span class="n">request</span> <span class="n">GET</span> <span class="s1">&#39;http:/&lt;baseURL&gt;:8080/actuator/health&#39;</span>
</pre></div>
</div>
<p>You must receive a response similar to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span><span class="p">,</span>

<span class="s2">&quot;components&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span><span class="p">,</span>

<span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="s2">&quot;PostgreSQL&quot;</span><span class="p">,</span>

<span class="s2">&quot;validationQuery&quot;</span><span class="p">:</span> <span class="s2">&quot;isValid()&quot;</span>

<span class="p">}</span>

<span class="p">},</span>

<span class="s2">&quot;diskSpace&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span><span class="p">,</span>

<span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">53675536384</span><span class="p">,</span>

<span class="s2">&quot;free&quot;</span><span class="p">:</span> <span class="mi">7795793920</span><span class="p">,</span>

<span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mi">10485760</span><span class="p">,</span>

<span class="s2">&quot;exists&quot;</span><span class="p">:</span> <span class="n">true</span>

<span class="p">}</span>

<span class="p">},</span>

<span class="s2">&quot;ping&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span>

<span class="p">}</span>

<span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="production-installation-using-kubernetes">
<h1>Production Installation Using Kubernetes<a class="headerlink" href="#production-installation-using-kubernetes" title="Permalink to this heading"></a></h1>
<p>This section describes how you can deploy Titaniam Server using Kubernetes and Helm charts</p>
<section id="production-installation-instructions">
<span id="install-prod"></span><h2>Production Installation Instructions<a class="headerlink" href="#production-installation-instructions" title="Permalink to this heading"></a></h2>
<p>This section explains the overall process to install Titaniam Server in a high-availability production environment. You can supply  all the application properties, license, and encryption keys to Titaniam Server through a secret entry in a secrets manager.</p>
<section id="id3">
<h3>Titaniam Server Artifacts<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h3>
<p>Obtain the following installation artifacts from Titaniam support:</p>
<ul class="simple">
<li><p>License file and SHA Checksum</p></li>
<li><p>Access token to retrieve the Titaniam Server images are available in a private repository in Docker Hub. You need an access token to download the images. Contact Titaniam support to get your access token.</p></li>
</ul>
</section>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Read this <a class="reference internal" href="#ps-matrix"><span class="std std-ref">Platform Support Matrix</span></a>.</p></li>
<li><p>Ensure that you are familiar with deployed a kubenetes cluster.</p></li>
</ul>
<ul class="simple">
<li><p>Ensure that the each node in your kubernetes cluster where you run Titaniam Server must have access to the Secrets Manager. Obtain an IAM Role with policy <strong>SecretsManagerReadWrite</strong>. This role allows the Titaniam Server to read and write to AWS Secrets Manager.</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">kubectl</span></code> to deploy Titaniam Server on your Kubernetes cluster.</p></li>
</ul>
</section>
<section id="id4">
<h3>Install Titaniam Server<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h3>
<p>Following is the process to install Titaniam Server.</p>
<ol class="arabic">
<li><p>Store the following as secrets or keys:</p>
<ol class="loweralpha simple">
<li><p>License</p></li>
<li><p>Titaniam Server application properties</p></li>
<li><p>Encryption keys</p></li>
</ol>
</li>
<li><p>Integrate with the datastore.</p></li>
<li><p>Configure Titaniam Server as one of the following services:</p>
<blockquote>
<div><ul class="simple">
<li><p>Translation Service</p></li>
<li><p>Vault</p></li>
<li><p>Proxy for the object store</p></li>
<li><p>Elastic Proxy</p></li>
</ul>
</div></blockquote>
</li>
<li><p>(Optional) Configure the mTLS parameters if required.</p></li>
<li><p>Specify the location of the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> and encryption keys in the <code class="docutils literal notranslate"><span class="pre">spectra-configmap.yaml</span></code> file.</p></li>
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">spectra-secret.yaml</span></code> file to store your access token in base64 format.</p></li>
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">spectra-service.yaml</span></code> file to ensure that the Titaniam Server service is accessible from outside the kubernetes cluster.</p></li>
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">spectra-deployment.yaml</span></code> file to fill in the image details.</p></li>
<li><p>Deploy Titaniam Server using <code class="docutils literal notranslate"><span class="pre">kubectl</span></code> or <code class="docutils literal notranslate"><span class="pre">helm</span></code> charts.</p></li>
</ol>
<blockquote>
<div></div></blockquote>
</section>
</section>
<section id="lic-keys-aws-ec2">
<span id="id5"></span><h2>Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager<a class="headerlink" href="#lic-keys-aws-ec2" title="Permalink to this heading"></a></h2>
<p>Titaniam supports supplying all the application properties, licenses, and encryption keys through a secret entry in AWS Secrets Manager. The advantage of doing this is that you can maintain the configuration settings centrally instead of storing the settings in each server node.</p>
<p>Use this procedure (<span class="xref std std-ref">supplying_secrets</span>) here to create the following new secrets:</p>
<ul class="simple">
<li><p>Titaniam License (see <a class="reference internal" href="single_node.html#license"><span class="std std-ref">Step 1.a: Content of titaniam.license secret</span></a>)</p></li>
<li><p>Data Encryption keys (see <a class="reference internal" href="single_node.html#key-generation"><span class="std std-ref">Step 1.b: Store Encryption Keys</span></a>)</p></li>
<li><p>Configuration properties (see <a class="reference internal" href="single_node.html#configuration-settings"><span class="std std-ref">Step 1.c: Create Configuration Settings</span></a>)</p></li>
</ul>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Next Step: <a class="reference internal" href="single_node.html#configure-server"><span class="std std-ref">Step 2: Configure Services</span></a></p></li>
</ul>
<section id="id6">
<span id="id7"></span><h3>Step 1.a: Content of titaniam.license secret<a class="headerlink" href="#id6" title="Permalink to this heading"></a></h3>
<p>The following content can be copied and pasted as a secret named <code class="docutils literal notranslate"><span class="pre">titaniam.license</span></code> in the PlainText view.</p>
<p>The secret name can be of the following formats:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam.license</span></code>. <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;</span></code> is the value of the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> from the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.license</span></code> if you have not specified the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code>.</p></li>
</ul>
<p>The values provided here are just examples. Edit it to reflect the
license file and SHA that you received from Titaniam Support before you
save the secret. Occasionally the license file may include an expiry date. You can leave that in place. It does not affect the behavior.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="s2">&quot;digest&quot;</span><span class="p">:</span> <span class="s2">&quot;P9r7miQDNOf/0HWg8WQjBotJ79PP6WTw+0BQ9VT/fXQ=&quot;</span><span class="p">,</span>

<span class="s2">&quot;license&quot;</span><span class="p">:</span><span class="s2">&quot;vwOraInV23PJ2ePSqHmsnULtSfi98AYO2NHJDCv3f39INv4c9xIGiry3fyW19iZ3nOpIb3QI2akOSg0I6/CZvweoozFtZnP3xqWWXL6t4hhCBNuCdpWGh3XCAVN2xXb5u8S55GjTeWs3IZz5JnHOTSPUCBunicy2TSPNmo/4ScNM7fQagyrqxsiQphq9hnU8vmngQ4E3udqIh086S++2ERk+nki/TDpMWpOxCVcf3ZdnVo+Ra+Tw01MIOxeM3PuRzFMAVJNyGb7BumDfmN6wOlnzpXoVKkDSfQwD1pwkpJcMpKcX8uJMmPo0fJ022w3j0bjMsHy/buMeUybRSdjYUzrIrNosrjDJtoCgel8ygOrscUf9HnJFIziRSd2wCzNpyZyJFUKWhV7LHATPigmeXoHHqWlND0f5YECdvlqLdZXnZllYxuv/xOAIPKzjSyN+GeESmoQavFTNL14XGSKw6Xz825iBdyRJkGW/JsYClBemBRQelgkoxerBTyq80CcSmaie5UdblYuMwTXr13sySWJbX7VdKMKoReRGun+vphHBQnTDPIagb1AiYnsOjSMYdK03SZvGjuujzwRwgn23m9pBJL3iaGTP+1cTrqN/b6FijTsAzxU55Ny3YbQ54f4zM7g0lk0wZepPtPpTG3hx6D83StcNaXRxRx5u3YB5ET8=&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
</section>
<section id="id8">
<span id="id9"></span><h3>Step 1.b: Store Encryption Keys<a class="headerlink" href="#id8" title="Permalink to this heading"></a></h3>
<p>You have two options of using the data encryption keys.</p>
<ul>
<li><p>Option 1, Storing Encrypted Data Keys: Includes a master key (also called as Key Encryption Key, KEK) and one or more data encryption keys. The data encryption keys are encoded using the master key before adding them to the AWS Secrets Manager. You can select one of the data encryption keys as an active key.</p>
<blockquote>
<div><ol class="arabic">
<li><p>Generate an encrypted data encryption key and optionally a master key. If you have an existing master key, you can choose not to generate the master key. See <a class="reference internal" href="#keygen2"><span class="std std-ref">Generate an Encrypted Data Encryption Key and Optionally a Master Key</span></a>.</p></li>
<li><p>Store the master key as <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code> or <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code>. This key is the master encryption key.</p></li>
<li><p>Store the encrypted data key as a secret: <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code>.</p>
<p>Titaniam Server uses only keys that have the <code class="docutils literal notranslate"><span class="pre">Active</span></code> tag.</p>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Option 2, Storing Plain Data Keys: Generate a data encryption key and store it as a Secret in the AWS Secrets Manager. You are not encrypting the data encryption key with a master key in this case. See <a class="reference internal" href="#master-key"><span class="std std-ref">Generate Keys</span></a>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="lowerroman simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;</span></code> is the string from the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file. If you have not mentioned the <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> property, the secret name must be of the format <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code> for data encryption key and <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code> for master encryption key.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam_key_ring</span></code> must be entered <strong>as is</strong>. This is the namespace that Titaniam server looks for when loading the encryption keys.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;keyring_name&gt;</span></code> is the name of the keyring. This name distinguishes different Titaniam installations. Decide a name for the Titaniam Server installation (for example <cite>production_finance</cite>, <cite>dev_sandbox</cite>).</p></li>
</ol>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
</section>
<section id="id10">
<span id="id11"></span><h3>Step 1.c: Create Configuration Settings<a class="headerlink" href="#id10" title="Permalink to this heading"></a></h3>
<p>Populate the rest of the configuration settings in a secret.</p>
<ol class="arabic simple">
<li><p>Create a new secret called <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code>.</p></li>
<li><p>Copy and paste the <a class="reference internal" href="#sdss-properties"><span class="std std-ref">titaniam.properties Secret</span></a>
to the secret using PlainText view.</p></li>
<li><p>Edit the entries to reflect your installation reality. Pay attention
to these specifically:</p>
<ul class="simple">
<li><p><a class="reference internal" href="single_node.html#integrate-data-store"><span class="std std-ref">Integrating with the Data Store</span></a></p></li>
<li><p><a class="reference internal" href="#mtls"><span class="std std-ref">Configure TLS and mTLS Authentication</span></a></p></li>
<li><p><a class="reference internal" href="#auth-token"><span class="std std-ref">Configure Authorization</span></a></p></li>
<li><p><a class="reference internal" href="#configure-misc"><span class="std std-ref">Configure Additional Properties in titaniam.properties</span></a></p></li>
</ul>
</li>
<li><p>Save the secret.</p></li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
<blockquote>
<div></div></blockquote>
<section id="id12">
<span id="id13"></span><h4>Integrating with the Data Store<a class="headerlink" href="#id12" title="Permalink to this heading"></a></h4>
<p>Titaniam Server uses a datastore to store the metadata and schema versions. After you install the Titaniam Server, you must ensure that the Titaniam Server can communicate with the data store.</p>
<ol class="arabic">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file and edit the sections corresponding to the database you are using.</p></li>
<li><p>(If using MySQL) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:mysql:&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.MySQL57InnoDBDialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
<li><p>(If using MariaDB) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:mariadb:&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;org.mariadb.jdbc.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.MariaDB53Dialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
<li><p>(If using PostgreSQL) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:postgresql&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;org.postgresql.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.PostgreSQL10Dialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
</ol>
<p>Where,</p>
<ul>
<li><p>&lt;database_URL&gt; is the URL (including the port) where you can access the database. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">PostgresSQL</span><span class="p">)</span><span class="c1">#spring.datasource.url=jdbc:postgresql://tlab1/titaniam_v1</span>
<span class="p">(</span><span class="n">MySQL</span><span class="p">)</span>      <span class="c1">#spring.datasource.url=jdbc:mysql://localhost:3306/testdb</span>
<span class="p">(</span><span class="n">MariaDB</span><span class="p">)</span>    <span class="c1">#spring.datasource.url=jdbc:mariadb://localhost:3306/testdb</span>
</pre></div>
</div>
</li>
<li><p>&lt;username&gt; is the username for accessing the database.</p></li>
<li><p>&lt;password&gt; is the password required to access the database.</p></li>
</ul>
</section>
</section>
</section>
<section id="id14">
<span id="id15"></span><h2>Step 2: Configure Services<a class="headerlink" href="#id14" title="Permalink to this heading"></a></h2>
<p>You can choose to configure Titaniam Server as one of the following services:</p>
<ul class="simple">
<li><p>Translation Service</p></li>
<li><p>Vault</p></li>
<li><p>Proxy for the object store</p></li>
<li><p>Elastic Proxy</p></li>
</ul>
<p>The following subsections describe the properties needed for each of the services:</p>
<ul class="simple">
<li><p><a class="reference internal" href="single_node.html#api-service"><span class="std std-ref">Step 2: Configure Service: Translation Service</span></a></p></li>
<li><p><a class="reference internal" href="single_node.html#sdss-vault"><span class="std std-ref">Step 2: Configure Service: Configure as a Vault</span></a></p></li>
<li><p><a class="reference internal" href="single_node.html#proxy-s3"><span class="std std-ref">Step 2: Configure Service: Proxy for the S3 Object Store</span></a></p></li>
<li><p><a class="reference internal" href="single_node.html#es-proxy"><span class="std std-ref">Step 2: Configure Service: Elastic Proxy</span></a></p></li>
<li><p><a class="reference internal" href="single_node.html#dp-service"><span class="std std-ref">Step 2: Configure Service: Data Protection Service for Object Store</span></a></p></li>
</ul>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#lic-keys-aws"><span class="std std-ref">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#compile-docker"><span class="std std-ref">Step 3: Compose the docker-compose.yml File</span></a></p></li>
</ul>
<section id="id16">
<span id="id17"></span><h3>Step 2: Configure Service: Translation Service<a class="headerlink" href="#id16" title="Permalink to this heading"></a></h3>
<p>You must set the following property in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file and disable the other services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">panther</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#lic-keys-aws"><span class="std std-ref">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#compile-docker"><span class="std std-ref">Step 3: Compose the docker-compose.yml File</span></a></p></li>
</ul>
</section>
<section id="step-3-configure-service-configure-as-a-vault">
<span id="id18"></span><h3>Step 3: Configure Service: Configure as a Vault<a class="headerlink" href="#step-3-configure-service-configure-as-a-vault" title="Permalink to this heading"></a></h3>
<p>Enable the vault service. You must set <code class="docutils literal notranslate"><span class="pre">sdv.enabled</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> and disable the other services in the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;sdv.enabled&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span>
</pre></div>
</div>
<section id="id19">
<h4>Configure Secure Search Index<a class="headerlink" href="#id19" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>When you configure Titaniam Server as a vault, you must also configure a secure search index (Titaniam plugin integrated with Elasticsearch). You must configure the following:</p>
</div></blockquote>
<ol class="arabic">
<li><p>Configure the following properties in the <cite>arcus:</cite> section of the <code class="docutils literal notranslate"><span class="pre">spectra-configmap</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">aws_region</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">2</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">keyring</span><span class="o">.</span><span class="n">name</span><span class="o">=&lt;</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">aws</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">access</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_ACCESS_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">secret</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_SECRET_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">arcus01</span>
<span class="o">-</span> <span class="n">http</span><span class="o">.</span><span class="n">port</span><span class="o">=</span><span class="mi">9200</span>
</pre></div>
</div>
</li>
<li><p>Configure the following property in the <code class="docutils literal notranslate"><span class="pre">spectra:</span></code> section of the <code class="docutils literal notranslate"><span class="pre">spectra-configmap</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>- spring.elasticsearch.rest.uris: this property must match the IP and port of the elastic configured in the `arcus` section.
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">spring</span><span class="o">.</span><span class="n">elasticsearch</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">uris</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">arcus</span><span class="p">:</span><span class="mi">9200</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="single_node.html#integrate-data-store"><span class="std std-ref">Integrating with the Data Store</span></a></p></li>
<li><p>Next Step: <span class="xref std std-ref">tls</span></p></li>
</ul>
</section>
</section>
<section id="id20">
<span id="id21"></span><h3>Step 2: Configure Service: Proxy for the S3 Object Store<a class="headerlink" href="#id20" title="Permalink to this heading"></a></h3>
<p>You can use the Titaniam Server as an S3 proxy to protect any requests to an S3 bucket in the specified region. The following diagrams illustrate the configuration with and without the Titaniam Server as a proxy. When the Titaniam Server is configured as an proxy, it passes through the endpoint requests except the PUTObject and GETObject endpoints. These endpoints are intercepted by the Titaniam Proxy for S3 and the data is encrypted and decrypted.</p>
<img alt="_images/proxy.png" src="_images/proxy.png" />
<p>Enable the proxy service. You must set the following property and disable other services in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      - ripple.enabled=true
- amazon.s3.bucket-name=[bucket_name]
- amazon.s3.access-key=[access_key_id]
- amazon.s3.secret-key=[secret_access_key]

Where,

   * ``amazon.s3.access-key`` and ``amazon.s3.secret-key`` are the access credentials for AWS S3. Ensure that you encrypt these using the zero-day encryption service. See :ref:`zero-day-encrypt`.
   * ``amazon.s3.bucket-name``=&lt;bucket_name&gt; is the S3 bucket name.
</pre></div>
</div>
<section id="id22">
<h4>Configure your Application to Route Traffic to Titaniam S3 Proxy<a class="headerlink" href="#id22" title="Permalink to this heading"></a></h4>
<p>In your application, you must override the existing endpoint URL. You must now point the endpoint URL to the Titaniam S3 Proxy.</p>
<p><strong>If you are using AWS SDK V1</strong>, modify the endpoint URL as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AmazonS3</span> <span class="n">s3</span> <span class="o">=</span> <span class="n">AmazonS3ClientBuilder</span><span class="o">.</span><span class="n">standard</span><span class="p">()</span>
   <span class="o">.</span><span class="n">withEndpointConfiguration</span><span class="p">(</span><span class="n">new</span> <span class="n">EndpointConfiguration</span><span class="p">(</span>
        <span class="s2">&quot;{{secureStoreURL}}/v2/titaniam-s3-proxy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">))</span>
   <span class="o">.</span><span class="n">withCredentials</span><span class="p">(</span><span class="n">CREDENTIALS_PROVIDER</span><span class="p">)</span>
   <span class="o">.</span><span class="n">build</span><span class="p">();</span>
</pre></div>
</div>
<p>Where, you <code class="docutils literal notranslate"><span class="pre">{secureStoreURL}}/v2/titaniam-s3-proxy</span></code> points to the Titaniam S3 Proxy URL.</p>
<p><strong>If you are using AWS SDK V2</strong>, modify the endpoint URL as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">URI</span> <span class="n">endpointOverride</span> <span class="o">=</span> <span class="n">new</span> <span class="n">URI</span><span class="p">(</span><span class="s2">&quot;{{secureStoreURL}}/v2/titaniam-s3-proxy&quot;</span><span class="p">);</span>
<span class="n">S3Client</span><span class="o">.</span><span class="n">builder</span><span class="p">()</span>
<span class="o">.</span><span class="n">credentialsProvider</span><span class="p">(</span><span class="n">CREDENTIALS_PROVIDER</span><span class="p">)</span>
<span class="o">.</span><span class="n">endpointOverride</span><span class="p">(</span><span class="n">endpointOverride</span><span class="p">)</span>
<span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
<span class="o">.</span><span class="n">build</span><span class="p">();</span>
</pre></div>
</div>
<p>Where, you <code class="docutils literal notranslate"><span class="pre">{secureStoreURL}}/v2/titaniam-s3-proxy</span></code> points to the Titaniam S3 Proxy URL.</p>
<p><strong>If you are using boto3</strong>, modify the endpoint URL during client creation as described <a class="reference external" href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/core/session.html">here</a>.</p>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#lic-keys-aws"><span class="std std-ref">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#compile-docker"><span class="std std-ref">Step 3: Compose the docker-compose.yml File</span></a></p></li>
</ul>
</section>
</section>
<section id="id23">
<span id="id24"></span><h3>Step 2: Configure Service: Elastic Proxy<a class="headerlink" href="#id23" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>When you configure Titaniam Server as an elastic proxy, you must configure the following properties:</p>
</div></blockquote>
<ol class="arabic">
<li><p>Create a folder on your virtual machine: <code class="docutils literal notranslate"><span class="pre">/var/lib/arcusdata</span></code>.</p></li>
<li><p>Enable the elastic proxy service. Disable the other services. Set <code class="docutils literal notranslate"><span class="pre">sdss.esproxy.enabled</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> in the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;sdss.esproxy.enabled&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Configure the location of the keys:</p>
<blockquote>
<div><ol class="loweralpha">
<li><p>(Optional) If you are using the active key from the AWS Secrets Manager, Configure the following properties in the <code class="docutils literal notranslate"><span class="pre">arcus:</span></code> section of the <code class="docutils literal notranslate"><span class="pre">spectra-configmap.yml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">aws_region</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">2</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">keyring</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">vault</span><span class="o">-</span><span class="n">singlenode</span><span class="o">-</span><span class="n">byok</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">aws</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">access</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_ACCESS_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">secret</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_SECRET_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">arcus01</span>
<span class="o">-</span> <span class="n">http</span><span class="o">.</span><span class="n">port</span><span class="o">=</span><span class="mi">9200</span>
<span class="o">-</span> <span class="n">indices</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">bool</span><span class="o">.</span><span class="n">max_clause_count</span><span class="o">=</span><span class="mi">2000</span>
</pre></div>
</div>
</li>
<li><p>(Optional) If using byok (bring your own key) mode,</p>
<ol class="lowerroman">
<li><p>In your <code class="docutils literal notranslate"><span class="pre">spectra-configmap.yml</span></code> file, configure the following lines of code in the <cite>arcus</cite> section:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># byok configuration</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">byok</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">host</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">arcus</span><span class="p">:</span><span class="mi">9200</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">byok</span><span class="o">.</span><span class="n">refresh</span><span class="o">-</span><span class="n">secs</span><span class="o">=</span><span class="mi">30</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>In your <cite>spectra-configmap.yml</cite> file, configure the following lines of code in the <cite>spectra</cite> section:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># byok configuration</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">byok</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">byok</span><span class="o">.</span><span class="n">host</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">arcus</span><span class="p">:</span><span class="mi">9200</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">byok</span><span class="o">.</span><span class="n">refresh</span><span class="o">-</span><span class="n">secs</span><span class="o">=</span><span class="mi">30</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Configure the following property in the <code class="docutils literal notranslate"><span class="pre">spectra:</span></code> section of the <code class="docutils literal notranslate"><span class="pre">spectra-configmap.yml</span></code> file:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">spring.elasticsearch.rest.uris=http://arcus:9200</span></code> indicates the URL of the Titaniam plugin.</p></li>
<li><p>(Optional) <code class="docutils literal notranslate"><span class="pre">sdss.es.login=admin</span></code> indicates the admin login of the elastic node. This property is required only if you have installed Elasticsearch with authentication.</p></li>
<li><p>(Optional) <code class="docutils literal notranslate"><span class="pre">sdss.es.password</span></code> provide the password after encrypting it with the master encryption key. This property is required only if you have installed Elasticsearch with authentication.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.search.proxy.override.fields.&lt;INDEX_NAME&gt;.&lt;ABSOLUTE_FIELD_NAME&gt;=&lt;OVERRIDE_TYPE&gt;</span></code> specify any field properties in the elastic index that you want to override. For example, to return the values from the index as integers or boolean formats instead of strings. For example,</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sdss</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">proxy</span><span class="o">.</span><span class="n">override</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">example_index</span><span class="o">.</span><span class="n">days</span><span class="o">=</span><span class="n">integer</span>
<span class="n">sdss</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">proxy</span><span class="o">.</span><span class="n">override</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">example_index</span><span class="o">.</span><span class="n">hours</span><span class="o">=</span><span class="n">integer</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">ingest_byok</span></p></li>
<li><p>Previous Step: <a class="reference internal" href="single_node.html#integrate-data-store"><span class="std std-ref">Integrating with the Data Store</span></a></p></li>
<li><p>Next Step: <span class="xref std std-ref">tls</span></p></li>
</ul>
</section>
<section id="id25">
<span id="id26"></span><h3>Step 2: Configure Service: Data Protection Service for Object Store<a class="headerlink" href="#id25" title="Permalink to this heading"></a></h3>
<p>The Titaniam Server can be used as a data protection service for an object store. The data protection service for object stores lets you encrypt and decrypt objects in your object stores. Currently, AWS S3 is supported. This service lets you do the following operations:</p>
<ul class="simple">
<li><p>Encrypt an object in-place in the object store. You must pass on the object reference to the data protection service.</p></li>
<li><p>Generate an encoded URI to an object. You can use this URI to download the object in clear format.</p></li>
</ul>
<p>To enable the data-protection service, do the following:</p>
<ol class="arabic">
<li><p>(Configure at least one object store service) For example, If you are protecting objects in an AWS S3 object store, you must configure the Titaniam S3 proxy related properties (see <span class="xref std std-ref">_proxy_s3</span>).</p></li>
<li><p>Set the following property file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sdss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">protection</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#lic-keys-aws"><span class="std std-ref">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#compile-docker"><span class="std std-ref">Step 3: Compose the docker-compose.yml File</span></a></p></li>
</ul>
</section>
</section>
<section id="step-3-configure-token-secret">
<span id="config-secret"></span><h2>Step 3: Configure Token Secret<a class="headerlink" href="#step-3-configure-token-secret" title="Permalink to this heading"></a></h2>
<p>You must specify the base64 encoded token (procured from Titaniam) to pull in Titaniam Server images.</p>
<p>Enter the base64-encoded version of the token in the <code class="docutils literal notranslate"><span class="pre">dockerconfigjson</span></code> property in <code class="docutils literal notranslate"><span class="pre">spectra-secret.yaml</span></code>. Use the following command to generate the base64 version:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s1">&#39;token&#39;</span> <span class="o">|</span> <span class="n">base64</span>
</pre></div>
</div>
<p>Following is a sample <code class="docutils literal notranslate"><span class="pre">spectra-secret.yaml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">data</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">.dockerconfigjson</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ewoJImF1dGhzIjogewoJCSJodHRwczovL2luZGV4LmRvY2tlci5pby92MS8iOiB7CgkJCSJhdXRoIjogImRHbDBZVzVwWVcwNk1EY3haV00wWXpZdFpXRXlNaTAwTkRWaUxXSXpOR1F0TWpNeFl6bG1PV0l4WldVMCIKCQl9Cgl9Cn0=</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2022-03-16T06:55:02Z&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra-secret</span><span class="w"></span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class="w"></span>
<span class="w">  </span><span class="nt">resourceVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;658&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">uid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">44cc72ca-7d1d-4f56-968e-bdc22640e560</span><span class="w"></span>
<span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/dockerconfigjson</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="single_node.html#configure-server"><span class="std std-ref">Step 2: Configure Services</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#config-configmap"><span class="std std-ref">Step 4: Configure ConfigMap</span></a></p></li>
</ul>
</section>
<section id="step-4-configure-configmap">
<span id="config-configmap"></span><h2>Step 4: Configure ConfigMap<a class="headerlink" href="#step-4-configure-configmap" title="Permalink to this heading"></a></h2>
<p>Specify the location of the encryption keys and <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> in a <code class="docutils literal notranslate"><span class="pre">spectra-configmap.yaml</span></code> file.</p>
<p>Set the following properties:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">properties</span><span class="o">-</span><span class="n">source</span><span class="o">=</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">secretsmanager</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">keyname</span><span class="o">=</span><span class="n">titaniam</span><span class="o">.</span><span class="n">properties</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">region</span><span class="o">=&lt;</span><span class="n">region</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">=&lt;</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">aws</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">access</span><span class="o">-</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">AWS_ACCESS_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">secret</span><span class="o">-</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">AWS_SECRET_ID</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>Where,</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.properties-source</span></code> indicates that the configuration properties are stored in the AWS Secrets Manager.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.secretsmanager.properties.keyname</span></code> specifies the key name of the configuration properties file. This must be set to <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.region</span></code> indicates the region of the AWS Secrets Manager.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.keyring-name</span></code> indicates the &lt;keyring_name&gt; from the Secrets Manager. Secret name is of the format - <cite>titaniam_key_ring/&lt;keyring_name&gt;/&lt;key_name&gt;</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.seed.store.type</span></code> specifies that the keystore is in AWS.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.access-key</span></code> specifies the encrypted access key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.secret-key</span></code> specifies the encrypted secret key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
</ul>
<p>Following is a sample <code class="docutils literal notranslate"><span class="pre">spectra-configmap.yaml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra-config</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra</span><span class="w"></span>
<span class="nt">data</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">jvm_args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-Xms512m -Xmx512m</span><span class="w"></span>

<span class="w">  </span><span class="c1"># This property determines which secret name contains the</span><span class="w"></span>
<span class="w">  </span><span class="c1"># configuration for spectra application. The contents of</span><span class="w"></span>
<span class="w">  </span><span class="c1"># the property is included in Getting Started Guide.</span><span class="w"></span>
<span class="w">  </span><span class="nt">sdss.properties-source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws.sm</span><span class="w"></span>
<span class="w">  </span><span class="nt">sdss.secretsmanager.properties.keyname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam.properties</span><span class="w"></span>
<span class="w">  </span><span class="nt">sdss.aws.sm.access-key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;ENCRYPTED_ACCESS_KEY&gt;</span><span class="w"></span>
<span class="w">  </span><span class="nt">sdss.aws.sm.secret-key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;ENCRYPTED_ACCESS_KEY&gt;</span><span class="w"></span>

<span class="w">  </span><span class="c1"># This is the same as aws_region environment variable above under arcus</span><span class="w"></span>
<span class="w">  </span><span class="nt">sdss.aws.sm.region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-2</span><span class="w"></span>

<span class="w">  </span><span class="c1"># This is the same as keyring_name environment variable above under arcus</span><span class="w"></span>
<span class="w">  </span><span class="c1"># This value *must* match the value specified under arcus</span><span class="w"></span>
<span class="w">  </span><span class="nt">sdss.aws.sm.keyring-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">func-testing</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain"># All of these values should ideally be present in the secret name specified</span><span class="w"></span>
<span class="w">  </span><span class="c1"># under &#39;sdss.secretsmanager.properties.keyname&#39;, so that docker-compose does</span><span class="w"></span>
<span class="w">  </span><span class="c1"># not have DB credentials.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># If specified here, the values will override the ones from Secrets Manager.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># This value *must* match the value specified under arcus</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.datasource.url: jdbc:postgresql://postgres:5432/titaniam?autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.datasource.url: jdbc:postgresql://host.minikube.internal:5433/titaniam_v1?autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.datasource.url: jdbc:postgresql://65.0.12.72:5432/testdb?autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span><span class="w"></span>

<span class="w">  </span><span class="c1"># spring.datasource.password: password123</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.datasource.username: admin</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.datasource.driver-class-name=org.mariadb.jdbc.Driver</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MariaDB53Dialect</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.datasource.driverClassName: org.postgresql.Driver</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.jpa.properties.hibernate.dialect: org.hibernate.dialect.PostgreSQL10Dialect</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.jpa.open-in-view: &quot;false&quot;</span><span class="w"></span>


<span class="w">  </span><span class="c1"># This must match the IP and port of the elastic configured</span><span class="w"></span>
<span class="w">  </span><span class="c1"># in the arcus above.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># This is required only if spectra is enabled. (sdv.enabled: true in sdss.secretsmanager.properties.keyname secret)</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.elasticsearch.rest.uris: http://65.0.12.72:9200</span><span class="w"></span>
<span class="w">  </span><span class="c1"># sdss.es.login: 294lgnpkis</span><span class="w"></span>
<span class="w">  </span><span class="c1"># sdss.es.password: ASVrWiEAAAADAAABfksxvOED72flKpUcrSAQmZ6W5p8r</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Multipart configuration</span><span class="w"></span>
<span class="w">  </span><span class="nt">spring.servlet.multipart.max-file-size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40MB</span><span class="w"></span>
<span class="w">  </span><span class="nt">spring.servlet.multipart.max-request-size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50MB</span><span class="w"></span>
<span class="w">  </span><span class="nt">hibernate.jdbc.use_streams_for_binary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Disalbe single-sing-on</span><span class="w"></span>
<span class="w">  </span><span class="nt">sso.enabled</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">spring.autoconfigure.exclude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,org.springframework.boot.actuate.autoconfigure.security.servlet.ManagementWebSecurityAutoConfiguration</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Possible values aws|byok|file</span><span class="w"></span>
<span class="w">  </span><span class="c1"># AWS Secrets Manager based keys - aws</span><span class="w"></span>
<span class="w">  </span><span class="c1"># BYOK based key configuration - byok (see below for additional byok params)</span><span class="w"></span>
<span class="w">  </span><span class="c1"># File based key store (use only in dev environments)</span><span class="w"></span>
<span class="w">  </span><span class="nt">sdss.seed.store.type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws</span><span class="w"></span>

<span class="w">  </span><span class="c1"># byok configuration</span><span class="w"></span>
<span class="w">  </span><span class="c1"># create an index named - titaniam_byok_config</span><span class="w"></span>
<span class="w">  </span><span class="c1">#      - sdss.seed.store.type=byok</span><span class="w"></span>
<span class="w">  </span><span class="c1">#      - sdss.byok.refresh-secs=30</span><span class="w"></span>
<span class="w">  </span><span class="c1">#      - sdss.byok.host=http://arcus:9200</span><span class="w"></span>

<span class="w">  </span><span class="c1"># S3 file mgmt</span><span class="w"></span>
<span class="w">  </span><span class="nt">amazon.s3.region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-2</span><span class="w"></span>

<span class="w">  </span><span class="c1">## Enabling the trust store that has the root-ca certs</span><span class="w"></span>
<span class="w">  </span><span class="c1">#- sdss.trust.store=file:/usr/local/granger/trust-store.jks</span><span class="w"></span>
<span class="w">  </span><span class="c1">#- sdss.trust.store.password=secret</span><span class="w"></span>
<span class="w">  </span><span class="c1">#- sdss.es.login=admin</span><span class="w"></span>
<span class="w">  </span><span class="c1">#- sdss.es.password=ASVrWiEAAAABAAABfikxCXxfKK2hxqCmCAliJupigssc</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Controls logging.</span><span class="w"></span>
<span class="w">  </span><span class="nt">log_level_root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">info</span><span class="w"></span>
<span class="w">  </span><span class="nt">log_level_titaniam</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">debug</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Disable cache</span><span class="w"></span>
<span class="w">  </span><span class="nt">spring.cache.type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NONE</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#config-secret"><span class="std std-ref">Step 3: Configure Token Secret</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#configure-cluster-service"><span class="std std-ref">Step 5: Make Service Available Outside the Cluster</span></a></p></li>
</ul>
</section>
<section id="step-5-make-service-available-outside-the-cluster">
<span id="configure-cluster-service"></span><h2>Step 5: Make Service Available Outside the Cluster<a class="headerlink" href="#step-5-make-service-available-outside-the-cluster" title="Permalink to this heading"></a></h2>
<p>You must ensure that the Titaniam Server service is accessible outside the kubernetes cluster. To do this, you must create a service for Titaniam Server in the kubernetes cluster. To configure the service, use the <code class="docutils literal notranslate"><span class="pre">spectra-service.yaml</span></code> file.</p>
<ol class="arabic simple">
<li><p>Specify the port in the <code class="docutils literal notranslate"><span class="pre">port</span></code> field.</p></li>
<li><p>Specify the service name. This service name must match the one you mentioned in the <code class="docutils literal notranslate"><span class="pre">spectra-configmap.yaml</span></code> file.</p></li>
</ol>
<p>Following is a sample <code class="docutils literal notranslate"><span class="pre">spectra-service.yaml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra-service</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span><span class="w"></span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span><span class="w"></span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#config-configmap"><span class="std std-ref">Step 4: Configure ConfigMap</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#config-deployment"><span class="std std-ref">Step 6: Configure Kubernetes Deployment File</span></a></p></li>
</ul>
</section>
<section id="step-6-configure-kubernetes-deployment-file">
<span id="config-deployment"></span><h2>Step 6: Configure Kubernetes Deployment File<a class="headerlink" href="#step-6-configure-kubernetes-deployment-file" title="Permalink to this heading"></a></h2>
<p>When deploying Titaniam Server, ensure that you specify the number of replicas of this deployment. You can specify this in the <code class="docutils literal notranslate"><span class="pre">spectra-deployment.yaml</span></code> file.</p>
<ol class="arabic">
<li><p>Specify the number of replicas in the <code class="docutils literal notranslate"><span class="pre">replicas</span></code> property.</p></li>
<li><p>Specify the Titaniam Server configmap file using the following property:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">envFrom</span><span class="p">:</span>
       <span class="o">-</span> <span class="n">configMapRef</span><span class="p">:</span>
           <span class="n">name</span><span class="p">:</span> <span class="n">spectra</span><span class="o">-</span><span class="n">config</span>
</pre></div>
</div>
</li>
<li><p>Specify the secret token file needed to access the Titaniam Server images.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">imagePullSecrets</span><span class="p">:</span>
   <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">spectra</span><span class="o">-</span><span class="n">secret</span>
</pre></div>
</div>
</li>
</ol>
<p>Following is a sample <code class="docutils literal notranslate"><span class="pre">spectra-deployment.yaml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra-deployment</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra</span><span class="w"></span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra</span><span class="w"></span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra</span><span class="w"></span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam/spectra:2.0.4</span><span class="w"></span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span><span class="w"></span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span><span class="w"></span>
<span class="w">          </span><span class="nt">envFrom</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">configMapRef</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra-config</span><span class="w"></span>
<span class="w">      </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra-secret</span><span class="w"></span>
<span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#configure-cluster-service"><span class="std std-ref">Step 5: Make Service Available Outside the Cluster</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#deploy-kubernetes"><span class="std std-ref">Step 7: Deploy Titaniam Server using Kubernetes</span></a></p></li>
</ul>
</section>
<section id="step-7-deploy-titaniam-server-using-kubernetes">
<span id="deploy-kubernetes"></span><h2>Step 7: Deploy Titaniam Server using Kubernetes<a class="headerlink" href="#step-7-deploy-titaniam-server-using-kubernetes" title="Permalink to this heading"></a></h2>
<p>This section explains how you can deploy Titaniam Server on Kubernetes using <code class="docutils literal notranslate"><span class="pre">kubectl</span></code> and <code class="docutils literal notranslate"><span class="pre">helm</span> <span class="pre">chart</span></code>.</p>
<p>You must already have kubernetes cluster deployed in your environment.</p>
<section id="creating-kubernetes-cluster-on-eks">
<h3>Creating Kubernetes Cluster on EKS<a class="headerlink" href="#creating-kubernetes-cluster-on-eks" title="Permalink to this heading"></a></h3>
<p>If you have not already created a kubernetes cluster on EKS (Amazon Elastic Kubernetes Service), do so using this <a class="reference external" href="https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html">guide</a>.</p>
</section>
<section id="creating-kubernetes-cluster">
<h3>Creating Kubernetes Cluster<a class="headerlink" href="#creating-kubernetes-cluster" title="Permalink to this heading"></a></h3>
<p>If you are deploying the application on a Kubernetes cluster on a virtual machine from your cloud provider, then read this section.</p>
<p>Use one of these guides to running Kubernetes on AWS EC2.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://kubernetes.io/docs/setup/production-environment/tools/kops/">Using kOps</a></p></li>
<li><p><a class="reference external" href="https://jamesdefabia.github.io/docs/getting-started-guides/aws/">Using get-kube</a></p></li>
</ul>
</section>
<section id="verifying-cluster-using-kubectl">
<h3>Verifying Cluster using kubectl<a class="headerlink" href="#verifying-cluster-using-kubectl" title="Permalink to this heading"></a></h3>
<p>After the cluster is created, the <cite>kubectl</cite> command refers to the newly created cluster.  However, you can verify the cluster that <cite>kubectl</cite> refers by using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl config current-context
</pre></div>
</div>
<p>The following command lists all clusters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl config get-contexts
</pre></div>
</div>
<p>The following example output illustrates the current kubectl context is pointing to a sample cluster. The <strong>CURRENT</strong> column is marked with <code class="docutils literal notranslate"><span class="pre">*</span></code> for the current cluster, which indicates that aws eks cluster is the current context which kubectl is referring.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl config get-contexts
CURRENT   NAME                                                  CLUSTER                                   AUTHINFO                                              NAMESPACE
   *      docker-desktop                                        docker-desktop                            docker-desktop
          kind-kind                                             kind-kind                                 kind-kind
          minikube                                              minikube                                  minikube                                              default
</pre></div>
</div>
<p>There can be many cluster(for example minikube, staging-cluster or local-cluster), you can switch to any cluster using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">config</span> <span class="n">use</span><span class="o">-</span><span class="n">context</span> <span class="o">&lt;</span><span class="n">cluster</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The following command checks whether the cluster nodes are ready. The following example illustrates that the <code class="docutils literal notranslate"><span class="pre">minikube</span></code> cluster is ready for deploying kubernetes resources.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl get nodes
NAME       STATUS   ROLES                  AGE   VERSION
minikube   Ready    control-plane,master   25h   v1.23.3
</pre></div>
</div>
</section>
<section id="deployment">
<h3>Deployment<a class="headerlink" href="#deployment" title="Permalink to this heading"></a></h3>
<p>After the kubernetes cluster is avaiable, Titaniam server can be deployed using one of the following ways:</p>
<ul class="simple">
<li><p>Deployment using kubernetes yaml file</p></li>
</ul>
</section>
<section id="deployment-using-kubernetes-yaml-file">
<h3>Deployment Using Kubernetes yaml File<a class="headerlink" href="#deployment-using-kubernetes-yaml-file" title="Permalink to this heading"></a></h3>
<p>You will need the following <code class="docutils literal notranslate"><span class="pre">yaml</span></code> files for deploying Titaniam Server in kubernetes</p>
<ul class="simple">
<li><p><strong>spectra-secret.yaml</strong> contains the access token encrypted in base64 format. Use this access token to pull images from Titaniam private repository.</p></li>
<li><p><strong>spectra-configmap.yaml</strong> contains the environment variables.</p></li>
<li><p><strong>spectra-deployment.yaml</strong> contains image details.</p></li>
<li><p><strong>spectra-service.yaml</strong> used for accessing the app from outside the kubernetes cluster.</p></li>
</ul>
<ol class="arabic">
<li><p>Execute the following sequence of commands on the kubernetes cluster.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">spectra</span><span class="o">-</span><span class="n">secret</span><span class="o">.</span><span class="n">yaml</span>

<span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">spectra</span><span class="o">-</span><span class="n">configmap</span><span class="o">.</span><span class="n">yaml</span>

<span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">spectra</span><span class="o">-</span><span class="n">deployment</span><span class="o">.</span><span class="n">yaml</span>

<span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">spectra</span><span class="o">-</span><span class="n">service</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Check the service list</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="n">svc</span>
</pre></div>
</div>
</div></blockquote>
<p>This command lists the IP address or DNS name to access the application through the load balancer.</p>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">172.105.45.27</span><span class="p">:</span><span class="mi">8080</span>
</pre></div>
</div>
<p>Now you must be able to access the Titaniam Server service at this URL.</p>
</li>
</ol>
</section>
<section id="checking-whether-all-kubernetes-resources-in-the-cluster-are-up-available">
<h3>Checking whether all kubernetes resources in the cluster are up/available<a class="headerlink" href="#checking-whether-all-kubernetes-resources-in-the-cluster-are-up-available" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="nb">all</span>
</pre></div>
</div>
<p>Output</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span>                                      <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">pod</span><span class="o">/</span><span class="n">spectra</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="mi">57468</span><span class="n">f8586</span><span class="o">-</span><span class="n">fvbvg</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">19</span><span class="n">s</span>
<span class="n">pod</span><span class="o">/</span><span class="n">spectra</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="mi">57468</span><span class="n">f8586</span><span class="o">-</span><span class="n">ws8mm</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">19</span><span class="n">s</span>
<span class="n">pod</span><span class="o">/</span><span class="n">spectra</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="mi">57468</span><span class="n">f8586</span><span class="o">-</span><span class="n">xdbqw</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">19</span><span class="n">s</span>

<span class="n">NAME</span>                      <span class="n">TYPE</span>           <span class="n">CLUSTER</span><span class="o">-</span><span class="n">IP</span>      <span class="n">EXTERNAL</span><span class="o">-</span><span class="n">IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>          <span class="n">AGE</span>
<span class="n">service</span><span class="o">/</span><span class="n">kubernetes</span>        <span class="n">ClusterIP</span>      <span class="mf">10.96.0.1</span>       <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">443</span><span class="o">/</span><span class="n">TCP</span>          <span class="mi">7</span><span class="n">h3m</span>
<span class="n">service</span><span class="o">/</span><span class="n">spectra</span><span class="o">-</span><span class="n">service</span>   <span class="n">LoadBalancer</span>   <span class="mf">10.101.205.25</span>   <span class="o">&lt;</span><span class="n">pending</span><span class="o">&gt;</span>     <span class="mi">8080</span><span class="p">:</span><span class="mi">30120</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">19</span><span class="n">s</span>

<span class="n">NAME</span>                                 <span class="n">READY</span>   <span class="n">UP</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">DATE</span>   <span class="n">AVAILABLE</span>   <span class="n">AGE</span>
<span class="n">deployment</span><span class="o">.</span><span class="n">apps</span><span class="o">/</span><span class="n">spectra</span><span class="o">-</span><span class="n">deployment</span>   <span class="mi">3</span><span class="o">/</span><span class="mi">3</span>     <span class="mi">3</span>            <span class="mi">3</span>           <span class="mi">19</span><span class="n">s</span>

<span class="n">NAME</span>                                            <span class="n">DESIRED</span>   <span class="n">CURRENT</span>   <span class="n">READY</span>   <span class="n">AGE</span>
<span class="n">replicaset</span><span class="o">.</span><span class="n">apps</span><span class="o">/</span><span class="n">spectra</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="mi">57468</span><span class="n">f8586</span>   <span class="mi">3</span>         <span class="mi">3</span>         <span class="mi">3</span>       <span class="mi">19</span><span class="n">s</span>
</pre></div>
</div>
</section>
<section id="checking-the-log-of-a-running-pod">
<h3>Checking the log of a running pod<a class="headerlink" href="#checking-the-log-of-a-running-pod" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl logs pod/spectra-deployment-57468f8586-fvbvg
 _____ _ _              _
|_   _(_) |_ __ _ _ __ (_) __ _ _ __ ___
  | | | | __/ _` | &#39;_ \| |/ _` | &#39;_ ` _ \
  | | | | || (_| | | | | | (_| | | | | | |
  |_| |_|\__\__,_|_| |_|_|\__,_|_| |_| |_|

 ____                  _
/ ___| _ __   ___  ___| |_ _ __ __ _
\___ \| &#39;_ \ / _ \/ __| __| &#39;__/ _` |
 ___) | |_) |  __/ (__| |_| | | (_| |
|____/| .__/ \___|\___|\__|_|  \__,_|
      |_|
java -Xms512m -Xmx512m -DLOG_HOME=/var/log/granger -Dlogging.config=file:///usr/local/granger/logback.xml -jar /usr/local/granger/titaniam-server.jar --spring.config.location=file:///usr/local/granger/application.properties

  .   ____          _            __ _ _
 /\\ / ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | &#39;_ | &#39;_| | &#39;_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  &#39;  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v2.5.3)

09:36:43.486 [INFO ] c.t.Application: Starting Application using Java 16.0.2 on spectra-deployment-57468f8586-fvbvg with PID 30 (/usr/local/granger/titaniam-server.jar started by titaniam in /usr/local/granger)
09:36:43.530 [DEBUG] c.t.Application: Running with Spring Boot v2.5.3, Spring v5.3.9
09:36:43.534 [INFO ] c.t.Application: No active profile set, falling back to default profiles: default
09:36:56.131 [INFO ] o.s.d.r.c.RepositoryConfigurationDelegate: Bootstrapping Spring Data JPA repositories in DEFAULT mode.
09:36:57.972 [INFO ] o.s.d.r.c.RepositoryConfigurationDelegate: Finished Spring Data repository scanning in 1735 ms. Found 8 JPA repository interfaces.
09:37:02.680 [INFO ] o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker: Bean &#39;application&#39; of type [com.titaniamlabs.Application$$EnhancerBySpringCGLIB$$c1b44626] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
09:37:03.552 [INFO ] o.h.v.i.u.Version: HV000001: Hibernate Validator 6.2.0.Final
09:37:08.703 [INFO ] o.s.b.w.e.t.TomcatWebServer: Tomcat initialized with port(s): 8080 (http)
09:37:08.826 [INFO ] o.a.c.h.Http11NioProtocol: Initializing ProtocolHandler [&quot;http-nio-8080&quot;]
09:37:08.828 [INFO ] o.a.c.c.StandardService: Starting service [Tomcat]
09:37:08.832 [INFO ] o.a.c.c.StandardEngine: Starting Servlet engine: [Apache Tomcat/9.0.50]
09:37:09.322 [INFO ] o.a.c.c.C.[.[.[/]: Initializing Spring embedded WebApplicationContext
09:37:09.323 [INFO ] o.s.b.w.s.c.ServletWebServerApplicationContext: Root WebApplicationContext: initialization completed in 25268 ms
09:37:13.987 [INFO ] o.h.j.i.u.LogHelper: HHH000204: Processing PersistenceUnitInfo [name: default]
09:37:14.780 [INFO ] o.h.Version: HHH000412: Hibernate ORM core version 5.4.32.Final
09:37:15.970 [INFO ] o.h.a.c.Version: HCANN000001: Hibernate Commons Annotations {5.1.2.Final}
09:37:16.868 [INFO ] c.z.h.HikariDataSource: HikariPool-1 - Starting...
09:37:17.745 [INFO ] c.z.h.HikariDataSource: HikariPool-1 - Start completed.
09:37:18.145 [INFO ] o.h.d.Dialect: HHH000400: Using dialect: org.hibernate.dialect.PostgreSQL10Dialect
09:37:27.961 [INFO ] o.h.e.t.j.p.i.JtaPlatformInitiator: HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
09:37:28.027 [INFO ] o.s.o.j.LocalContainerEntityManagerFactoryBean: Initialized JPA EntityManagerFactory for persistence unit &#39;default&#39;
09:37:28.897 [DEBUG] c.t.a.s.AwsSeedStore: build secretsmanager
09:37:29.005 [DEBUG] c.t.a.A.Builder: end - secretsmanager created successfully
09:37:29.006 [DEBUG] c.t.a.s.AwsSeedStore: begin - build keyring using aws secretsmanager
09:37:29.014 [DEBUG] c.t.a.AwsSecretsManagerImpl: List all secrets
09:37:29.088 [DEBUG] c.t.a.AwsSecretsManagerImpl: Calling AWS SM. Iteration #: 0
09:37:30.530 [DEBUG] c.t.a.AwsSecretsManagerImpl: Calling AWS SM. Iteration #: 1
09:37:30.832 [DEBUG] c.t.a.AwsSecretsManagerImpl: Calling AWS SM. Iteration #: 2
09:37:31.114 [DEBUG] c.t.a.AwsSecretsManagerImpl: AWS SM call iterations completed. Total iterations: 3
09:37:31.115 [DEBUG] c.t.a.Utils: Fetching key: titaniam_key_ring/func-testing/func-test-001
09:37:31.116 [DEBUG] c.t.a.AwsSecretsManagerImpl: Fetching key: titaniam_key_ring/func-testing/func-test-001
09:37:31.388 [DEBUG] c.t.a.Utils: begin - Parsing value for: titaniam_key_ring/func-testing/func-test-001
09:37:31.393 [DEBUG] c.t.a.Utils: end - &#39;titaniam_key_ring/func-testing/func-test-001&#39; value parsed successfully
09:37:31.400 [DEBUG] c.t.a.Utils: Fetching key: titaniam_key_ring/func-testing/default-key-for-testing
09:37:31.401 [DEBUG] c.t.a.AwsSecretsManagerImpl: Fetching key: titaniam_key_ring/func-testing/default-key-for-testing
09:37:31.689 [DEBUG] c.t.a.Utils: begin - Parsing value for: titaniam_key_ring/func-testing/default-key-for-testing
09:37:31.693 [DEBUG] c.t.a.Utils: end - &#39;titaniam_key_ring/func-testing/default-key-for-testing&#39; value parsed successfully
09:37:31.709 [DEBUG] c.t.a.s.AwsSeedStore: SimpleKeyRing{keys=[default-key-for-testing, func-test-001], activeName=&#39;default-key-for-testing&#39;}
09:37:31.719 [DEBUG] c.t.a.s.AwsSeedStore: end - keyring successfully created using aws secretsmanager
09:37:31.906 [DEBUG] c.t.e.EventRegistry: register - com.titaniamlabs.crypto.engine.FieldLevelInitializationFactory
09:37:31.934 [DEBUG] c.t.a.A.Builder: end - secretsmanager created successfully
09:37:31.935 [DEBUG] c.t.a.AwsSecretsManagerImpl: Fetching key: titaniam.license
09:37:33.104 [INFO ] c.t.a.l.AwsLicenseLoader: Loaded license
09:37:33.109 [DEBUG] c.t.a.l.AwsLicenseLoader: Valid json license found
09:37:33.110 [DEBUG] c.t.a.l.AwsLicenseLoader: License initialization from AWS successful
09:37:41.031 [DEBUG] c.t.s.ESClient: sdss_store_prod v1.0 Schema already exists
09:37:41.171 [DEBUG] c.t.s.RestClientManager: credentials found. creating provider with: 294lgnpkis
09:37:41.187 [DEBUG] c.t.s.RestClientManager: trust store not set
09:37:41.831 [DEBUG] c.t.s.ESClient: sdss-tangle-pipeline Pipeline already exists
09:37:41.852 [DEBUG] c.t.s.ESClient: default-key-for-testing Index already exists
09:37:41.891 [DEBUG] c.t.s.ESClient: sdss_store_prod Index alias already exists for default-key-for-testing Index
09:37:49.436 [INFO ] o.s.b.a.e.w.EndpointLinksResolver: Exposing 1 endpoint(s) beneath base path &#39;/actuator&#39;
09:37:49.696 [INFO ] o.a.c.h.Http11NioProtocol: Starting ProtocolHandler [&quot;http-nio-8080&quot;]
09:37:49.815 [INFO ] o.s.b.w.e.t.TomcatWebServer: Tomcat started on port(s): 8080 (http) with context path &#39;&#39;
09:37:49.983 [INFO ] c.t.Application: Started Application in 84.307 seconds (JVM running for 88.929)
--&gt; Application Initialized &lt;--
</pre></div>
</div>
</section>
<section id="removing-the-kubernetes-resources-using-kubectl">
<h3>Removing the kubernetes resources using kubectl<a class="headerlink" href="#removing-the-kubernetes-resources-using-kubectl" title="Permalink to this heading"></a></h3>
<section id="removing-deployment">
<h4>Removing deployment<a class="headerlink" href="#removing-deployment" title="Permalink to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl delete deployment.apps/spectra-deployment
deployment.apps &quot;spectra-deployment&quot; deleted
user@host helm-chart % kubectl get all
NAME                                      READY   STATUS        RESTARTS   AGE
pod/spectra-deployment-57468f8586-29pzx   1/1     Terminating   0          13h
pod/spectra-deployment-57468f8586-2cj6s   1/1     Terminating   0          13h
pod/spectra-deployment-57468f8586-zf84x   1/1     Terminating   0          13h

NAME                      TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
service/kubernetes        ClusterIP      10.96.0.1        &lt;none&gt;        443/TCP          24h
service/spectra-service   LoadBalancer   10.107.107.188   &lt;pending&gt;     8080:30735/TCP   13h
</pre></div>
</div>
</section>
<section id="removing-service">
<h4>Removing service<a class="headerlink" href="#removing-service" title="Permalink to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl delete service/spectra-service
</pre></div>
</div>
</section>
<section id="removing-configmap">
<h4>Removing configmap<a class="headerlink" href="#removing-configmap" title="Permalink to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl delete configmap spectra-config
configmap &quot;spectra-config&quot; deleted
</pre></div>
</div>
</section>
<section id="removing-secret">
<h4>Removing secret<a class="headerlink" href="#removing-secret" title="Permalink to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl delete secret spectra-secret
secret &quot;spectra-secret&quot; deleted
</pre></div>
</div>
<blockquote>
<div></div></blockquote>
</section>
</section>
</section>
<section id="zero-day-encryption-service">
<span id="zero-day-encrypt"></span><h2>Zero-day Encryption Service<a class="headerlink" href="#zero-day-encryption-service" title="Permalink to this heading"></a></h2>
<p>Ensure that any passwords and secrets that you mention in the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file are encrypted. You must not enter PlainText values. Use the Zero-day encryption service from Titaniam to perform the encryption.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl --location --request POST ‘https://demo.titaniam.io:8080/v1/mgmt/property?type=encrypt&amp;value=&lt;value&gt;’
</pre></div>
</div>
<p>The Titaniam zero-day encryption utility returns the encrypted value.</p>
</section>
<section id="id27">
<h2>Post-Installation Steps<a class="headerlink" href="#id27" title="Permalink to this heading"></a></h2>
<p>This chapter describes the following:</p>
<ul class="simple">
<li><p>Accessing the Logs</p></li>
<li><p>Verifying the Installation</p></li>
</ul>
<section id="id28">
<h3>Logs<a class="headerlink" href="#id28" title="Permalink to this heading"></a></h3>
<p>All logs are handled by the docker logs. See <a class="reference external" href="https://docs.docker.com/config/containers/logging/">docker log documentation</a>.</p>
<p>Run the following command tocheck logs for your container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">logs</span> <span class="o">-</span><span class="n">f</span> <span class="o">&lt;</span><span class="n">container_name</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="id29">
<h3>Verifying the Installation for Vault and Translation Services<a class="headerlink" href="#id29" title="Permalink to this heading"></a></h3>
<p>Perform the following steps to verify that the installation is successful, send the following CURL request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">location</span> <span class="o">--</span><span class="n">request</span> <span class="n">GET</span> <span class="s1">&#39;http:/&lt;baseURL&gt;:8080/actuator/health&#39;</span>
</pre></div>
</div>
<p>You must receive a response similar to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span><span class="p">,</span>

<span class="s2">&quot;components&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span><span class="p">,</span>

<span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="s2">&quot;PostgreSQL&quot;</span><span class="p">,</span>

<span class="s2">&quot;validationQuery&quot;</span><span class="p">:</span> <span class="s2">&quot;isValid()&quot;</span>

<span class="p">}</span>

<span class="p">},</span>

<span class="s2">&quot;diskSpace&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span><span class="p">,</span>

<span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">53675536384</span><span class="p">,</span>

<span class="s2">&quot;free&quot;</span><span class="p">:</span> <span class="mi">7795793920</span><span class="p">,</span>

<span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mi">10485760</span><span class="p">,</span>

<span class="s2">&quot;exists&quot;</span><span class="p">:</span> <span class="n">true</span>

<span class="p">}</span>

<span class="p">},</span>

<span class="s2">&quot;ping&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span>

<span class="p">}</span>

<span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="production-installation-using-docker-on-ec2-instances">
<h1>Production Installation Using Docker on EC2 Instances<a class="headerlink" href="#production-installation-using-docker-on-ec2-instances" title="Permalink to this heading"></a></h1>
<p>This section describes how you can deploy Titaniam Server on EC2 instances using docker in the following production layout:</p>
<img alt="_images/prod_ec2.png" src="_images/prod_ec2.png" />
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>This section explains instructions to deploy Titaniam Server in the following configurations:</p>
<ul class="simple">
<li><p>4 EC2 instances:</p>
<ul>
<li><p>An EC2 instance for installing Titaniam Plugin and Kibana</p></li>
<li><p>An EC2 instance for installing and hosting PostgreSQL</p></li>
<li><p>Two EC2 instances for installing and hosting Titaniam Server configured as Vault.</p></li>
</ul>
</li>
<li><p>The Titaniam Server and Kibana are accessible only through a network load balancer.</p></li>
<li><p>The Titaniam Server can access the PostgreSQL instance and Titaniam Plugin using their private IP addresses.</p></li>
</ul>
</section>
<section id="id30">
<h2>Prerequisites<a class="headerlink" href="#id30" title="Permalink to this heading"></a></h2>
<ul>
<li><p>Read this <a class="reference internal" href="#ps-matrix"><span class="std std-ref">Platform Support Matrix</span></a>.</p></li>
<li><p>Ensure that the each EC2 instance where you run Titaniam Server must have access to the Secrets Manager. Obtain an IAM Role with policy <strong>SecretsManagerReadWrite</strong>. This role allows the Titaniam Server to read and write to AWS Secrets Manager.</p></li>
<li><p>The AWS EC2 instances have access to internet initially to install docker, docker-compose, and Titaniam Server from the docker registry.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>After installing the components, ensure that you remove any public IP on the EC2 instances. You must access the EC2 instance only using the load balancer.</p>
</div>
</li>
</ul>
</section>
<section id="id31">
<span id="id32"></span><h2>Production Installation Instructions<a class="headerlink" href="#id31" title="Permalink to this heading"></a></h2>
<p>This section explains the overall process to install Titaniam Server in a high-availability production environment. You can supply  all the application properties, license, and encryption keys to Titaniam Server through a secret entry in a secrets manager.</p>
<section id="artifacts">
<h3>Artifacts<a class="headerlink" href="#artifacts" title="Permalink to this heading"></a></h3>
<p>Obtain the following installation artifacts from Titaniam support:</p>
<ul class="simple">
<li><p>License file and SHA Checksum for Titaniam Plugin and Titaniam Server.</p></li>
<li><p>Access token to retrieve the Titaniam Server and Plugin images from the private repository in Docker Hub. You need an access token to download the images. Contact Titaniam support to get your access token.</p></li>
</ul>
</section>
<section id="installation-process">
<h3>Installation Process<a class="headerlink" href="#installation-process" title="Permalink to this heading"></a></h3>
<p>Following is the process to install Titaniam Server, Plugin, and PostgreSQL.</p>
<ol class="arabic">
<li><p>Store the following as secrets in the AWS Secrets Manager:</p>
<ol class="loweralpha simple">
<li><p>License</p></li>
<li><p>Titaniam Server application properties</p></li>
<li><p>Encryption keys</p></li>
</ol>
<blockquote>
<div><p>Or</p>
<p>Store the license, application properties, and encryption keys in the local file system.</p>
</div></blockquote>
</li>
<li><p>Install Titaniam plugin and Kibana on an EC2 instance.</p></li>
<li><p>Install PostgreSQL on an EC2 instance.</p></li>
<li><p>Install Titaniam Server on an EC2 instance.</p>
<ol class="arabic simple">
<li><p>Configure as Vault.</p></li>
<li><p>Integrate with the PostgreSQL datastore.</p></li>
</ol>
</li>
<li><p>Configure load balancer.</p></li>
</ol>
<blockquote>
<div></div></blockquote>
</section>
</section>
<section id="id33">
<span id="id34"></span><h2>Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager<a class="headerlink" href="#id33" title="Permalink to this heading"></a></h2>
<p>Titaniam supports supplying all the application properties, licenses, and encryption keys through a secret entry in AWS Secrets Manager. The advantage of doing this is that you can maintain the configuration settings centrally instead of storing the settings in each server node.</p>
<p>Use this procedure (<span class="xref std std-ref">supplying_secrets</span>) here to create the following new secrets:</p>
<ul class="simple">
<li><p>Titaniam License (see <a class="reference internal" href="single_node.html#license"><span class="std std-ref">Step 1.a: Content of titaniam.license secret</span></a>)</p></li>
<li><p>Data Encryption keys (see <a class="reference internal" href="single_node.html#key-generation"><span class="std std-ref">Step 1.b: Store Encryption Keys</span></a>)</p></li>
<li><p>Configuration properties (see <a class="reference internal" href="single_node.html#configuration-settings"><span class="std std-ref">Step 1.c: Create Configuration Settings</span></a>)</p></li>
</ul>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Next Step: <a class="reference internal" href="single_node.html#configure-server"><span class="std std-ref">Step 2: Configure Services</span></a></p></li>
</ul>
<section id="id35">
<span id="id36"></span><h3>Step 1.a: Content of titaniam.license secret<a class="headerlink" href="#id35" title="Permalink to this heading"></a></h3>
<p>The following content can be copied and pasted as a secret named <code class="docutils literal notranslate"><span class="pre">titaniam.license</span></code> in the PlainText view.</p>
<p>The secret name can be of the following formats:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam.license</span></code>. <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;</span></code> is the value of the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> from the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.license</span></code> if you have not specified the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code>.</p></li>
</ul>
<p>The values provided here are just examples. Edit it to reflect the
license file and SHA that you received from Titaniam Support before you
save the secret. Occasionally the license file may include an expiry date. You can leave that in place. It does not affect the behavior.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="s2">&quot;digest&quot;</span><span class="p">:</span> <span class="s2">&quot;P9r7miQDNOf/0HWg8WQjBotJ79PP6WTw+0BQ9VT/fXQ=&quot;</span><span class="p">,</span>

<span class="s2">&quot;license&quot;</span><span class="p">:</span><span class="s2">&quot;vwOraInV23PJ2ePSqHmsnULtSfi98AYO2NHJDCv3f39INv4c9xIGiry3fyW19iZ3nOpIb3QI2akOSg0I6/CZvweoozFtZnP3xqWWXL6t4hhCBNuCdpWGh3XCAVN2xXb5u8S55GjTeWs3IZz5JnHOTSPUCBunicy2TSPNmo/4ScNM7fQagyrqxsiQphq9hnU8vmngQ4E3udqIh086S++2ERk+nki/TDpMWpOxCVcf3ZdnVo+Ra+Tw01MIOxeM3PuRzFMAVJNyGb7BumDfmN6wOlnzpXoVKkDSfQwD1pwkpJcMpKcX8uJMmPo0fJ022w3j0bjMsHy/buMeUybRSdjYUzrIrNosrjDJtoCgel8ygOrscUf9HnJFIziRSd2wCzNpyZyJFUKWhV7LHATPigmeXoHHqWlND0f5YECdvlqLdZXnZllYxuv/xOAIPKzjSyN+GeESmoQavFTNL14XGSKw6Xz825iBdyRJkGW/JsYClBemBRQelgkoxerBTyq80CcSmaie5UdblYuMwTXr13sySWJbX7VdKMKoReRGun+vphHBQnTDPIagb1AiYnsOjSMYdK03SZvGjuujzwRwgn23m9pBJL3iaGTP+1cTrqN/b6FijTsAzxU55Ny3YbQ54f4zM7g0lk0wZepPtPpTG3hx6D83StcNaXRxRx5u3YB5ET8=&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
</section>
<section id="id37">
<span id="id38"></span><h3>Step 1.b: Store Encryption Keys<a class="headerlink" href="#id37" title="Permalink to this heading"></a></h3>
<p>You have two options of using the data encryption keys.</p>
<ul>
<li><p>Option 1, Storing Encrypted Data Keys: Includes a master key (also called as Key Encryption Key, KEK) and one or more data encryption keys. The data encryption keys are encoded using the master key before adding them to the AWS Secrets Manager. You can select one of the data encryption keys as an active key.</p>
<blockquote>
<div><ol class="arabic">
<li><p>Generate an encrypted data encryption key and optionally a master key. If you have an existing master key, you can choose not to generate the master key. See <a class="reference internal" href="#keygen2"><span class="std std-ref">Generate an Encrypted Data Encryption Key and Optionally a Master Key</span></a>.</p></li>
<li><p>Store the master key as <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code> or <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code>. This key is the master encryption key.</p></li>
<li><p>Store the encrypted data key as a secret: <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code>.</p>
<p>Titaniam Server uses only keys that have the <code class="docutils literal notranslate"><span class="pre">Active</span></code> tag.</p>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Option 2, Storing Plain Data Keys: Generate a data encryption key and store it as a Secret in the AWS Secrets Manager. You are not encrypting the data encryption key with a master key in this case. See <a class="reference internal" href="#master-key"><span class="std std-ref">Generate Keys</span></a>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="lowerroman simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;</span></code> is the string from the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file. If you have not mentioned the <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> property, the secret name must be of the format <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code> for data encryption key and <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code> for master encryption key.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam_key_ring</span></code> must be entered <strong>as is</strong>. This is the namespace that Titaniam server looks for when loading the encryption keys.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;keyring_name&gt;</span></code> is the name of the keyring. This name distinguishes different Titaniam installations. Decide a name for the Titaniam Server installation (for example <cite>production_finance</cite>, <cite>dev_sandbox</cite>).</p></li>
</ol>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
</section>
<section id="id39">
<span id="id40"></span><h3>Step 1.c: Create Configuration Settings<a class="headerlink" href="#id39" title="Permalink to this heading"></a></h3>
<p>Populate the rest of the configuration settings in a secret.</p>
<ol class="arabic simple">
<li><p>Create a new secret called <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code>.</p></li>
<li><p>Copy and paste the <a class="reference internal" href="#sdss-properties"><span class="std std-ref">titaniam.properties Secret</span></a>
to the secret using PlainText view.</p></li>
<li><p>Edit the entries to reflect your installation reality. Pay attention
to these specifically:</p>
<ul class="simple">
<li><p><a class="reference internal" href="single_node.html#integrate-data-store"><span class="std std-ref">Integrating with the Data Store</span></a></p></li>
<li><p><a class="reference internal" href="#mtls"><span class="std std-ref">Configure TLS and mTLS Authentication</span></a></p></li>
<li><p><a class="reference internal" href="#auth-token"><span class="std std-ref">Configure Authorization</span></a></p></li>
<li><p><a class="reference internal" href="#configure-misc"><span class="std std-ref">Configure Additional Properties in titaniam.properties</span></a></p></li>
</ul>
</li>
<li><p>Save the secret.</p></li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
<blockquote>
<div></div></blockquote>
</section>
</section>
<section id="step-1-supplying-configuration-values-and-keys-using-local-file-system">
<span id="lic-keys-aws-ec2-local"></span><h2>Step 1: Supplying Configuration Values and Keys using Local File System<a class="headerlink" href="#step-1-supplying-configuration-values-and-keys-using-local-file-system" title="Permalink to this heading"></a></h2>
<p>Titaniam supports supplying all the application properties, licenses, and encryption keys through using the local file system.</p>
<section id="id41">
<span id="id42"></span><h3>Storing Titaniam License on Local File System<a class="headerlink" href="#id41" title="Permalink to this heading"></a></h3>
<p>Store the license with the value provided by Titaniam on your virtual machine, for example, <code class="docutils literal notranslate"><span class="pre">/home/centos/titaniam_config/license</span></code>.</p>
<section id="id43">
<h4>Example Titaniam License<a class="headerlink" href="#id43" title="Permalink to this heading"></a></h4>
<p>The values provided here are just examples. Edit it to reflect the
license file and SHA that you received from Titaniam Support. Occasionally the license file may include an expiry date. You can leave that in place. It does not affect the behavior.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="s2">&quot;digest&quot;</span><span class="p">:</span> <span class="s2">&quot;P9r7miQDNOf/0HWg8WQjBotJ79PP6WTw+0BQ9VT/fXQ=&quot;</span><span class="p">,</span>

<span class="s2">&quot;license&quot;</span><span class="p">:</span><span class="s2">&quot;vwOraInV23PJ2ePSqHmsnULtSfi98AYO2NHJDCv3f39INv4c9xIGiry3fyW19iZ3nOpIb3QI2akOSg0I6/CZvweoozFtZnP3xqWWXL6t4hhCBNuCdpWGh3XCAVN2xXb5u8S55GjTeWs3IZz5JnHOTSPUCBunicy2TSPNmo/4ScNM7fQagyrqxsiQphq9hnU8vmngQ4E3udqIh086S++2ERk+nki/TDpMWpOxCVcf3ZdnVo+Ra+Tw01MIOxeM3PuRzFMAVJNyGb7BumDfmN6wOlnzpXoVKkDSfQwD1pwkpJcMpKcX8uJMmPo0fJ022w3j0bjMsHy/buMeUybRSdjYUzrIrNosrjDJtoCgel8ygOrscUf9HnJFIziRSd2wCzNpyZyJFUKWhV7LHATPigmeXoHHqWlND0f5YECdvlqLdZXnZllYxuv/xOAIPKzjSyN+GeESmoQavFTNL14XGSKw6Xz825iBdyRJkGW/JsYClBemBRQelgkoxerBTyq80CcSmaie5UdblYuMwTXr13sySWJbX7VdKMKoReRGun+vphHBQnTDPIagb1AiYnsOjSMYdK03SZvGjuujzwRwgn23m9pBJL3iaGTP+1cTrqN/b6FijTsAzxU55Ny3YbQ54f4zM7g0lk0wZepPtPpTG3hx6D83StcNaXRxRx5u3YB5ET8=&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="local-properties-aws">
<span id="id44"></span><h3>Storing Application Properties and Service Definitions<a class="headerlink" href="#local-properties-aws" title="Permalink to this heading"></a></h3>
<p>Create a <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file with the following values and store it at a location on your EC2 instance.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">management</span><span class="o">.</span><span class="n">endpoint</span><span class="o">.</span><span class="n">health</span><span class="o">.</span><span class="n">show</span><span class="o">-</span><span class="n">details</span><span class="o">=</span><span class="n">always</span>
<span class="n">sdss</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">tiny_keyword</span><span class="o">.</span><span class="n">disabled</span><span class="o">=</span><span class="n">true</span>
<span class="n">sdss</span><span class="o">.</span><span class="k">async</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">core</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span>
<span class="n">sdss</span><span class="o">.</span><span class="k">async</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">max</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span>
<span class="n">sdss</span><span class="o">.</span><span class="k">async</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">keep</span><span class="o">-</span><span class="n">alive</span><span class="o">=</span><span class="mi">120</span>
<span class="n">sdss</span><span class="o">.</span><span class="k">async</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">queue</span><span class="o">-</span><span class="n">capacity</span><span class="o">=</span><span class="mi">1000</span>
<span class="n">sdss</span><span class="o">.</span><span class="k">async</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">thread</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">prefix</span><span class="o">=</span><span class="n">sdss</span><span class="o">-</span><span class="k">async</span><span class="o">-</span>
<span class="n">sdss</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">millis</span><span class="o">=</span><span class="n">true</span>
<span class="n">spring</span><span class="o">.</span><span class="n">servlet</span><span class="o">.</span><span class="n">multipart</span><span class="o">.</span><span class="n">max</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="n">MB</span>
<span class="n">spring</span><span class="o">.</span><span class="n">servlet</span><span class="o">.</span><span class="n">multipart</span><span class="o">.</span><span class="n">max</span><span class="o">-</span><span class="n">request</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="n">MB</span>
</pre></div>
</div>
</section>
<section id="id45">
<h3>Storing Encryption Keys in Local File System<a class="headerlink" href="#id45" title="Permalink to this heading"></a></h3>
<p>Storing Encrypted Data Keys: Includes a master key (also called as Key Encryption Key, KEK) and one or more data encryption keys. The data encryption keys are encoded using the master key before adding them to the <code class="docutils literal notranslate"><span class="pre">keyring.json</span></code> file. You can select one of the data encryption keys as an active key.</p>
<p>Storing encryption keys involves the following steps:</p>
<ol class="arabic simple">
<li><p>Generate a master key and an encrypted data encryption key. See <a class="reference internal" href="#keygen2"><span class="std std-ref">Generate an Encrypted Data Encryption Key and Optionally a Master Key</span></a>.</p></li>
<li><p>Create a <a class="reference internal" href="#key-ring-json"><span class="std std-ref">Keyring.JSON</span></a> file and update the <code class="docutils literal notranslate"><span class="pre">keyring.json</span></code> file with the output of the previous step.</p></li>
<li><p>Store the <code class="docutils literal notranslate"><span class="pre">keyring.JSON</span></code> file on your EC2 instance.</p></li>
<li><p>Update the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file to mount the <code class="docutils literal notranslate"><span class="pre">keyring.JSON</span></code> file as a volume.</p></li>
</ol>
</section>
</section>
<section id="step-2-installing-titaniam-plugin-and-kibana">
<span id="install-plugin-kibana"></span><h2>Step 2: Installing Titaniam Plugin and Kibana<a class="headerlink" href="#step-2-installing-titaniam-plugin-and-kibana" title="Permalink to this heading"></a></h2>
<p>This section explains the overall process to install and configure Titaniam Plugin and Kibana on an EC2 instance.</p>
<section id="install-titaniam-plugin">
<h3>Install Titaniam Plugin<a class="headerlink" href="#install-titaniam-plugin" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>Bring up an EC2 instance with the configuration as described <a class="reference internal" href="#hw-matrix"><span class="std std-ref">here</span></a>.</p></li>
<li><p>Login to the EC2 instance using ssh.</p></li>
<li><p>Install docker and docker-compose on the EC2 instance. See <a class="reference internal" href="#install-docker-os"><span class="std std-ref">Install Docker and Docker Compose</span></a>.</p></li>
<li><p>Create the following folders (<code class="docutils literal notranslate"><span class="pre">/var/lib/arcusdata</span></code> and <code class="docutils literal notranslate"><span class="pre">/var/lib/kibanadata</span></code>) on your EC2 instance:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">arcusdata</span>
<span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">kibanadata</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Ensure that your EC2 user has ownership and write access to these folders. Do the following:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="mi">1000</span><span class="p">:</span><span class="mi">1000</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">arcusdata</span>
<span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="mi">1000</span><span class="p">:</span><span class="mi">1000</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">kibanadata</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>(If using AWS Secrets Manager) Copy this <a class="reference internal" href="#plugin-dockercompose"><span class="std std-ref">docker-compose.yml</span></a> file, and modify the following properties.</p>
<blockquote>
<div><blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">aws_region</span><span class="o">=&lt;</span><span class="n">region</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">keyring</span><span class="o">.</span><span class="n">name</span><span class="o">=&lt;</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">aws</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">access</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_ACCESS_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">secret</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_SECRET_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span>
<span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">arcus01</span>
<span class="o">-</span> <span class="n">http</span><span class="o">.</span><span class="n">port</span><span class="o">=</span><span class="mi">9200</span>
</pre></div>
</div>
<p>Where,</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aws_region</span></code> specifies the AWS Secrets Manager region.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.keyring.name</span></code> specifies the keyringname.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.store.type</span></code> specifies where the data encryption keys are stored.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.aws.access.id</span></code> specifies the encrypted access key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.aws.secret.id</span></code> specifies the encrypted secret key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">node</span></code> specifies the node on which Titaniam plugin is accessible. Do not modify this.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">http.port</span></code> specifies the port on which you can access the Titaniam plugin endpoints. Best practice is to leave 9200 as is. If you modify this port, ensure that you open this port for inbound traffic.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> specifies the prefix path to secrets in AWS Secrets Manager. For example if you have specify <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix=prefix1</span></code>, you must store the titaniam.license in AWS Secrets as <code class="docutils literal notranslate"><span class="pre">&lt;prefix1&gt;titaniam.licence</span></code>. Encryptions keys as <code class="docutils literal notranslate"><span class="pre">&lt;prefix1&gt;titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code>.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file also includes properties for installing Kibaba. You need not change any of the Kibana properties. Use the properties as specified in the example file.</p>
</div>
</div></blockquote>
</li>
<li><p>(If using a local file system for license and keys) Copy this <span class="xref std std-ref">docker-compose.yml</span> file, and modify the following properties.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">file</span>

<span class="n">Volumes</span><span class="p">:</span>

 <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">titaniam</span> <span class="n">licence</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">titaniam</span><span class="o">/</span><span class="n">license</span>
 <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">keyring</span><span class="o">.</span><span class="n">json</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">titaniam</span><span class="o">/</span><span class="n">keyring</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
</li>
<li><p>Login to the docker registry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">login</span>
</pre></div>
</div>
</li>
<li><p>At the password prompt, enter the username and personal access token you received.</p></li>
<li><p>Bring up the Titaniam Plugin service with the respective <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code>, run the following command with the Titaniam plugin service:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</li>
<li><p>To troubleshoot the bring up, open a separate ssh connection to the EC2 instance, and run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">granger</span><span class="o">/</span><span class="n">server</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
</li>
<li><p>Create a security group for this instance and create inbound rules to allow traffic on the ports that you have assigned for Titaniam Plugin (9200) and Kibana (5601). For more information, see <a class="reference external" href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#SecurityGroupRules">this document</a>.</p></li>
<li><p>In your browser, send the following request:</p>
<p>Request</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddress</span><span class="p">:</span><span class="mi">9200</span>
</pre></div>
</div>
<p>Response</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;arcus01&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cluster_name&quot;</span> <span class="p">:</span> <span class="s2">&quot;elasticsearch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cluster_uuid&quot;</span> <span class="p">:</span> <span class="s2">&quot;iN75tpULSFSEGaWCT42ajg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;version&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;number&quot;</span> <span class="p">:</span> <span class="s2">&quot;7.10.2&quot;</span><span class="p">,</span>
      <span class="s2">&quot;build_flavor&quot;</span> <span class="p">:</span> <span class="s2">&quot;oss&quot;</span><span class="p">,</span>
      <span class="s2">&quot;build_type&quot;</span> <span class="p">:</span> <span class="s2">&quot;docker&quot;</span><span class="p">,</span>
      <span class="s2">&quot;build_hash&quot;</span> <span class="p">:</span> <span class="s2">&quot;747e1cc71def077253878a59143c1f785afa92b9&quot;</span><span class="p">,</span>
      <span class="s2">&quot;build_date&quot;</span> <span class="p">:</span> <span class="s2">&quot;2021-01-13T00:42:12.435326Z&quot;</span><span class="p">,</span>
      <span class="s2">&quot;build_snapshot&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;lucene_version&quot;</span> <span class="p">:</span> <span class="s2">&quot;8.7.0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;minimum_wire_compatibility_version&quot;</span> <span class="p">:</span> <span class="s2">&quot;6.8.0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;minimum_index_compatibility_version&quot;</span> <span class="p">:</span> <span class="s2">&quot;6.0.0-beta1&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;tagline&quot;</span> <span class="p">:</span> <span class="s2">&quot;You Know, for Search&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>From your EC2 instance settings, note the private IP address of the EC2 instance and port number on which the Titaniam plugin service is available. You will need this information when configuring Titaniam Server as a Vault.</p></li>
<li><p>Remove any public IP on the EC2 instances. You must access the EC2 instance only using the load balancer. See <a class="reference internal" href="#configure-lb"><span class="std std-ref">configuring a load balancer</span></a>.</p></li>
</ol>
</section>
</section>
<section id="step-3-installing-postgresql-on-an-ec2-instance">
<span id="id46"></span><h2>Step 3: Installing PostgreSQL on an EC2 Instance<a class="headerlink" href="#step-3-installing-postgresql-on-an-ec2-instance" title="Permalink to this heading"></a></h2>
<p>This section explains the overall process to install and configure PostgreSQL on an EC2 instance.</p>
<section id="install-postgresql">
<h3>Install PostgreSQL<a class="headerlink" href="#install-postgresql" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>Bring up an EC2 instance with the configuration as described <a class="reference internal" href="#hw-matrix"><span class="std std-ref">here</span></a>.</p></li>
<li><p>Login to the EC2 instance using <code class="docutils literal notranslate"><span class="pre">ssh</span></code>.</p></li>
<li><p>Install docker and docker-compose on the EC2 instance. See <a class="reference internal" href="#install-docker-os"><span class="std std-ref">Install Docker and Docker Compose</span></a>.</p></li>
<li><p>Create the following folders (<code class="docutils literal notranslate"><span class="pre">/var/lib/postgresql/13/main</span></code>) on your EC2 instance:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">postgresql</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="n">main</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Ensure that your EC2 user has ownership and write access to these folders. Do the following:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="mi">1000</span><span class="p">:</span><span class="mi">1000</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">postgresql</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="n">main</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Copy this <a class="reference internal" href="#postgres-dockercompose"><span class="std std-ref">docker-compose.yml</span></a> file, and modify the following properties.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">POSTGRES_USER</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span>
  <span class="n">POSTGRES_PASSWORD</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">password</span><span class="o">&gt;</span>
  <span class="n">POSTGRES_DB</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">database_name</span><span class="o">&gt;</span>
  <span class="n">PGDATA</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">postgresql</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="n">main</span>
<span class="n">ports</span><span class="p">:</span>
  <span class="o">-</span> <span class="s2">&quot;5432:5432&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>Where,</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">POSTGRES_USER</span></code> specifies the database user.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">POSTGRES_PASSWORD</span></code> specifies the database password corresponding to the user.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">POSTGRES_DB</span></code> specifies database name to create.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ports</span></code> specifies the port on which the PostgreSQL service is available.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Store the information from the previous step as you will need it to configure Titaniam Server as a Vault.</p></li>
<li><p>Login to the docker registry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">login</span>
</pre></div>
</div>
</li>
<li><p>At the password prompt, enter the username and personal access token you received.</p></li>
<li><p>Bring up the PostgreSQL with the respective <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code>, run the following command with the Titaniam Server service:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</li>
<li><p>Create a security group for this instance and create inbound rules to allow traffic on the ports that you have assigned for PostgreSQL (5432). For more information, see <a class="reference external" href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#SecurityGroupRules">this document</a>.</p></li>
<li><p>From your EC2 instance settings, note the private IP address of the EC2 instance and port number on which the PostgreSQL service is available. You will need this information when configuring Titaniam Server as a Vault.</p></li>
<li><p>Remove any public IP on the EC2 instances. You must access the EC2 instance only using the load balancer. See <a class="reference internal" href="#configure-lb"><span class="std std-ref">configuring a load balancer</span></a>.</p></li>
</ol>
</section>
</section>
<section id="step-4-installing-titaniam-server-and-configuring-as-a-vault">
<span id="install-vault"></span><h2>Step 4: Installing Titaniam Server and Configuring as a Vault<a class="headerlink" href="#step-4-installing-titaniam-server-and-configuring-as-a-vault" title="Permalink to this heading"></a></h2>
<p>This section explains the overall process to install and configure Titaniam Server as a Vault on an EC2 instance.</p>
<p>You must follow the procedure in this section on two EC2 instances.</p>
<section id="id47">
<h3>Install Titaniam Server<a class="headerlink" href="#id47" title="Permalink to this heading"></a></h3>
<p>Following is the process to install Titaniam Server.</p>
<ol class="arabic">
<li><p>Bring up an EC2 instance with the configuration as described <a class="reference internal" href="#hw-matrix"><span class="std std-ref">here</span></a>.</p></li>
<li><p>Login to the EC2 instance using ssh.</p></li>
<li><p>Install docker and docker-compose on the EC2 instance. See <a class="reference internal" href="#install-docker-os"><span class="std std-ref">Install Docker and Docker Compose</span></a>.</p></li>
<li><p>(If using AWS Secrets Manager) Copy this <a class="reference internal" href="#server-dockercompose"><span class="std std-ref">docker-compose.yml</span></a> file, and modify the following properties.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">panther</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">false</span>
<span class="o">-</span> <span class="n">sdv</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
<span class="o">-</span> <span class="n">ripple</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">false</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">properties</span><span class="o">-</span><span class="n">source</span><span class="o">=</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">secretsmanager</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">keyname</span><span class="o">=</span><span class="n">titaniam</span><span class="o">.</span><span class="n">properties</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">region</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">2</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">=&lt;</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">aws</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">access</span><span class="o">-</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">AWS_ACCESS_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">secret</span><span class="o">-</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">AWS_SECRET_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">spring</span><span class="o">.</span><span class="n">elasticsearch</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">uris</span><span class="o">=&lt;</span><span class="n">Titaniam_plugin_url</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span>
</pre></div>
</div>
<p>Where,</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">panther.enabled</span></code> must be set to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdv.enabled</span></code> Set this to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ripple.enabled</span></code> must be set to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.properties-source</span></code> indicates that the configuration properties are stored in the AWS Secrets Manager.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.secretsmanager.properties.keyname</span></code> specifies the key name of the configuration properties file. This must be set to <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.region</span></code> indicates the region of the AWS machines.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.keyring-name</span></code> indicates the &lt;keyring_name&gt; from the Secrets Manager. Secret name is of the format - <cite>titaniam_key_ring/&lt;keyring_name&gt;/&lt;key_name&gt;</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.seed.store.type</span></code> specifies that the keystore is in AWS.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.access-key</span></code> specifies the encrypted access key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.secret-key</span></code> specifies the encrypted secret key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spring.elasticsearch.rest.uris</span></code> this property must match the IP and port of the Titaniam Plugin EC2 instance. For example, <code class="docutils literal notranslate"><span class="pre">http://&lt;plugin_private_ip_address&gt;:9200</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> specifies the prefix path to secrets in AWS Secrets Manager. For example if you have specify <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix=prefix1</span></code>, you must store the titaniam.license in AWS Secrets as <code class="docutils literal notranslate"><span class="pre">&lt;prefix1&gt;titaniam.licence</span></code>. Encryptions keys as <code class="docutils literal notranslate"><span class="pre">&lt;prefix1&gt;titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>(If using a local file system for license and keys) Copy this <span class="xref std std-ref">docker-compose.yml</span> file, and modify the following properties.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">-</span> <span class="n">panther</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">false</span>
 <span class="o">-</span> <span class="n">sdv</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
 <span class="o">-</span> <span class="n">ripple</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">false</span>
 <span class="o">-</span> <span class="n">spring</span><span class="o">.</span><span class="n">elasticsearch</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">uris</span><span class="o">=&lt;</span><span class="n">Titaniam_plugin_url</span><span class="o">&gt;</span>
 <span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">file</span>

<span class="n">Volumes</span><span class="p">:</span>

 <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">titaniam</span> <span class="n">licence</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">titaniam</span><span class="o">/</span><span class="n">license</span>
 <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">keyring</span><span class="o">.</span><span class="n">json</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">titaniam</span><span class="o">/</span><span class="n">keyring</span><span class="o">.</span><span class="n">json</span>
 <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">properties</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">titaniam</span><span class="o">/</span><span class="n">application</span><span class="o">.</span><span class="n">properties</span>
</pre></div>
</div>
</li>
<li><p>Login to the docker registry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">login</span>
</pre></div>
</div>
</li>
<li><p>At the password prompt, enter the username and personal access token you received.</p></li>
<li><p>Bring up the Titaniam Plugin service with the respective <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code>, run the following command with the Titaniam Server service:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</li>
<li><p>To troubleshoot the bring up, open a separate ssh connection to the EC2 instance, and run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">granger</span><span class="o">/</span><span class="n">server</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
</li>
<li><p>Create a security group for this instance and create inbound rules to allow traffic on the ports that you have assigned for Titaniam Server (8080). For more information, see <a class="reference external" href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#SecurityGroupRules">this document</a>.</p></li>
<li><p>Send the curl command from the terminal in the EC2 instance:</p>
<p>Request</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{</span>
    <span class="s2">&quot;data_type&quot;</span><span class="p">:</span><span class="s2">&quot;keyword&quot;</span><span class="p">,</span>
    <span class="s2">&quot;field_name&quot;</span><span class="p">:</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
    <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;abcd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;include_protected_field&quot;</span><span class="p">:</span><span class="s2">&quot;true&quot;</span>
<span class="p">}</span><span class="s1">&#39; &quot;http:localhost.com:8080/v2/secure/store&quot;</span>
</pre></div>
</div>
<p>Response</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span><span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span><span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;success&quot;</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="p">:{</span><span class="s2">&quot;key_id&quot;</span><span class="p">:</span><span class="s2">&quot;k:e5d9a41a-5f29-414b-998b-11c5159124fd&quot;</span><span class="p">,</span><span class="s2">&quot;es_millis&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;guid&quot;</span><span class="p">:</span><span class="s2">&quot;tn:a1664f0d-6111-4415-bbcd-b54c65cf58c5&quot;</span><span class="p">,</span><span class="s2">&quot;protected_field&quot;</span><span class="p">:</span><span class="s2">&quot;03sGZ06alY{_Y06&#39;%7&gt;Pl06Qu-fE^&quot;</span><span class="p">,</span><span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;abcd&quot;</span><span class="p">,</span><span class="s2">&quot;db_millis&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;db_lookup_millis&quot;</span><span class="p">:</span><span class="mi">9</span><span class="p">}}</span>
</pre></div>
</div>
</li>
<li><p>Remove any public IP on the EC2 instances. You must access the EC2 instance only using the load balancer. See <a class="reference internal" href="#configure-lb"><span class="std std-ref">configuring a load balancer</span></a>.</p></li>
</ol>
<blockquote>
<div></div></blockquote>
</section>
</section>
<section id="step-5-integrating-with-the-data-store">
<span id="integrate-data-store-ec2"></span><h2>Step 5: Integrating with the Data Store<a class="headerlink" href="#step-5-integrating-with-the-data-store" title="Permalink to this heading"></a></h2>
<p>Titaniam Server uses a datastore to store the metadata and schema versions. After you install the Titaniam Server, you must ensure that the Titaniam Server can communicate with the data store.</p>
<ol class="arabic">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file and edit the sections corresponding to the database you are using.</p></li>
<li><p>(If using MySQL) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:mysql:&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.MySQL57InnoDBDialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
<li><p>(If using MariaDB) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:mariadb:&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;org.mariadb.jdbc.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.MariaDB53Dialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
<li><p>(If using PostgreSQL) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:postgresql&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;org.postgresql.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.PostgreSQL10Dialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
</ol>
<p>Where,</p>
<ul>
<li><p>&lt;database_URL&gt; is the URL (including the port) where you can access the database. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">PostgresSQL</span><span class="p">)</span><span class="c1">#spring.datasource.url=jdbc:postgresql://postgres_private_ip_address:5432/&lt;database_name&gt;?autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span>
<span class="p">(</span><span class="n">MySQL</span><span class="p">)</span>      <span class="c1">#spring.datasource.url=jdbc:mysql://localhost:3306/testdb</span>
<span class="p">(</span><span class="n">MariaDB</span><span class="p">)</span>    <span class="c1">#spring.datasource.url=jdbc:mariadb://localhost:3306/testdb</span>
</pre></div>
</div>
</li>
<li><p>&lt;username&gt; is the username (POSTGRES_USER) for accessing the database.</p></li>
<li><p>&lt;password&gt; is the password (POSTGRES_PASSWORD) required to access the database.</p></li>
<li><p>&lt;database_name&gt; is the PostgreSQL database name (POSTGRES_DB).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spring.jpa.properties.hibernate.dialect=</span></code> Ensure that you select the correct dialect depending on your database version. See the respective database documentation for this information.</p></li>
</ul>
</section>
<section id="step-6-configure-load-balancer">
<span id="configure-lb"></span><h2>Step 6: Configure Load Balancer<a class="headerlink" href="#step-6-configure-load-balancer" title="Permalink to this heading"></a></h2>
<p>This section explains how you can create a network load balancer and route traffic to the Titaniam Servers. Configuring a Load Balancer involves the following steps:</p>
<ol class="arabic simple">
<li><p>Create a target group.</p></li>
<li><p>Create a load balancer and associate it with a target group.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must create separate target group for the Kibana EC2 instance and separate target group for Titaniam Server EC2 instances.</p>
</div>
<section id="create-a-target-group-for-titaniam-server">
<h3>Create a Target Group for Titaniam Server<a class="headerlink" href="#create-a-target-group-for-titaniam-server" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>Log into your AWS account.</p></li>
<li><p>Navigate to the EC2 dashboard.</p></li>
<li><p>Click <strong>Load Balancing</strong> &gt; <strong>Target Groups</strong> &gt; <strong>Create target group</strong>.</p></li>
<li><p>Select the following:</p>
<ul class="simple">
<li><p><strong>Basic Configuration</strong> &gt; <strong>Choose a target type</strong>: <em>Instances</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>Target group name</strong>: <em>&lt;provide a target group name&gt;</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>Protocol</strong>: <em>TCP</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>Port</strong>: <em>8080</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>VPC</strong>: <em>&lt;VPC name where your EC2 instances are deployed&gt;</em></p></li>
<li><p><strong>Health Checks</strong> &gt; <strong>Health check protocol</strong>: <em>TCP</em></p></li>
</ul>
</li>
<li><p>Click <strong>Next</strong>.</p>
<p>The list of <strong>Available instances</strong> appears.</p>
</li>
<li><p>Select the EC2 instances of your Titaniam Servers from the <strong>Available Instances</strong> list.</p></li>
<li><p>Set the <strong>Port</strong> for the selected instances as <em>8080</em>.</p></li>
<li><p>Click <strong>Include as pending below</strong>.</p></li>
<li><p>Review your targets.</p></li>
<li><p>Click <strong>Create target group</strong>.</p></li>
<li><p>After your Target group is created, ensure that the health checks are okay for both the instances.</p>
<img alt="_images/target_groups.png" src="_images/target_groups.png" />
</li>
</ol>
</section>
<section id="create-a-target-group-for-kibana">
<h3>Create a Target Group for Kibana<a class="headerlink" href="#create-a-target-group-for-kibana" title="Permalink to this heading"></a></h3>
<p>Use the same procedure as described above for creating a target for Kibana. Use the following values:</p>
<ol class="arabic simple">
<li><p>Select the following:</p>
<ul class="simple">
<li><p><strong>Basic Configuration</strong> &gt; <strong>Choose a target type</strong>: <em>Instances</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>Target group name</strong>: <em>&lt;provide a target group name&gt;</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>Protocol</strong>: <em>TCP</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>Port</strong>: <em>5601</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>VPC</strong>: <em>&lt;VPC name where your EC2 instances are deployed&gt;</em></p></li>
<li><p><strong>Health Checks</strong> &gt; <strong>Health check protocol</strong>: <em>TCP</em></p></li>
</ul>
</li>
<li><p>Select the Titaniam Plugin EC2 instance from the <strong>Available Instances</strong> list.</p></li>
</ol>
</section>
<section id="create-load-balancer">
<h3>Create Load Balancer<a class="headerlink" href="#create-load-balancer" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>Log into your AWS account.</p></li>
<li><p>Navigate to the EC2 dashboard.</p></li>
<li><p>Click <strong>Load Balancing</strong> &gt; <strong>Load Balancers</strong> &gt; <strong>Create Load Balancer</strong>.</p></li>
<li><p>Click <strong>Create</strong> in the <strong>Network Load Balancer</strong> card.</p></li>
<li><p>Provide a name for the load balancer.</p></li>
<li><p>Ensure the <strong>Scheme</strong> value is set to <em>Internet-facing</em> and <strong>IP address type</strong> is set to <em>IPV4</em></p></li>
<li><p>Select the VPC where your EC2 instances are located.</p></li>
<li><p>Select the availability zones of the EC2 instances on which Titaniam Servers are installed.</p></li>
<li><p>Add listener for Titaniam Server</p>
<ol class="loweralpha simple">
<li><p>Set the <strong>Protocol</strong> as <em>TCP</em> and <strong>Port</strong> as <em>8080</em> in the <strong>Listener and routing</strong> menu.</p></li>
<li><p>Select the target group for Titaniam Server you previously created in the Defaul action &gt; Forward to dialog.</p></li>
</ol>
</li>
<li><p>Add listener for Kibana</p>
<ol class="loweralpha simple">
<li><p>Set the <strong>Protocol</strong> as <em>TCP</em> and <strong>Port</strong> as <em>5601</em> in the <strong>Listener and routing</strong> menu.</p></li>
<li><p>Select the target group for Kibana you previously created in the Defaul action &gt; Forward to dialog.</p></li>
</ol>
</li>
<li><p>Add listener for Kibana</p>
<ol class="loweralpha simple">
<li><p>Set the <strong>Protocol</strong> as <em>TCP</em> and <strong>Port</strong> as <em>5601</em> in the <strong>Listener and routing</strong> menu.</p></li>
<li><p>Select the target group for Titaniam Plugin you previously created in the Defaul action &gt; Forward to dialog.</p></li>
</ol>
</li>
<li><p>Click Create Load Balancer to finish the process.</p>
<p>The load balancer is now created.</p>
</li>
<li><p>Select your load balancer from the <strong>EC2 dashboard</strong> &gt; <strong>Load Balancer</strong> page.</p></li>
<li><p>Copy the DNS Name from the your load balancer &gt; Description &gt; Basic Configuration settings pane.</p></li>
<li><p>On your local computer, run the following curl command to test access to Titaniam Server:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{</span>
 <span class="s2">&quot;data_type&quot;</span><span class="p">:</span><span class="s2">&quot;keyword&quot;</span><span class="p">,</span>
 <span class="s2">&quot;field_name&quot;</span><span class="p">:</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
 <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;abcd&quot;</span><span class="p">,</span>
 <span class="s2">&quot;include_protected_field&quot;</span><span class="p">:</span><span class="s2">&quot;true&quot;</span>
<span class="p">}</span><span class="s1">&#39; &quot;http://&lt;load_balancer_dns&gt;:8080/v2/secure/store&quot;</span>
</pre></div>
</div>
<p>You must see a response similar to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span><span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span><span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;success&quot;</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="p">:{</span><span class="s2">&quot;key_id&quot;</span><span class="p">:</span><span class="s2">&quot;k:e5d9a41a-5f29-414b-998b-11c5159124fd&quot;</span><span class="p">,</span><span class="s2">&quot;es_millis&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;guid&quot;</span><span class="p">:</span><span class="s2">&quot;tn:a1664f0d-6111-4415-bbcd-b54c65cf58c5&quot;</span><span class="p">,</span><span class="s2">&quot;protected_field&quot;</span><span class="p">:</span><span class="s2">&quot;03sGZ06alY{_Y06&#39;%7&gt;Pl06Qu-fE^&quot;</span><span class="p">,</span><span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;abcd&quot;</span><span class="p">,</span><span class="s2">&quot;db_millis&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;db_lookup_millis&quot;</span><span class="p">:</span><span class="mi">13</span><span class="p">}}</span>
</pre></div>
</div>
</div></blockquote>
<p>This message means that the Titaniam Server configured as a Vault is working and is accessible through the load balancer.</p>
</li>
<li><p>On your local computer, run the following request in your browser</p>
<p>Request</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">load_balancer_dns</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">5601</span>
</pre></div>
</div>
</div></blockquote>
<p>Response</p>
<blockquote>
<div><p>The Kibana interface must launch in the browser.</p>
</div></blockquote>
<p>This message means that the Titaniam Plugin is accessible through the load balancer.</p>
</li>
</ol>
</section>
</section>
</section>
<section id="appendix-titaniam-specific">
<h1>Appendix: Titaniam-Specific<a class="headerlink" href="#appendix-titaniam-specific" title="Permalink to this heading"></a></h1>
<p>This section includes information about how-tos, code examples, and resources that are useful when you want to do advanced installations and configurations of the Titaniam Server.</p>
<blockquote>
<div></div></blockquote>
<section id="id48">
<span id="id49"></span><h2>Zero-day Encryption Service<a class="headerlink" href="#id48" title="Permalink to this heading"></a></h2>
<p>Ensure that any passwords and secrets that you mention in the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file are encrypted. You must not enter PlainText values. Use the Zero-day encryption service from Titaniam to perform the encryption.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl --location --request POST ‘https://demo.titaniam.io:8080/v1/mgmt/property?type=encrypt&amp;value=&lt;value&gt;’
</pre></div>
</div>
<p>The Titaniam zero-day encryption utility returns the encrypted value.</p>
</section>
<section id="configure-tls-and-mtls-authentication">
<span id="mtls"></span><h2>Configure TLS and mTLS Authentication<a class="headerlink" href="#configure-tls-and-mtls-authentication" title="Permalink to this heading"></a></h2>
<p>Titaniam Server is built using standard Java framework (SpringBoot) and setting up TLS and MTLS broadly involves: procuring the certificates, populating these certificates in the java trust store, and mounting it as a volume to the docker container.</p>
<ol class="arabic">
<li><p>You must configure the TLS following properties in the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;server.ssl.port&quot;</span><span class="p">:</span> <span class="s2">&quot;443&quot;</span><span class="p">,</span>
<span class="s2">&quot;server.ssl.enabled&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;server.ssl.key-store&quot;</span><span class="p">:</span> <span class="s2">&quot;file:/usr/local/granger/key-store.jks&quot;</span><span class="p">,</span>
<span class="s2">&quot;server.ssl.key-store-password&quot;</span><span class="p">:</span> <span class="s2">&quot;changeit&quot;</span><span class="p">,</span>
<span class="s2">&quot;server.ssl.key-alias&quot;</span><span class="p">:</span> <span class="s2">&quot;server&quot;</span><span class="p">,</span>
<span class="s2">&quot;server.ssl.key-store-type&quot;</span><span class="p">:</span> <span class="s2">&quot;JKS&quot;</span><span class="p">,</span>
<span class="s2">&quot;server.ssl.key-store-provider&quot;</span><span class="p">:</span> <span class="s2">&quot;SUN&quot;</span>
</pre></div>
</div>
</li>
<li><p>You must configure the following additional properties in the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>## enable mTLS
  &quot;server.ssl.client-auth&quot;:&quot;need&quot;,
  &quot;server.ssl.trust-store&quot;:&quot;file:/usr/local/granger/trust-store.jks&quot;,
  &quot;server.ssl.trust-store-password&quot;:&quot;changeit&quot;,
  &quot;server.ssl.trust-store-type&quot;:&quot;JKS&quot;

.. Note::

   You must supply the ``key-store.jks`` and ``trust-store.jks`` files.
</pre></div>
</div>
</li>
<li><p>Obtain a CA issued certificate and add it to the Java keystore file. See <a class="reference external" href="https://www.baeldung.com/java-import-cer-certificate-into-keystore">instructions</a>.</p></li>
<li><p>Mount the disk containing the keystore to the Docker image as a volume in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file:</p></li>
</ol>
<blockquote>
<div><dl class="simple">
<dt>volumes:</dt><dd><ul class="simple">
<li><p>/home/centos/certs/server.keys.jks:/usr/local/granger/key-store.jks</p></li>
<li><p>/home/centos/certs/trust-store.jks.jks:/usr/local/granger/trust-store.jks</p></li>
</ul>
</dd>
</dl>
</div></blockquote>
</section>
<section id="configure-single-sign-on">
<span id="sso"></span><h2>Configure Single-Sign On<a class="headerlink" href="#configure-single-sign-on" title="Permalink to this heading"></a></h2>
<section id="id50">
<h3>Prerequisites<a class="headerlink" href="#id50" title="Permalink to this heading"></a></h3>
<p>An SSO server such as KeyCloak and Google oAUTH.</p>
</section>
<section id="configuring-sso">
<h3>Configuring SSO<a class="headerlink" href="#configuring-sso" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>You must configure the following properties in the Titaniam Server <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">sso</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
</li>
<li><p>Delete or comment out the following property:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">spring</span><span class="o">.</span><span class="n">autoconfigure</span><span class="o">.</span><span class="n">exclude</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">boot</span><span class="o">.</span><span class="n">autoconfigure</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">servlet</span><span class="o">.</span><span class="n">SecurityAutoConfiguration</span><span class="p">,</span><span class="n">org</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">boot</span><span class="o">.</span><span class="n">actuate</span><span class="o">.</span><span class="n">autoconfigure</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">servlet</span><span class="o">.</span><span class="n">ManagementWebSecurityAutoConfiguration</span>
</pre></div>
</div>
</li>
<li><p>Create SSO configuration table (<code class="docutils literal notranslate"><span class="pre">sdss_configurations</span></code>) in the datastore that you installed with Titaniam Server.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="o">*****</span> <span class="n">PostgreSQL</span> <span class="o">*****</span>
<span class="o">--</span> <span class="n">Create</span> <span class="n">configurations</span> <span class="n">table</span>
<span class="n">create</span> <span class="n">table</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span> <span class="n">sdss_configurations</span> <span class="p">(</span>
       <span class="nb">id</span> <span class="n">bigserial</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span>
       <span class="n">name</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span>
       <span class="n">value</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span>
       <span class="n">primary</span> <span class="n">key</span> <span class="p">(</span><span class="nb">id</span><span class="p">)</span>
   <span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Delete any existing entries in the <code class="docutils literal notranslate"><span class="pre">sdss_configurations</span></code> table.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">delete</span> <span class="kn">from</span> <span class="nn">sdss_configurations</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Insert entries in the <code class="docutils literal notranslate"><span class="pre">sdss_configurations</span></code> table.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">--</span> <span class="n">insert</span> <span class="n">configurations</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">sdss_configurations</span> <span class="n">values</span>
 <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;sso_issuer_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://&lt;SSO_HOST&gt;/auth/realms/&lt;SSO_REALM_NAME&gt;&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;sso_client_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;SSO_CLIENT_ID&gt;&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;sso_client_secret&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;SSO_CLIENT_SECRET&gt;&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Where,</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SSO_HOST</span></code> - SSO server host with port</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SSO_REALM_NAME</span></code> - Created SSO Realm name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SSO_CLIENT_ID</span></code>- SSO Client ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SSO_CLIENT_SECRET</span></code> - SSO Client Secret</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Bring up the Titaniam Server service.</p></li>
<li><p>Generate SSO token using the following curl command:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type:application/x-www-form-urlencoded&quot;</span> \
  <span class="o">-</span><span class="n">d</span> <span class="s2">&quot;grant_type=password&quot;</span> \
  <span class="o">-</span><span class="n">d</span> <span class="s2">&quot;client_id=titaniam-sdv&quot;</span> \
  <span class="o">-</span><span class="n">d</span> <span class="s2">&quot;client_secret=444d83c8-9732-41d1-9416-d7cd36382de5&quot;</span> \
  <span class="o">-</span><span class="n">d</span> <span class="s2">&quot;username=sdvtestuser&quot;</span> \
  <span class="o">-</span><span class="n">d</span> <span class="s2">&quot;password=sdvtestuser&quot;</span> \
<span class="s1">&#39;http://&lt;SSO_HOST&gt;/auth/realms/&lt;SSO_REALM_NAME&gt;/protocol/openid-connect/token&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Pass the authorization token generated from the previous step in the Titaniam Server endpoints. For example,</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">location</span> <span class="o">--</span><span class="n">request</span> <span class="n">POST</span> <span class="s1">&#39;http://localhost:8080/v2/secure/store&#39;</span> \
 <span class="o">--</span><span class="n">header</span> <span class="s1">&#39;Authorization: Bearer &lt;TOKEN&gt; </span><span class="se">\</span>
<span class="s1"> --header &#39;</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="s1">&#39; </span><span class="se">\</span>
<span class="s1"> --data-raw &#39;</span><span class="p">{</span>
     <span class="s2">&quot;data_type&quot;</span><span class="p">:</span><span class="s2">&quot;keyword&quot;</span><span class="p">,</span>
     <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span>
     <span class="s2">&quot;include_protected_field&quot;</span><span class="p">:</span><span class="n">true</span>
 <span class="p">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</section>
<section id="disabling-sso">
<h3>Disabling SSO<a class="headerlink" href="#disabling-sso" title="Permalink to this heading"></a></h3>
<p>To disable SSO, do the following:</p>
<ol class="arabic">
<li><p>You must configure the following properties in the Titaniam Server <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">sso</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">false</span>
</pre></div>
</div>
</li>
<li><p>Add or uncomment the following property:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">spring</span><span class="o">.</span><span class="n">autoconfigure</span><span class="o">.</span><span class="n">exclude</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">boot</span><span class="o">.</span><span class="n">autoconfigure</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">servlet</span><span class="o">.</span><span class="n">SecurityAutoConfiguration</span><span class="p">,</span><span class="n">org</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">boot</span><span class="o">.</span><span class="n">actuate</span><span class="o">.</span><span class="n">autoconfigure</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">servlet</span><span class="o">.</span><span class="n">ManagementWebSecurityAutoConfiguration</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="configure-authorization">
<span id="auth-token"></span><h2>Configure Authorization<a class="headerlink" href="#configure-authorization" title="Permalink to this heading"></a></h2>
<p>Token-based authorization is a method for securing endpoints (API calls or web pages) in a server-client architecture. The basic idea is that the client (e.g. a mobile app or website) sends a request to the server to authenticate a user. If the user is successfully authenticated, the server responds with a token. The client then includes this token in subsequent requests to the server, which uses it to determine the user’s identity and authorize access to specific endpoints.</p>
<p>One of the advantages of token-based authorization is that it allows the server to grant or deny access to specific endpoints, rather than just allowing or denying all access. Additionally, token-based authorization allows for the use of short-lived tokens, which can be easily revoked if a user’s device is lost or stolen, for example.</p>
<p>Configuring the token-based authorization is a deployment-time operation. You must configure the following properties in the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;sdss.auth.enabled&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span>
<span class="s2">&quot;sdss.auth.access-key.1.encrypted&quot;</span><span class="p">:</span> <span class="s2">&quot;zero-day-encrypted-access-token&gt;&quot;</span>
<span class="s2">&quot;sdss.auth.access-key.1.paths&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;end-points-to-protect&gt;&quot;</span>
</pre></div>
</div>
<p>Where,</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.auth.enabled=true</span></code> enables token-based authorization.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.auth.access-key.1.encrypted</span></code> specifies the encrypted token. The token you receive from your adminsitator must be encrypted using the zero-day encryption service. You must pass this token as part of the HTTP request using the header <code class="docutils literal notranslate"><span class="pre">x-tn-access-key</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.auth.access-key.1.paths</span></code> specifies a list of endpoints that you want to protect. You can specify multiple endpoints in this property. For example, <code class="docutils literal notranslate"><span class="pre">sdss.auth.access-key.1.paths=/v1/mgmt/,/schema/{schema_name}/{schema_version}</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>When you protect an endpoint such as <code class="docutils literal notranslate"><span class="pre">/v1/mgmt/</span></code>, all endpoints such as <code class="docutils literal notranslate"><span class="pre">/v1/mgmt/key-rotations</span></code>, <code class="docutils literal notranslate"><span class="pre">/v1/mgmt/version</span></code> are also protected.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">,</span></code> is the delimited when specifying multiple paths.</p></li>
<li><p>HTTP verbs are currently <em>not protected</em>.</p></li>
<li><p>You can mention multiple authorization tokens. For mentioning a second access key, use <code class="docutils literal notranslate"><span class="pre">sdss.auth.access-key.2.encrypted</span></code> and <code class="docutils literal notranslate"><span class="pre">sdss.auth.access-key.1.paths</span></code>.</p></li>
</ul>
</div>
</li>
</ul>
</section>
<section id="generate-keys">
<span id="master-key"></span><h2>Generate Keys<a class="headerlink" href="#generate-keys" title="Permalink to this heading"></a></h2>
<p>This section explains how you can generate a key using openssl. The key generated using this procedure can be used as a master key (also called as key encryption key (KEK)) or as a plain text data encryption key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openssl</span> <span class="n">rand</span> <span class="mi">1024</span> <span class="o">|</span> <span class="n">openssl</span> <span class="n">enc</span> <span class="o">-</span><span class="n">A</span> <span class="o">-</span><span class="n">base64</span>
</pre></div>
</div>
<p>Expected Output: The command produces an output similar to the following. The exact output varies each time you run the command. Copy the output to clipboard and use it as an encryption key. The master key must be entered in plain text in the keyring.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Ensure that you keep this output safe and secure.</p></li>
<li><p>Ensure that there are no whitespaces and line endings in the key. <code class="docutils literal notranslate"><span class="pre">-A</span></code> in the above command ensures that the output it stripped of new lines.</p></li>
</ul>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AYtK7YeK2SLR8pfKxPvDssM3HAJr3QihYIGYrfd4bHCgS3Lwuxrc</span><span class="o">/</span><span class="n">uqbbCvc05fd4MWv</span><span class="o">/</span><span class="mi">0</span><span class="n">LRTTXuE6KJ4h</span><span class="o">/</span><span class="n">rqyorIVX1VjOoAfh3Gc</span><span class="o">+</span><span class="n">NzNDGSpZika9Bwgat</span><span class="o">+</span><span class="mi">6</span><span class="n">eEI9SCm3wu5KwujXEqRRSZzr2gZEPc6C26iFJUqsWwudyQLC25m</span><span class="o">+</span><span class="n">uPUDwdDzOGendSI2xjgMbFnOZgyDZmXKWYpyjNiSb3P7qZqTte40j7az2HlLfM6pUlUU3gVMObxCXNX6BgzjjBeuUkNLYNdaaggVSc</span><span class="o">/</span><span class="n">eZLY6MBdsCZ9x926d8TGmTIVe4tioULq45jEf9ON</span><span class="o">/</span><span class="n">q</span><span class="o">/</span><span class="n">lWU4vtoCNNNODP</span><span class="o">/</span><span class="n">jUColaiAdxoDJRV2</span><span class="o">+</span><span class="n">tSzRPsYOdUcTfmPEQThAMhk8IdcFXrouAQyOtLLxn4</span><span class="o">+</span><span class="n">IIuqPdIwBnCzZM9apFjmD5pN84lL1EZTCH</span><span class="o">/</span><span class="n">B5wM2OSwqjF0Y90qyoiGYrcEKY6jQIqekk</span><span class="o">+</span><span class="n">ceNAOxskdQdcFsQlsYzrlH</span><span class="o">/</span><span class="n">dVJq9GkcQvTxQieOrL5X1P5LjJpcMOiT4puIDps44sBxw2S25xWtkV4lYYE</span><span class="o">+</span><span class="n">X</span><span class="o">+</span><span class="n">fc</span><span class="o">/</span><span class="n">HNKxI</span><span class="o">+</span><span class="n">im5LsqJKR8WmuQZlAxdbCJJRgymxmfhJfYIvL3LLR</span><span class="o">/</span><span class="n">lDrcSvA6GmK8oUMO2NfcpQ1eZnmwxg3zFxNi</span><span class="o">/</span><span class="n">mAOXHu</span><span class="o">/</span><span class="n">SEf5DGNCCF2dWcNJs3iF4YvkweUW1STditWZHNwMKjw394MzE</span><span class="o">/</span><span class="n">WX0DDMWY88MiSy</span><span class="o">/</span><span class="n">EnecaDdXWz0s97LOwSkmU4SP2iJIoXabmMf8Uc3YOjXD7wqy</span><span class="o">/</span><span class="n">ujUIyUewd</span><span class="o">/</span><span class="n">Ys0umFzuGOTmoOtAinjL</span><span class="o">+</span><span class="n">cMuyyS5G4Zfu0kEBlGexbDDtj6mqk</span><span class="o">+</span><span class="n">T369B8VTSF3gi</span><span class="o">/</span><span class="n">HAEQSZUz83YivE60PypE69E7qb1BhIfodgZLBHyyKWXfX11jNqGmUbH0tUU8p6K1dxo8pkjFRxXI8nB</span><span class="o">+</span><span class="n">A5LuwjTZtOFO1Ak0el</span><span class="o">+</span><span class="n">dIJKxQgSWSQsFwrBjiUcvX</span><span class="o">/</span><span class="n">Erlb5eKB56cTCwjozETUGOtngIlnroqbn2SmpDK1XA</span><span class="o">/</span><span class="n">PG04wdKlDPvHAOqY3jHv0BO4xmBQAMQjY6HqnvxU7dlSkjBh3k04St1VBB</span><span class="o">+</span><span class="mi">4</span><span class="n">ejjqfKu</span><span class="o">/</span><span class="n">uP70GmlYapBJYuBNgdA</span><span class="o">/</span><span class="n">Ugy3yi2rWyK1PmXg1X7t</span><span class="o">+</span><span class="n">TFeDxhZACiwZ6xPCdO23lDPGPezQuApEBTzOoAkHnn8oXMDflUfR7Hp7Zxu</span><span class="o">/</span><span class="n">X1eo7WijeVGjwc3DQ5wbps5sGBJlS5FZFjxBaHpdzBQ5a1mVVnMe7kGdN</span><span class="o">+</span><span class="mi">62</span><span class="n">noKD</span><span class="o">/</span><span class="n">AJ822Ly7eyJGpUxPrabwgqP5K8UIbB7p</span><span class="o">/</span><span class="n">zGhx9IpPPBriphStP2v8YnKg31TpTlswTJ4v4UzIuMtohW3UxO</span><span class="o">/</span><span class="n">Sd5lJZYPWZ3svnHVS5LZ1jPLKt2NmNrHRXglde</span><span class="o">/</span><span class="mi">39</span><span class="n">EDzNRKhZkeK3Dy</span><span class="o">+</span><span class="mi">486</span><span class="n">UGLndn4M</span><span class="o">+</span><span class="n">PqbFyKEgttRMnd3Nw0GqoG1fw</span><span class="o">==</span>
</pre></div>
</div>
</section>
<section id="keyring-json">
<span id="key-ring-json"></span><h2>Keyring.JSON<a class="headerlink" href="#keyring-json" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">keyring.json</span></code> being used in the key rotation scheme includes a master key and one or more data encryption keys. You can select one of these keys as an active key. The active key is used for protecting the data.</p>
<p>Use the key encryption key and data encryption key you have generated (see <a class="reference internal" href="#keygen2"><span class="std std-ref">Generate Keys</span></a>) to construct the <code class="docutils literal notranslate"><span class="pre">keyring.json</span></code>.</p>
<p>Following is a structure of the keyring:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="s2">&quot;master&quot;</span><span class="p">:</span> <span class="s2">&quot;Lj4NvwjpKC5653EXLvFEcsi8tPz0kiR9J12baG6JS6wuXfX0eEw92Pmidv7qDGPdyHZrsds+1gZlI6Vai7/VpOzmF53swKkMtXs26PK6DthxeuL1/0KbVbORxUkp5GsAgdzgrDZ37fGh0GS7eheHFLMeHTYBOnw2a8HcI5+ui3RZLrSw5/6NMB9yP8kbxdsyFcvVFIXFyNucYAa25t6aeLLStGvX2hKXidwXjU/V6YYw9g9HturnIokUbN8eLvq7ICzo16ElL3WsQtmM+EDdzDJ0e9e/fifcKKwRhgfPVWQMwO93JEbLf0hoVY/Z8DjCXBWDXFOjXA+jIgXFiH5VKDA90xgDtODTkUxibBtWp5eElCBtJVNnANtxnI4sJA79HNKUtybMWbqxpBJyypIVtpTVz0lx/upG4DSr6KAC17a104k7N7VnI0Mmk7lWMttfCXQ7QHI3zqR6Gtr7N3hksLCzsRsmVABs2qF2zRNy8Ex1oXzJ6W5TZ6QnimpmT0pFG0eF0qZQduR47XqyuRl1f/1TCMSdwNwGC8rtxkifR6/VXPg4rSlduxefELvk4wk028Sjc9XPrGmTukGLGjz+nxGkp374WStkJJcvjZV2vv/dPvoi4LM2ptKvT6rAt/fC1+JseoSMTE3+WkJpr+uV4+Q8rluN9M5hk+CkqT/yGS6DfNN7FuGVvXw/MhB76eNbZtj/qrOWz/BVViY6QTrtqERIJ5u0QE79ZGPenSRLBDjth2LSqziBLcoP7W6U/VWdnrcXwyrCPIP1eYdMPFkvVZYtnBTRPluTWPOTBasJpHbpTClUhx5vul5l+lw2kmwtk3VHCQYQbYybkWGuG1wZLs9hb0+dNaoZRKGDTukC5omphNMBMWICB+G39+Ufg0rG0j1Ia4SitrFAfDEfBVSF2D7C18nS9rUicq/HS3sUQwnWzU0ICPh/41UrUzFKpB1fRgvoIaykC9+VKVp7RwHHCEN4eOySUkDpqQGaM9sY4Lic+N65QaJjAdDE65PAyfds6VL10ODQ+yr8r3mulq0YyTq3VNsBgE52g5HFP3tKcnLvYVj1cruplggc+m1e/0GahVLCWzM2+QbI3xZvnW6XL9MFo4lPtfFCG2UavNqy5hg3FFteFoOI6wMvk9awoSXC+I4kvANGv8MgdW18fvMDEA7iMRSOhns/BlZW8QcXYEgqn1eA0RdrYpisegQMSCb33gBRaSCqx177XD4mig8oT2QcxUeSfJP7PU0d3n+pT7aOZGdiMgK9YbE8jL2XkCGXg/9jaZUrQXi66GrUhOsNsMjG23oxwKZ/HRPLIakfT83hLDRKjBXFvI+1A==&quot;</span><span class="p">,</span>
<span class="s2">&quot;keys&quot;</span><span class="p">:</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;sdss-store&quot;</span><span class="p">,</span>
    <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;AS2hS0BWfbrH74e4DZbsMul6evT9HCU3UQ+3JlYKRrocZrBh4CXKhMyQ7dEaa61K53gg1r3gRl8wjdgH8HWqm0dMwit7JxEahjLQpU6ceDoxTqYd7QX+0KNw7jVQhTVZcAn9TGwMTOYbYyLeYRPpbCKikjp7YYyCRuGnzdRtYRJR+bbOkPaOHEFwuc=&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;sdss-store-006&quot;</span><span class="p">,</span>
    <span class="s2">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;AdTcKbtAzL9cV9upT1lVGkAV2obWWXrJoczAysONsapEs6xpLWM5Htg8jITOu5omOe55OrzNGj4rdM691CL+tped3JHc+uzP47T1+ebF/XxIRzylU2J4nmJjFFurgSFUZeQJHmEoOX6z8N5NMVt8XiKsDK35lAQyj8Rb6qwNlQe7TZlv+BRAn1Y5r8uqnt2wkrZg8uqBgAQuU7RbjwS2gf/3hmD7XCzOV6FxnILDJBRhtsuGqjGVfjP3B7U0ctQoKUZvI2fjvOkb6O0GN5QQjBRq+RU4djz+/4wWejcLp5qrEYiLSm6CGLNlqEoik766qj/kjJBqShDEOkurWFx5wM+zhl6oChHLkucFHjumJf48B+77p5YY29OjmNvkby2G1BXcs1WLUC+ZCHLjVZk1SiAMLndQVJw4rXuk+hyNES7osM0mMbs3fmRKOJSYUUKosIXTPJYm2KrbdQUP2KsPTqCBDRhb/T7HYJa4RP+X35zUPde5L+yyDKdGmjqmpWeSeUqkuvx27xaRbYX+Z7uDD6H2WBWpTHZ7tiqJUdkz29yqDxWRdONRa4ElO4ibQgdf+oJc73E6wqmOuzz5J8YnnV/BEZ9ahELvgjQAfuJnmA6IpvHPxD8XpMvjIPiPaOtE5Hocwf879OWFcPiEoebCQFGi8My2xQJr9VQUgHglmTdc03Izr6acMUrXr1Om1X6vPV8hDzuufSdbWCauDh62bSV3y2rQgIB+kDlHDlzQarn48erHWsL6n0B/rUeXYl6sNCrllWaNTzSQlQMo6XyTKFBP0VoxKcZTa8CgjGY3gMBuU6azXYJKoZxkEEbUYfgMKawc+/lZ4U4fhUIrapMZBPGVGArm/6wECLnQxefQc7X2NjpeLb1vCCputHzXkH+yalsFckhjwGrVPfegWyGmRNff4CHeicm/BevsBB6uP47pKFfFQFR/YJ3E+mjrDijlVZsvBds7hFdM3NYSZA+cZ/vnwSJYTP0mnC+u5RoI/89DbOcdIWGiQoZvLhhvCnKMIrIC7BnGyrrYnrJiJoVxHP3ErwvFRJL7xUFYrsrKNA21cQta/jP2ZhuFFW/3PN9enPV+5CKoyTfdwb7MsvzER7CVgcKkHma9h3KXCc6e7rR2EL2PJdlov/xvkDi3OqKtHwvmpG3JJok8VGcFUYHLbuM0+yt45/WJKp/L8Vy066w7ZxkM6xfeMxQoRGDzM6UlDUTbllzPHcY99/34EPUWubkkqjvhJRPc1hsM2fh9AmiI3E92/8DJQOt9RvC8mgYj1EB/oqwRu5hOSG4Q6nYJrBGeHj8Oq6C0wZ+wu7Nasps7V9FWckoH9NM+QXkHT0rtBrh9XFDGXKQ==&quot;</span><span class="p">,</span>
    <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">true</span>
    <span class="p">}</span>
   <span class="p">]</span>
  <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="generate-an-encrypted-data-encryption-key-and-optionally-a-master-key">
<span id="keygen2"></span><h2>Generate an Encrypted Data Encryption Key and Optionally a Master Key<a class="headerlink" href="#generate-an-encrypted-data-encryption-key-and-optionally-a-master-key" title="Permalink to this heading"></a></h2>
<p>Titaniam provides Java code to generate master key and encrypted data encryption keys. This Java code does the following:</p>
<ol class="arabic simple">
<li><p>Generates a master encryption key (if you do not provide one). If you provide a master encryption key, this code will use that key to encrypt the data encryption key.</p></li>
<li><p>Generates a data encryption key.</p></li>
<li><p>Encrypts the data encryption key using the master key.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>JAVA minimum version required is <code class="docutils literal notranslate"><span class="pre">jdk-8u351</span></code> to compile this code.</p>
</div>
<p>Use the following procedure to generate an encrypted data encryption key.</p>
<ol class="arabic simple">
<li><p>Compile <a class="reference internal" href="#keygencode"><span class="std std-ref">KeyGen Code</span></a> Java code.</p></li>
<li><p>Run the following command:</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">java</span> <span class="n">KeyGen2</span> <span class="n">number</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">keys</span> <span class="p">(</span><span class="n">optional</span><span class="p">)</span> <span class="n">key</span><span class="o">-</span><span class="n">encryption</span><span class="o">-</span><span class="n">key</span> <span class="p">(</span><span class="n">optional</span><span class="p">)</span>
</pre></div>
</div>
<p>Where,</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">number-of-keys</span></code> specifies the number of data encryption keys you want to generate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key-encryption-key</span></code> provide your master key or KEK. This argument is optional. If you do not provide any key here, this code generates a new master key</p></li>
</ul>
</div></blockquote>
<p>The output is an encrypted data encryption key. You can directly use this key in your <code class="docutils literal notranslate"><span class="pre">keyring.json</span></code> or store this as secret in your AWS Secrets Manager.</p>
</div></blockquote>
<section id="keygen-code">
<span id="keygencode"></span><h3>KeyGen Code<a class="headerlink" href="#keygen-code" title="Permalink to this heading"></a></h3>
<p>Following is the code to generate the KeyGen utility.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import javax.crypto.BadPaddingException;
import javax.crypto.Cipher;
import javax.crypto.IllegalBlockSizeException;
import javax.crypto.ShortBufferException;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import java.security.InvalidAlgorithmParameterException;
import java.security.InvalidKeyException;
import java.util.Base64;
import java.util.Random;

/**
 * Utility class to generate encryption key ciphers as well as
 * key encryption key for including in Titaniam KeyRing.
 * &lt;p&gt;
 * Usage  : java KeyGen2 number-of-keys (optional) key-encryption-key (optional)
 * Input Parameters:
 * 1. number-of-keys: indicates how many data encryption keys must be generated.
 *                    defaults to 1 if nothing is specified
 * 2. key-encryption-key : when adding an encryption key to an existing keyring, specify
 *                         the key-encryption-key from the existing keyring. not required
 *                         for generating new keyring. must be the second parameter when used.
 * &lt;p&gt;
 * Example: java KeyGen2 3
 * Example: java KeyGen2 1 &quot;m7ODlUJ3m....rrAHJmQ==&quot;
 *
 * &lt;p&gt;
 * This outputs a new key encryption key and the encryption key encrypted using the new
 * key encryption key.
 */
public class KeyGen2 {

    /**
     * Main method of execution.
     * Run without any arguments to get usage help.
     *
     * @param argv expects 2 args for this application.
     * @throws Exception if there is any issue with input data
     */
    public static void main(String[] argv) throws Exception {

        if (isHelpRequested(argv)) {
            printUsage();
            return;
        }

        String numberOfKeysAsString = argv.length &gt; 0 ? argv[0] : &quot;1&quot;;
        String inputKEK             = argv.length &gt; 1 ? argv[1] : null;

        int numberOfKeys = Integer.parseInt(numberOfKeysAsString);
        Cipher cipher    = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);

        // Key Encryption Key
        byte[] newKEK = inputKEK!=null ? base64ToBytes(inputKEK) : randomBytes(1024);
        prettyPrintResults(newKEK, &quot;master&quot;);

        for(int i=0;i&lt;numberOfKeys;i++) {
            byte[] encryptionKey    = randomBytes(1024);
            // Encrypt using KEK
            byte[] dataReEncrypted  = encryptData(newKEK, encryptionKey, cipher);

            prettyPrintResults(dataReEncrypted, &quot;key&quot;+(i+1));
        }
    }

    private static void prettyPrintResults(byte[] data, String name) {

        System.out.println(name+&quot;:&quot;);
        System.out.print(&quot;\&quot;&quot;);
        System.out.print(Base64.getEncoder().encodeToString(data));
        System.out.println(&quot;\&quot;\n&quot;);
    }

    private static byte[] encryptData(byte[] newKEK, byte[] dataClear, Cipher cipher) throws InvalidKeyException, InvalidAlgorithmParameterException, ShortBufferException, IllegalBlockSizeException, BadPaddingException {

        SecretKeySpec reEncryptKeySpec = new SecretKeySpec(makeKey(newKEK), &quot;AES&quot;);

        byte[] initVector = randomBytes(cipher.getBlockSize());
        IvParameterSpec encryptIVSpec = new IvParameterSpec(initVector);

        cipher.init(Cipher.ENCRYPT_MODE, reEncryptKeySpec, encryptIVSpec);

        byte[] output    = new byte[cipher.getBlockSize() + cipher.getOutputSize(dataClear.length)];

        System.arraycopy(initVector,0,output,0, cipher.getBlockSize());

        cipher.doFinal(dataClear, 0, dataClear.length, output, cipher.getBlockSize());

        return output;
    }


    /**
     * Convers the input string in base64 to bytes.
     * Will throw exceptions if there are any issues with
     * data validity.
     */
    private static byte[] base64ToBytes(String base64) {
        return Base64.getDecoder().decode(base64);
    }

    /**
     * Returns a subset of the key of the length
     * that is required for AES encryption
     */
    public static byte[] makeKey(byte[] keyBytes) {

        final int size = 16;

        assert keyBytes!=null;

        if(keyBytes.length &lt; size) {
            throw new IllegalArgumentException(&quot;Unable to make key. Expected &gt; &quot;+size+&quot;, actual: &quot;+keyBytes.length);
        }

        byte[] bytes = new byte[size];

        System.arraycopy(keyBytes, 0, bytes, 0, bytes.length);

        return bytes;
    }

    public static byte[] randomBytes(int size) {

        byte[] bytes = new byte[size];

        new Random().nextBytes(bytes);

        return bytes;
    }

    /**
     * Prints help
     */
    private static void printUsage() {
        System.out.println(&quot;\tUsage  : java KeyGen2 number-of-keys (optional) key-encryption-key (optional)&quot;);
        System.out.println(&quot;\tExample: java KeyGen2 1 \&quot;m7ODlUJ3m....rrAHJmQ==\&quot; &quot;);
        System.out.println(&quot;\tExample: java KeyGen2 3 &quot;);
    }

    private static boolean isHelpRequested(String[] argv) {
        return argv != null &amp;&amp; argv.length == 1 &amp;&amp; (argv[0].equals(&quot;-h&quot;) || argv[0].equals(&quot;--help&quot;));
    }

}
</pre></div>
</div>
</section>
</section>
<section id="rekeying">
<span id="rekey"></span><h2>Rekeying<a class="headerlink" href="#rekeying" title="Permalink to this heading"></a></h2>
<p>Changing the master key is called <em>rekeying</em>. How frequently you perform <em>Rekeying</em> is entirely based on your company’s security policies.</p>
<p><strong>How Does the Rekeying Process work in the Titaniam Server</strong></p>
<p>The rekeying process involves the following steps:</p>
<ol class="arabic simple">
<li><p>Generate a new master key.</p></li>
<li><p>Decrypt the existing encrypted data encryption in your keyring (<code class="docutils literal notranslate"><span class="pre">keyring.json</span></code> or secret from AWS) to get the plain data encryption key.</p></li>
<li><p>Re-encrypt the data encryption key using the new master key.</p></li>
</ol>
<section id="rekeying-prerequisites">
<h3>Rekeying Prerequisites<a class="headerlink" href="#rekeying-prerequisites" title="Permalink to this heading"></a></h3>
<ul>
<li><p>JAVA minimum version required is jdk-8u351.</p></li>
<li><p>Gather data to validate the rekeying process. The following example assumes that you are using the Titaniam translation service. Send the following request to the Titaniam Translation Service.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{</span>
         <span class="p">{</span><span class="s2">&quot;input&quot;</span><span class="p">:[</span><span class="s2">&quot;Hello World&quot;</span><span class="p">,</span><span class="s2">&quot;Hello again&quot;</span><span class="p">]}</span>
     <span class="p">}</span><span class="s1">&#39; &quot;{{IPaddress}}/aes/encrypt&quot;</span>
</pre></div>
</div>
<p>Response</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
     <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
     <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
     <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
         <span class="s2">&quot;Hello World&quot;</span><span class="p">:</span> <span class="s2">&quot;AQAAAAEAAAGF1/0PHs/70H5gI0ZnRRmfQ3EG37nTdEeO&quot;</span><span class="p">,</span>
         <span class="s2">&quot;Hello again&quot;</span><span class="p">:</span> <span class="s2">&quot;AQAAAAIAAAGF1/0PIM/70H4j/8NLswjpyMVmrkURuapL&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Note these output values. You will need them to decrypt after rekeying.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="how-to-rekey">
<h3>How to Rekey<a class="headerlink" href="#how-to-rekey" title="Permalink to this heading"></a></h3>
<p>Use the following process to update the <code class="docutils literal notranslate"><span class="pre">keyring.JSON</span></code> file when you rekey your master encryption key:</p>
<ol class="arabic">
<li><p>Compile the <code class="docutils literal notranslate"><span class="pre">ReKey.java</span></code> code. See the code here.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">javac</span> <span class="n">ReKey</span><span class="o">.</span><span class="n">java</span>
</pre></div>
</div>
</li>
<li><p>Run the following command. The following command does the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">java</span> <span class="n">ReKey</span> <span class="o">&lt;&lt;</span><span class="n">old</span> <span class="n">master</span> <span class="n">key</span> <span class="o">/</span><span class="n">key</span> <span class="n">encryption</span> <span class="n">key</span><span class="o">&gt;&gt;</span>  <span class="o">&lt;&lt;</span> <span class="n">encrypted</span> <span class="n">data</span> <span class="n">encryption</span> <span class="n">key</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;&lt;old</span> <span class="pre">master</span> <span class="pre">key</span> <span class="pre">/key</span> <span class="pre">encryption</span> <span class="pre">key&gt;&gt;</span></code> is the <code class="docutils literal notranslate"><span class="pre">master</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span> <span class="pre">encrypted</span> <span class="pre">data</span> <span class="pre">encryption</span> <span class="pre">key&gt;&gt;</span></code> is the <code class="docutils literal notranslate"><span class="pre">key</span></code> field from the active key in your <code class="docutils literal notranslate"><span class="pre">keryring.json</span></code> file.</p>
</div>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">java</span> <span class="n">ReKey</span> <span class="n">Lj4NvwjpKC5653EXLvFEcsi8tPz0kiR9J12baG6JS6wuXfX0eEw92Pmidv7qDGPdyHZrsds</span><span class="o">+</span><span class="mi">1</span><span class="n">gZlI6Vai7</span><span class="o">/</span><span class="n">VpOzmF53swKkMtXs26PK6DthxeuL1</span><span class="o">/</span><span class="mi">0</span><span class="n">KbVbORxUkp5GsAgdzgrDZ37fGh0GS7eheHFLMeHTYBOnw2a8HcI5</span><span class="o">+</span><span class="n">ui3RZLrSw5</span><span class="o">/</span><span class="mi">6</span><span class="n">NMB9yP8kbxdsyFcvVFIXFyNucYAa25t6aeLLStGvX2hKXidwXjU</span><span class="o">/</span><span class="n">V6YYw9g9HturnIokUbN8eLvq7ICzo16ElL3WsQtmM</span><span class="o">+</span><span class="n">EDdzDJ0e9e</span><span class="o">/</span><span class="n">fifcKKwRhgfPVWQMwO93JEbLf0hoVY</span><span class="o">/</span><span class="n">Z8DjCXBWDXFOjXA</span><span class="o">+</span><span class="n">jIgXFiH5VKDA90xgDtODTkUxibBtWp5eElCBtJVNnANtxnI4sJA79HNKUtybMWbqxpBJyypIVtpTVz0lx</span><span class="o">/</span><span class="n">upG4DSr6KAC17a104k7N7VnI0Mmk7lWMttfCXQ7QHI3zqR6Gtr7N3hksLCzsRsmVABs2qF2zRNy8Ex1oXzJ6W5TZ6QnimpmT0pFG0eF0qZQduR47XqyuRl1f</span><span class="o">/</span><span class="mi">1</span><span class="n">TCMSdwNwGC8rtxkifR6</span><span class="o">/</span><span class="n">VXPg4rSlduxefELvk4wk028Sjc9XPrGmTukGLGjz</span><span class="o">+</span><span class="n">nxGkp374WStkJJcvjZV2vv</span><span class="o">/</span><span class="n">dPvoi4LM2ptKvT6rAt</span><span class="o">/</span><span class="n">fC1</span><span class="o">+</span><span class="n">JseoSMTE3</span><span class="o">+</span><span class="n">WkJpr</span><span class="o">+</span><span class="n">uV4</span><span class="o">+</span><span class="n">Q8rluN9M5hk</span><span class="o">+</span><span class="n">CkqT</span><span class="o">/</span><span class="n">yGS6DfNN7FuGVvXw</span><span class="o">/</span><span class="n">MhB76eNbZtj</span><span class="o">/</span><span class="n">qrOWz</span><span class="o">/</span><span class="n">BVViY6QTrtqERIJ5u0QE79ZGPenSRLBDjth2LSqziBLcoP7W6U</span><span class="o">/</span><span class="n">VWdnrcXwyrCPIP1eYdMPFkvVZYtnBTRPluTWPOTBasJpHbpTClUhx5vul5l</span><span class="o">+</span><span class="n">lw2kmwtk3VHCQYQbYybkWGuG1wZLs9hb0</span><span class="o">+</span><span class="n">dNaoZRKGDTukC5omphNMBMWICB</span><span class="o">+</span><span class="n">G39</span><span class="o">+</span><span class="n">Ufg0rG0j1Ia4SitrFAffUoEy8ejrP2WpS5ltRZrNJyvRWO</span><span class="o">+</span><span class="n">oDEfBVSF2D7C18nS9rUicq</span><span class="o">/</span><span class="n">HS3sUQwnWzU0ICPh</span><span class="o">/</span><span class="mi">41</span><span class="n">UrUzFKpB1fRgvoIaykC9</span><span class="o">+</span><span class="n">VKVp7RwHHCEN4eOySUkDpqQGaM9sY4Lic</span><span class="o">+</span><span class="n">N65QaJjAdDE65PAyfds6VL10ODQ</span><span class="o">+</span><span class="n">yr8r3mulq0YyTq3VNsBgE52g5HFP3tKcnLvYVj1cruplggc</span><span class="o">+</span><span class="n">m1e</span><span class="o">/</span><span class="mi">0</span><span class="n">GahVLCWzM2</span><span class="o">+</span><span class="n">QbI3xZvnW6XL9MFo4lPtfFCG2UavNqy5hg3FFteFoOI6wMvk9awoSXC</span><span class="o">+</span><span class="n">I4kvANGv8MgdW18fvMDEA7iMRSOhns</span><span class="o">/</span><span class="n">BlZW8QcXYEgqn1eA0RdrYpisegQMSCb33gBRaSCqx177XD4mig8oT2QcxUeSfJP7PU0d3n</span><span class="o">+</span><span class="n">pT7aOZGdiMgK9YbE8jL2XkCGXg</span><span class="o">/</span><span class="mi">9</span><span class="n">jaZUrQXi66GrUhOsNsMjG23oxwKZ</span><span class="o">/</span><span class="n">HRPLIakfT83hLDRKjBXFvI</span><span class="o">+</span><span class="mi">1</span><span class="n">A</span><span class="o">==</span> <span class="n">AYtK7YeK2SLR8pfKxPvDssM3HAJr3QihYIGYrfd4bHCgS3Lwuxrc</span><span class="o">/</span><span class="n">uqbbCvc05fd4MWv</span><span class="o">/</span><span class="mi">0</span><span class="n">LRTTXuE6KJ4h</span><span class="o">/</span><span class="n">rqyorIVX1VjOoAfh3Gc</span><span class="o">+</span><span class="n">NzNDGSpZika9Bwgat</span><span class="o">+</span><span class="mi">6</span><span class="n">eEI9SCm3wu5KwujXEqRRSZzr2gZEPc6C26iFJUqsWwudyQLC25m</span><span class="o">+</span><span class="n">uPUDwdDzOGendSI2xjgMbFnOZgyDZmXKWYpyjNiSb3P7qZqTte40j7az2HlLfM6pUlUU3gVMObxCXNX6BgzjjBeuUkNLYNdaaggVSc</span><span class="o">/</span><span class="n">eZLY6MBdsCZ9x926d8TGmTIVe4tioULq45jEf9ON</span><span class="o">/</span><span class="n">q</span><span class="o">/</span><span class="n">lWU4vtoCNNNODP</span><span class="o">/</span><span class="n">jUColaiAdxoDJRV2</span><span class="o">+</span><span class="n">tSzRPsYOdUcTfmPEQThAMhk8IdcFXrouAQyOtLLxn4</span><span class="o">+</span><span class="n">IIuqPdIwBnCzZM9apFjmD5pN84lL1EZTCH</span><span class="o">/</span><span class="n">B5wM2OSwqjF0Y90qyoiGYrcEKY6jQIqekk</span><span class="o">+</span><span class="n">ceNAOxskdQdcFsQlsYzrlH</span><span class="o">/</span><span class="n">dVJq9GkcQvTxQieOrL5X1P5LjJpcMOiT4puIDps44sBxw2S25xWtkV4lYYE</span><span class="o">+</span><span class="n">X</span><span class="o">+</span><span class="n">fc</span><span class="o">/</span><span class="n">HNKxI</span><span class="o">+</span><span class="n">im5LsqJKR8WmuQZlAxdbCJJRgymxmfhJfYIvL3LLR</span><span class="o">/</span><span class="n">lDrcSvA6GmK8oUMO2NfcpQ1eZnmwxg3zFxNi</span><span class="o">/</span><span class="n">mAOXHu</span><span class="o">/</span><span class="n">SEf5DGNCCF2dWcNJs3iF4YvkweUW1STditWZHNwMKjw394MzE</span><span class="o">/</span><span class="n">WX0DDMWY88MiSy</span><span class="o">/</span><span class="n">EnecaDdXWz0s97LOwSkmU4SP2iJIoXabmMf8Uc3YOjXD7wqy</span><span class="o">/</span><span class="n">ujUIyUewd</span><span class="o">/</span><span class="n">Ys0umFzuGOTmoOtAinjL</span><span class="o">+</span><span class="n">cMuyyS5G4Zfu0kEBlGexbDDtj6mqk</span><span class="o">+</span><span class="n">T369B8VTSF3gi</span><span class="o">/</span><span class="n">HAEQSZUz83YivE60PypE69E7qb1BhIfodgZLBHyyKWXfX11jNqGmUbH0tUU8p6K1dxo8pkjFRxXI8nB</span><span class="o">+</span><span class="n">A5LuwjTZtOFO1Ak0el</span><span class="o">+</span><span class="n">dIJKxQgSWSQsFwrBjiUcvX</span><span class="o">/</span><span class="n">Erlb5eKB56cTCwjozETUGOtngIlnroqbn2SmpDK1XA</span><span class="o">/</span><span class="n">PG04wdKlDPvHAOqY3jHv0BO4xmBQAMQjY6HqnvxU7dlSkjBh3k04St1VBB</span><span class="o">+</span><span class="mi">4</span><span class="n">ejjqfKu</span><span class="o">/</span><span class="n">uP70GmlYapBJYuBNgdA</span><span class="o">/</span><span class="n">Ugy3yi2rWyK1PmXg1X7t</span><span class="o">+</span><span class="n">TFeDxhZACiwZ6xPCdO23lDPGPezQuApEBTzOoAkHnn8oXMDflUfR7Hp7Zxu</span><span class="o">/</span><span class="n">X1eo7WijeVGjwc3DQ5wbps5sGBJlS5FZFjxBaHpdzBQ5a1mVVnMe7kGdN</span><span class="o">+</span><span class="mi">62</span><span class="n">noKD</span><span class="o">/</span><span class="n">AJ822Ly7eyJGpUxPrabwgqP5K8UIbB7p</span><span class="o">/</span><span class="n">zGhx9IpPPBriphStP2v8YnKg31TpTlswTJ4v4UzIuMtohW3UxO</span><span class="o">/</span><span class="n">Sd5lJZYPWZ3svnHVS5LZ1jPLKt2NmNrHRXglde</span><span class="o">/</span><span class="mi">39</span><span class="n">EDzNRKhZkeK3Dy</span><span class="o">+</span><span class="mi">486</span><span class="n">UGLndn4M</span><span class="o">+</span><span class="n">PqbFyKEgttRMnd3Nw0GqoG1fw</span><span class="o">==</span>
</pre></div>
</div>
<p>Results in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">master</span><span class="p">:</span>
    <span class="n">UNjcLcEceXA9CwtEUHziL</span><span class="o">+</span><span class="n">jigWQ7SfwCjiI7PUuPT3mbYPKH82oeqLM</span><span class="o">+</span><span class="n">Jq5C</span><span class="o">/</span><span class="n">rbNCZc0tv44By6Ym</span><span class="o">/</span><span class="n">r94Clnmf7K5X4OhXziB</span><span class="o">/</span><span class="n">iE</span><span class="o">+</span><span class="n">zmM6Q0rvDuYFp</span><span class="o">+</span><span class="n">XG4VaIR0K</span><span class="o">/</span><span class="mi">8</span><span class="n">z3GKj1XzPP</span><span class="o">+</span><span class="n">vdbzzJ5RKLXsFkIZsnKCcrp8nMQrcsmkrT</span><span class="o">/</span><span class="n">f52m7UE47mRjZyh6gfYjUaxSLgL</span><span class="o">+</span><span class="n">rFROWPb6akoo</span><span class="o">+</span><span class="n">bzMqXGmEpyy6xeBe3RMvd0HdrqPzqdjPl76JmbzCIFZysTgty</span><span class="o">/</span><span class="n">sItpOJCl3zjMGPSDDygrgGr7JuEXi8rVrBd</span><span class="o">+</span><span class="n">b9QmsPLdqe</span><span class="o">//</span><span class="n">xevWqsrideEP8lQwjaSpH5QIawmpXehOuXi</span><span class="o">/</span><span class="n">m8j4WBMtI6izbzvydiw8gz6QX0M1ZT0xygQ</span><span class="o">+</span><span class="n">FCzmtSCedJ</span><span class="o">+</span><span class="n">J22NeQ</span><span class="o">/</span><span class="mi">7</span><span class="n">IH9lF3GRrGjUccXGBn</span><span class="o">/</span><span class="n">eBS6DDP57hVYau8ywJxrVzOn9gdC1zJsDJVhGTcqIfPa14KPqHsoBPYEsDea7dHYMzjb7p3C1OUewxJnYncnaY3xGkWNAVYqjNhQNkFidudLSrapvKlpvGq</span><span class="o">/+</span><span class="n">OrcvRm</span><span class="o">/</span><span class="n">qoZaHgx9Xae</span><span class="o">/+</span><span class="n">RFKjy8cV</span><span class="o">+</span><span class="n">qI527Dz3gKu3l</span><span class="o">/</span><span class="n">Qf735Hc700sL7XQ8</span><span class="o">+</span><span class="n">ssZsysC6</span><span class="o">/</span><span class="mi">9</span><span class="n">RAEzWXAURhnwFqKmB1x7IB12nmLz0RaIk45uCwaGJUcwcylEin3cBZUdkwnrH9aApHKbVnMJnM</span><span class="o">+</span><span class="n">TXSJPrFB4wZdFE4</span><span class="o">+</span><span class="n">TeNQH45p0K3</span><span class="o">+</span><span class="n">myRg4WjyZrdZEap61qONBJROqEj8UCYhonaEyS89T</span><span class="o">+</span><span class="n">aLfPVtoBKU9JJCq2Bck1R1SQwgiMFSRm2P0ckqU</span><span class="o">+</span><span class="n">QN</span><span class="o">/</span><span class="n">nYjTkx03MvbU8Zqe5jqGkjhWaFNn</span><span class="o">+</span><span class="n">yk</span><span class="o">/</span><span class="n">tGYpXfqnnahyognnuxwtKTv9Y47rL1</span><span class="o">/</span><span class="n">AzQds2zw</span><span class="o">/</span><span class="n">vpFZpA6Dpw0bL89O9TPJVoBJol9dGdKKF4kaQYqvhX7tOYWiHjfqjHrfuhn</span><span class="o">+</span><span class="n">TpNEJSfEqlN3q1Bchr4mmPchbm0</span><span class="o">+</span><span class="n">H47PsrT3v</span><span class="o">+</span><span class="n">AJcFlmqHcs4lLvzB9pzNS8aXf1aHFV1dJCjvV</span><span class="o">+</span><span class="n">G2CtU</span><span class="o">+</span><span class="n">hlDkVaOLDVcidW3GbnxyJiOna</span><span class="o">+</span><span class="mi">2</span><span class="n">VrkNrtWbDPaeJVVV807f0Ea4yc8cSMe3RHk9wK</span><span class="o">+</span><span class="n">YwlE4JS2jopwKs</span><span class="o">+</span><span class="n">F6XmqnJpvuKCsYDwZjYBvu</span><span class="o">+</span><span class="n">tZN</span><span class="o">+</span><span class="n">YuCZ7vjpFy7tLffdxk4AeldjNf84Vk83QzSZ9bSHgCy60QV7fLEFBrb8</span><span class="o">+</span><span class="n">I9Pcn65iXf5eiiHVWjdNFVgrGRvmm</span><span class="o">/</span><span class="n">kDmFnxZyOCR6TsI1aCmYtQ9CXzhaE2ZFp9fqPmVxRVqC0Q7hJyrxzIfBUVAStrKSmAgbxkTNUjmFuyXEwalot78bUseGoKkNRv3iwVbAG91PIqB5glf3A</span><span class="o">+</span><span class="n">wDwUhX</span><span class="o">+</span><span class="n">qm387jJHYRBkoT</span><span class="o">+</span><span class="n">UjCtU3iB5oNu9N2Pg</span><span class="o">==</span>

    <span class="n">data</span><span class="p">:</span>
    <span class="n">sNlc31MJQJh2EZiE2yF1IPLtYAS</span><span class="o">/</span><span class="n">qP9LuAXKhlXekiu9oYxfkPetWqpXPGCXDcvxlqvin6fQQb48rbGFQcRJovep9C</span><span class="o">/</span><span class="n">IR1pHUZwENvSiw</span><span class="o">/</span><span class="n">kRZmh7Ju3d5aFVkz56OoDx9YBTUhxnQmAQv4OH</span><span class="o">/</span><span class="mi">7</span><span class="n">G18IGavpa09oXSeiT3vui0Rot0Iof4zerY2Gu7WXtyNKpSBSPIEX2YeIs2q</span><span class="o">/</span><span class="n">RYesRQru2Ne6BGE3U58LgOfkiXzDHxrZefaDePMxSHNT3geOJYkxcM3YgpISIPgMyx9VRKTDSVluyTt3SwcNXstkJpnf</span><span class="o">+</span><span class="n">RM3qVQ6ObIrE0VMglqGdOgZpVxqOzwFeFB</span><span class="o">+</span><span class="n">iywqiHaLSFhJYECTvQi</span><span class="o">+</span><span class="mi">3</span><span class="n">yW8TfliUlyzBzBI4Oc</span><span class="o">+</span><span class="n">A7VU9c3wTTN2DNx1IP9U9YT</span><span class="o">+/</span><span class="n">JeW1uMQo9NVJWCXinKKLETJW</span><span class="o">/</span><span class="n">GhaN4GYcbja3OR21driBXFEUoMkRoSwwG9hz6f7Mw7MCMrt09</span><span class="o">/</span><span class="n">W</span><span class="o">/</span><span class="n">x9zcQtTdIqFOBh1KJXqlgXBF20ApbfhqqyBh3NHBZ5tDLXBNIIhTPezCt9TrHe3qKtIYqZYwJEVGKdDsSKYpsJifDlA</span><span class="o">+</span><span class="n">cY02TiHTvB6ej5g2YyxidLgx7CkOqfyaiHf9OanMusjZXjJGJNHsm7BSwTWiQfU6iQyPVSgQQKAJ0aBzBhTsU6t</span><span class="o">/</span><span class="n">MBFVT8DA25MDTHZoPMrhtS7TBXOxqVxZQ1WI1WhS4H1psOQXrhha6O1KsN</span><span class="o">+</span><span class="n">EfbE0XNdjDl83HUfltfV9O95Ix6Xzrmeo32NkjZuVUDP83bLryKHzd9xLerZzbiD9</span><span class="o">+</span><span class="n">v5Qbao2u1otnQ5h0q</span><span class="o">+</span><span class="n">lmzH3dIRjpBQ29RSyzh8XQIi2E5vEcAarZto19WID38iX2</span><span class="o">/</span><span class="n">PDYuk6ms5cKX</span><span class="o">+</span><span class="mi">0</span><span class="n">JEAyqJEExJTZzfuhF0FpqEi3KzpTFEFUo1Kg3ocw5VLym5wWqQ2SC6</span><span class="o">+</span><span class="n">gXXhAWXwNLo8Wg9h48FLE70Q4gYm7TjEuW</span><span class="o">/</span><span class="n">uBv2op9kb4USmiHDLZ71IpHsBVj7a4KwuO8U9fraFORG6CKzP1osHrjY2gGb7tuZx</span><span class="o">+</span><span class="n">svXQ2d6btdwe6qnSLswPaFrwL6akggpn1</span><span class="o">/</span><span class="n">Oks6</span><span class="o">/</span><span class="n">KH9KVdExomx2jte7JETvzh5WWwGNPv1YeW</span><span class="o">+</span><span class="n">BrPjzrnabYmQlp9R4IzCna4ovBvWzq2tcALV</span><span class="o">+</span><span class="n">S8FPkPJic9Q5sv0uJRvQ</span><span class="o">+</span><span class="mi">937</span><span class="n">vVmMLRPvXEXCo3RvFWIW8L9L5rPPelKqqVUEem9WBZwre8XehSJa9bkJvFHSN7Cp18i4OSyxBds8PSt</span><span class="o">/</span><span class="n">CNoTQLmvUo5hMNUTBFizOA84</span><span class="o">+</span><span class="n">sLdTA3GYK3e3sWsSf9rHUSXj6pXyrkf</span><span class="o">+</span><span class="n">mgJ7zIhP87iwrQcFkr1drai4yfuUH3PF1WZfZ5LlJBrvDjFq88tuHXuxDQjsG</span><span class="o">+</span><span class="n">LfH7JhnYYRvFgWKm2WCfVsk2sgqdTPbaOLHtJ9q8J2oZsXaKScIsxWwFSe</span>
</pre></div>
</div>
<p>In the above example, <code class="docutils literal notranslate"><span class="pre">master</span></code> is the new master key and <code class="docutils literal notranslate"><span class="pre">data</span></code> is the existing data key encrypted with the new master key. You can directly use these values in the <code class="docutils literal notranslate"><span class="pre">keyring.json</span></code> file.</p>
</li>
<li><p>Backup your existing <code class="docutils literal notranslate"><span class="pre">keyring.json</span></code> file.</p></li>
<li><p>Copy the <code class="docutils literal notranslate"><span class="pre">master</span></code> and <code class="docutils literal notranslate"><span class="pre">key</span></code> fields with the values from rekeying step. Ensure that you update the keys that have the setting <code class="docutils literal notranslate"><span class="pre">default:true</span></code>.</p></li>
<li><p>Restart the Titaniam service.</p></li>
</ol>
</section>
<section id="validating-the-rekeying-process">
<h3>Validating the Rekeying Process<a class="headerlink" href="#validating-the-rekeying-process" title="Permalink to this heading"></a></h3>
<p>The following procedure assumes that you are using the Titaniam Translation Service. Send the following request to the Titaniam Translation Service.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{</span>
            <span class="p">{</span><span class="s2">&quot;input&quot;</span><span class="p">:[</span><span class="s2">&quot;AQAAAAEAAAGF1/0PHs/70H5gI0ZnRRmfQ3EG37nTdEeO&quot;</span><span class="p">]}</span>
    <span class="p">}</span><span class="s1">&#39; &quot;{{IPaddress}}/aes/decrypt&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">input</span></code> value must match the output you generated in the <span class="xref std std-ref">pre-rekeying</span> section.</p>
</div>
<p>You must see an output similar to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
 <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
 <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
     <span class="s2">&quot;AQAAAAEAAAGF1/0PHs/70H5gI0ZnRRmfQ3EG37nTdEeO&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello World&quot;</span>
      <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Verify that the result matches the input string in the <span class="xref std std-ref">pre-rekeying</span> section.</p>
</section>
<section id="rekey-java-code">
<h3>ReKey.Java Code<a class="headerlink" href="#rekey-java-code" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import javax.crypto.BadPaddingException;
import javax.crypto.Cipher;
import javax.crypto.IllegalBlockSizeException;
import javax.crypto.ShortBufferException;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import java.security.InvalidAlgorithmParameterException;
import java.security.InvalidKeyException;
import java.util.Arrays;
import java.util.Base64;
import java.util.Random;

/**
 * Utility class to rekey en existing encryption key ciphers for including in
 * Titaniam KeyRing.
 * &lt;p&gt;
 * Usage  : java ReKey &lt;old-key-encryption-key-hex-encoded&gt; &lt;old-encrypted-data-encryption-key&gt;
 * Example: java ReKey &quot;m7ODlUJ3m....rrAHJmQ==&quot; &quot;ASIY7EYA....iTqRJJBJA==&quot;
 * &lt;p&gt;
 * This outputs a new key encryption key and the encryption key encrypted using the new
 * key encryption key.
 */
public class ReKey {

    /**
     * Main method of execution.
     * Run without any arguments to get usage help.
     *
     * @param argv expects 2 args for this applciation.
     * @throws Exception if there is any issue with input data
     */
    public static void main(String[] argv) throws Exception {

        if (!validate(argv)) {
            return;
        }

        String oldKeKBase64 = argv[0];
        String dataBase64   = argv[1];

        byte[] oldKEK           = base64ToBytes(oldKeKBase64);
        byte[] dataEncrypted    = base64ToBytes(dataBase64);
        byte[] newKEK           = randomBytes(1024);

        Cipher cipher           = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);

        // Decrypt
        byte[] dataClear        = decryptData(oldKEK, dataEncrypted, cipher);

        // Re-Encrypt
        byte[] dataReEncrypted  = encryptData(newKEK, dataClear, cipher);

        //
        prettyPrintResults(newKEK, dataReEncrypted);
    }

    private static void prettyPrintResults(byte[] newKEK, byte[] dataReEncrypted) {

        System.out.println(&quot;\n----------Result------------\n&quot;);
        System.out.println(&quot;master:&quot;);
        System.out.println(Base64.getEncoder().encodeToString(newKEK));
        System.out.println(&quot;&quot;);
        System.out.println(&quot;data:&quot;);
        System.out.println(Base64.getEncoder().encodeToString(dataReEncrypted));
        System.out.println(&quot;&quot;);
    }

    private static byte[] encryptData(byte[] newKEK, byte[] dataClear, Cipher cipher) throws InvalidKeyException, InvalidAlgorithmParameterException, ShortBufferException, IllegalBlockSizeException, BadPaddingException {

        SecretKeySpec reEncryptKeySpec = new SecretKeySpec(makeKey(newKEK), &quot;AES&quot;);

        byte[] initVector = randomBytes(cipher.getBlockSize());
        IvParameterSpec encryptIVSpec = new IvParameterSpec(initVector);

        cipher.init(Cipher.ENCRYPT_MODE, reEncryptKeySpec, encryptIVSpec);

        byte[] output    = new byte[cipher.getBlockSize() + cipher.getOutputSize(dataClear.length)];

        System.arraycopy(initVector,0,output,0, cipher.getBlockSize());

        cipher.doFinal(dataClear, 0, dataClear.length, output, cipher.getBlockSize());

        return output;
    }

    private static byte[] decryptData(byte[] oldKEK, byte[] dataEncrypted, Cipher cipher) throws InvalidKeyException, InvalidAlgorithmParameterException, IllegalBlockSizeException, BadPaddingException {

        int start = dataEncrypted.length%16==0 ? 0 : 1;

        SecretKeySpec decryptKeySpec = new SecretKeySpec(makeKey(oldKEK), &quot;AES&quot;);

        byte[] initVector         = Arrays.copyOfRange(dataEncrypted, start, start + cipher.getBlockSize());
        IvParameterSpec decryptIV = new IvParameterSpec(initVector);

        cipher.init(Cipher.DECRYPT_MODE, decryptKeySpec, decryptIV);

        return cipher.doFinal(dataEncrypted, start + cipher.getBlockSize(), dataEncrypted.length - cipher.getBlockSize() - start);
    }


    /**
     * Convers the input string in base64 to bytes.
     * Will throw exceptions if there are any issues with
     * data validity.
     */
    private static byte[] base64ToBytes(String base64) {
        return Base64.getDecoder().decode(base64);
    }

    /**
     * Returns a subset of the key of the length
     * that is required for AES encryption
     */
    public static byte[] makeKey(byte[] keyBytes) {

        final int size = 16;

        assert keyBytes!=null;

        if(keyBytes.length &lt; size) {
            throw new IllegalArgumentException(&quot;Unable to make key. Expected &gt; &quot;+size+&quot;, actual: &quot;+keyBytes.length);
        }

        byte[] bytes = new byte[size];

        System.arraycopy(keyBytes, 0, bytes, 0, bytes.length);

        return bytes;
    }

    public static byte[] randomBytes(int size) {

        byte[] bytes = new byte[size];

        new Random().nextBytes(bytes);

        return bytes;
    }

    /**
     * Input validation and error printing if the input
     * arguments are not correct/
     */
    private static boolean validate(String[] argv) {

        if (isHelpRequested(argv)) {
            printUsage();
            return false;
        }

        if (argv == null || argv.length != 2) {
            System.out.println(&quot;Invalid input. Expected: 2, Actual: &quot; + argv.length);
            printUsage();
            return false;
        }

        return true;
    }

    /**
     * Prints help
     */
    private static void printUsage() {
        System.out.println(&quot;\tUsage  : java ReKey &lt;old-key-encryption-key&gt; &lt;old-encrypted-data-encryption-key&gt;&quot;);
        System.out.println(&quot;\tExample: java KeyGen \&quot;m7ODlUJ3m....rrAHJmQ==\&quot; \&quot;ASIY7EYA....iTqRJJBJA==\&quot;&quot;);
    }

    private static boolean isHelpRequested(String[] argv) {
        return argv != null &amp;&amp; argv.length == 1 &amp;&amp; (argv[0].equals(&quot;-h&quot;) || argv[0].equals(&quot;--help&quot;));
    }

}
</pre></div>
</div>
</section>
</section>
<section id="bring-your-own-keys">
<span id="byok-keys"></span><h2>Bring Your Own Keys<a class="headerlink" href="#bring-your-own-keys" title="Permalink to this heading"></a></h2>
<p>You can bring your own keys (byok) and store in them in a store of choice. You can supply your own keys using one of the following methods:</p>
<ul class="simple">
<li><p>Hashicorp Vault</p></li>
<li><p>Azure Key Vault</p></li>
<li><p>AWS Secrets Manager</p></li>
</ul>
<p>To configure Titaniam Server to use your keys, do the following:</p>
<ol class="arabic">
<li><p>Store your key in your key store.</p></li>
<li><p>(If you are using Titaniam Plugin) In your <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file, configure the following lines of code in the <cite>arcus</cite> section:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># byok configuration</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">byok</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">host</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">arcus</span><span class="p">:</span><span class="mi">9200</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">byok</span><span class="o">.</span><span class="n">refresh</span><span class="o">-</span><span class="n">secs</span><span class="o">=</span><span class="mi">30</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>(If you are using docker) In your <cite>docker-compose.yml</cite> file, configure the following lines of code in the <cite>spectra</cite> section:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># byok configuration</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">byok</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">byok</span><span class="o">.</span><span class="n">host</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">arcus</span><span class="p">:</span><span class="mi">9200</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">byok</span><span class="o">.</span><span class="n">refresh</span><span class="o">-</span><span class="n">secs</span><span class="o">=</span><span class="mi">30</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.es.host</span></code> and <code class="docutils literal notranslate"><span class="pre">sdss.byok.host</span></code> specify the host of the Elasticsearch where you can store your keys. In the above example, arcus refers to the docker process of the same name. The elasticsearch index that is stores the keys by default is <code class="docutils literal notranslate"><span class="pre">titaniam_byok_config</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.byok.refresh-secs</span></code> and <code class="docutils literal notranslate"><span class="pre">sdss.byok.refresh-secs</span></code> specify the interval at which the Titaniam Server checks for any updated keys. This must be set to 30.</p></li>
</ul>
</div></blockquote>
</li>
</ol>
<section id="setup-byok-index-with-keys-in-aws-sm">
<span id="ingest-byok-aws"></span><h3>Setup BYOK Index with Keys in AWS SM<a class="headerlink" href="#setup-byok-index-with-keys-in-aws-sm" title="Permalink to this heading"></a></h3>
<p>After you have successfully installed the Elasticsearch Proxy or the Vault, if you are using a byok mode, you must create an index in Elasticsearch,``titaniam_byok_config`` , that acts like a key registry (a map between index name to key location).</p>
<p>The elasticsearch index that stores the keys by default is <code class="docutils literal notranslate"><span class="pre">titaniam_byok_config</span></code>. You must create keys for your index in this index. Run the following command after you have successfully brought up the Elasticsearch Proxy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">XPOST</span> <span class="s2">&quot;http://arcus:9200/titaniam_byok_config/_doc/1&quot;</span> <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="o">-</span><span class="n">d</span><span class="s1">&#39;{</span>
  <span class="s2">&quot;secretName&quot;</span><span class="p">:</span> <span class="s2">&quot;titaniam_key_ring/test/test-index&quot;</span><span class="p">,</span>
  <span class="s2">&quot;accessKeyEncrypted&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;ENCRYPTED_AWS_ACCESS_ID&gt;&quot;</span><span class="p">,</span>
  <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;users&quot;</span><span class="p">,</span>
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;aws-secretsmanager&quot;</span><span class="p">,</span>
  <span class="s2">&quot;secretKeyEncrypted&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;ENCRYPTED_AWS_SECRET_ID&gt;&quot;</span><span class="p">,</span>
  <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;us-east-1&quot;</span>
<span class="p">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">secretName</span></code> specifies the host of the Elastic search where you can store your keys. In the above example, arcus refers to the docker process of the same name. The elasticsearch index that is stores the keys by default is <cite>titaniam_byok_config</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">accessKeyEncrypted</span></code> specifies the encrypted access key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code> The index for which the specified keys will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> indicates where the keys are stored. If using AWS, use <code class="docutils literal notranslate"><span class="pre">aws-secretsmanager</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secretKeyEncrypted</span></code> specifies the encrypted secret key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">region</span></code> - indicates the region of the AWS Secrets Manager.</p></li>
</ul>
</div></blockquote>
<p>This command will create the key registry <code class="docutils literal notranslate"><span class="pre">titaniam_byok_config</span></code> with keys for an index.</p>
</section>
<section id="setup-byok-keys-in-hashicorp-vault">
<span id="ingest-byok"></span><h3>Setup BYOK Keys in Hashicorp Vault<a class="headerlink" href="#setup-byok-keys-in-hashicorp-vault" title="Permalink to this heading"></a></h3>
<p>After you have successfully installed the Elasticsearch Proxy or the Vault, if you are using a byok mode, you must create an index in Elasticsearch,``titaniam_byok_config`` , that acts like a key registry (a map between index name to key location).</p>
<p>The elasticsearch index that stores the keys by default is <code class="docutils literal notranslate"><span class="pre">titaniam_byok_config</span></code>. You must create keys for your index in this index. Run the following command after you have successfully brought up the Elasticsearch Proxy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">curl</span> <span class="o">-</span><span class="n">XPOST</span> <span class="s2">&quot;http://localhost:9200/titaniam_byok_config/_doc/1&quot;</span> <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="o">-</span><span class="n">d</span><span class="s1">&#39;{</span>
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;hashicorp-vault&quot;</span><span class="p">,</span>
  <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;INDEX_NAME&gt;&quot;</span><span class="p">,</span>
  <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://&lt;MACHINE_PRIVATE_IP&gt;:8200/v1/kv/titaniamlabs/VaultSeedStore&quot;</span><span class="p">,</span>
  <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;X-Vault-Token&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;HASHICORP_VAULT_ROOT_TOKEN&gt;&quot;</span>
  <span class="p">}</span>
<span class="p">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code> The index for which the specified keys will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> indicates where the keys are stored. If using Hashicorp Vault, leave it as <code class="docutils literal notranslate"><span class="pre">hashicorp-vault</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">url</span></code> specifies the URL to access the Titaniam Seed store in your Hashicorp vault. For more information, see <span class="xref std std-ref">hashicorp_keys</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-Vault-Token</span></code> - Specifies the VAULT_ROOT_TOKEN. For more information, see <span class="xref std std-ref">hashicorp_keys</span></p></li>
</ul>
</div></blockquote>
<p>This command will create the key registry <code class="docutils literal notranslate"><span class="pre">titaniam_byok_config</span></code> with keys for an index.</p>
<section id="refresh-the-seed-store">
<h4>Refresh the Seed Store<a class="headerlink" href="#refresh-the-seed-store" title="Permalink to this heading"></a></h4>
<p>You must ensure that Titaniam Server uses the BYOK keys. Run the following endpoint on your Titaniam Server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">location</span> <span class="o">--</span><span class="n">request</span> <span class="n">POST</span> <span class="s1">&#39;http://localhost:8080/v1/mgmt/seed-store-reload&#39;</span>
</pre></div>
</div>
</section>
</section>
<section id="create-index-and-ingest-data-in-the-elasticsearch-index">
<span id="ingest-byok-index"></span><h3>Create Index and Ingest Data in the Elasticsearch Index<a class="headerlink" href="#create-index-and-ingest-data-in-the-elasticsearch-index" title="Permalink to this heading"></a></h3>
<p>This example creates an index <code class="docutils literal notranslate"><span class="pre">users</span></code> in the Elasticsearch index.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">location</span> <span class="o">--</span><span class="n">request</span> <span class="n">PUT</span> <span class="s1">&#39;http://localhost:8080/users&#39;</span> \
<span class="o">--</span><span class="n">header</span> <span class="s1">&#39;X-tn-customer: users&#39;</span> \
<span class="o">--</span><span class="n">header</span> <span class="s1">&#39;Content-Type: application/json&#39;</span> \
<span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">raw</span> <span class="s1">&#39;{</span>
    <span class="s2">&quot;mappings&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;keyword&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;keyword&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;salary&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;long&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;dob&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span>
                <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;basic_date_time||strict_date_optional_time||epoch_millis||yyyy-MM-dd HH:mm:ssz||strict_date_optional_time_nanos||yyyy-MM-dd HH:mm:ss.SSSSSSz||yyyy-MM-dd HH:mm:ss&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;user_ip&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ip&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;street&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;keyword&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;pincode&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>You must see a response similar to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;acknowledged&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
   <span class="s2">&quot;shards_acknowledged&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
   <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;users&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="ingest-document">
<h3>Ingest document<a class="headerlink" href="#ingest-document" title="Permalink to this heading"></a></h3>
<p>Add a document to the index.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">location</span> <span class="o">--</span><span class="n">request</span> <span class="n">PUT</span> <span class="s1">&#39;http://localhost:8080/users/_doc/1&#39;</span> \
<span class="o">--</span><span class="n">header</span> <span class="s1">&#39;X-tn-customer: users&#39;</span> \
<span class="o">--</span><span class="n">header</span> <span class="s1">&#39;Content-Type: application/json&#39;</span> \
<span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">raw</span> <span class="s1">&#39;{</span>
    <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
    <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span>
    <span class="s2">&quot;user_ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.2.31&quot;</span><span class="p">,</span>
    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;test description&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dob&quot;</span><span class="p">:</span> <span class="s2">&quot;1993-09-30&quot;</span><span class="p">,</span>
    <span class="s2">&quot;salary&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;street&quot;</span><span class="p">:</span> <span class="s2">&quot;My Street, Kingston&quot;</span><span class="p">,</span>
        <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;California&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pincode&quot;</span><span class="p">:</span> <span class="s2">&quot;12401&quot;</span>
    <span class="p">}</span>
<span class="p">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>Response</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;users&quot;</span><span class="p">,</span>
   <span class="s2">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;_doc&quot;</span><span class="p">,</span>
   <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
   <span class="s2">&quot;_version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;created&quot;</span><span class="p">,</span>
   <span class="s2">&quot;_shards&quot;</span><span class="p">:</span> <span class="p">{</span>
       <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
       <span class="s2">&quot;successful&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
       <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="mi">0</span>
   <span class="p">},</span>
   <span class="s2">&quot;_seq_no&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
   <span class="s2">&quot;_primary_term&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="get-document-by-id">
<h3>Get document by ID<a class="headerlink" href="#get-document-by-id" title="Permalink to this heading"></a></h3>
<p>Use the following example to get a document by its ID:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">location</span> <span class="o">--</span><span class="n">request</span> <span class="n">GET</span> <span class="s1">&#39;http://localhost:8080/users/_doc/1&#39;</span> \
<span class="o">--</span><span class="n">header</span> <span class="s1">&#39;X-tn-customer: users&#39;</span>
</pre></div>
</div>
<p>Response:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;users&quot;</span><span class="p">,</span>
   <span class="s2">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;_doc&quot;</span><span class="p">,</span>
   <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
   <span class="s2">&quot;_version&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
   <span class="s2">&quot;_seq_no&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="s2">&quot;_primary_term&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="s2">&quot;found&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
   <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
       <span class="s2">&quot;user_ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.2.31&quot;</span><span class="p">,</span>
       <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="p">{</span>
           <span class="s2">&quot;pincode&quot;</span><span class="p">:</span> <span class="mi">12401</span><span class="p">,</span>
           <span class="s2">&quot;street&quot;</span><span class="p">:</span> <span class="s2">&quot;My Street, Kingston&quot;</span><span class="p">,</span>
           <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;California&quot;</span>
       <span class="p">},</span>
       <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
       <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;test description&quot;</span><span class="p">,</span>
       <span class="s2">&quot;salary&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
       <span class="s2">&quot;dob&quot;</span><span class="p">:</span> <span class="s2">&quot;1985-09-30&quot;</span><span class="p">,</span>
       <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
       <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">28</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="search-term-search">
<h3>Search (Term search)<a class="headerlink" href="#search-term-search" title="Permalink to this heading"></a></h3>
<p>Use the following request to perform a term search on the index.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">location</span> <span class="o">--</span><span class="n">request</span> <span class="n">GET</span> <span class="s1">&#39;http://localhost:8080/users/_search&#39;</span> \
<span class="o">--</span><span class="n">header</span> <span class="s1">&#39;X-tn-customer: users&#39;</span> \
<span class="o">--</span><span class="n">header</span> <span class="s1">&#39;Content-Type: application/json&#39;</span> \
<span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">raw</span> <span class="s1">&#39;{</span>
    <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;term&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="s2">&quot;John&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>Response:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;took&quot;</span><span class="p">:</span> <span class="mi">889</span><span class="p">,</span>
   <span class="s2">&quot;timed_out&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
   <span class="s2">&quot;_shards&quot;</span><span class="p">:</span> <span class="p">{</span>
       <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
       <span class="s2">&quot;successful&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
       <span class="s2">&quot;skipped&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
       <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="mi">0</span>
   <span class="p">},</span>
   <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span>
       <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="p">{</span>
           <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
           <span class="s2">&quot;relation&quot;</span><span class="p">:</span> <span class="s2">&quot;eq&quot;</span>
       <span class="p">},</span>
       <span class="s2">&quot;max_score&quot;</span><span class="p">:</span> <span class="mf">0.18232156</span><span class="p">,</span>
       <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="p">[</span>
           <span class="p">{</span>
               <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;users&quot;</span><span class="p">,</span>
               <span class="s2">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;_doc&quot;</span><span class="p">,</span>
               <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
               <span class="s2">&quot;_score&quot;</span><span class="p">:</span> <span class="mf">0.18232156</span><span class="p">,</span>
               <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                   <span class="s2">&quot;user_ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.2.31&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="p">{</span>
                       <span class="s2">&quot;pincode&quot;</span><span class="p">:</span> <span class="mi">12401</span><span class="p">,</span>
                       <span class="s2">&quot;street&quot;</span><span class="p">:</span> <span class="s2">&quot;My Street, Kingston&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;California&quot;</span>
                   <span class="p">},</span>
                   <span class="s2">&quot;dob&quot;</span><span class="p">:</span> <span class="s2">&quot;1993-09-30&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;test description&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;salary&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
                   <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">28</span>
               <span class="p">}</span>
           <span class="p">}</span>
       <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="rotating-vault-token-keys-using-krs">
<span id="krs-key-rotation"></span><h2>Rotating Vault Token Keys using KRS<a class="headerlink" href="#rotating-vault-token-keys-using-krs" title="Permalink to this heading"></a></h2>
<p>This section explains the procedure to rotate Vault token keys. This section assumes that you already have Vault tokens that are encrypted with a key. You are now looking to use a new key for encryption. This operation means that all new data will be encrypted using the new key. And, you have to migrate (decrypt using old key and encrypt using new key) your existing Vault tokens to the new key.</p>
<p>Titaniam Vault provides a set of APIs to address the preceding scenario. The overall process is as follows:</p>
<img alt="_static/key_rotation_process.png" src="_static/key_rotation_process.png" />
<section id="how-to-rotate-keys">
<h3>How to Rotate Keys<a class="headerlink" href="#how-to-rotate-keys" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>Create a new key in AWS Secrets Manager.</p></li>
<li><p>Schedule the key rotation in Titaniam Vault. Send the following request to your Titaniam Vault.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must always use a new key (in AWS Secrets Manager) when scheduling key rotation even if you are running this task after an <strong>ABANDONED</strong> status.</p>
</div>
<p>Request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="p">{{</span><span class="n">SpectraURL</span><span class="p">}}</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">mgmt</span><span class="o">/</span><span class="n">key_rotation</span>
</pre></div>
</div>
<p>Body:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>{
      &quot;type&quot;: &quot;vault_token&quot;,
      &quot;number_of_shards&quot;: 2,
      &quot;number_of_replicas&quot;: 2,
      &quot;reindex_slices&quot;: “2”,
      &quot;reindex_batch_size&quot;: 500,
      &quot;reindex_scroll_timeout_mins&quot;: 10,
      &quot;key_metadata&quot;: {
          &quot;key_name&quot;: &quot;sdss-store-key2&quot;,
          &quot;description&quot;: &quot;key2 for key rotation&quot;,
          &quot;store_type&quot;: &quot;aws-secretsmanager&quot;,
          &quot;location&quot;: {
              &quot;secretName&quot;: &quot;titaniam_key_ring/reindex-test/key2&quot;,
              &quot;secretKeyEncrypted&quot;: &quot;&lt;SECRET_KEY&gt;&quot;,
              &quot;region&quot;: &quot;&lt;REGION&gt;&quot;,
              &quot;accessKeyEncrypted&quot;: &quot;&lt;ACCESS_KEY&gt;&quot;
        }
    }
}
</pre></div>
</div>
<p>Response:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
   <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
   <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
       <span class="s2">&quot;guid&quot;</span><span class="p">:</span> <span class="s2">&quot;kr:83813c7e-7b37-42ba-9b32-f6d6c85f0795&quot;</span><span class="p">,</span>
       <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;IN_PROGRESS&quot;</span><span class="p">,</span>
       <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;KEY_ROTATION&quot;</span><span class="p">,</span>
       <span class="s2">&quot;schema_name&quot;</span><span class="p">:</span> <span class="s2">&quot;example-schema&quot;</span><span class="p">,</span>
       <span class="s2">&quot;created_by&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Verify the status of the scheduled request. This endpoint returns the status of the latest scheduled key rotation.</p>
<p>Request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GET</span> <span class="p">{{</span><span class="n">SpectraURL</span><span class="p">}}</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">mgmt</span><span class="o">/</span><span class="n">key_rotation</span><span class="o">/</span><span class="n">latest</span><span class="o">/</span><span class="n">status</span>
</pre></div>
</div>
<p>Body:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vault_token&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Response:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;IN_PROGRESS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;in-progress. please check after sometime&quot;</span><span class="p">,</span>
    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;parent_guid&quot;</span><span class="p">:</span> <span class="s2">&quot;kr:ca228d41-91fc-4c40-ae1e-aafef58d9674&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;elasticsearch&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;in_progress&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;IN_PROGRESS&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;in-progress. please check after sometime&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;guid&quot;</span><span class="p">:</span> <span class="s2">&quot;rt:37a26c05-97b4-4178-89d5-473594af99fd&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;elastic_task_id&quot;</span><span class="p">:</span> <span class="s2">&quot;W7zkItbURMazYGLXxgXt8g:3090917&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">200005</span><span class="p">,</span>
                        <span class="s2">&quot;processed&quot;</span><span class="p">:</span> <span class="mi">35000</span><span class="p">,</span>
                        <span class="s2">&quot;elapsed_time_secs&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
                        <span class="s2">&quot;records_per_sec&quot;</span><span class="p">:</span> <span class="mi">1458</span><span class="p">,</span>
                        <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-03-15T06:33:57.215+00:00&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;reindex from [embedded-finance] to [embedded-finance-sdss-store-efegjobodf][_doc]&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;retry_count&quot;</span><span class="p">:</span> <span class="mi">0</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;in_progress&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;DB_KEY_ROTATION_IN_PROGRESS&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;DB key rotation still in progress&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;guid&quot;</span><span class="p">:</span> <span class="s2">&quot;dkr:24fe86ff-056e-484e-a120-6082e918a2e7&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;TOKENS&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">200001</span><span class="p">,</span>
                        <span class="s2">&quot;processed&quot;</span><span class="p">:</span> <span class="mi">153000</span><span class="p">,</span>
                        <span class="s2">&quot;failures&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-03-15T06:33:57.434+00:00&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;elapsed_time_secs&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
                        <span class="s2">&quot;records_per_sec&quot;</span><span class="p">:</span> <span class="mi">6375</span><span class="p">,</span>
                        <span class="s2">&quot;retry_count&quot;</span><span class="p">:</span> <span class="mi">0</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;completed&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;guid&quot;</span><span class="p">:</span> <span class="s2">&quot;dkr:0a300b4b-6ac4-4a24-bf52-01aebf5c8711&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;BINARIES&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                        <span class="s2">&quot;processed&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                        <span class="s2">&quot;failures&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-03-15T06:33:57.429+00:00&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;retry_count&quot;</span><span class="p">:</span> <span class="mi">0</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>(When the status of the schedule key rotation is <strong>SUCCESS</strong> and field <code class="docutils literal notranslate"><span class="pre">completed</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code>) Swap the aliases in the Elasticsearch index. Swapping aliases involves ensuring that the newly ingested data uses the new keys. And, existing data is also re-encrypted using the new key.</p>
<p>Request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PUT</span> <span class="p">{{</span><span class="n">SpectraURL</span><span class="p">}}</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">mgmt</span><span class="o">/</span><span class="n">key_rotation</span><span class="o">/</span><span class="n">latest</span>
</pre></div>
</div>
<p>Body:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vault_token&quot;</span><span class="p">,</span>
   <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;swap_aliases&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Response:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;parent_guid&quot;</span><span class="p">:</span> <span class="s2">&quot;kr:83813c7e-7b37-42ba-9b32-f6d6c85f0795&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;elasticsearch&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;completed&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;guid&quot;</span><span class="p">:</span> <span class="s2">&quot;rt:c692ff38-88b8-4a36-9052-e0d8ab484c95&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;reindex from [embedded-finance-sdss-store-iijiknsfsh] to [embedded-finance-sdss-store-jjkjlotgti][_doc]&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;elastic_task_id&quot;</span><span class="p">:</span> <span class="s2">&quot;W7zkItbURMazYGLXxgXt8g:555363&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-01-31T11:20:58.218+00:00&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-01-31T11:21:40.475+00:00&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;retry_count&quot;</span><span class="p">:</span> <span class="mi">0</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;guid&quot;</span><span class="p">:</span> <span class="s2">&quot;rt:4381c2be-d25d-43ee-ad1e-aaa3c05ccaee&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;reindex from [embedded-finance-sdss-store-fghiiijikn] to [embedded-finance-sdss-store-ghijjjkjlo][_doc]&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;elastic_task_id&quot;</span><span class="p">:</span> <span class="s2">&quot;W7zkItbURMazYGLXxgXt8g:554969&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-01-31T11:21:00.445+00:00&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-01-31T11:21:41.540+00:00&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;retry_count&quot;</span><span class="p">:</span> <span class="mi">0</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;completed&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;guid&quot;</span><span class="p">:</span> <span class="s2">&quot;dkr:071496ce-ca10-41c1-8021-9483624af5dc&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;BINARIES&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">10006</span><span class="p">,</span>
                        <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="mi">10006</span><span class="p">,</span>
                        <span class="s2">&quot;failures&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-01-31T11:21:16.963+00:00&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-01-31T11:23:39.230+00:00&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;retry_count&quot;</span><span class="p">:</span> <span class="mi">0</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;guid&quot;</span><span class="p">:</span> <span class="s2">&quot;dkr:41d4cd8b-1e41-48fb-901f-d0dfbf05d415&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;TOKENS&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">90000</span><span class="p">,</span>
                        <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="mi">90000</span><span class="p">,</span>
                        <span class="s2">&quot;failures&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-01-31T11:21:16.966+00:00&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-01-31T11:23:39.236+00:00&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;retry_count&quot;</span><span class="p">:</span> <span class="mi">0</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Check the status of the key rotation operation.</p>
<ul class="simple">
<li><p>If the status after the index aliasing swapping is set to <strong>COMPLETED</strong>, the key rotation is successful.</p></li>
<li><p>If the status after the index aliasing swapping is set to <strong>FAILED</strong>, that means that index alias swapping is not successful. In this case, run the rerun key rotation operation.</p></li>
<li><p>If the status is <strong>IN PROGRESS</strong> and the database status is stuck for example, there is no progress in the number of records reindexed, then rerun the database actions.</p></li>
<li><p>If the status indicates any Elasticsearch errors, rerun the Elasticsearch operations.</p></li>
</ul>
</li>
<li><p>(If status is FAILED)Correct any errors indicated in the status, and rerun the key rotation operation.</p>
<blockquote>
<div><p>Request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PUT</span> <span class="p">{{</span><span class="n">SpectraURL</span><span class="p">}}</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">mgmt</span><span class="o">/</span><span class="n">key_rotation</span><span class="o">/</span><span class="n">latest</span>
</pre></div>
</div>
<p>Body:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vault_token&quot;</span><span class="p">,</span>
   <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;rerun&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Response:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;RERUN_STARTED&quot;</span><span class="p">,</span>
   <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Rerun started successfully&quot;</span><span class="p">,</span>
   <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
       <span class="s2">&quot;guid&quot;</span><span class="p">:</span> <span class="s2">&quot;kr:83813c7e-7b37-42ba-9b32-f6d6c85f0795&quot;</span><span class="p">,</span>
       <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;IN_PROGRESS&quot;</span><span class="p">,</span>
       <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;KEY_ROTATION&quot;</span><span class="p">,</span>
       <span class="s2">&quot;schema_name&quot;</span><span class="p">:</span> <span class="s2">&quot;example-schema&quot;</span><span class="p">,</span>
       <span class="s2">&quot;created_by&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>(If status in IN PROGRESS and database operations are stuck) Continue the database key rotation.</p>
<blockquote>
<div><p>Request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PUT</span> <span class="p">{{</span><span class="n">SpectraURL</span><span class="p">}}</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">mgmt</span><span class="o">/</span><span class="n">key_rotation</span><span class="o">/</span><span class="n">latest</span>
</pre></div>
</div>
<p>Body:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vault_token&quot;</span><span class="p">,</span>
   <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;continue_db&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>(If status is other than COMPLETED and Elasticsearch errors are reported) Continue the Elasticsearch key rotation operations.</p>
<blockquote>
<div><p>Request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PUT</span> <span class="p">{{</span><span class="n">SpectraURL</span><span class="p">}}</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">mgmt</span><span class="o">/</span><span class="n">key_rotation</span><span class="o">/</span><span class="n">latest</span>
</pre></div>
</div>
<p>Body:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vault_token&quot;</span><span class="p">,</span>
   <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;continue_elastic&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Check the status of the current operation (rerun).</p>
<p>If the status is <strong>COMPLETED</strong>, the errors are successfully resolved. Run the swap index aliases (<code class="docutils literal notranslate"><span class="pre">PUT</span> <span class="pre">{{SpectraURL}}/v1/mgmt/key_rotation/latest</span></code>) API again.</p>
<p>If the status is <strong>ABANDONED</strong>, it means that the key rotation rerun was unsuccessful. You must now schedule a new key rotation.</p>
</li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html">API Reference</a></p></li>
</ul>
</section>
</section>
<section id="id64">
<h2>Post-Installation Steps<a class="headerlink" href="#id64" title="Permalink to this heading"></a></h2>
<p>This chapter describes the following:</p>
<ul class="simple">
<li><p>Accessing the Logs</p></li>
<li><p>Verifying the Installation</p></li>
</ul>
<section id="id65">
<h3>Logs<a class="headerlink" href="#id65" title="Permalink to this heading"></a></h3>
<p>All logs are handled by the docker logs. See <a class="reference external" href="https://docs.docker.com/config/containers/logging/">docker log documentation</a>.</p>
<p>Run the following command tocheck logs for your container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">logs</span> <span class="o">-</span><span class="n">f</span> <span class="o">&lt;</span><span class="n">container_name</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="id66">
<h3>Verifying the Installation for Vault and Translation Services<a class="headerlink" href="#id66" title="Permalink to this heading"></a></h3>
<p>Perform the following steps to verify that the installation is successful, send the following CURL request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">location</span> <span class="o">--</span><span class="n">request</span> <span class="n">GET</span> <span class="s1">&#39;http:/&lt;baseURL&gt;:8080/actuator/health&#39;</span>
</pre></div>
</div>
<p>You must receive a response similar to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span><span class="p">,</span>

<span class="s2">&quot;components&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span><span class="p">,</span>

<span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="s2">&quot;PostgreSQL&quot;</span><span class="p">,</span>

<span class="s2">&quot;validationQuery&quot;</span><span class="p">:</span> <span class="s2">&quot;isValid()&quot;</span>

<span class="p">}</span>

<span class="p">},</span>

<span class="s2">&quot;diskSpace&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span><span class="p">,</span>

<span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">53675536384</span><span class="p">,</span>

<span class="s2">&quot;free&quot;</span><span class="p">:</span> <span class="mi">7795793920</span><span class="p">,</span>

<span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mi">10485760</span><span class="p">,</span>

<span class="s2">&quot;exists&quot;</span><span class="p">:</span> <span class="n">true</span>

<span class="p">}</span>

<span class="p">},</span>

<span class="s2">&quot;ping&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span>

<span class="p">}</span>

<span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="appendix-example-docker-compose-yml-files-and-property-files">
<span id="example-compose"></span><h1>Appendix: Example Docker Compose YML Files and Property Files<a class="headerlink" href="#appendix-example-docker-compose-yml-files-and-property-files" title="Permalink to this heading"></a></h1>
<p>This section provides example <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> files for various configurations.</p>
<section id="example-docker-compose-yml-file-for-titaniam-plugin-using-aws">
<span id="plugin-dockercompose"></span><h2>Example: Docker Compose YML File for Titaniam Plugin using AWS<a class="headerlink" href="#example-docker-compose-yml-file-for-titaniam-plugin-using-aws" title="Permalink to this heading"></a></h2>
<p>The following is an example of the Titaniam plugin <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file. Save this text as <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span><span class="w"></span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.7&#39;</span><span class="w"></span>
<span class="c1"># This docker-compose enables ssl for elastic.</span><span class="w"></span>
<span class="c1"># Test certs/jks are available in the test-certs.zip</span><span class="w"></span>
<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">arcus</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam/arcus_v710:1.0.0</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arcus-node1</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># aws_region - region where the SM values are stored in AWS</span><span class="w"></span>
<span class="w">      </span><span class="c1"># this configuraiton uses IAM roles to read data from AWS</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Assign proper IAM roles to the ec2 instances that will enable</span><span class="w"></span>
<span class="w">      </span><span class="c1"># SecretsManagerReadWrite</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws_region=us-east-1</span><span class="w"></span>
<span class="w">      </span><span class="c1"># keyring_name is part of the Secrets Manager (SM) secret name.</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Secret name is of the format - titaniam_key_ring/&lt;keyring_name&gt;/&lt;key_name&gt;</span><span class="w"></span>
<span class="w">      </span><span class="c1"># - Secret name must begin with titaniam_key_ring</span><span class="w"></span>
<span class="w">      </span><span class="c1"># - &lt;titaniam.keyring.name&gt; is a custom name of the environment &amp; deployment</span><span class="w"></span>
<span class="w">      </span><span class="c1"># - &lt;key_name&gt; will correspond to the elastic index name</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Setting Active=true as a tag on Secrets Manager secret name will make that key default,</span><span class="w"></span>
<span class="w">      </span><span class="c1"># when index level key is absent. (This will make index level keys default to a single key for new index)</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam.keyring.name=installtest</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Disable single-sign-on</span><span class="w"></span>
<span class="w">      </span><span class="c1"># - sso.enabled=false</span><span class="w"></span>
<span class="w">      </span><span class="c1"># - spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,org.springframework.boot.actuate.autoconfigure.security.servlet.ManagementWebSecurityAutoConfiguration</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Possible values aws|byok|file|azure</span><span class="w"></span>
<span class="w">      </span><span class="c1"># AWS Secrets Manager based keys - aws</span><span class="w"></span>
<span class="w">      </span><span class="c1"># BYOK based key configuration - byok (see below for additional byok params)</span><span class="w"></span>
<span class="w">      </span><span class="c1"># File based key store (use only in dev environments)</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Azure Key vault based keys - azure</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam.store.type=aws</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam.secrets.prefix=prefix</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws_access_id=&lt;ENCRYPTED_ACCESS_ID&gt;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws_secret_id=&lt;ENCRYPTED_SECRET_ID&gt;</span><span class="w"></span>
<span class="w">      </span><span class="c1"># byok configuration</span><span class="w"></span>
<span class="w">      </span><span class="c1">#      - titaniam.store.type=byok</span><span class="w"></span>
<span class="w">      </span><span class="c1">#      - titaniam.es.host=http://arcus:9200</span><span class="w"></span>
<span class="w">      </span><span class="c1">#      - titaniam.byok.refresh-secs=30</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Elastic node name</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node.name=arcus01</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http.port=9200</span><span class="w"></span>
<span class="w">      </span><span class="c1"># For development purposes only</span><span class="w"></span>
<span class="w">      </span><span class="c1"># For multi-node cluster, remove this propery and add cluster related properties</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">discovery.type=single-node</span><span class="w"></span>
<span class="w">      </span><span class="c1">#- cluster.name=titaniam-vault-cluster</span><span class="w"></span>
<span class="w">      </span><span class="c1">#- cluster.initial_master_nodes=arcus01,arcus02</span><span class="w"></span>
<span class="w">      </span><span class="c1"># IP address of the &quot;other&quot; master-eligible hosts, comma separated.</span><span class="w"></span>
<span class="w">      </span><span class="c1">#- discovery.seed_hosts=172.32.92.48</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Binds http.port to all IP address on the host.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network.host=0.0.0.0</span><span class="w"></span>
<span class="w">      </span><span class="c1"># The external IP published for this node in /_cat/nodes etc., for multi-node setup</span><span class="w"></span>
<span class="w">      </span><span class="c1">#- network.publish_host=172.32.92.48</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node.roles=master, data, ingest</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.recover_after_nodes=1</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">transport.port=9300-9400</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Sets the log levels for all non-titaniam packages</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_level_root=info</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Sets the log levels for all titaniam packages</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_level_titaniam=info</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Required, shouldn&#39;t be changed across restarts of the container else data will be lost.</span><span class="w"></span>
<span class="w">      </span><span class="c1"># This should reflect the external directory mount</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Ensure this directory is writable by uid=1000 and not root.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path.data=/var/lib/arcusdata</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Sets the memory size of the java process. 512m is an example. Production setups</span><span class="w"></span>
<span class="w">      </span><span class="c1"># should be ~4G or higher depending on use cases.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;ES_JAVA_OPTS=-Xms512m</span><span class="nv"> </span><span class="s">-Xmx512m&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opendistro_security.disabled=true</span><span class="w"></span>
<span class="w">    </span><span class="nt">ulimits</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">memlock</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">soft</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span><span class="w"></span>
<span class="w">        </span><span class="nt">hard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span><span class="w"></span>
<span class="w">      </span><span class="nt">nofile</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">soft</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65536</span><span class="w"></span>
<span class="w">        </span><span class="nt">hard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65536</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Important configuration that determines where Elasticsearch will store</span><span class="w"></span>
<span class="w">      </span><span class="c1"># the data. This volume tells docker container how the host directory maps</span><span class="w"></span>
<span class="w">      </span><span class="c1"># to directory inside docker container. Actual mapping to elastic is done</span><span class="w"></span>
<span class="w">      </span><span class="c1"># using path.data environment variable above.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/arcusdata:/var/lib/arcusdata</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9200:9200&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9300:9300&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">kibana</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arcus</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker.elastic.co/kibana/kibana-oss:7.9.1</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/kibanadata:/usr/share/kibana/data</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5601:5601</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVERNAME=kibana</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ELASTICSEARCH_HOSTS=http://arcus:9200</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="example-docker-compose-yml-file-for-titaniam-plugin-using-local-file-system">
<span id="plugin-dockercompose-localfile"></span><h2>Example: Docker Compose YML File for Titaniam Plugin Using Local File System<a class="headerlink" href="#example-docker-compose-yml-file-for-titaniam-plugin-using-local-file-system" title="Permalink to this heading"></a></h2>
<p>The following is an example of the Titaniam plugin <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file. Save this text as <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span><span class="w"></span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.7&#39;</span><span class="w"></span>

<span class="c1"># This docker-compose enables ssl for elastic.</span><span class="w"></span>
<span class="c1"># Test certs/jks are available in the test-certs.zip</span><span class="w"></span>

<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w"> </span><span class="nt">arcus</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam/arcus_v710:1.0.0</span><span class="w"></span>
<span class="w">   </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arcus-node1</span><span class="w"></span>
<span class="w">   </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Possible values aws|byok|file|azure</span><span class="w"></span>
<span class="w">     </span><span class="c1"># AWS Secrets Manager based keys - aws</span><span class="w"></span>
<span class="w">     </span><span class="c1"># BYOK based key configuration - byok (see below for additional byok params)</span><span class="w"></span>
<span class="w">     </span><span class="c1"># File based key store (use only in dev environments)</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Azure Key vault based keys - azure</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam.store.type=file</span><span class="w"></span>

<span class="w">     </span><span class="c1"># byok configuration</span><span class="w"></span>
<span class="w">     </span><span class="c1"># - titaniam.es.host=http://node1.titaniamlabs.com:9200</span><span class="w"></span>
<span class="w">     </span><span class="c1"># - titaniam.byok.refresh-secs=30</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Elastic node name</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node.name=arcus01</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http.port=9200</span><span class="w"></span>

<span class="w">     </span><span class="c1"># For development purposes only</span><span class="w"></span>
<span class="w">     </span><span class="c1"># For multi-node cluster, remove this property and add cluster related properties</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">discovery.type=single-node</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Binds http.port to all IP address on the host.</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network.host=0.0.0.0</span><span class="w"></span>

<span class="w">     </span><span class="c1"># The external IP published for this node in /_cat/nodes etc., for multi-node setup</span><span class="w"></span>
<span class="w">     </span><span class="c1">#- network.publish_host=172.32.92.48</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node.roles=master, data, ingest</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.recover_after_nodes=1</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">transport.port=9300-9400</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Sets the log levels for all non-titaniam packages</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_level_root=info</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Sets the log levels for all titaniam packages</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_level_titaniam=info</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Required, shouldn&#39;t be changed across restarts of the container else data will be lost.</span><span class="w"></span>
<span class="w">     </span><span class="c1"># This should reflect the external directory mount</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Ensure this directory is writable by uid=1000 and not root.</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path.data=/var/lib/arcusdata</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Sets the memory size of the java process. 512m is an example. Production setups</span><span class="w"></span>
<span class="w">     </span><span class="c1"># should be ~4G or higher depending on use cases.</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;ES_JAVA_OPTS=-Xms512m</span><span class="nv"> </span><span class="s">-Xmx512m&quot;</span><span class="w"></span>

<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opendistro_security.disabled=true</span><span class="w"></span>

<span class="w">   </span><span class="nt">ulimits</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="nt">memlock</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="nt">soft</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span><span class="w"></span>
<span class="w">       </span><span class="nt">hard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span><span class="w"></span>
<span class="w">     </span><span class="nt">nofile</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="nt">soft</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65536</span><span class="w"></span>
<span class="w">       </span><span class="nt">hard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65536</span><span class="w"></span>
<span class="w">   </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Important configuration that determines where Elasticsearch will store</span><span class="w"></span>
<span class="w">     </span><span class="c1"># the data. This volume tells docker container how the host directory maps</span><span class="w"></span>
<span class="w">     </span><span class="c1"># to directory inside docker container. Actual mapping to elastic is done</span><span class="w"></span>
<span class="w">     </span><span class="c1"># using path.data environment variable above.</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/arcusdata:/var/lib/arcusdata</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/centos/titaniam_config/license:/usr/local/titaniam/license</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/local/titaniam/keyring.json:/usr/local/titaniam/keyring.json</span><span class="w"></span>
<span class="w">   </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9200:9200&quot;</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9300:9300&quot;</span><span class="w"></span>
<span class="w">   </span><span class="nt">extra_hosts</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Set machine IP</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node1.titaniamlabs.com:&lt;MACHINE_PRIVATE_IP&gt;&quot;</span><span class="w"></span>

<span class="w"> </span><span class="nt">kibana</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arcus</span><span class="w"></span>
<span class="w">   </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker.elastic.co/kibana/kibana-oss:7.10.2</span><span class="w"></span>
<span class="w">   </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/kibanadata:/usr/share/kibana/data</span><span class="w"></span>
<span class="w">   </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5601:5601</span><span class="w"></span>
<span class="w">   </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVERNAME=kibana</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ELASTICSEARCH_HOSTS=http://arcus:9200</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="example-docker-compose-yml-file-for-titaniam-plugin-in-byok-mode">
<span id="plugin-dockercompose-byok"></span><h2>Example: Docker Compose YML File for Titaniam Plugin in BYOK Mode<a class="headerlink" href="#example-docker-compose-yml-file-for-titaniam-plugin-in-byok-mode" title="Permalink to this heading"></a></h2>
<p>The following is an example of the Titaniam plugin <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file in a BYOK mode.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span><span class="w"></span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.7&#39;</span><span class="w"></span>

<span class="c1"># This docker-compose enables ssl for elastic.</span><span class="w"></span>
<span class="c1"># Test certs/jks are available in the test-certs.zip</span><span class="w"></span>

<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">arcus</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam/arcus_v710:1.0.0</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arcus-node1</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># aws_region - region where the SM values are stored in AWS</span><span class="w"></span>
<span class="w">      </span><span class="c1"># this configuraiton uses IAM roles to read data from AWS</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Assign proper IAM roles to the ec2 instances that will enable</span><span class="w"></span>
<span class="w">      </span><span class="c1"># SecretsManagerReadWrite</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws_region=us-east-2</span><span class="w"></span>

<span class="w">      </span><span class="c1"># keyring_name is part of the Secrets Manager (SM) secret name.</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Secret name is of the format - titaniam_key_ring/&lt;keyring_name&gt;/&lt;key_name&gt;</span><span class="w"></span>
<span class="w">      </span><span class="c1"># - Secret name must begin with titaniam_key_ring</span><span class="w"></span>
<span class="w">      </span><span class="c1"># - &lt;titaniam.keyring.name&gt; is a custom name of the environment &amp; deployment</span><span class="w"></span>
<span class="w">      </span><span class="c1"># - &lt;key_name&gt; will correspond to the elastic index name</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Setting Active=true as a tag on Secrets Manager secret name will make that key default,</span><span class="w"></span>
<span class="w">      </span><span class="c1"># when index level key is absent. (This will make index level keys default to a single key for new index)</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam.keyring.name=exampleringname</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Possible values aws|byok|file|azure</span><span class="w"></span>
<span class="w">      </span><span class="c1"># AWS Secrets Manager based keys - aws</span><span class="w"></span>
<span class="w">      </span><span class="c1"># BYOK based key configuration - byok (see below for additional byok params)</span><span class="w"></span>
<span class="w">      </span><span class="c1"># File based key store (use only in dev environments)</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Azure Key vault based keys - azure</span><span class="w"></span>


<span class="w">      </span><span class="c1"># byok configuration</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam.store.type=byok</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam.es.host=http://arcus:9200</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam.byok.refresh-secs=30</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Elastic node name</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node.name=arcus01</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http.port=9200</span><span class="w"></span>

<span class="w">      </span><span class="c1"># For development purposes only</span><span class="w"></span>
<span class="w">      </span><span class="c1"># For multi-node cluster, remove this propery and add cluster related properties</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">discovery.type=single-node</span><span class="w"></span>
<span class="w">      </span><span class="c1">#- cluster.name=titaniam-vault-cluster</span><span class="w"></span>
<span class="w">      </span><span class="c1">#- cluster.initial_master_nodes=arcus01,arcus02</span><span class="w"></span>
<span class="w">      </span><span class="c1"># IP address of the &quot;other&quot; master-eligible hosts, comma separated.</span><span class="w"></span>
<span class="w">      </span><span class="c1">#- discovery.seed_hosts=172.32.92.48</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Binds http.port to all IP address on the host.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network.host=0.0.0.0</span><span class="w"></span>

<span class="w">      </span><span class="c1"># The external IP published for this node in /_cat/nodes etc., for multi-node setup</span><span class="w"></span>
<span class="w">      </span><span class="c1">#- network.publish_host=172.32.92.48</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node.roles=master, data, ingest</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.recover_after_nodes=1</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">transport.port=9300-9400</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Sets the log levels for all non-titaniam packages</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_level_root=info</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Sets the log levels for all titaniam packages</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_level_titaniam=info</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Required, shouldn&#39;t be changed across restarts of the container else data will be lost.</span><span class="w"></span>
<span class="w">      </span><span class="c1"># This should reflect the external directory mount</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Ensure this directory is writable by uid=1000 and not root.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path.data=/var/lib/arcusdata</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Sets the memory size of the java process. 512m is an example. Production setups</span><span class="w"></span>
<span class="w">      </span><span class="c1"># should be ~4G or higher depending on use cases.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;ES_JAVA_OPTS=-Xms512m</span><span class="nv"> </span><span class="s">-Xmx512m&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opendistro_security.disabled=true</span><span class="w"></span>

<span class="w">    </span><span class="nt">ulimits</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">memlock</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">soft</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span><span class="w"></span>
<span class="w">        </span><span class="nt">hard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span><span class="w"></span>
<span class="w">      </span><span class="nt">nofile</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">soft</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65536</span><span class="w"></span>
<span class="w">        </span><span class="nt">hard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65536</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Important configuration that determines where Elasticsearch will store</span><span class="w"></span>
<span class="w">      </span><span class="c1"># the data. This volume tells docker container how the host directory maps</span><span class="w"></span>
<span class="w">      </span><span class="c1"># to directory inside docker container. Actual mapping to elastic is done</span><span class="w"></span>
<span class="w">      </span><span class="c1"># using path.data environment variable above.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/user/lib/arcusdata:/var/lib/arcusdata</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9200:9200&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9300:9300&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">kibana</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arcus</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker.elastic.co/kibana/kibana-oss:7.10.2</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/kibanadata:/usr/share/kibana/data</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5601:5601</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVERNAME=kibana</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ELASTICSEARCH_HOSTS=https://arcus:9200</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="example-docker-compose-yml-file-for-postgresql">
<span id="postgres-dockercompose"></span><h2>Example: Docker Compose YML File for PostgreSQL<a class="headerlink" href="#example-docker-compose-yml-file-for-postgresql" title="Permalink to this heading"></a></h2>
<p>The following is an example of the Titaniam plugin <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file. Save this text as <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span><span class="w"></span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.7&#39;</span><span class="w"></span>
<span class="c1"># This docker-compose enables ssl for elastic.</span><span class="w"></span>
<span class="c1"># Test certs/jks are available in the test-certs.zip</span><span class="w"></span>

<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="c1"># Database service (Postgres)</span><span class="w"></span>
<span class="w"> </span><span class="nt">spectra-postgres</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span><span class="w"></span>
<span class="w">   </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13.3-alpine</span><span class="w"></span>
<span class="w">   </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span><span class="w"></span>
<span class="w">   </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span><span class="w"></span>
<span class="w">     </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PoSSiBle</span><span class="w"></span>
<span class="w">     </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam</span><span class="w"></span>
<span class="w">     </span><span class="nt">PGDATA</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/postgresql/13/main</span><span class="w"></span>
<span class="w">   </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5432:5432&quot;</span><span class="w"></span>
<span class="w">   </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Ensure this directory exists on the local filesystem</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/postgresql/13/main:/var/lib/postgresql/13/main</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="example-docker-compose-yml-file-for-titaniam-server-using-aws">
<span id="server-dockercompose"></span><h2>Example: Docker Compose YML File for Titaniam Server using AWS<a class="headerlink" href="#example-docker-compose-yml-file-for-titaniam-server-using-aws" title="Permalink to this heading"></a></h2>
<p>The following is an example of the Titaniam Server <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file. Save this text as <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span><span class="w"></span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.7&#39;</span><span class="w"></span>

<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w"> </span><span class="nt">spectra</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam/spectra:&lt;version&gt;</span><span class="w"></span>
<span class="w">   </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra_node1</span><span class="w"></span>
<span class="w">   </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:8080&quot;</span><span class="w"></span>
<span class="w">   </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jvm_args=-Xms512m -Xmx512m</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panther.enabled=false</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdv.enabled=true</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ripple.enabled=false</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.esproxy.enabled=false</span><span class="w"></span>
<span class="w">     </span><span class="c1"># This property determines which secret name contains the</span><span class="w"></span>
<span class="w">     </span><span class="c1"># configuration for spectra application. The contents of</span><span class="w"></span>
<span class="w">     </span><span class="c1"># the property is included in Getting Started Guide.</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.properties-source=aws.sm</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.secretsmanager.properties.keyname=titaniam.properties</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.aws.sm.keyring-name=installtest</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.aws.sm.region=us-east-1</span><span class="w"></span>

<span class="w">     </span><span class="c1"># This is the same as aws_region environment variable</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.seed.store.type=aws</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam.secrets.prefix=prefix</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.aws.sm.access-key=&lt;Encrypted_access_key&gt;</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.aws.sm.secret-key=&lt;Encrypted_secret_key&gt;</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spring.datasource.url=jdbc:postgresql://&lt;postgres_private_ip&gt;/titaniam</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spring.datasource.password=PoSSiBle</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spring.datasource.username=admin</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQL10Dialect</span><span class="w"></span>


<span class="w">     </span><span class="c1"># This must match the IP and port of the elastic configured</span><span class="w"></span>
<span class="w">     </span><span class="c1"># in the arcus above.</span><span class="w"></span>
<span class="w">     </span><span class="c1"># This is required only if spectra is enabled. (sdv.enabled: true in sdss.secretsmanager.properties.keyname secret)</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spring.elasticsearch.rest.uris=http://&lt;plugin_private_ip&gt;:9200</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Disalbe single-sing-on</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sso.enabled=false</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,org.springframework.boot.actuate.autoconfigure.security.servlet.ManagementWebSecurityAutoConfiguration</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Possible values aws|byok|file|azure</span><span class="w"></span>
<span class="w">     </span><span class="c1"># AWS Secrets Manager based keys - aws</span><span class="w"></span>
<span class="w">     </span><span class="c1"># BYOK based key configuration - byok (see below for additional byok params)</span><span class="w"></span>
<span class="w">     </span><span class="c1"># File based key store (use only in dev environments)</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Azure Key vault based keys - azure</span><span class="w"></span>
<span class="w">     </span><span class="c1"># - sdss.seed.store.type=byok</span><span class="w"></span>

<span class="w">     </span><span class="c1"># byok configuration</span><span class="w"></span>
<span class="w">     </span><span class="c1"># create an index named - titaniam_byok_config</span><span class="w"></span>
<span class="w">     </span><span class="c1"># - sdss.byok.refresh-secs=30</span><span class="w"></span>
<span class="w">     </span><span class="c1"># - sdss.byok.host=http://node1.titaniamlabs.com:9200</span><span class="w"></span>

<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amazon.s3.region=us-east-2</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Controls logging.</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_level_root=debug</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_level_titaniam=debug</span><span class="w"></span>

<span class="w">   </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/granger:/var/log/granger</span><span class="w"></span>
<span class="w">   </span><span class="nt">extra_hosts</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Set machine IP</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node1.titaniamlabs.com:172.31.16.163&quot;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="example-docker-compose-yml-file-for-titaniam-server">
<span id="server-dockercompose-localfilesystem"></span><h2>Example: Docker Compose YML File for Titaniam Server<a class="headerlink" href="#example-docker-compose-yml-file-for-titaniam-server" title="Permalink to this heading"></a></h2>
<p>The following is an example of the Titaniam Server <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span><span class="w"></span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.7&#39;</span><span class="w"></span>

<span class="c1"># This docker-compose enables ssl for elastic.</span><span class="w"></span>
<span class="c1"># Test certs/jks are available in the test-certs.zip</span><span class="w"></span>

<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">spectra</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra-postgres</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam/spectra:&lt;version&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra_node1</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:8080&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jvm_args=-Xms512m -Xmx512m -Djavax.net.debug=ssl:handshake</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panther.enabled=false</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdv.enabled=true</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ripple.enabled=false</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.esproxy.enabled=false</span><span class="w"></span>

<span class="w">      </span><span class="c1"># This property determines which secret name contains the</span><span class="w"></span>
<span class="w">      </span><span class="c1"># configuration for spectra application. The contents of</span><span class="w"></span>
<span class="w">      </span><span class="c1"># the property is included in Getting Started Guide.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.properties-source=aws.sm</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.secretsmanager.properties.keyname=titaniam.properties</span><span class="w"></span>

<span class="w">      </span><span class="c1"># This is the same as aws_region environment variable above under arcus</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.aws.sm.region=us-east-2</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Disable single-sign-on</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sso.enabled=false</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,org.springframework.boot.actuate.autoconfigure.security.servlet.ManagementWebSecurityAutoConfiguration</span><span class="w"></span>


<span class="w">      </span><span class="c1"># Possible values aws|byok|file|azure</span><span class="w"></span>
<span class="w">      </span><span class="c1"># AWS Secrets Manager based keys - aws</span><span class="w"></span>
<span class="w">      </span><span class="c1"># BYOK based key configuration - byok (see below for additional byok params)</span><span class="w"></span>
<span class="w">      </span><span class="c1"># File based key store (use only in dev environments)</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Azure Key vault based keys - azure</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.seed.store.type=aws</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.aws.sm.access-key=&lt;AWS_ACCESS_ID&gt;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.aws.sm.secret-key=&lt;AWS_SECRET_ID&gt;</span><span class="w"></span>
<span class="w">      </span><span class="c1"># This is the same as keyring_name environment variable above under arcus</span><span class="w"></span>
<span class="w">      </span><span class="c1"># This value *must* match the value specified under arcus</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.aws.sm.keyring-name=exampleringname</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam.secrets.prefix=prefix</span><span class="w"></span>
<span class="w">      </span>
<span class="w">      </span><span class="c1"># This must match the IP and port of the elastic configured</span><span class="w"></span>
<span class="w">      </span><span class="c1"># in the arcus above.</span><span class="w"></span>
<span class="w">      </span><span class="c1"># This is required only if spectra is enabled. (sdv.enabled: true in sdss.secretsmanager.properties.keyname secret)</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spring.elasticsearch.rest.uris=http://&lt;plugin_private_ip&gt;:9200</span><span class="w"></span>
<span class="w">      </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spring.datasource.url=jdbc:postgresql://&lt;postgres_private_ip&gt;/titaniam</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spring.datasource.password=PoSSiBle</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spring.datasource.username=admin</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQL10Dialect</span><span class="w"></span>

<span class="w">      </span><span class="c1"># byok configuration</span><span class="w"></span>
<span class="w">      </span><span class="c1"># create an index named - titaniam_byok_config</span><span class="w"></span>
<span class="w">      </span><span class="c1"># issues with doing BYOK with SSL??</span><span class="w"></span>
<span class="w">      </span><span class="c1">#      - sdss.seed.store.type=byok</span><span class="w"></span>
<span class="w">      </span><span class="c1">#      - sdss.byok.refresh-secs=30</span><span class="w"></span>
<span class="w">      </span><span class="c1">#      - sdss.byok.host=http://arcus:9200</span><span class="w"></span>

<span class="w">      </span><span class="c1"># S3 file mgmt</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amazon.s3.region=us-east-2</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Controls logging.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_level_root=info</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_level_titaniam=info</span><span class="w"></span>


<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1">#   - /home/centos/certs/server.keys.jks:/usr/local/granger/key-store.jks</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/granger:/var/log/granger</span><span class="w"></span>

<span class="w">    </span><span class="nt">extra_hosts</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node1.titaniamlabs.com:172.32.79.211&quot;</span><span class="w"></span>

<span class="c1"># Database service (Postgres)</span><span class="w"></span>
<span class="w">  </span><span class="nt">spectra-postgres</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13.3-alpine</span><span class="w"></span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span><span class="w"></span>
<span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PoSSiBle</span><span class="w"></span>
<span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam</span><span class="w"></span>
<span class="w">      </span><span class="nt">PGDATA</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/postgresql/13/main</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5432:5432&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Ensure this directory exists on the local filesystem</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/postgresql/13/main:/var/lib/postgresql/13/main</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="example-docker-compose-yml-file-for-titaniam-server-in-byok-for-vault-and-elasticsearch-proxy">
<span id="server-dockercompose-byok"></span><h2>Example: Docker Compose YML File for Titaniam Server in BYOK for Vault and Elasticsearch Proxy<a class="headerlink" href="#example-docker-compose-yml-file-for-titaniam-server-in-byok-for-vault-and-elasticsearch-proxy" title="Permalink to this heading"></a></h2>
<p>The following is an example of the Titaniam Server <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span><span class="w"></span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.7&#39;</span><span class="w"></span>

<span class="c1"># This docker-compose enables ssl for elastic.</span><span class="w"></span>
<span class="c1"># Test certs/jks are available in the test-certs.zip</span><span class="w"></span>

<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">spectra</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra-postgres</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam/spectra:&lt;version&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra_node1</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:8080&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jvm_args=-Xms512m -Xmx512m -Djavax.net.debug=ssl:handshake</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panther.enabled=false</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdv.enabled=true</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ripple.enabled=false</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.esproxy.enabled=true</span><span class="w"></span>

<span class="w">      </span><span class="c1"># This property determines which secret name contains the</span><span class="w"></span>
<span class="w">      </span><span class="c1"># configuration for spectra application. The contents of</span><span class="w"></span>
<span class="w">      </span><span class="c1"># the property is included in Getting Started Guide.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.properties-source=aws.sm</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.secretsmanager.properties.keyname=titaniam.properties</span><span class="w"></span>

<span class="w">      </span><span class="c1"># This is the same as aws_region environment variable above under arcus</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.aws.sm.region=us-east-2</span><span class="w"></span>

<span class="w">      </span><span class="c1"># This is the same as keyring_name environment variable above under arcus</span><span class="w"></span>
<span class="w">      </span><span class="c1"># This value *must* match the value specified under arcus</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.aws.sm.keyring-name=exampleringname</span><span class="w"></span>

<span class="w">      </span><span class="c1"># This must match the IP and port of the elastic configured</span><span class="w"></span>
<span class="w">      </span><span class="c1"># in the arcus above.</span><span class="w"></span>
<span class="w">      </span><span class="c1"># This is required only if spectra is enabled. (sdv.enabled: true in sdss.secretsmanager.properties.keyname secret)</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spring.elasticsearch.rest.uris=http://node1.titaniamlabs.com:9200</span><span class="w"></span>


<span class="w">      </span><span class="c1"># Disable single-sign-on</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sso.enabled=false</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,org.springframework.boot.actuate.autoconfigure.security.servlet.ManagementWebSecurityAutoConfiguration</span><span class="w"></span>


<span class="w">      </span><span class="c1"># Possible values aws|byok|file|azure</span><span class="w"></span>
<span class="w">      </span><span class="c1"># AWS Secrets Manager based keys - aws</span><span class="w"></span>
<span class="w">      </span><span class="c1"># BYOK based key configuration - byok (see below for additional byok params)</span><span class="w"></span>
<span class="w">      </span><span class="c1"># File based key store (use only in dev environments)</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Azure Key vault based keys - azure</span><span class="w"></span>

<span class="w">      </span><span class="c1"># byok configuration</span><span class="w"></span>
<span class="w">      </span><span class="c1"># create an index named - titaniam_byok_config</span><span class="w"></span>
<span class="w">      </span><span class="c1"># issues with doing BYOK with SSL??</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.seed.store.type=byok</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.byok.refresh-secs=30</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdss.byok.host=http://arcus:9200</span><span class="w"></span>

<span class="w">      </span><span class="c1"># S3 file mgmt</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amazon.s3.region=us-east-2</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Controls logging.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_level_root=info</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_level_titaniam=info</span><span class="w"></span>


<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1">#   - /home/centos/certs/server.keys.jks:/usr/local/granger/key-store.jks</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/granger:/var/log/granger</span><span class="w"></span>

<span class="w">    </span><span class="nt">extra_hosts</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node1.titaniamlabs.com:172.32.79.211&quot;</span><span class="w"></span>

<span class="c1"># Database service (Postgres)</span><span class="w"></span>
<span class="w">  </span><span class="nt">spectra-postgres</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13.3-alpine</span><span class="w"></span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span><span class="w"></span>
<span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PoSSiBle</span><span class="w"></span>
<span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam</span><span class="w"></span>
<span class="w">      </span><span class="nt">PGDATA</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/postgresql/13/main</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5432:5432&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Ensure this directory exists on the local filesystem</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/postgresql/13/main:/var/lib/postgresql/13/main</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="example-docker-compose-yml-file-for-enabling-all-titaniam-services-and-properties-in-local-file-system">
<span id="titaniam-file-server"></span><h2>Example: Docker Compose YML File for Enabling All Titaniam Services and Properties in Local File System<a class="headerlink" href="#example-docker-compose-yml-file-for-enabling-all-titaniam-services-and-properties-in-local-file-system" title="Permalink to this heading"></a></h2>
<p>The following is an example of the Titaniam Server, Titaniam Plugin, and Postgres <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span><span class="w"></span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.7&#39;</span><span class="w"></span>

<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">arcus</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam/arcus:1.7.8</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arcus-node1</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam.store.type=file</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node.name=arcus01</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http.port=9200</span><span class="w"></span>

<span class="w">      </span><span class="c1"># For development purposes only</span><span class="w"></span>
<span class="w">      </span><span class="c1"># For multi-node cluster, remove this propery and add cluster related properties</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">discovery.type=single-node</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Binds http.port to all IP address on the host.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network.host=0.0.0.0</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Sets the log levels for all non-titaniam packages</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_level_root=info</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Sets the log levels for all titaniam packages</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_level_titaniam=info</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Required, shouldn&#39;t be changed across restarts of the container else data will be lost.</span><span class="w"></span>
<span class="w">      </span><span class="c1"># This should reflect the external directory mount</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Ensure this directory is writable by uid=1000 and not root.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path.data=/var/lib/arcusdata</span><span class="w"></span>

<span class="w">      </span><span class="c1"># Sets the memory size of the java process. 512m is an example. Production setups</span><span class="w"></span>
<span class="w">      </span><span class="c1"># should be ~4G or higher depending on use cases.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;ES_JAVA_OPTS=-Xms1g</span><span class="nv"> </span><span class="s">-Xmx1g&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opendistro_security.disabled=true</span><span class="w"></span>

<span class="w">    </span><span class="nt">ulimits</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">memlock</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">soft</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span><span class="w"></span>
<span class="w">        </span><span class="nt">hard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span><span class="w"></span>
<span class="w">      </span><span class="nt">nofile</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">soft</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65536</span><span class="w"></span>
<span class="w">        </span><span class="nt">hard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65536</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Important configuration that determines where Elasticsearch will store</span><span class="w"></span>
<span class="w">      </span><span class="c1"># the data. This volume tells docker container how the host directory maps</span><span class="w"></span>
<span class="w">      </span><span class="c1"># to directory inside docker container. Actual mapping to elastic is done</span><span class="w"></span>
<span class="w">      </span><span class="c1"># using path.data environment variable above.</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/arcusdata:/var/lib/arcusdata</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;location of keyring.json&gt;:/usr/local/titaniam/keyring.json</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;location of titaniam licence&gt;:/usr/local/titaniam/license</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9200:9200&quot;</span><span class="w"></span>

<span class="w">  </span><span class="nt">spectra</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam/spectra:2.3.6</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra_node1</span><span class="w"></span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arcus</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:8080&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">JAVA_TOOL_OPTIONS=-Xms512m -Xmx512m</span><span class="w"></span>

<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/granger:/var/log/granger</span><span class="w"></span>
<span class="w">      </span><span class="c1"># check the keyring.json, license and titaniam.properties are present under</span><span class="w"></span>
<span class="w">      </span><span class="c1"># the path &#39;/usr/local/titaniam&#39;, if not create these files with the value</span><span class="w"></span>
<span class="w">      </span><span class="c1"># from titaniam</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;location of titaniam licence&gt;:/usr/local/titaniam/license</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;location of titaniam.properties file&gt;:/usr/local/granger/application.properties</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;location of keyring.json&gt;:/usr/local/titaniam/keyring.json</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Database service (Postgres)</span><span class="w"></span>
<span class="w">  </span><span class="nt">spectra-postgres</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13.3-alpine</span><span class="w"></span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span><span class="w"></span>
<span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PoSSiBle</span><span class="w"></span>
<span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam</span><span class="w"></span>
<span class="w">      </span><span class="nt">PGDATA</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/postgresql/13/main</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5432:5432&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Ensure this directory exists on the local filesystem</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/postgresql/13/main:/var/lib/postgresql/13/main</span><span class="w"></span>

<span class="w">  </span><span class="nt">kibana</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arcus</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker.elastic.co/kibana/kibana-oss:7.9.1</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/kibanadata:/usr/share/kibana/data</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5601:5601</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVERNAME=kibana</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ELASTICSEARCH_HOSTS=http://arcus:9200</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="titaniam-properties-secret">
<span id="sdss-properties"></span><h2>titaniam.properties Secret<a class="headerlink" href="#titaniam-properties-secret" title="Permalink to this heading"></a></h2>
<p>The following content can be copied and pasted onto a secret named <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> in PlainText view.</p>
<p>The values provided here are just examples. Edit it to reflect your
installation reality before creating the secret.</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span>{
    &quot;management.endpoint.health.show-details&quot;: &quot;always&quot;,
    &quot;server.ssl.port&quot;: &quot;443&quot;,
    &quot;server.ssl.enabled&quot;: &quot;true&quot;,
    &quot;server.ssl.key-store&quot;: &quot;file:/usr/local/granger/key-store.jks&quot;,
    &quot;server.ssl.key-store-password&quot;: &quot;changeit&quot;,
    &quot;server.ssl.key-alias&quot;: &quot;server&quot;,
    &quot;server.ssl.key-store-type&quot;: &quot;JKS&quot;,
    &quot;server.ssl.key-store-provider&quot;: &quot;SUN&quot;
    &quot;server.ssl.client-auth&quot;:&quot;need&quot;,
    &quot;server.ssl.trust-store&quot;:&quot;file:/usr/local/granger/trust-store.jks&quot;,
    &quot;server.ssl.trust-store-password&quot;:&quot;changeit&quot;,
    &quot;server.ssl.trust-store-type&quot;:&quot;JKS&quot;,
    &quot;sdss.auth.enabled&quot;: &quot;true&quot;,
    &quot;sdss.auth.access-key.1.encrypted&quot;: &quot;zero-day-encrypted-access-token&gt;&quot;,
    &quot;sdss.auth.access-key.1.paths&quot;: &quot;&lt;end-points-to-protect&gt;&quot;,
    &quot;spring.datasource.url&quot;: &quot;jdbc:mysql:&lt;database_URL&gt;&quot;,
    &quot;spring.datasource.username&quot;: &quot;&lt;username&gt;&quot;,
    &quot;spring.datasource.password&quot;: &quot;&lt;password&gt;&quot;,
    &quot;spring.datasource.driver-class-name&quot;: &quot;com.mysql.cj.jdbc.Driver&quot;,
    &quot;spring.jpa.properties.hibernate.format_sql&quot;: &quot;true&quot;,
    &quot;spring.jpa.properties.hibernate.dialect&quot;: &quot;org.hibernate.dialect.MySQL57InnoDBDialect&quot;,
    &quot;spring.datasource.hikari.minimumIdle&quot;: &quot;5&quot;,
    &quot;spring.jpa.hibernate.ddl-auto&quot;: &quot;update&quot;,
    &quot;sdss.encryption-keys.check-integrity&quot;: &quot;true&quot;,
    &quot;sdss.es.number_of_shards&quot;: &quot;2&quot;,
    &quot;sdss.es.number_of_replicas&quot;: &quot;2&quot;,
    &quot;sdss.store.elapsed.millis&quot;: &quot;true&quot;,
    &quot;sdss.es.reindex.slices&quot;: “auto”, 
    &quot;sdss.es.reindex.batch_size&quot;: 500,
    &quot;sdss.es.reindex.scroll_timeout_mins&quot;: 10
}
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ensure that there are no comments in the JSON file.</p>
</div>
</section>
<section id="titaniam-properties-with-all-enabled-services">
<span id="titaniam-all-props"></span><h2>titaniam.properties with All Enabled Services<a class="headerlink" href="#titaniam-properties-with-all-enabled-services" title="Permalink to this heading"></a></h2>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span>spring.jpa.hibernate.ddl-auto=update
spring.datasource.hikari.auto-commit=true
spring.datasource.url=jdbc:postgresql://spectra-postgres:5432/titaniam?autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true
spring.datasource.password=PoSSiBle
spring.datasource.username=admin
spring.datasource.driverClassName=org.postgresql.Driver
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQL10Dialect
spring.jpa.open-in-view=false

panther.enabled=true
ripple.enabled=true
sdv.enabled=true
sdss.esproxy.enabled=true
sdss.data.protection.enabled=true

sdss.store.elapsed.millis=true

# This must match the IP and port of the elastic configured
# in the arcus above.
# This is required only if spectra is enabled. (sdv.enabled: true in sdss.secretsmanager.properties.keyname secret)
spring.elasticsearch.rest.uris=http://arcus:9200

# Disalbe single-sing-on
sso.enabled=false
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,org.springframework.boot.actuate.autoconfigure.security.servlet.ManagementWebSecurityAutoConfiguration

# Possible values aws|byok|file
# AWS Secrets Manager based keys aws
# BYOK based key configuration byok (see below for additional byok params)
# File based key store (use only in dev environments)
sdss.seed.store.type=file

# S3 file mgmt
amazon.s3.region=us-east-2
# if &#39;ripple.enabled=true&#39;, uncomment the following props and replace bucket_name, access_key_id and secret_access_key with appropriate value
# access_key_id and secret_access_key values should be encrypted
amazon.s3.bucket-name=&lt;bucket_name&gt;
amazon.s3.access-key=&lt;encrypted_access_key_id&gt;
amazon.s3.secret-key=&lt;encrypted_secret_access_key&gt;

# Controls logging.
log_level_root=info
log_level_titaniam=debug
</pre></div>
</div>
</section>
<section id="configure-additional-properties-in-titaniam-properties">
<span id="configure-misc"></span><h2>Configure Additional Properties in titaniam.properties<a class="headerlink" href="#configure-additional-properties-in-titaniam-properties" title="Permalink to this heading"></a></h2>
<p>In addition to the Titaniam Server related properties, you can also specify the following additional properties based on your requirements in the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file.</p>
<section id="management-endpoints-for-health-and-version">
<h3>Management Endpoints for Health and Version<a class="headerlink" href="#management-endpoints-for-health-and-version" title="Permalink to this heading"></a></h3>
<p>Management endpoints to check health of the server and product version of the Titaniam Server.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;management.endpoint.health.show-details&quot;</span><span class="p">:</span> <span class="s2">&quot;always&quot;</span>
</pre></div>
</div>
<p>Managment endpoints to verify that Titaniam Plugin and Titaniam Server are using the same encryption keys. If this property is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, Titaniam Server starts only if the encryption keys are the same as Titaniam Plugin. If this property is set to <code class="docutils literal notranslate"><span class="pre">false</span></code>, this verification step is skipped.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;sdss.bootstrap.assert-keysha&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span>
</pre></div>
</div>
</section>
<section id="refresh-key-rate">
<h3>Refresh Key Rate<a class="headerlink" href="#refresh-key-rate" title="Permalink to this heading"></a></h3>
<p>Interval at which the Titaniam Server refreshes keys from the key store.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;sdss.byok.refresh-secs&quot;</span><span class="p">:</span> <span class="s2">&quot;30&quot;</span>
</pre></div>
</div>
</section>
<section id="enable-integrity-checks-on-encryption-key-table">
<h3>Enable Integrity Checks on Encryption Key Table<a class="headerlink" href="#enable-integrity-checks-on-encryption-key-table" title="Permalink to this heading"></a></h3>
<p>To enable integrity checks on the encryption_key tables in the datastore, you must set the following proprety to true. During startup, Titaniam Server checks if the active encryption key material matches the digest related to this key in the <code class="docutils literal notranslate"><span class="pre">encryption_key</span></code> table. If there is any discrepancy, then an exception is raised. Similarly, check is also performed if the key is deleted.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;sdss.encryption-keys.check-integrity&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span>
</pre></div>
</div>
</section>
<section id="configure-elasticsearch-index-settings-for-vault">
<span id="static-index"></span><h3>Configure Elasticsearch Index Settings for Vault<a class="headerlink" href="#configure-elasticsearch-index-settings-for-vault" title="Permalink to this heading"></a></h3>
<p>You can define the number of shards and number of replicas in the following ways:</p>
<ul class="simple">
<li><p>Using deployment-time Titaniam properties for creating Vault token or collection indexes.</p></li>
<li><p>Using deployment-time Titaniam properties or as body parameters in the API request when rotating keys for Vault tokens  (<a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-key-rotation-endpoints-schedule-key-rotation">Schedule key rotation</a>, <a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-key-rotation-endpoints-rerun-elastic">Continue Elasticsearch Tasks</a>, and <a class="reference external" href="https://docs.titaniamlabs.com/server/api/index.html#request-key-rotation-endpoints-rerun-key-activation-on-failure">Rerun</a> endpoints).</p></li>
</ul>
<p>For more information about these settings, see <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/index-modules.html#_static_index_settings">this document</a>.</p>
<section id="property-description">
<h4>Property Description<a class="headerlink" href="#property-description" title="Permalink to this heading"></a></h4>
<p>Use the following properties to define these settings:</p>
<p><code class="docutils literal notranslate"><span class="pre">sdss.es.number_of_shards=&lt;value&gt;</span></code> (Titaniam property) | <code class="docutils literal notranslate"><span class="pre">number_of_shards</span></code> (Body parameter)</p>
<blockquote>
<div><p>Defines the number of primary shards an Elasticsearch index must have. The number of shards must be greater than or equal to <code class="docutils literal notranslate"><span class="pre">1</span></code>. This property defaults to <code class="docutils literal notranslate"><span class="pre">1</span></code>. Based on this property, Titaniam Vault creates the Elasticsearch index.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">sdss.es.number_of_replicas=&lt;value&gt;</span></code> (Titaniam property) | <code class="docutils literal notranslate"><span class="pre">number_of_replicas</span></code> (Body parameter)</p>
<blockquote>
<div><p>Defines the number of replicas per Elasticsearch index shard. The number of replicas must be greater than or equal to <code class="docutils literal notranslate"><span class="pre">0</span></code>. This property defaults to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</div></blockquote>
<p>If you are using KRS to rotate keys in Titaniam Vault, you have the option of passing these properties in the request body of the <code class="docutils literal notranslate"><span class="pre">{{SpectraURL}}/v1/mgmt/key_rotation</span> <span class="pre">endpoint</span></code>. In this case, these values (from the request body) take precedence over the values from the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file. Following is an example of passing these value through the request body:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="p">{{</span><span class="n">SpectraURL</span><span class="p">}}</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">mgmt</span><span class="o">/</span><span class="n">key_rotation</span>

<span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vault_token&quot;</span><span class="p">,</span>
    <span class="s2">&quot;number_of_shards&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;number_of_replicas&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;reindex_slices&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reindex_batch_size&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
    <span class="s2">&quot;reindex_scroll_timeout_mins&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;key_metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;key_name&quot;</span><span class="p">:</span> <span class="s2">&quot;sdss-store-key2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;key2 for key rotation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;store_type&quot;</span><span class="p">:</span> <span class="s2">&quot;aws-secretsmanager&quot;</span><span class="p">,</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;secretName&quot;</span><span class="p">:</span> <span class="s2">&quot;titaniam_key_ring/reindex-test/key2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;secretKeyEncrypted&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;SECRET_KEY&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;REGION&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;accessKeyEncrypted&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;ACCESS_KEY&gt;&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="configure-elasticsearch-reindex-settings-for-vault">
<span id="reindex-settings"></span><h3>Configure Elasticsearch ReIndex Settings for Vault<a class="headerlink" href="#configure-elasticsearch-reindex-settings-for-vault" title="Permalink to this heading"></a></h3>
<p>When you are performing key rotation on Vault tokens, you can now define the following Elasticsearch reindex settings:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">reindex_slices</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reindex_batch_size</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reindex_scroll_timeout_mins</span></code></p></li>
</ul>
<p>For more information about these settings, see <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-reindex.html#docs-reindex-picking-slices">this document</a>.</p>
<section id="how-to-specify-these-reindex-settings">
<h4>How to specify these reindex settings<a class="headerlink" href="#how-to-specify-these-reindex-settings" title="Permalink to this heading"></a></h4>
<p>You can specify these reindex values in the following ways:</p>
<ul class="simple">
<li><p>API request body</p></li>
<li><p>Titaniam properties file during deployment</p></li>
</ul>
</section>
<section id="where-are-the-reindex-settings-picked-from">
<h4>Where are the reindex settings picked from?<a class="headerlink" href="#where-are-the-reindex-settings-picked-from" title="Permalink to this heading"></a></h4>
<p>The reindex values are picked in the following order of precedence:</p>
<ol class="arabic simple">
<li><p>API request body</p></li>
<li><p>Titaniam properties file during deployment</p></li>
<li><p>Following default Elastic values if these reindex settings are not specified:</p>
<ul class="simple">
<li><p>reindex_slices: none</p></li>
<li><p>reindex_scroll_timeout_mins: 5</p></li>
<li><p>reindex_batch_size: 1000</p></li>
</ul>
</li>
</ol>
</section>
<section id="reindex-property-description">
<h4>Reindex Property Description<a class="headerlink" href="#reindex-property-description" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">reindex_slices</span></code> (Body parameter) | <code class="docutils literal notranslate"><span class="pre">sdss.es.reindex.slices</span></code> (Titaniam property)</p>
<blockquote>
<div><p>Set to a <code class="docutils literal notranslate"><span class="pre">number</span></code> or <code class="docutils literal notranslate"><span class="pre">auto</span></code>. When set to <code class="docutils literal notranslate"><span class="pre">auto</span></code>, Elasticsearch creates slices equal to the number of primary shards. If you are explicitly specifying a number, the best practice is to set it equal to the number of shards.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">reindex_batch_size</span></code> (Body parameter) | <code class="docutils literal notranslate"><span class="pre">sdss.es.reindex.batch_size</span></code> (Titaniam property)</p>
<blockquote>
<div><p>Specifies the number of documents to reindex per batch in Elasticsearch. You can set any value in the range {1 - 10000}.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">reindex_scroll_timeout_mins</span></code> (Body parameter) | <code class="docutils literal notranslate"><span class="pre">sdss.es.reindex.scroll_timeout_mins</span></code> (Titaniam property)</p>
<blockquote>
<div><p>Specifies the scroll out time in minutes. That is, the time required to complete reindexing of the batch. You can set any value in the range {1 - 1440}.</p>
</div></blockquote>
<p>If you are using KRS to rotate keys in Titaniam Vault, you have the option of passing these properties in the request body of the <code class="docutils literal notranslate"><span class="pre">{{SpectraURL}}/v1/mgmt/key_rotation</span> <span class="pre">endpoint</span></code>. In this case, these values (from the request body) take precedence over the values from the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file. Following is an example of passing these value through the request body:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>POST {{SpectraURL}}/v1/mgmt/key_rotation

{
    &quot;type&quot;: &quot;vault_token&quot;,
    &quot;number_of_shards&quot;: 2,
    &quot;number_of_replicas&quot;: 2,
    &quot;reindex_slices&quot;: “2”,
    &quot;reindex_batch_size&quot;: 500,
    &quot;reindex_scroll_timeout_mins&quot;: 10,
    &quot;key_metadata&quot;: {
        &quot;key_name&quot;: &quot;sdss-store-key2&quot;,
        &quot;description&quot;: &quot;key2 for key rotation&quot;,
        &quot;store_type&quot;: &quot;aws-secretsmanager&quot;,
        &quot;location&quot;: {
            &quot;secretName&quot;: &quot;titaniam_key_ring/reindex-test/key2&quot;,
            &quot;secretKeyEncrypted&quot;: &quot;&lt;SECRET_KEY&gt;&quot;,
            &quot;region&quot;: &quot;&lt;REGION&gt;&quot;,
            &quot;accessKeyEncrypted&quot;: &quot;&lt;ACCESS_KEY&gt;&quot;
        }
    }
}
</pre></div>
</div>
</section>
</section>
<section id="include-time-taken-for-ingestion-in-api-response-headers">
<span id="millisecs"></span><h3>Include Time Taken for Ingestion in API Response Headers<a class="headerlink" href="#include-time-taken-for-ingestion-in-api-response-headers" title="Permalink to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is applicable only when using the bulk store (<code class="docutils literal notranslate"><span class="pre">/v2/secure/store/bulk</span></code>) endpoint for Vault tokens.</p>
</div>
<p>If you want to include the time taken for the following operations involving Elasticsearch in the API response headers, you must set the property <code class="docutils literal notranslate"><span class="pre">sdss.store.elapsed.millis</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> during the Titaniam Server deployment:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X-tn-es-lookup-millis</span></code>: time in milliseconds to look up if the fields exists in the Elasticsearch index.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-tn-es-millis</span></code>: Time (in millisecond) taken to ingest data in Elasticsearch. A PTOS in the value indicates zero.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-tn-db-millis</span></code>: Time (in millisecond) taken to ingest metadata in the datastore. A PTOS in the value indicates zero.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-tn-total-time-millis</span></code>: Total time taken to execute the bulk query.</p></li>
</ul>
</section>
</section>
</section>
<section id="appendix-generic-concepts-and-tasks">
<h1>Appendix: Generic Concepts and Tasks<a class="headerlink" href="#appendix-generic-concepts-and-tasks" title="Permalink to this heading"></a></h1>
<p>This section explains generic (not maintained by Titaniam) concepts and tasks that are useful when installing and configuring Titaniam Server.</p>
<section id="install-docker-and-docker-compose">
<span id="install-docker-os"></span><h2>Install Docker and Docker Compose<a class="headerlink" href="#install-docker-and-docker-compose" title="Permalink to this heading"></a></h2>
<p>This section explains how to install docker on the EC2 instances.</p>
<p><strong>CentOS</strong></p>
<ol class="arabic simple">
<li><p>Install Docker. See <a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-centos-7">this
document</a>
to install Docker.</p></li>
<li><p>Install Docker-compose. See <a class="reference external" href="https://docs.docker.com/compose/install/other/">this document</a>.</p></li>
</ol>
<p><strong>Ubuntu</strong></p>
<p>Install docker and docker-compose using the instructions described <a class="reference external" href="https://docs.docker.com/engine/install/ubuntu/">here</a>.</p>
<p><strong>RHEL</strong></p>
<p>Install docker and docker-compose using the instructions described <a class="reference external" href="https://docs.docker.com/engine/install/rhel">here</a>.</p>
</section>
<section id="aws-secrets-manager-supplying-secrets">
<span id="supplying-secrets"></span><h2>AWS Secrets Manager: Supplying Secrets<a class="headerlink" href="#aws-secrets-manager-supplying-secrets" title="Permalink to this heading"></a></h2>
<p>Supply each encryption key, license, and titaniam.properties as separate secrets using the following instructions:</p>
<ol class="arabic">
<li><p>Log into AWS and visit the <a class="reference external" href="https://console.aws.amazon.com/secretsmanager/">Secrets Manager
console</a>.</p></li>
<li><p>Select <strong>Store a new secret</strong>.</p>
<img alt="_images/store_a_new_secret.png" src="_images/store_a_new_secret.png" />
</li>
<li><p>On the <strong>Select secret type</strong> page, do the following:</p>
<ol class="loweralpha simple">
<li><p>Select <strong>Other type of secrets.</strong></p></li>
<li><p>Set key/value in the <strong>Specify the key/value pairs to be stored in
this secret</strong> section.</p>
<ol class="lowerroman simple">
<li><p>Key - Enter name for the secret. This can be any alphanumeric
text. For example, “key”. The application ignores the key
name.</p></li>
<li><p>Value - Enter your key here.</p></li>
</ol>
</li>
<li><p>Select <strong>DefaultEncryptionKey</strong> in <strong>Select the encryption key</strong>
drop down.</p></li>
<li><p>Select <strong>Next.</strong></p></li>
</ol>
</li>
<li><p>Fill the <strong>Secret name and description</strong> page.</p></li>
<li><p>In the <strong>Tags</strong> section, create the tag as below to set the index as active</p>
<ol class="loweralpha">
<li><p><strong>Key</strong> - Active</p></li>
<li><p><strong>Value</strong> - (optional)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As you start rotating keys, eventually, there will be many keys for an installation. However, there can only be one active key among all the secrets for an installation. If you are installing Titaniam for the first time, this is likely the first key. Therefore, set the active tag.</p>
</div>
</li>
</ol>
</li>
<li><p>Select <strong>Next</strong>.</p></li>
<li><p>Select <strong>Next</strong> On the <strong>Configure automatic rotation page</strong>.</p></li>
<li><p>Review and store the key. You might see a key similar to the following.</p>
<img alt="_images/example_key.png" src="_images/example_key.png" />
</li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Titaniam Server Installation Guide for AWS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Titaniam, Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>