<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Production Installation Using Docker on EC2 Instances &mdash; Titaniam Server Installation Guide for AWS 1.00a documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/Primary lockup red_white.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html">What’s New</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#introduction">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#planning-your-installation">Planning your Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#platform-support-matrix">Platform Support Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#poc-installation-with-secrets-in-local-file-system">POC Installation with Secrets in Local File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#poc-installation-with-aws-secrets-manager">POC Installation with AWS Secrets Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#production-installation-using-kubernetes">Production Installation Using Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#production-installation-using-docker-on-ec2-instances">Production Installation Using Docker on EC2 Instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#appendix-titaniam-specific">Appendix: Titaniam-Specific</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#appendix-example-docker-compose-yml-files-and-property-files">Appendix: Example Docker Compose YML Files and Property Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#appendix-generic-concepts-and-tasks">Appendix: Generic Concepts and Tasks</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Titaniam Server Installation Guide for AWS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Production Installation Using Docker on EC2 Instances</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/production_docker_ec2.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="production-installation-using-docker-on-ec2-instances">
<h1>Production Installation Using Docker on EC2 Instances<a class="headerlink" href="#production-installation-using-docker-on-ec2-instances" title="Permalink to this heading"></a></h1>
<p>This section describes how you can deploy Titaniam Server on EC2 instances using docker in the following production layout:</p>
<img alt="_images/prod_ec2.png" src="_images/prod_ec2.png" />
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>This section explains instructions to deploy Titaniam Server in the following configurations:</p>
<ul class="simple">
<li><p>4 EC2 instances:</p>
<ul>
<li><p>An EC2 instance for installing Titaniam Plugin and Kibana</p></li>
<li><p>An EC2 instance for installing and hosting PostgreSQL</p></li>
<li><p>Two EC2 instances for installing and hosting Titaniam Server configured as Vault.</p></li>
</ul>
</li>
<li><p>The Titaniam Server and Kibana are accessible only through a network load balancer.</p></li>
<li><p>The Titaniam Server can access the PostgreSQL instance and Titaniam Plugin using their private IP addresses.</p></li>
</ul>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h2>
<ul>
<li><p>Read this <a class="reference internal" href="hello_world_aws.html#ps-matrix"><span class="std std-ref">Platform Support Matrix</span></a>.</p></li>
<li><p>Ensure that the each EC2 instance where you run Titaniam Server must have access to the Secrets Manager. Obtain an IAM Role with policy <strong>SecretsManagerReadWrite</strong>. This role allows the Titaniam Server to read and write to AWS Secrets Manager.</p></li>
<li><p>The AWS EC2 instances have access to internet initially to install docker, docker-compose, and Titaniam Server from the docker registry.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>After installing the components, ensure that you remove any public IP on the EC2 instances. You must access the EC2 instance only using the load balancer.</p>
</div>
</li>
</ul>
</section>
<section id="production-installation-instructions">
<span id="install-prod"></span><h2>Production Installation Instructions<a class="headerlink" href="#production-installation-instructions" title="Permalink to this heading"></a></h2>
<p>This section explains the overall process to install Titaniam Server in a high-availability production environment. You can supply  all the application properties, license, and encryption keys to Titaniam Server through a secret entry in a secrets manager.</p>
<section id="artifacts">
<h3>Artifacts<a class="headerlink" href="#artifacts" title="Permalink to this heading"></a></h3>
<p>Obtain the following installation artifacts from Titaniam support:</p>
<ul class="simple">
<li><p>License file and SHA Checksum for Titaniam Plugin and Titaniam Server.</p></li>
<li><p>Access token to retrieve the Titaniam Server and Plugin images from the private repository in Docker Hub. You need an access token to download the images. Contact Titaniam support to get your access token.</p></li>
</ul>
</section>
<section id="installation-process">
<h3>Installation Process<a class="headerlink" href="#installation-process" title="Permalink to this heading"></a></h3>
<p>Following is the process to install Titaniam Server, Plugin, and PostgreSQL.</p>
<ol class="arabic">
<li><p>Store the following as secrets in the AWS Secrets Manager:</p>
<ol class="loweralpha simple">
<li><p>License</p></li>
<li><p>Titaniam Server application properties</p></li>
<li><p>Encryption keys</p></li>
</ol>
<blockquote>
<div><p>Or</p>
<p>Store the license, application properties, and encryption keys in the local file system.</p>
</div></blockquote>
</li>
<li><p>Install Titaniam plugin and Kibana on an EC2 instance.</p></li>
<li><p>Install PostgreSQL on an EC2 instance.</p></li>
<li><p>Install Titaniam Server on an EC2 instance.</p>
<ol class="arabic simple">
<li><p>Configure as Vault.</p></li>
<li><p>Integrate with the PostgreSQL datastore.</p></li>
</ol>
</li>
<li><p>Configure load balancer.</p></li>
</ol>
<blockquote>
<div></div></blockquote>
</section>
</section>
<section id="step-1-supplying-configuration-values-and-keys-using-aws-secrets-manager">
<span id="lic-keys-aws-ec2"></span><h2>Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager<a class="headerlink" href="#step-1-supplying-configuration-values-and-keys-using-aws-secrets-manager" title="Permalink to this heading"></a></h2>
<p>Titaniam supports supplying all the application properties, licenses, and encryption keys through a secret entry in AWS Secrets Manager. The advantage of doing this is that you can maintain the configuration settings centrally instead of storing the settings in each server node.</p>
<p>Use this procedure (<span class="xref std std-ref">supplying_secrets</span>) here to create the following new secrets:</p>
<ul class="simple">
<li><p>Titaniam License (see <a class="reference internal" href="single_node.html#license"><span class="std std-ref">Step 1.a: Content of titaniam.license secret</span></a>)</p></li>
<li><p>Data Encryption keys (see <a class="reference internal" href="single_node.html#key-generation"><span class="std std-ref">Step 1.b: Store Encryption Keys</span></a>)</p></li>
<li><p>Configuration properties (see <a class="reference internal" href="single_node.html#configuration-settings"><span class="std std-ref">Step 1.c: Create Configuration Settings</span></a>)</p></li>
</ul>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Next Step: <a class="reference internal" href="single_node.html#configure-server"><span class="std std-ref">Step 2: Configure Services</span></a></p></li>
</ul>
<section id="step-1-a-content-of-titaniam-license-secret">
<span id="license"></span><h3>Step 1.a: Content of titaniam.license secret<a class="headerlink" href="#step-1-a-content-of-titaniam-license-secret" title="Permalink to this heading"></a></h3>
<p>The following content can be copied and pasted as a secret named <code class="docutils literal notranslate"><span class="pre">titaniam.license</span></code> in the PlainText view.</p>
<p>The secret name can be of the following formats:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam.license</span></code>. <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;</span></code> is the value of the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> from the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.license</span></code> if you have not specified the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code>.</p></li>
</ul>
<p>The values provided here are just examples. Edit it to reflect the
license file and SHA that you received from Titaniam Support before you
save the secret. Occasionally the license file may include an expiry date. You can leave that in place. It does not affect the behavior.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="s2">&quot;digest&quot;</span><span class="p">:</span> <span class="s2">&quot;P9r7miQDNOf/0HWg8WQjBotJ79PP6WTw+0BQ9VT/fXQ=&quot;</span><span class="p">,</span>

<span class="s2">&quot;license&quot;</span><span class="p">:</span><span class="s2">&quot;vwOraInV23PJ2ePSqHmsnULtSfi98AYO2NHJDCv3f39INv4c9xIGiry3fyW19iZ3nOpIb3QI2akOSg0I6/CZvweoozFtZnP3xqWWXL6t4hhCBNuCdpWGh3XCAVN2xXb5u8S55GjTeWs3IZz5JnHOTSPUCBunicy2TSPNmo/4ScNM7fQagyrqxsiQphq9hnU8vmngQ4E3udqIh086S++2ERk+nki/TDpMWpOxCVcf3ZdnVo+Ra+Tw01MIOxeM3PuRzFMAVJNyGb7BumDfmN6wOlnzpXoVKkDSfQwD1pwkpJcMpKcX8uJMmPo0fJ022w3j0bjMsHy/buMeUybRSdjYUzrIrNosrjDJtoCgel8ygOrscUf9HnJFIziRSd2wCzNpyZyJFUKWhV7LHATPigmeXoHHqWlND0f5YECdvlqLdZXnZllYxuv/xOAIPKzjSyN+GeESmoQavFTNL14XGSKw6Xz825iBdyRJkGW/JsYClBemBRQelgkoxerBTyq80CcSmaie5UdblYuMwTXr13sySWJbX7VdKMKoReRGun+vphHBQnTDPIagb1AiYnsOjSMYdK03SZvGjuujzwRwgn23m9pBJL3iaGTP+1cTrqN/b6FijTsAzxU55Ny3YbQ54f4zM7g0lk0wZepPtPpTG3hx6D83StcNaXRxRx5u3YB5ET8=&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
</section>
<section id="step-1-b-store-encryption-keys">
<span id="key-generation"></span><h3>Step 1.b: Store Encryption Keys<a class="headerlink" href="#step-1-b-store-encryption-keys" title="Permalink to this heading"></a></h3>
<p>You have two options of using the data encryption keys.</p>
<ul>
<li><p>Option 1, Storing Encrypted Data Keys: Includes a master key (also called as Key Encryption Key, KEK) and one or more data encryption keys. The data encryption keys are encoded using the master key before adding them to the AWS Secrets Manager. You can select one of the data encryption keys as an active key.</p>
<blockquote>
<div><ol class="arabic">
<li><p>Generate an encrypted data encryption key and optionally a master key. If you have an existing master key, you can choose not to generate the master key. See <a class="reference internal" href="hello_world_aws.html#keygen2"><span class="std std-ref">Generate an Encrypted Data Encryption Key and Optionally a Master Key</span></a>.</p></li>
<li><p>Store the master key as <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code> or <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code>. This key is the master encryption key.</p></li>
<li><p>Store the encrypted data key as a secret: <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code>.</p>
<p>Titaniam Server uses only keys that have the <code class="docutils literal notranslate"><span class="pre">Active</span></code> tag.</p>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Option 2, Storing Plain Data Keys: Generate a data encryption key and store it as a Secret in the AWS Secrets Manager. You are not encrypting the data encryption key with a master key in this case. See <a class="reference internal" href="hello_world_aws.html#master-key"><span class="std std-ref">Generate Keys</span></a>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="lowerroman simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;</span></code> is the string from the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file. If you have not mentioned the <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> property, the secret name must be of the format <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code> for data encryption key and <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code> for master encryption key.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam_key_ring</span></code> must be entered <strong>as is</strong>. This is the namespace that Titaniam server looks for when loading the encryption keys.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;keyring_name&gt;</span></code> is the name of the keyring. This name distinguishes different Titaniam installations. Decide a name for the Titaniam Server installation (for example <cite>production_finance</cite>, <cite>dev_sandbox</cite>).</p></li>
</ol>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
</section>
<section id="step-1-c-create-configuration-settings">
<span id="configuration-settings"></span><h3>Step 1.c: Create Configuration Settings<a class="headerlink" href="#step-1-c-create-configuration-settings" title="Permalink to this heading"></a></h3>
<p>Populate the rest of the configuration settings in a secret.</p>
<ol class="arabic simple">
<li><p>Create a new secret called <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code>.</p></li>
<li><p>Copy and paste the <a class="reference internal" href="hello_world_aws.html#sdss-properties"><span class="std std-ref">titaniam.properties Secret</span></a>
to the secret using PlainText view.</p></li>
<li><p>Edit the entries to reflect your installation reality. Pay attention
to these specifically:</p>
<ul class="simple">
<li><p><a class="reference internal" href="single_node.html#integrate-data-store"><span class="std std-ref">Integrating with the Data Store</span></a></p></li>
<li><p><a class="reference internal" href="hello_world_aws.html#mtls"><span class="std std-ref">Configure TLS and mTLS Authentication</span></a></p></li>
<li><p><a class="reference internal" href="hello_world_aws.html#auth-token"><span class="std std-ref">Configure Authorization</span></a></p></li>
<li><p><a class="reference internal" href="hello_world_aws.html#configure-misc"><span class="std std-ref">Configure Additional Properties in titaniam.properties</span></a></p></li>
</ul>
</li>
<li><p>Save the secret.</p></li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
<blockquote>
<div></div></blockquote>
</section>
</section>
<section id="step-1-supplying-configuration-values-and-keys-using-local-file-system">
<span id="lic-keys-aws-ec2-local"></span><h2>Step 1: Supplying Configuration Values and Keys using Local File System<a class="headerlink" href="#step-1-supplying-configuration-values-and-keys-using-local-file-system" title="Permalink to this heading"></a></h2>
<p>Titaniam supports supplying all the application properties, licenses, and encryption keys through using the local file system.</p>
<section id="storing-titaniam-license-on-local-file-system">
<span id="license-local"></span><h3>Storing Titaniam License on Local File System<a class="headerlink" href="#storing-titaniam-license-on-local-file-system" title="Permalink to this heading"></a></h3>
<p>Store the license with the value provided by Titaniam on your virtual machine, for example, <code class="docutils literal notranslate"><span class="pre">/home/centos/titaniam_config/license</span></code>.</p>
<section id="example-titaniam-license">
<h4>Example Titaniam License<a class="headerlink" href="#example-titaniam-license" title="Permalink to this heading"></a></h4>
<p>The values provided here are just examples. Edit it to reflect the
license file and SHA that you received from Titaniam Support. Occasionally the license file may include an expiry date. You can leave that in place. It does not affect the behavior.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="s2">&quot;digest&quot;</span><span class="p">:</span> <span class="s2">&quot;P9r7miQDNOf/0HWg8WQjBotJ79PP6WTw+0BQ9VT/fXQ=&quot;</span><span class="p">,</span>

<span class="s2">&quot;license&quot;</span><span class="p">:</span><span class="s2">&quot;vwOraInV23PJ2ePSqHmsnULtSfi98AYO2NHJDCv3f39INv4c9xIGiry3fyW19iZ3nOpIb3QI2akOSg0I6/CZvweoozFtZnP3xqWWXL6t4hhCBNuCdpWGh3XCAVN2xXb5u8S55GjTeWs3IZz5JnHOTSPUCBunicy2TSPNmo/4ScNM7fQagyrqxsiQphq9hnU8vmngQ4E3udqIh086S++2ERk+nki/TDpMWpOxCVcf3ZdnVo+Ra+Tw01MIOxeM3PuRzFMAVJNyGb7BumDfmN6wOlnzpXoVKkDSfQwD1pwkpJcMpKcX8uJMmPo0fJ022w3j0bjMsHy/buMeUybRSdjYUzrIrNosrjDJtoCgel8ygOrscUf9HnJFIziRSd2wCzNpyZyJFUKWhV7LHATPigmeXoHHqWlND0f5YECdvlqLdZXnZllYxuv/xOAIPKzjSyN+GeESmoQavFTNL14XGSKw6Xz825iBdyRJkGW/JsYClBemBRQelgkoxerBTyq80CcSmaie5UdblYuMwTXr13sySWJbX7VdKMKoReRGun+vphHBQnTDPIagb1AiYnsOjSMYdK03SZvGjuujzwRwgn23m9pBJL3iaGTP+1cTrqN/b6FijTsAzxU55Ny3YbQ54f4zM7g0lk0wZepPtPpTG3hx6D83StcNaXRxRx5u3YB5ET8=&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="storing-application-properties-and-service-definitions">
<span id="local-properties-aws"></span><h3>Storing Application Properties and Service Definitions<a class="headerlink" href="#storing-application-properties-and-service-definitions" title="Permalink to this heading"></a></h3>
<p>Create a <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file with the following values and store it at a location on your EC2 instance.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">management</span><span class="o">.</span><span class="n">endpoint</span><span class="o">.</span><span class="n">health</span><span class="o">.</span><span class="n">show</span><span class="o">-</span><span class="n">details</span><span class="o">=</span><span class="n">always</span>
<span class="n">sdss</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">tiny_keyword</span><span class="o">.</span><span class="n">disabled</span><span class="o">=</span><span class="n">true</span>
<span class="n">sdss</span><span class="o">.</span><span class="k">async</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">core</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span>
<span class="n">sdss</span><span class="o">.</span><span class="k">async</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">max</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span>
<span class="n">sdss</span><span class="o">.</span><span class="k">async</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">keep</span><span class="o">-</span><span class="n">alive</span><span class="o">=</span><span class="mi">120</span>
<span class="n">sdss</span><span class="o">.</span><span class="k">async</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">queue</span><span class="o">-</span><span class="n">capacity</span><span class="o">=</span><span class="mi">1000</span>
<span class="n">sdss</span><span class="o">.</span><span class="k">async</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">thread</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">prefix</span><span class="o">=</span><span class="n">sdss</span><span class="o">-</span><span class="k">async</span><span class="o">-</span>
<span class="n">sdss</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">millis</span><span class="o">=</span><span class="n">true</span>
<span class="n">spring</span><span class="o">.</span><span class="n">servlet</span><span class="o">.</span><span class="n">multipart</span><span class="o">.</span><span class="n">max</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="n">MB</span>
<span class="n">spring</span><span class="o">.</span><span class="n">servlet</span><span class="o">.</span><span class="n">multipart</span><span class="o">.</span><span class="n">max</span><span class="o">-</span><span class="n">request</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="n">MB</span>
</pre></div>
</div>
</section>
<section id="storing-encryption-keys-in-local-file-system">
<h3>Storing Encryption Keys in Local File System<a class="headerlink" href="#storing-encryption-keys-in-local-file-system" title="Permalink to this heading"></a></h3>
<p>Storing Encrypted Data Keys: Includes a master key (also called as Key Encryption Key, KEK) and one or more data encryption keys. The data encryption keys are encoded using the master key before adding them to the <code class="docutils literal notranslate"><span class="pre">keyring.json</span></code> file. You can select one of the data encryption keys as an active key.</p>
<p>Storing encryption keys involves the following steps:</p>
<ol class="arabic simple">
<li><p>Generate a master key and an encrypted data encryption key. See <a class="reference internal" href="hello_world_aws.html#keygen2"><span class="std std-ref">Generate an Encrypted Data Encryption Key and Optionally a Master Key</span></a>.</p></li>
<li><p>Create a <a class="reference internal" href="hello_world_aws.html#key-ring-json"><span class="std std-ref">Keyring.JSON</span></a> file and update the <code class="docutils literal notranslate"><span class="pre">keyring.json</span></code> file with the output of the previous step.</p></li>
<li><p>Store the <code class="docutils literal notranslate"><span class="pre">keyring.JSON</span></code> file on your EC2 instance.</p></li>
<li><p>Update the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file to mount the <code class="docutils literal notranslate"><span class="pre">keyring.JSON</span></code> file as a volume.</p></li>
</ol>
</section>
</section>
<section id="step-2-installing-titaniam-plugin-and-kibana">
<span id="install-plugin-kibana"></span><h2>Step 2: Installing Titaniam Plugin and Kibana<a class="headerlink" href="#step-2-installing-titaniam-plugin-and-kibana" title="Permalink to this heading"></a></h2>
<p>This section explains the overall process to install and configure Titaniam Plugin and Kibana on an EC2 instance.</p>
<section id="install-titaniam-plugin">
<h3>Install Titaniam Plugin<a class="headerlink" href="#install-titaniam-plugin" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>Bring up an EC2 instance with the configuration as described <a class="reference internal" href="hello_world_aws.html#hw-matrix"><span class="std std-ref">here</span></a>.</p></li>
<li><p>Login to the EC2 instance using ssh.</p></li>
<li><p>Install docker and docker-compose on the EC2 instance. See <a class="reference internal" href="hello_world_aws.html#install-docker-os"><span class="std std-ref">Install Docker and Docker Compose</span></a>.</p></li>
<li><p>Create the following folders (<code class="docutils literal notranslate"><span class="pre">/var/lib/arcusdata</span></code> and <code class="docutils literal notranslate"><span class="pre">/var/lib/kibanadata</span></code>) on your EC2 instance:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">arcusdata</span>
<span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">kibanadata</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Ensure that your EC2 user has ownership and write access to these folders. Do the following:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="mi">1000</span><span class="p">:</span><span class="mi">1000</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">arcusdata</span>
<span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="mi">1000</span><span class="p">:</span><span class="mi">1000</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">kibanadata</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>(If using AWS Secrets Manager) Copy this <a class="reference internal" href="hello_world_aws.html#plugin-dockercompose"><span class="std std-ref">docker-compose.yml</span></a> file, and modify the following properties.</p>
<blockquote>
<div><blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">aws_region</span><span class="o">=&lt;</span><span class="n">region</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">keyring</span><span class="o">.</span><span class="n">name</span><span class="o">=&lt;</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">aws</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">access</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_ACCESS_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">secret</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_SECRET_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span>
<span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">arcus01</span>
<span class="o">-</span> <span class="n">http</span><span class="o">.</span><span class="n">port</span><span class="o">=</span><span class="mi">9200</span>
</pre></div>
</div>
<p>Where,</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aws_region</span></code> specifies the AWS Secrets Manager region.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.keyring.name</span></code> specifies the keyringname.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.store.type</span></code> specifies where the data encryption keys are stored.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.aws.access.id</span></code> specifies the encrypted access key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.aws.secret.id</span></code> specifies the encrypted secret key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">node</span></code> specifies the node on which Titaniam plugin is accessible. Do not modify this.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">http.port</span></code> specifies the port on which you can access the Titaniam plugin endpoints. Best practice is to leave 9200 as is. If you modify this port, ensure that you open this port for inbound traffic.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> specifies the prefix path to secrets in AWS Secrets Manager. For example if you have specify <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix=prefix1</span></code>, you must store the titaniam.license in AWS Secrets as <code class="docutils literal notranslate"><span class="pre">&lt;prefix1&gt;titaniam.licence</span></code>. Encryptions keys as <code class="docutils literal notranslate"><span class="pre">&lt;prefix1&gt;titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code>.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file also includes properties for installing Kibaba. You need not change any of the Kibana properties. Use the properties as specified in the example file.</p>
</div>
</div></blockquote>
</li>
<li><p>(If using a local file system for license and keys) Copy this <span class="xref std std-ref">docker-compose.yml</span> file, and modify the following properties.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">file</span>

<span class="n">Volumes</span><span class="p">:</span>

 <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">titaniam</span> <span class="n">licence</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">titaniam</span><span class="o">/</span><span class="n">license</span>
 <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">keyring</span><span class="o">.</span><span class="n">json</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">titaniam</span><span class="o">/</span><span class="n">keyring</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
</li>
<li><p>Login to the docker registry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">login</span>
</pre></div>
</div>
</li>
<li><p>At the password prompt, enter the username and personal access token you received.</p></li>
<li><p>Bring up the Titaniam Plugin service with the respective <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code>, run the following command with the Titaniam plugin service:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</li>
<li><p>To troubleshoot the bring up, open a separate ssh connection to the EC2 instance, and run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">granger</span><span class="o">/</span><span class="n">server</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
</li>
<li><p>Create a security group for this instance and create inbound rules to allow traffic on the ports that you have assigned for Titaniam Plugin (9200) and Kibana (5601). For more information, see <a class="reference external" href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#SecurityGroupRules">this document</a>.</p></li>
<li><p>In your browser, send the following request:</p>
<p>Request</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddress</span><span class="p">:</span><span class="mi">9200</span>
</pre></div>
</div>
<p>Response</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;arcus01&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cluster_name&quot;</span> <span class="p">:</span> <span class="s2">&quot;elasticsearch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cluster_uuid&quot;</span> <span class="p">:</span> <span class="s2">&quot;iN75tpULSFSEGaWCT42ajg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;version&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;number&quot;</span> <span class="p">:</span> <span class="s2">&quot;7.10.2&quot;</span><span class="p">,</span>
      <span class="s2">&quot;build_flavor&quot;</span> <span class="p">:</span> <span class="s2">&quot;oss&quot;</span><span class="p">,</span>
      <span class="s2">&quot;build_type&quot;</span> <span class="p">:</span> <span class="s2">&quot;docker&quot;</span><span class="p">,</span>
      <span class="s2">&quot;build_hash&quot;</span> <span class="p">:</span> <span class="s2">&quot;747e1cc71def077253878a59143c1f785afa92b9&quot;</span><span class="p">,</span>
      <span class="s2">&quot;build_date&quot;</span> <span class="p">:</span> <span class="s2">&quot;2021-01-13T00:42:12.435326Z&quot;</span><span class="p">,</span>
      <span class="s2">&quot;build_snapshot&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;lucene_version&quot;</span> <span class="p">:</span> <span class="s2">&quot;8.7.0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;minimum_wire_compatibility_version&quot;</span> <span class="p">:</span> <span class="s2">&quot;6.8.0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;minimum_index_compatibility_version&quot;</span> <span class="p">:</span> <span class="s2">&quot;6.0.0-beta1&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;tagline&quot;</span> <span class="p">:</span> <span class="s2">&quot;You Know, for Search&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>From your EC2 instance settings, note the private IP address of the EC2 instance and port number on which the Titaniam plugin service is available. You will need this information when configuring Titaniam Server as a Vault.</p></li>
<li><p>Remove any public IP on the EC2 instances. You must access the EC2 instance only using the load balancer. See <a class="reference internal" href="#configure-lb"><span class="std std-ref">configuring a load balancer</span></a>.</p></li>
</ol>
</section>
</section>
<section id="step-3-installing-postgresql-on-an-ec2-instance">
<span id="id1"></span><h2>Step 3: Installing PostgreSQL on an EC2 Instance<a class="headerlink" href="#step-3-installing-postgresql-on-an-ec2-instance" title="Permalink to this heading"></a></h2>
<p>This section explains the overall process to install and configure PostgreSQL on an EC2 instance.</p>
<section id="install-postgresql">
<h3>Install PostgreSQL<a class="headerlink" href="#install-postgresql" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>Bring up an EC2 instance with the configuration as described <a class="reference internal" href="hello_world_aws.html#hw-matrix"><span class="std std-ref">here</span></a>.</p></li>
<li><p>Login to the EC2 instance using <code class="docutils literal notranslate"><span class="pre">ssh</span></code>.</p></li>
<li><p>Install docker and docker-compose on the EC2 instance. See <a class="reference internal" href="hello_world_aws.html#install-docker-os"><span class="std std-ref">Install Docker and Docker Compose</span></a>.</p></li>
<li><p>Create the following folders (<code class="docutils literal notranslate"><span class="pre">/var/lib/postgresql/13/main</span></code>) on your EC2 instance:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">postgresql</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="n">main</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Ensure that your EC2 user has ownership and write access to these folders. Do the following:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="mi">1000</span><span class="p">:</span><span class="mi">1000</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">postgresql</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="n">main</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Copy this <a class="reference internal" href="hello_world_aws.html#postgres-dockercompose"><span class="std std-ref">docker-compose.yml</span></a> file, and modify the following properties.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">POSTGRES_USER</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span>
  <span class="n">POSTGRES_PASSWORD</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">password</span><span class="o">&gt;</span>
  <span class="n">POSTGRES_DB</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">database_name</span><span class="o">&gt;</span>
  <span class="n">PGDATA</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">postgresql</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="n">main</span>
<span class="n">ports</span><span class="p">:</span>
  <span class="o">-</span> <span class="s2">&quot;5432:5432&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>Where,</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">POSTGRES_USER</span></code> specifies the database user.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">POSTGRES_PASSWORD</span></code> specifies the database password corresponding to the user.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">POSTGRES_DB</span></code> specifies database name to create.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ports</span></code> specifies the port on which the PostgreSQL service is available.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Store the information from the previous step as you will need it to configure Titaniam Server as a Vault.</p></li>
<li><p>Login to the docker registry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">login</span>
</pre></div>
</div>
</li>
<li><p>At the password prompt, enter the username and personal access token you received.</p></li>
<li><p>Bring up the PostgreSQL with the respective <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code>, run the following command with the Titaniam Server service:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</li>
<li><p>Create a security group for this instance and create inbound rules to allow traffic on the ports that you have assigned for PostgreSQL (5432). For more information, see <a class="reference external" href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#SecurityGroupRules">this document</a>.</p></li>
<li><p>From your EC2 instance settings, note the private IP address of the EC2 instance and port number on which the PostgreSQL service is available. You will need this information when configuring Titaniam Server as a Vault.</p></li>
<li><p>Remove any public IP on the EC2 instances. You must access the EC2 instance only using the load balancer. See <a class="reference internal" href="#configure-lb"><span class="std std-ref">configuring a load balancer</span></a>.</p></li>
</ol>
</section>
</section>
<section id="step-4-installing-titaniam-server-and-configuring-as-a-vault">
<span id="install-vault"></span><h2>Step 4: Installing Titaniam Server and Configuring as a Vault<a class="headerlink" href="#step-4-installing-titaniam-server-and-configuring-as-a-vault" title="Permalink to this heading"></a></h2>
<p>This section explains the overall process to install and configure Titaniam Server as a Vault on an EC2 instance.</p>
<p>You must follow the procedure in this section on two EC2 instances.</p>
<section id="install-titaniam-server">
<h3>Install Titaniam Server<a class="headerlink" href="#install-titaniam-server" title="Permalink to this heading"></a></h3>
<p>Following is the process to install Titaniam Server.</p>
<ol class="arabic">
<li><p>Bring up an EC2 instance with the configuration as described <a class="reference internal" href="hello_world_aws.html#hw-matrix"><span class="std std-ref">here</span></a>.</p></li>
<li><p>Login to the EC2 instance using ssh.</p></li>
<li><p>Install docker and docker-compose on the EC2 instance. See <a class="reference internal" href="hello_world_aws.html#install-docker-os"><span class="std std-ref">Install Docker and Docker Compose</span></a>.</p></li>
<li><p>(If using AWS Secrets Manager) Copy this <a class="reference internal" href="hello_world_aws.html#server-dockercompose"><span class="std std-ref">docker-compose.yml</span></a> file, and modify the following properties.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">panther</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">false</span>
<span class="o">-</span> <span class="n">sdv</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
<span class="o">-</span> <span class="n">ripple</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">false</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">properties</span><span class="o">-</span><span class="n">source</span><span class="o">=</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">secretsmanager</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">keyname</span><span class="o">=</span><span class="n">titaniam</span><span class="o">.</span><span class="n">properties</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">region</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">2</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">=&lt;</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">aws</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">access</span><span class="o">-</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">AWS_ACCESS_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">secret</span><span class="o">-</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">AWS_SECRET_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">spring</span><span class="o">.</span><span class="n">elasticsearch</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">uris</span><span class="o">=&lt;</span><span class="n">Titaniam_plugin_url</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span>
</pre></div>
</div>
<p>Where,</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">panther.enabled</span></code> must be set to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdv.enabled</span></code> Set this to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ripple.enabled</span></code> must be set to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.properties-source</span></code> indicates that the configuration properties are stored in the AWS Secrets Manager.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.secretsmanager.properties.keyname</span></code> specifies the key name of the configuration properties file. This must be set to <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.region</span></code> indicates the region of the AWS machines.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.keyring-name</span></code> indicates the &lt;keyring_name&gt; from the Secrets Manager. Secret name is of the format - <cite>titaniam_key_ring/&lt;keyring_name&gt;/&lt;key_name&gt;</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.seed.store.type</span></code> specifies that the keystore is in AWS.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.access-key</span></code> specifies the encrypted access key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.secret-key</span></code> specifies the encrypted secret key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="production.html#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spring.elasticsearch.rest.uris</span></code> this property must match the IP and port of the Titaniam Plugin EC2 instance. For example, <code class="docutils literal notranslate"><span class="pre">http://&lt;plugin_private_ip_address&gt;:9200</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> specifies the prefix path to secrets in AWS Secrets Manager. For example if you have specify <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix=prefix1</span></code>, you must store the titaniam.license in AWS Secrets as <code class="docutils literal notranslate"><span class="pre">&lt;prefix1&gt;titaniam.licence</span></code>. Encryptions keys as <code class="docutils literal notranslate"><span class="pre">&lt;prefix1&gt;titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>(If using a local file system for license and keys) Copy this <span class="xref std std-ref">docker-compose.yml</span> file, and modify the following properties.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">-</span> <span class="n">panther</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">false</span>
 <span class="o">-</span> <span class="n">sdv</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
 <span class="o">-</span> <span class="n">ripple</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">false</span>
 <span class="o">-</span> <span class="n">spring</span><span class="o">.</span><span class="n">elasticsearch</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">uris</span><span class="o">=&lt;</span><span class="n">Titaniam_plugin_url</span><span class="o">&gt;</span>
 <span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">file</span>

<span class="n">Volumes</span><span class="p">:</span>

 <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">titaniam</span> <span class="n">licence</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">titaniam</span><span class="o">/</span><span class="n">license</span>
 <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">keyring</span><span class="o">.</span><span class="n">json</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">titaniam</span><span class="o">/</span><span class="n">keyring</span><span class="o">.</span><span class="n">json</span>
 <span class="o">-</span> <span class="o">&lt;</span><span class="n">location</span> <span class="n">of</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">properties</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">titaniam</span><span class="o">/</span><span class="n">application</span><span class="o">.</span><span class="n">properties</span>
</pre></div>
</div>
</li>
<li><p>Login to the docker registry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">login</span>
</pre></div>
</div>
</li>
<li><p>At the password prompt, enter the username and personal access token you received.</p></li>
<li><p>Bring up the Titaniam Plugin service with the respective <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code>, run the following command with the Titaniam Server service:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</li>
<li><p>To troubleshoot the bring up, open a separate ssh connection to the EC2 instance, and run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">granger</span><span class="o">/</span><span class="n">server</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
</li>
<li><p>Create a security group for this instance and create inbound rules to allow traffic on the ports that you have assigned for Titaniam Server (8080). For more information, see <a class="reference external" href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#SecurityGroupRules">this document</a>.</p></li>
<li><p>Send the curl command from the terminal in the EC2 instance:</p>
<p>Request</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{</span>
    <span class="s2">&quot;data_type&quot;</span><span class="p">:</span><span class="s2">&quot;keyword&quot;</span><span class="p">,</span>
    <span class="s2">&quot;field_name&quot;</span><span class="p">:</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
    <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;abcd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;include_protected_field&quot;</span><span class="p">:</span><span class="s2">&quot;true&quot;</span>
<span class="p">}</span><span class="s1">&#39; &quot;http:localhost.com:8080/v2/secure/store&quot;</span>
</pre></div>
</div>
<p>Response</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span><span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span><span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;success&quot;</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="p">:{</span><span class="s2">&quot;key_id&quot;</span><span class="p">:</span><span class="s2">&quot;k:e5d9a41a-5f29-414b-998b-11c5159124fd&quot;</span><span class="p">,</span><span class="s2">&quot;es_millis&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;guid&quot;</span><span class="p">:</span><span class="s2">&quot;tn:a1664f0d-6111-4415-bbcd-b54c65cf58c5&quot;</span><span class="p">,</span><span class="s2">&quot;protected_field&quot;</span><span class="p">:</span><span class="s2">&quot;03sGZ06alY{_Y06&#39;%7&gt;Pl06Qu-fE^&quot;</span><span class="p">,</span><span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;abcd&quot;</span><span class="p">,</span><span class="s2">&quot;db_millis&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;db_lookup_millis&quot;</span><span class="p">:</span><span class="mi">9</span><span class="p">}}</span>
</pre></div>
</div>
</li>
<li><p>Remove any public IP on the EC2 instances. You must access the EC2 instance only using the load balancer. See <a class="reference internal" href="#configure-lb"><span class="std std-ref">configuring a load balancer</span></a>.</p></li>
</ol>
<blockquote>
<div></div></blockquote>
</section>
</section>
<section id="step-5-integrating-with-the-data-store">
<span id="integrate-data-store-ec2"></span><h2>Step 5: Integrating with the Data Store<a class="headerlink" href="#step-5-integrating-with-the-data-store" title="Permalink to this heading"></a></h2>
<p>Titaniam Server uses a datastore to store the metadata and schema versions. After you install the Titaniam Server, you must ensure that the Titaniam Server can communicate with the data store.</p>
<ol class="arabic">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file and edit the sections corresponding to the database you are using.</p></li>
<li><p>(If using MySQL) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:mysql:&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.MySQL57InnoDBDialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
<li><p>(If using MariaDB) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:mariadb:&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;org.mariadb.jdbc.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.MariaDB53Dialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
<li><p>(If using PostgreSQL) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:postgresql&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;org.postgresql.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.PostgreSQL10Dialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
</ol>
<p>Where,</p>
<ul>
<li><p>&lt;database_URL&gt; is the URL (including the port) where you can access the database. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">PostgresSQL</span><span class="p">)</span><span class="c1">#spring.datasource.url=jdbc:postgresql://postgres_private_ip_address:5432/&lt;database_name&gt;?autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span>
<span class="p">(</span><span class="n">MySQL</span><span class="p">)</span>      <span class="c1">#spring.datasource.url=jdbc:mysql://localhost:3306/testdb</span>
<span class="p">(</span><span class="n">MariaDB</span><span class="p">)</span>    <span class="c1">#spring.datasource.url=jdbc:mariadb://localhost:3306/testdb</span>
</pre></div>
</div>
</li>
<li><p>&lt;username&gt; is the username (POSTGRES_USER) for accessing the database.</p></li>
<li><p>&lt;password&gt; is the password (POSTGRES_PASSWORD) required to access the database.</p></li>
<li><p>&lt;database_name&gt; is the PostgreSQL database name (POSTGRES_DB).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spring.jpa.properties.hibernate.dialect=</span></code> Ensure that you select the correct dialect depending on your database version. See the respective database documentation for this information.</p></li>
</ul>
</section>
<section id="step-6-configure-load-balancer">
<span id="configure-lb"></span><h2>Step 6: Configure Load Balancer<a class="headerlink" href="#step-6-configure-load-balancer" title="Permalink to this heading"></a></h2>
<p>This section explains how you can create a network load balancer and route traffic to the Titaniam Servers. Configuring a Load Balancer involves the following steps:</p>
<ol class="arabic simple">
<li><p>Create a target group.</p></li>
<li><p>Create a load balancer and associate it with a target group.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must create separate target group for the Kibana EC2 instance and separate target group for Titaniam Server EC2 instances.</p>
</div>
<section id="create-a-target-group-for-titaniam-server">
<h3>Create a Target Group for Titaniam Server<a class="headerlink" href="#create-a-target-group-for-titaniam-server" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>Log into your AWS account.</p></li>
<li><p>Navigate to the EC2 dashboard.</p></li>
<li><p>Click <strong>Load Balancing</strong> &gt; <strong>Target Groups</strong> &gt; <strong>Create target group</strong>.</p></li>
<li><p>Select the following:</p>
<ul class="simple">
<li><p><strong>Basic Configuration</strong> &gt; <strong>Choose a target type</strong>: <em>Instances</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>Target group name</strong>: <em>&lt;provide a target group name&gt;</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>Protocol</strong>: <em>TCP</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>Port</strong>: <em>8080</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>VPC</strong>: <em>&lt;VPC name where your EC2 instances are deployed&gt;</em></p></li>
<li><p><strong>Health Checks</strong> &gt; <strong>Health check protocol</strong>: <em>TCP</em></p></li>
</ul>
</li>
<li><p>Click <strong>Next</strong>.</p>
<p>The list of <strong>Available instances</strong> appears.</p>
</li>
<li><p>Select the EC2 instances of your Titaniam Servers from the <strong>Available Instances</strong> list.</p></li>
<li><p>Set the <strong>Port</strong> for the selected instances as <em>8080</em>.</p></li>
<li><p>Click <strong>Include as pending below</strong>.</p></li>
<li><p>Review your targets.</p></li>
<li><p>Click <strong>Create target group</strong>.</p></li>
<li><p>After your Target group is created, ensure that the health checks are okay for both the instances.</p>
<img alt="_images/target_groups.png" src="_images/target_groups.png" />
</li>
</ol>
</section>
<section id="create-a-target-group-for-kibana">
<h3>Create a Target Group for Kibana<a class="headerlink" href="#create-a-target-group-for-kibana" title="Permalink to this heading"></a></h3>
<p>Use the same procedure as described above for creating a target for Kibana. Use the following values:</p>
<ol class="arabic simple">
<li><p>Select the following:</p>
<ul class="simple">
<li><p><strong>Basic Configuration</strong> &gt; <strong>Choose a target type</strong>: <em>Instances</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>Target group name</strong>: <em>&lt;provide a target group name&gt;</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>Protocol</strong>: <em>TCP</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>Port</strong>: <em>5601</em></p></li>
<li><p><strong>Basic Configuration</strong> &gt; <strong>VPC</strong>: <em>&lt;VPC name where your EC2 instances are deployed&gt;</em></p></li>
<li><p><strong>Health Checks</strong> &gt; <strong>Health check protocol</strong>: <em>TCP</em></p></li>
</ul>
</li>
<li><p>Select the Titaniam Plugin EC2 instance from the <strong>Available Instances</strong> list.</p></li>
</ol>
</section>
<section id="create-load-balancer">
<h3>Create Load Balancer<a class="headerlink" href="#create-load-balancer" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>Log into your AWS account.</p></li>
<li><p>Navigate to the EC2 dashboard.</p></li>
<li><p>Click <strong>Load Balancing</strong> &gt; <strong>Load Balancers</strong> &gt; <strong>Create Load Balancer</strong>.</p></li>
<li><p>Click <strong>Create</strong> in the <strong>Network Load Balancer</strong> card.</p></li>
<li><p>Provide a name for the load balancer.</p></li>
<li><p>Ensure the <strong>Scheme</strong> value is set to <em>Internet-facing</em> and <strong>IP address type</strong> is set to <em>IPV4</em></p></li>
<li><p>Select the VPC where your EC2 instances are located.</p></li>
<li><p>Select the availability zones of the EC2 instances on which Titaniam Servers are installed.</p></li>
<li><p>Add listener for Titaniam Server</p>
<ol class="loweralpha simple">
<li><p>Set the <strong>Protocol</strong> as <em>TCP</em> and <strong>Port</strong> as <em>8080</em> in the <strong>Listener and routing</strong> menu.</p></li>
<li><p>Select the target group for Titaniam Server you previously created in the Defaul action &gt; Forward to dialog.</p></li>
</ol>
</li>
<li><p>Add listener for Kibana</p>
<ol class="loweralpha simple">
<li><p>Set the <strong>Protocol</strong> as <em>TCP</em> and <strong>Port</strong> as <em>5601</em> in the <strong>Listener and routing</strong> menu.</p></li>
<li><p>Select the target group for Kibana you previously created in the Defaul action &gt; Forward to dialog.</p></li>
</ol>
</li>
<li><p>Add listener for Kibana</p>
<ol class="loweralpha simple">
<li><p>Set the <strong>Protocol</strong> as <em>TCP</em> and <strong>Port</strong> as <em>5601</em> in the <strong>Listener and routing</strong> menu.</p></li>
<li><p>Select the target group for Titaniam Plugin you previously created in the Defaul action &gt; Forward to dialog.</p></li>
</ol>
</li>
<li><p>Click Create Load Balancer to finish the process.</p>
<p>The load balancer is now created.</p>
</li>
<li><p>Select your load balancer from the <strong>EC2 dashboard</strong> &gt; <strong>Load Balancer</strong> page.</p></li>
<li><p>Copy the DNS Name from the your load balancer &gt; Description &gt; Basic Configuration settings pane.</p></li>
<li><p>On your local computer, run the following curl command to test access to Titaniam Server:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{</span>
 <span class="s2">&quot;data_type&quot;</span><span class="p">:</span><span class="s2">&quot;keyword&quot;</span><span class="p">,</span>
 <span class="s2">&quot;field_name&quot;</span><span class="p">:</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
 <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;abcd&quot;</span><span class="p">,</span>
 <span class="s2">&quot;include_protected_field&quot;</span><span class="p">:</span><span class="s2">&quot;true&quot;</span>
<span class="p">}</span><span class="s1">&#39; &quot;http://&lt;load_balancer_dns&gt;:8080/v2/secure/store&quot;</span>
</pre></div>
</div>
<p>You must see a response similar to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span><span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span><span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;success&quot;</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="p">:{</span><span class="s2">&quot;key_id&quot;</span><span class="p">:</span><span class="s2">&quot;k:e5d9a41a-5f29-414b-998b-11c5159124fd&quot;</span><span class="p">,</span><span class="s2">&quot;es_millis&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;guid&quot;</span><span class="p">:</span><span class="s2">&quot;tn:a1664f0d-6111-4415-bbcd-b54c65cf58c5&quot;</span><span class="p">,</span><span class="s2">&quot;protected_field&quot;</span><span class="p">:</span><span class="s2">&quot;03sGZ06alY{_Y06&#39;%7&gt;Pl06Qu-fE^&quot;</span><span class="p">,</span><span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;abcd&quot;</span><span class="p">,</span><span class="s2">&quot;db_millis&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;db_lookup_millis&quot;</span><span class="p">:</span><span class="mi">13</span><span class="p">}}</span>
</pre></div>
</div>
</div></blockquote>
<p>This message means that the Titaniam Server configured as a Vault is working and is accessible through the load balancer.</p>
</li>
<li><p>On your local computer, run the following request in your browser</p>
<p>Request</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">load_balancer_dns</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">5601</span>
</pre></div>
</div>
</div></blockquote>
<p>Response</p>
<blockquote>
<div><p>The Kibana interface must launch in the browser.</p>
</div></blockquote>
<p>This message means that the Titaniam Plugin is accessible through the load balancer.</p>
</li>
</ol>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Titaniam, Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>