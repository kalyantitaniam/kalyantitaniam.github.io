<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Production Installation Using Kubernetes &mdash; Titaniam Server Installation Guide for AWS 1.00a documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/Primary lockup red_white.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html">What’s New</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#introduction">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#planning-your-installation">Planning your Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#platform-support-matrix">Platform Support Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#poc-installation-with-secrets-in-local-file-system">POC Installation with Secrets in Local File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#poc-installation-with-aws-secrets-manager">POC Installation with AWS Secrets Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#production-installation-using-kubernetes">Production Installation Using Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#production-installation-using-docker-on-ec2-instances">Production Installation Using Docker on EC2 Instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#appendix-titaniam-specific">Appendix: Titaniam-Specific</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#appendix-example-docker-compose-yml-files-and-property-files">Appendix: Example Docker Compose YML Files and Property Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_aws.html#appendix-generic-concepts-and-tasks">Appendix: Generic Concepts and Tasks</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Titaniam Server Installation Guide for AWS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Production Installation Using Kubernetes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/production.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="production-installation-using-kubernetes">
<h1>Production Installation Using Kubernetes<a class="headerlink" href="#production-installation-using-kubernetes" title="Permalink to this heading"></a></h1>
<p>This section describes how you can deploy Titaniam Server using Kubernetes and Helm charts</p>
<section id="production-installation-instructions">
<span id="install-prod"></span><h2>Production Installation Instructions<a class="headerlink" href="#production-installation-instructions" title="Permalink to this heading"></a></h2>
<p>This section explains the overall process to install Titaniam Server in a high-availability production environment. You can supply  all the application properties, license, and encryption keys to Titaniam Server through a secret entry in a secrets manager.</p>
<section id="titaniam-server-artifacts">
<h3>Titaniam Server Artifacts<a class="headerlink" href="#titaniam-server-artifacts" title="Permalink to this heading"></a></h3>
<p>Obtain the following installation artifacts from Titaniam support:</p>
<ul class="simple">
<li><p>License file and SHA Checksum</p></li>
<li><p>Access token to retrieve the Titaniam Server images are available in a private repository in Docker Hub. You need an access token to download the images. Contact Titaniam support to get your access token.</p></li>
</ul>
</section>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Read this <a class="reference internal" href="hello_world_aws.html#ps-matrix"><span class="std std-ref">Platform Support Matrix</span></a>.</p></li>
<li><p>Ensure that you are familiar with deployed a kubenetes cluster.</p></li>
</ul>
<ul class="simple">
<li><p>Ensure that the each node in your kubernetes cluster where you run Titaniam Server must have access to the Secrets Manager. Obtain an IAM Role with policy <strong>SecretsManagerReadWrite</strong>. This role allows the Titaniam Server to read and write to AWS Secrets Manager.</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">kubectl</span></code> to deploy Titaniam Server on your Kubernetes cluster.</p></li>
</ul>
</section>
<section id="install-titaniam-server">
<h3>Install Titaniam Server<a class="headerlink" href="#install-titaniam-server" title="Permalink to this heading"></a></h3>
<p>Following is the process to install Titaniam Server.</p>
<ol class="arabic">
<li><p>Store the following as secrets or keys:</p>
<ol class="loweralpha simple">
<li><p>License</p></li>
<li><p>Titaniam Server application properties</p></li>
<li><p>Encryption keys</p></li>
</ol>
</li>
<li><p>Integrate with the datastore.</p></li>
<li><p>Configure Titaniam Server as one of the following services:</p>
<blockquote>
<div><ul class="simple">
<li><p>Translation Service</p></li>
<li><p>Vault</p></li>
<li><p>Proxy for the object store</p></li>
<li><p>Elastic Proxy</p></li>
</ul>
</div></blockquote>
</li>
<li><p>(Optional) Configure the mTLS parameters if required.</p></li>
<li><p>Specify the location of the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> and encryption keys in the <code class="docutils literal notranslate"><span class="pre">spectra-configmap.yaml</span></code> file.</p></li>
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">spectra-secret.yaml</span></code> file to store your access token in base64 format.</p></li>
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">spectra-service.yaml</span></code> file to ensure that the Titaniam Server service is accessible from outside the kubernetes cluster.</p></li>
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">spectra-deployment.yaml</span></code> file to fill in the image details.</p></li>
<li><p>Deploy Titaniam Server using <code class="docutils literal notranslate"><span class="pre">kubectl</span></code> or <code class="docutils literal notranslate"><span class="pre">helm</span></code> charts.</p></li>
</ol>
<blockquote>
<div></div></blockquote>
</section>
</section>
<section id="step-1-supplying-configuration-values-and-keys-using-aws-secrets-manager">
<span id="lic-keys-aws-ec2"></span><h2>Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager<a class="headerlink" href="#step-1-supplying-configuration-values-and-keys-using-aws-secrets-manager" title="Permalink to this heading"></a></h2>
<p>Titaniam supports supplying all the application properties, licenses, and encryption keys through a secret entry in AWS Secrets Manager. The advantage of doing this is that you can maintain the configuration settings centrally instead of storing the settings in each server node.</p>
<p>Use this procedure (<span class="xref std std-ref">supplying_secrets</span>) here to create the following new secrets:</p>
<ul class="simple">
<li><p>Titaniam License (see <a class="reference internal" href="single_node.html#license"><span class="std std-ref">Step 1.a: Content of titaniam.license secret</span></a>)</p></li>
<li><p>Data Encryption keys (see <a class="reference internal" href="single_node.html#key-generation"><span class="std std-ref">Step 1.b: Store Encryption Keys</span></a>)</p></li>
<li><p>Configuration properties (see <a class="reference internal" href="single_node.html#configuration-settings"><span class="std std-ref">Step 1.c: Create Configuration Settings</span></a>)</p></li>
</ul>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Next Step: <a class="reference internal" href="single_node.html#configure-server"><span class="std std-ref">Step 2: Configure Services</span></a></p></li>
</ul>
<section id="step-1-a-content-of-titaniam-license-secret">
<span id="license"></span><h3>Step 1.a: Content of titaniam.license secret<a class="headerlink" href="#step-1-a-content-of-titaniam-license-secret" title="Permalink to this heading"></a></h3>
<p>The following content can be copied and pasted as a secret named <code class="docutils literal notranslate"><span class="pre">titaniam.license</span></code> in the PlainText view.</p>
<p>The secret name can be of the following formats:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam.license</span></code>. <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;</span></code> is the value of the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> from the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam.license</span></code> if you have not specified the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code>.</p></li>
</ul>
<p>The values provided here are just examples. Edit it to reflect the
license file and SHA that you received from Titaniam Support before you
save the secret. Occasionally the license file may include an expiry date. You can leave that in place. It does not affect the behavior.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="s2">&quot;digest&quot;</span><span class="p">:</span> <span class="s2">&quot;P9r7miQDNOf/0HWg8WQjBotJ79PP6WTw+0BQ9VT/fXQ=&quot;</span><span class="p">,</span>

<span class="s2">&quot;license&quot;</span><span class="p">:</span><span class="s2">&quot;vwOraInV23PJ2ePSqHmsnULtSfi98AYO2NHJDCv3f39INv4c9xIGiry3fyW19iZ3nOpIb3QI2akOSg0I6/CZvweoozFtZnP3xqWWXL6t4hhCBNuCdpWGh3XCAVN2xXb5u8S55GjTeWs3IZz5JnHOTSPUCBunicy2TSPNmo/4ScNM7fQagyrqxsiQphq9hnU8vmngQ4E3udqIh086S++2ERk+nki/TDpMWpOxCVcf3ZdnVo+Ra+Tw01MIOxeM3PuRzFMAVJNyGb7BumDfmN6wOlnzpXoVKkDSfQwD1pwkpJcMpKcX8uJMmPo0fJ022w3j0bjMsHy/buMeUybRSdjYUzrIrNosrjDJtoCgel8ygOrscUf9HnJFIziRSd2wCzNpyZyJFUKWhV7LHATPigmeXoHHqWlND0f5YECdvlqLdZXnZllYxuv/xOAIPKzjSyN+GeESmoQavFTNL14XGSKw6Xz825iBdyRJkGW/JsYClBemBRQelgkoxerBTyq80CcSmaie5UdblYuMwTXr13sySWJbX7VdKMKoReRGun+vphHBQnTDPIagb1AiYnsOjSMYdK03SZvGjuujzwRwgn23m9pBJL3iaGTP+1cTrqN/b6FijTsAzxU55Ny3YbQ54f4zM7g0lk0wZepPtPpTG3hx6D83StcNaXRxRx5u3YB5ET8=&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
</section>
<section id="step-1-b-store-encryption-keys">
<span id="key-generation"></span><h3>Step 1.b: Store Encryption Keys<a class="headerlink" href="#step-1-b-store-encryption-keys" title="Permalink to this heading"></a></h3>
<p>You have two options of using the data encryption keys.</p>
<ul>
<li><p>Option 1, Storing Encrypted Data Keys: Includes a master key (also called as Key Encryption Key, KEK) and one or more data encryption keys. The data encryption keys are encoded using the master key before adding them to the AWS Secrets Manager. You can select one of the data encryption keys as an active key.</p>
<blockquote>
<div><ol class="arabic">
<li><p>Generate an encrypted data encryption key and optionally a master key. If you have an existing master key, you can choose not to generate the master key. See <a class="reference internal" href="hello_world_aws.html#keygen2"><span class="std std-ref">Generate an Encrypted Data Encryption Key and Optionally a Master Key</span></a>.</p></li>
<li><p>Store the master key as <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code> or <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code>. This key is the master encryption key.</p></li>
<li><p>Store the encrypted data key as a secret: <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code>.</p>
<p>Titaniam Server uses only keys that have the <code class="docutils literal notranslate"><span class="pre">Active</span></code> tag.</p>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Option 2, Storing Plain Data Keys: Generate a data encryption key and store it as a Secret in the AWS Secrets Manager. You are not encrypting the data encryption key with a master key in this case. See <a class="reference internal" href="hello_world_aws.html#master-key"><span class="std std-ref">Generate Keys</span></a>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="lowerroman simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;</span></code> is the string from the property <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file. If you have not mentioned the <code class="docutils literal notranslate"><span class="pre">titaniam.secrets.prefix</span></code> property, the secret name must be of the format <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;keyring_name&gt;/&lt;INDEX_NAME&gt;</span></code> for data encryption key and <code class="docutils literal notranslate"><span class="pre">titaniam_key_ring/&lt;department&gt;/titaniam_key_encryption_key</span></code> for master encryption key.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titaniam_key_ring</span></code> must be entered <strong>as is</strong>. This is the namespace that Titaniam server looks for when loading the encryption keys.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;keyring_name&gt;</span></code> is the name of the keyring. This name distinguishes different Titaniam installations. Decide a name for the Titaniam Server installation (for example <cite>production_finance</cite>, <cite>dev_sandbox</cite>).</p></li>
</ol>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
</section>
<section id="step-1-c-create-configuration-settings">
<span id="configuration-settings"></span><h3>Step 1.c: Create Configuration Settings<a class="headerlink" href="#step-1-c-create-configuration-settings" title="Permalink to this heading"></a></h3>
<p>Populate the rest of the configuration settings in a secret.</p>
<ol class="arabic simple">
<li><p>Create a new secret called <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code>.</p></li>
<li><p>Copy and paste the <a class="reference internal" href="hello_world_aws.html#sdss-properties"><span class="std std-ref">titaniam.properties Secret</span></a>
to the secret using PlainText view.</p></li>
<li><p>Edit the entries to reflect your installation reality. Pay attention
to these specifically:</p>
<ul class="simple">
<li><p><a class="reference internal" href="single_node.html#integrate-data-store"><span class="std std-ref">Integrating with the Data Store</span></a></p></li>
<li><p><a class="reference internal" href="hello_world_aws.html#mtls"><span class="std std-ref">Configure TLS and mTLS Authentication</span></a></p></li>
<li><p><a class="reference internal" href="hello_world_aws.html#auth-token"><span class="std std-ref">Configure Authorization</span></a></p></li>
<li><p><a class="reference internal" href="hello_world_aws.html#configure-misc"><span class="std std-ref">Configure Additional Properties in titaniam.properties</span></a></p></li>
</ul>
</li>
<li><p>Save the secret.</p></li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">supplying_secrets</span></p></li>
</ul>
<blockquote>
<div></div></blockquote>
<section id="integrating-with-the-data-store">
<span id="integrate-data-store"></span><h4>Integrating with the Data Store<a class="headerlink" href="#integrating-with-the-data-store" title="Permalink to this heading"></a></h4>
<p>Titaniam Server uses a datastore to store the metadata and schema versions. After you install the Titaniam Server, you must ensure that the Titaniam Server can communicate with the data store.</p>
<ol class="arabic">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file and edit the sections corresponding to the database you are using.</p></li>
<li><p>(If using MySQL) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:mysql:&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.MySQL57InnoDBDialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
<li><p>(If using MariaDB) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:mariadb:&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;org.mariadb.jdbc.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.MariaDB53Dialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
<li><p>(If using PostgreSQL) Specify the following properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spring.datasource.url&quot;</span><span class="p">:</span> <span class="s2">&quot;jdbc:postgresql&lt;database_URL&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.driver-class-name&quot;</span><span class="p">:</span> <span class="s2">&quot;org.postgresql.Driver&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.jpa.properties.hibernate.dialect&quot;</span><span class="p">:</span> <span class="s2">&quot;org.hibernate.dialect.PostgreSQL10Dialect&quot;</span><span class="p">,</span>
<span class="s2">&quot;spring.datasource.hikari.minimumIdle&quot;</span><span class="p">:</span> <span class="s2">&quot;5,</span>
<span class="s2">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span>
</pre></div>
</div>
</li>
</ol>
<p>Where,</p>
<ul>
<li><p>&lt;database_URL&gt; is the URL (including the port) where you can access the database. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">PostgresSQL</span><span class="p">)</span><span class="c1">#spring.datasource.url=jdbc:postgresql://tlab1/titaniam_v1</span>
<span class="p">(</span><span class="n">MySQL</span><span class="p">)</span>      <span class="c1">#spring.datasource.url=jdbc:mysql://localhost:3306/testdb</span>
<span class="p">(</span><span class="n">MariaDB</span><span class="p">)</span>    <span class="c1">#spring.datasource.url=jdbc:mariadb://localhost:3306/testdb</span>
</pre></div>
</div>
</li>
<li><p>&lt;username&gt; is the username for accessing the database.</p></li>
<li><p>&lt;password&gt; is the password required to access the database.</p></li>
</ul>
</section>
</section>
</section>
<section id="step-2-configure-services">
<span id="configure-server"></span><h2>Step 2: Configure Services<a class="headerlink" href="#step-2-configure-services" title="Permalink to this heading"></a></h2>
<p>You can choose to configure Titaniam Server as one of the following services:</p>
<ul class="simple">
<li><p>Translation Service</p></li>
<li><p>Vault</p></li>
<li><p>Proxy for the object store</p></li>
<li><p>Elastic Proxy</p></li>
</ul>
<p>The following subsections describe the properties needed for each of the services:</p>
<ul class="simple">
<li><p><a class="reference internal" href="single_node.html#api-service"><span class="std std-ref">Step 2: Configure Service: Translation Service</span></a></p></li>
<li><p><a class="reference internal" href="single_node.html#sdss-vault"><span class="std std-ref">Step 2: Configure Service: Configure as a Vault</span></a></p></li>
<li><p><a class="reference internal" href="single_node.html#proxy-s3"><span class="std std-ref">Step 2: Configure Service: Proxy for the S3 Object Store</span></a></p></li>
<li><p><a class="reference internal" href="single_node.html#es-proxy"><span class="std std-ref">Step 2: Configure Service: Elastic Proxy</span></a></p></li>
<li><p><a class="reference internal" href="single_node.html#dp-service"><span class="std std-ref">Step 2: Configure Service: Data Protection Service for Object Store</span></a></p></li>
</ul>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="single_node.html#lic-keys-aws"><span class="std std-ref">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="single_node.html#compile-docker"><span class="std std-ref">Step 3: Compose the docker-compose.yml File</span></a></p></li>
</ul>
<section id="step-2-configure-service-translation-service">
<span id="api-service"></span><h3>Step 2: Configure Service: Translation Service<a class="headerlink" href="#step-2-configure-service-translation-service" title="Permalink to this heading"></a></h3>
<p>You must set the following property in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file and disable the other services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">panther</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="single_node.html#lic-keys-aws"><span class="std std-ref">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="single_node.html#compile-docker"><span class="std std-ref">Step 3: Compose the docker-compose.yml File</span></a></p></li>
</ul>
</section>
<section id="step-3-configure-service-configure-as-a-vault">
<span id="sdss-vault"></span><h3>Step 3: Configure Service: Configure as a Vault<a class="headerlink" href="#step-3-configure-service-configure-as-a-vault" title="Permalink to this heading"></a></h3>
<p>Enable the vault service. You must set <code class="docutils literal notranslate"><span class="pre">sdv.enabled</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> and disable the other services in the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;sdv.enabled&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span>
</pre></div>
</div>
<section id="configure-secure-search-index">
<h4>Configure Secure Search Index<a class="headerlink" href="#configure-secure-search-index" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>When you configure Titaniam Server as a vault, you must also configure a secure search index (Titaniam plugin integrated with Elasticsearch). You must configure the following:</p>
</div></blockquote>
<ol class="arabic">
<li><p>Configure the following properties in the <cite>arcus:</cite> section of the <code class="docutils literal notranslate"><span class="pre">spectra-configmap</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">aws_region</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">2</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">keyring</span><span class="o">.</span><span class="n">name</span><span class="o">=&lt;</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">aws</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">access</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_ACCESS_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">secret</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_SECRET_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">arcus01</span>
<span class="o">-</span> <span class="n">http</span><span class="o">.</span><span class="n">port</span><span class="o">=</span><span class="mi">9200</span>
</pre></div>
</div>
</li>
<li><p>Configure the following property in the <code class="docutils literal notranslate"><span class="pre">spectra:</span></code> section of the <code class="docutils literal notranslate"><span class="pre">spectra-configmap</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>- spring.elasticsearch.rest.uris: this property must match the IP and port of the elastic configured in the `arcus` section.
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">spring</span><span class="o">.</span><span class="n">elasticsearch</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">uris</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">arcus</span><span class="p">:</span><span class="mi">9200</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="single_node.html#integrate-data-store"><span class="std std-ref">Integrating with the Data Store</span></a></p></li>
<li><p>Next Step: <span class="xref std std-ref">tls</span></p></li>
</ul>
</section>
</section>
<section id="step-2-configure-service-proxy-for-the-s3-object-store">
<span id="proxy-s3"></span><h3>Step 2: Configure Service: Proxy for the S3 Object Store<a class="headerlink" href="#step-2-configure-service-proxy-for-the-s3-object-store" title="Permalink to this heading"></a></h3>
<p>You can use the Titaniam Server as an S3 proxy to protect any requests to an S3 bucket in the specified region. The following diagrams illustrate the configuration with and without the Titaniam Server as a proxy. When the Titaniam Server is configured as an proxy, it passes through the endpoint requests except the PUTObject and GETObject endpoints. These endpoints are intercepted by the Titaniam Proxy for S3 and the data is encrypted and decrypted.</p>
<img alt="_images/proxy.png" src="_images/proxy.png" />
<p>Enable the proxy service. You must set the following property and disable other services in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      - ripple.enabled=true
- amazon.s3.bucket-name=[bucket_name]
- amazon.s3.access-key=[access_key_id]
- amazon.s3.secret-key=[secret_access_key]

Where,

   * ``amazon.s3.access-key`` and ``amazon.s3.secret-key`` are the access credentials for AWS S3. Ensure that you encrypt these using the zero-day encryption service. See :ref:`zero-day-encrypt`.
   * ``amazon.s3.bucket-name``=&lt;bucket_name&gt; is the S3 bucket name.
</pre></div>
</div>
<section id="configure-your-application-to-route-traffic-to-titaniam-s3-proxy">
<h4>Configure your Application to Route Traffic to Titaniam S3 Proxy<a class="headerlink" href="#configure-your-application-to-route-traffic-to-titaniam-s3-proxy" title="Permalink to this heading"></a></h4>
<p>In your application, you must override the existing endpoint URL. You must now point the endpoint URL to the Titaniam S3 Proxy.</p>
<p><strong>If you are using AWS SDK V1</strong>, modify the endpoint URL as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AmazonS3</span> <span class="n">s3</span> <span class="o">=</span> <span class="n">AmazonS3ClientBuilder</span><span class="o">.</span><span class="n">standard</span><span class="p">()</span>
   <span class="o">.</span><span class="n">withEndpointConfiguration</span><span class="p">(</span><span class="n">new</span> <span class="n">EndpointConfiguration</span><span class="p">(</span>
        <span class="s2">&quot;{{secureStoreURL}}/v2/titaniam-s3-proxy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">))</span>
   <span class="o">.</span><span class="n">withCredentials</span><span class="p">(</span><span class="n">CREDENTIALS_PROVIDER</span><span class="p">)</span>
   <span class="o">.</span><span class="n">build</span><span class="p">();</span>
</pre></div>
</div>
<p>Where, you <code class="docutils literal notranslate"><span class="pre">{secureStoreURL}}/v2/titaniam-s3-proxy</span></code> points to the Titaniam S3 Proxy URL.</p>
<p><strong>If you are using AWS SDK V2</strong>, modify the endpoint URL as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">URI</span> <span class="n">endpointOverride</span> <span class="o">=</span> <span class="n">new</span> <span class="n">URI</span><span class="p">(</span><span class="s2">&quot;{{secureStoreURL}}/v2/titaniam-s3-proxy&quot;</span><span class="p">);</span>
<span class="n">S3Client</span><span class="o">.</span><span class="n">builder</span><span class="p">()</span>
<span class="o">.</span><span class="n">credentialsProvider</span><span class="p">(</span><span class="n">CREDENTIALS_PROVIDER</span><span class="p">)</span>
<span class="o">.</span><span class="n">endpointOverride</span><span class="p">(</span><span class="n">endpointOverride</span><span class="p">)</span>
<span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
<span class="o">.</span><span class="n">build</span><span class="p">();</span>
</pre></div>
</div>
<p>Where, you <code class="docutils literal notranslate"><span class="pre">{secureStoreURL}}/v2/titaniam-s3-proxy</span></code> points to the Titaniam S3 Proxy URL.</p>
<p><strong>If you are using boto3</strong>, modify the endpoint URL during client creation as described <a class="reference external" href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/core/session.html">here</a>.</p>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="single_node.html#lic-keys-aws"><span class="std std-ref">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="single_node.html#compile-docker"><span class="std std-ref">Step 3: Compose the docker-compose.yml File</span></a></p></li>
</ul>
</section>
</section>
<section id="step-2-configure-service-elastic-proxy">
<span id="es-proxy"></span><h3>Step 2: Configure Service: Elastic Proxy<a class="headerlink" href="#step-2-configure-service-elastic-proxy" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>When you configure Titaniam Server as an elastic proxy, you must configure the following properties:</p>
</div></blockquote>
<ol class="arabic">
<li><p>Create a folder on your virtual machine: <code class="docutils literal notranslate"><span class="pre">/var/lib/arcusdata</span></code>.</p></li>
<li><p>Enable the elastic proxy service. Disable the other services. Set <code class="docutils literal notranslate"><span class="pre">sdss.esproxy.enabled</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> in the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;sdss.esproxy.enabled&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Configure the location of the keys:</p>
<blockquote>
<div><ol class="loweralpha">
<li><p>(Optional) If you are using the active key from the AWS Secrets Manager, Configure the following properties in the <code class="docutils literal notranslate"><span class="pre">arcus:</span></code> section of the <code class="docutils literal notranslate"><span class="pre">spectra-configmap.yml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">aws_region</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">2</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">keyring</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">vault</span><span class="o">-</span><span class="n">singlenode</span><span class="o">-</span><span class="n">byok</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">aws</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">access</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_ACCESS_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">secret</span><span class="o">.</span><span class="n">id</span><span class="o">=&lt;</span><span class="n">AWS_SECRET_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">arcus01</span>
<span class="o">-</span> <span class="n">http</span><span class="o">.</span><span class="n">port</span><span class="o">=</span><span class="mi">9200</span>
<span class="o">-</span> <span class="n">indices</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">bool</span><span class="o">.</span><span class="n">max_clause_count</span><span class="o">=</span><span class="mi">2000</span>
</pre></div>
</div>
</li>
<li><p>(Optional) If using byok (bring your own key) mode,</p>
<ol class="lowerroman">
<li><p>In your <code class="docutils literal notranslate"><span class="pre">spectra-configmap.yml</span></code> file, configure the following lines of code in the <cite>arcus</cite> section:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># byok configuration</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">byok</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">host</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">arcus</span><span class="p">:</span><span class="mi">9200</span>
<span class="o">-</span> <span class="n">titaniam</span><span class="o">.</span><span class="n">byok</span><span class="o">.</span><span class="n">refresh</span><span class="o">-</span><span class="n">secs</span><span class="o">=</span><span class="mi">30</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>In your <cite>spectra-configmap.yml</cite> file, configure the following lines of code in the <cite>spectra</cite> section:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># byok configuration</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">byok</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">byok</span><span class="o">.</span><span class="n">host</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">arcus</span><span class="p">:</span><span class="mi">9200</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">byok</span><span class="o">.</span><span class="n">refresh</span><span class="o">-</span><span class="n">secs</span><span class="o">=</span><span class="mi">30</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Configure the following property in the <code class="docutils literal notranslate"><span class="pre">spectra:</span></code> section of the <code class="docutils literal notranslate"><span class="pre">spectra-configmap.yml</span></code> file:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">spring.elasticsearch.rest.uris=http://arcus:9200</span></code> indicates the URL of the Titaniam plugin.</p></li>
<li><p>(Optional) <code class="docutils literal notranslate"><span class="pre">sdss.es.login=admin</span></code> indicates the admin login of the elastic node. This property is required only if you have installed Elasticsearch with authentication.</p></li>
<li><p>(Optional) <code class="docutils literal notranslate"><span class="pre">sdss.es.password</span></code> provide the password after encrypting it with the master encryption key. This property is required only if you have installed Elasticsearch with authentication.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.search.proxy.override.fields.&lt;INDEX_NAME&gt;.&lt;ABSOLUTE_FIELD_NAME&gt;=&lt;OVERRIDE_TYPE&gt;</span></code> specify any field properties in the elastic index that you want to override. For example, to return the values from the index as integers or boolean formats instead of strings. For example,</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sdss</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">proxy</span><span class="o">.</span><span class="n">override</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">example_index</span><span class="o">.</span><span class="n">days</span><span class="o">=</span><span class="n">integer</span>
<span class="n">sdss</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">proxy</span><span class="o">.</span><span class="n">override</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">example_index</span><span class="o">.</span><span class="n">hours</span><span class="o">=</span><span class="n">integer</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p><span class="xref std std-ref">ingest_byok</span></p></li>
<li><p>Previous Step: <a class="reference internal" href="single_node.html#integrate-data-store"><span class="std std-ref">Integrating with the Data Store</span></a></p></li>
<li><p>Next Step: <span class="xref std std-ref">tls</span></p></li>
</ul>
</section>
<section id="step-2-configure-service-data-protection-service-for-object-store">
<span id="dp-service"></span><h3>Step 2: Configure Service: Data Protection Service for Object Store<a class="headerlink" href="#step-2-configure-service-data-protection-service-for-object-store" title="Permalink to this heading"></a></h3>
<p>The Titaniam Server can be used as a data protection service for an object store. The data protection service for object stores lets you encrypt and decrypt objects in your object stores. Currently, AWS S3 is supported. This service lets you do the following operations:</p>
<ul class="simple">
<li><p>Encrypt an object in-place in the object store. You must pass on the object reference to the data protection service.</p></li>
<li><p>Generate an encoded URI to an object. You can use this URI to download the object in clear format.</p></li>
</ul>
<p>To enable the data-protection service, do the following:</p>
<ol class="arabic">
<li><p>(Configure at least one object store service) For example, If you are protecting objects in an AWS S3 object store, you must configure the Titaniam S3 proxy related properties (see <span class="xref std std-ref">_proxy_s3</span>).</p></li>
<li><p>Set the following property file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sdss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">protection</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="single_node.html#lic-keys-aws"><span class="std std-ref">Step 1: Supplying Configuration Values and Keys using AWS Secrets Manager</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="single_node.html#compile-docker"><span class="std std-ref">Step 3: Compose the docker-compose.yml File</span></a></p></li>
</ul>
</section>
</section>
<section id="step-3-configure-token-secret">
<span id="config-secret"></span><h2>Step 3: Configure Token Secret<a class="headerlink" href="#step-3-configure-token-secret" title="Permalink to this heading"></a></h2>
<p>You must specify the base64 encoded token (procured from Titaniam) to pull in Titaniam Server images.</p>
<p>Enter the base64-encoded version of the token in the <code class="docutils literal notranslate"><span class="pre">dockerconfigjson</span></code> property in <code class="docutils literal notranslate"><span class="pre">spectra-secret.yaml</span></code>. Use the following command to generate the base64 version:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s1">&#39;token&#39;</span> <span class="o">|</span> <span class="n">base64</span>
</pre></div>
</div>
<p>Following is a sample <code class="docutils literal notranslate"><span class="pre">spectra-secret.yaml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">data</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">.dockerconfigjson</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ewoJImF1dGhzIjogewoJCSJodHRwczovL2luZGV4LmRvY2tlci5pby92MS8iOiB7CgkJCSJhdXRoIjogImRHbDBZVzVwWVcwNk1EY3haV00wWXpZdFpXRXlNaTAwTkRWaUxXSXpOR1F0TWpNeFl6bG1PV0l4WldVMCIKCQl9Cgl9Cn0=</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2022-03-16T06:55:02Z&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra-secret</span><span class="w"></span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class="w"></span>
<span class="w">  </span><span class="nt">resourceVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;658&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">uid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">44cc72ca-7d1d-4f56-968e-bdc22640e560</span><span class="w"></span>
<span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/dockerconfigjson</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="single_node.html#configure-server"><span class="std std-ref">Step 2: Configure Services</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#config-configmap"><span class="std std-ref">Step 4: Configure ConfigMap</span></a></p></li>
</ul>
</section>
<section id="step-4-configure-configmap">
<span id="config-configmap"></span><h2>Step 4: Configure ConfigMap<a class="headerlink" href="#step-4-configure-configmap" title="Permalink to this heading"></a></h2>
<p>Specify the location of the encryption keys and <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> in a <code class="docutils literal notranslate"><span class="pre">spectra-configmap.yaml</span></code> file.</p>
<p>Set the following properties:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">properties</span><span class="o">-</span><span class="n">source</span><span class="o">=</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">secretsmanager</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">keyname</span><span class="o">=</span><span class="n">titaniam</span><span class="o">.</span><span class="n">properties</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">region</span><span class="o">=&lt;</span><span class="n">region</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">=&lt;</span><span class="n">keyring</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">aws</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">access</span><span class="o">-</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">AWS_ACCESS_ID</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="n">sdss</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">secret</span><span class="o">-</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">AWS_SECRET_ID</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>Where,</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.properties-source</span></code> indicates that the configuration properties are stored in the AWS Secrets Manager.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.secretsmanager.properties.keyname</span></code> specifies the key name of the configuration properties file. This must be set to <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.region</span></code> indicates the region of the AWS Secrets Manager.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.keyring-name</span></code> indicates the &lt;keyring_name&gt; from the Secrets Manager. Secret name is of the format - <cite>titaniam_key_ring/&lt;keyring_name&gt;/&lt;key_name&gt;</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.seed.store.type</span></code> specifies that the keystore is in AWS.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.access-key</span></code> specifies the encrypted access key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdss.aws.sm.secret-key</span></code> specifies the encrypted secret key required by Titaniam Server to access the Secrets Manager. Ensure that you specify the encrypted value. You can encrypt your client ID using the zero-day encryption (see <a class="reference internal" href="#zero-day-encrypt"><span class="std std-ref">Zero-day Encryption Service</span></a>).</p></li>
</ul>
<p>Following is a sample <code class="docutils literal notranslate"><span class="pre">spectra-configmap.yaml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra-config</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra</span><span class="w"></span>
<span class="nt">data</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">jvm_args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-Xms512m -Xmx512m</span><span class="w"></span>

<span class="w">  </span><span class="c1"># This property determines which secret name contains the</span><span class="w"></span>
<span class="w">  </span><span class="c1"># configuration for spectra application. The contents of</span><span class="w"></span>
<span class="w">  </span><span class="c1"># the property is included in Getting Started Guide.</span><span class="w"></span>
<span class="w">  </span><span class="nt">sdss.properties-source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws.sm</span><span class="w"></span>
<span class="w">  </span><span class="nt">sdss.secretsmanager.properties.keyname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam.properties</span><span class="w"></span>
<span class="w">  </span><span class="nt">sdss.aws.sm.access-key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;ENCRYPTED_ACCESS_KEY&gt;</span><span class="w"></span>
<span class="w">  </span><span class="nt">sdss.aws.sm.secret-key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;ENCRYPTED_ACCESS_KEY&gt;</span><span class="w"></span>

<span class="w">  </span><span class="c1"># This is the same as aws_region environment variable above under arcus</span><span class="w"></span>
<span class="w">  </span><span class="nt">sdss.aws.sm.region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-2</span><span class="w"></span>

<span class="w">  </span><span class="c1"># This is the same as keyring_name environment variable above under arcus</span><span class="w"></span>
<span class="w">  </span><span class="c1"># This value *must* match the value specified under arcus</span><span class="w"></span>
<span class="w">  </span><span class="nt">sdss.aws.sm.keyring-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">func-testing</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain"># All of these values should ideally be present in the secret name specified</span><span class="w"></span>
<span class="w">  </span><span class="c1"># under &#39;sdss.secretsmanager.properties.keyname&#39;, so that docker-compose does</span><span class="w"></span>
<span class="w">  </span><span class="c1"># not have DB credentials.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># If specified here, the values will override the ones from Secrets Manager.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># This value *must* match the value specified under arcus</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.datasource.url: jdbc:postgresql://postgres:5432/titaniam?autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.datasource.url: jdbc:postgresql://host.minikube.internal:5433/titaniam_v1?autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.datasource.url: jdbc:postgresql://65.0.12.72:5432/testdb?autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span><span class="w"></span>

<span class="w">  </span><span class="c1"># spring.datasource.password: password123</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.datasource.username: admin</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.datasource.driver-class-name=org.mariadb.jdbc.Driver</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MariaDB53Dialect</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.datasource.driverClassName: org.postgresql.Driver</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.jpa.properties.hibernate.dialect: org.hibernate.dialect.PostgreSQL10Dialect</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.jpa.open-in-view: &quot;false&quot;</span><span class="w"></span>


<span class="w">  </span><span class="c1"># This must match the IP and port of the elastic configured</span><span class="w"></span>
<span class="w">  </span><span class="c1"># in the arcus above.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># This is required only if spectra is enabled. (sdv.enabled: true in sdss.secretsmanager.properties.keyname secret)</span><span class="w"></span>
<span class="w">  </span><span class="c1"># spring.elasticsearch.rest.uris: http://65.0.12.72:9200</span><span class="w"></span>
<span class="w">  </span><span class="c1"># sdss.es.login: 294lgnpkis</span><span class="w"></span>
<span class="w">  </span><span class="c1"># sdss.es.password: ASVrWiEAAAADAAABfksxvOED72flKpUcrSAQmZ6W5p8r</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Multipart configuration</span><span class="w"></span>
<span class="w">  </span><span class="nt">spring.servlet.multipart.max-file-size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40MB</span><span class="w"></span>
<span class="w">  </span><span class="nt">spring.servlet.multipart.max-request-size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50MB</span><span class="w"></span>
<span class="w">  </span><span class="nt">hibernate.jdbc.use_streams_for_binary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Disalbe single-sing-on</span><span class="w"></span>
<span class="w">  </span><span class="nt">sso.enabled</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">spring.autoconfigure.exclude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,org.springframework.boot.actuate.autoconfigure.security.servlet.ManagementWebSecurityAutoConfiguration</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Possible values aws|byok|file</span><span class="w"></span>
<span class="w">  </span><span class="c1"># AWS Secrets Manager based keys - aws</span><span class="w"></span>
<span class="w">  </span><span class="c1"># BYOK based key configuration - byok (see below for additional byok params)</span><span class="w"></span>
<span class="w">  </span><span class="c1"># File based key store (use only in dev environments)</span><span class="w"></span>
<span class="w">  </span><span class="nt">sdss.seed.store.type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws</span><span class="w"></span>

<span class="w">  </span><span class="c1"># byok configuration</span><span class="w"></span>
<span class="w">  </span><span class="c1"># create an index named - titaniam_byok_config</span><span class="w"></span>
<span class="w">  </span><span class="c1">#      - sdss.seed.store.type=byok</span><span class="w"></span>
<span class="w">  </span><span class="c1">#      - sdss.byok.refresh-secs=30</span><span class="w"></span>
<span class="w">  </span><span class="c1">#      - sdss.byok.host=http://arcus:9200</span><span class="w"></span>

<span class="w">  </span><span class="c1"># S3 file mgmt</span><span class="w"></span>
<span class="w">  </span><span class="nt">amazon.s3.region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-2</span><span class="w"></span>

<span class="w">  </span><span class="c1">## Enabling the trust store that has the root-ca certs</span><span class="w"></span>
<span class="w">  </span><span class="c1">#- sdss.trust.store=file:/usr/local/granger/trust-store.jks</span><span class="w"></span>
<span class="w">  </span><span class="c1">#- sdss.trust.store.password=secret</span><span class="w"></span>
<span class="w">  </span><span class="c1">#- sdss.es.login=admin</span><span class="w"></span>
<span class="w">  </span><span class="c1">#- sdss.es.password=ASVrWiEAAAABAAABfikxCXxfKK2hxqCmCAliJupigssc</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Controls logging.</span><span class="w"></span>
<span class="w">  </span><span class="nt">log_level_root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">info</span><span class="w"></span>
<span class="w">  </span><span class="nt">log_level_titaniam</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">debug</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Disable cache</span><span class="w"></span>
<span class="w">  </span><span class="nt">spring.cache.type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NONE</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#config-secret"><span class="std std-ref">Step 3: Configure Token Secret</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#configure-cluster-service"><span class="std std-ref">Step 5: Make Service Available Outside the Cluster</span></a></p></li>
</ul>
</section>
<section id="step-5-make-service-available-outside-the-cluster">
<span id="configure-cluster-service"></span><h2>Step 5: Make Service Available Outside the Cluster<a class="headerlink" href="#step-5-make-service-available-outside-the-cluster" title="Permalink to this heading"></a></h2>
<p>You must ensure that the Titaniam Server service is accessible outside the kubernetes cluster. To do this, you must create a service for Titaniam Server in the kubernetes cluster. To configure the service, use the <code class="docutils literal notranslate"><span class="pre">spectra-service.yaml</span></code> file.</p>
<ol class="arabic simple">
<li><p>Specify the port in the <code class="docutils literal notranslate"><span class="pre">port</span></code> field.</p></li>
<li><p>Specify the service name. This service name must match the one you mentioned in the <code class="docutils literal notranslate"><span class="pre">spectra-configmap.yaml</span></code> file.</p></li>
</ol>
<p>Following is a sample <code class="docutils literal notranslate"><span class="pre">spectra-service.yaml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra-service</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span><span class="w"></span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span><span class="w"></span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#config-configmap"><span class="std std-ref">Step 4: Configure ConfigMap</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#config-deployment"><span class="std std-ref">Step 6: Configure Kubernetes Deployment File</span></a></p></li>
</ul>
</section>
<section id="step-6-configure-kubernetes-deployment-file">
<span id="config-deployment"></span><h2>Step 6: Configure Kubernetes Deployment File<a class="headerlink" href="#step-6-configure-kubernetes-deployment-file" title="Permalink to this heading"></a></h2>
<p>When deploying Titaniam Server, ensure that you specify the number of replicas of this deployment. You can specify this in the <code class="docutils literal notranslate"><span class="pre">spectra-deployment.yaml</span></code> file.</p>
<ol class="arabic">
<li><p>Specify the number of replicas in the <code class="docutils literal notranslate"><span class="pre">replicas</span></code> property.</p></li>
<li><p>Specify the Titaniam Server configmap file using the following property:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">envFrom</span><span class="p">:</span>
       <span class="o">-</span> <span class="n">configMapRef</span><span class="p">:</span>
           <span class="n">name</span><span class="p">:</span> <span class="n">spectra</span><span class="o">-</span><span class="n">config</span>
</pre></div>
</div>
</li>
<li><p>Specify the secret token file needed to access the Titaniam Server images.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">imagePullSecrets</span><span class="p">:</span>
   <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">spectra</span><span class="o">-</span><span class="n">secret</span>
</pre></div>
</div>
</li>
</ol>
<p>Following is a sample <code class="docutils literal notranslate"><span class="pre">spectra-deployment.yaml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra-deployment</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra</span><span class="w"></span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra</span><span class="w"></span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra</span><span class="w"></span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">titaniam/spectra:2.0.4</span><span class="w"></span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span><span class="w"></span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span><span class="w"></span>
<span class="w">          </span><span class="nt">envFrom</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">configMapRef</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra-config</span><span class="w"></span>
<span class="w">      </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spectra-secret</span><span class="w"></span>
<span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Related Topics</strong></p>
<ul class="simple">
<li><p>Previous Step: <a class="reference internal" href="#configure-cluster-service"><span class="std std-ref">Step 5: Make Service Available Outside the Cluster</span></a></p></li>
<li><p>Next Step: <a class="reference internal" href="#deploy-kubernetes"><span class="std std-ref">Step 7: Deploy Titaniam Server using Kubernetes</span></a></p></li>
</ul>
</section>
<section id="step-7-deploy-titaniam-server-using-kubernetes">
<span id="deploy-kubernetes"></span><h2>Step 7: Deploy Titaniam Server using Kubernetes<a class="headerlink" href="#step-7-deploy-titaniam-server-using-kubernetes" title="Permalink to this heading"></a></h2>
<p>This section explains how you can deploy Titaniam Server on Kubernetes using <code class="docutils literal notranslate"><span class="pre">kubectl</span></code> and <code class="docutils literal notranslate"><span class="pre">helm</span> <span class="pre">chart</span></code>.</p>
<p>You must already have kubernetes cluster deployed in your environment.</p>
<section id="creating-kubernetes-cluster-on-eks">
<h3>Creating Kubernetes Cluster on EKS<a class="headerlink" href="#creating-kubernetes-cluster-on-eks" title="Permalink to this heading"></a></h3>
<p>If you have not already created a kubernetes cluster on EKS (Amazon Elastic Kubernetes Service), do so using this <a class="reference external" href="https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html">guide</a>.</p>
</section>
<section id="creating-kubernetes-cluster">
<h3>Creating Kubernetes Cluster<a class="headerlink" href="#creating-kubernetes-cluster" title="Permalink to this heading"></a></h3>
<p>If you are deploying the application on a Kubernetes cluster on a virtual machine from your cloud provider, then read this section.</p>
<p>Use one of these guides to running Kubernetes on AWS EC2.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://kubernetes.io/docs/setup/production-environment/tools/kops/">Using kOps</a></p></li>
<li><p><a class="reference external" href="https://jamesdefabia.github.io/docs/getting-started-guides/aws/">Using get-kube</a></p></li>
</ul>
</section>
<section id="verifying-cluster-using-kubectl">
<h3>Verifying Cluster using kubectl<a class="headerlink" href="#verifying-cluster-using-kubectl" title="Permalink to this heading"></a></h3>
<p>After the cluster is created, the <cite>kubectl</cite> command refers to the newly created cluster.  However, you can verify the cluster that <cite>kubectl</cite> refers by using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl config current-context
</pre></div>
</div>
<p>The following command lists all clusters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl config get-contexts
</pre></div>
</div>
<p>The following example output illustrates the current kubectl context is pointing to a sample cluster. The <strong>CURRENT</strong> column is marked with <code class="docutils literal notranslate"><span class="pre">*</span></code> for the current cluster, which indicates that aws eks cluster is the current context which kubectl is referring.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl config get-contexts
CURRENT   NAME                                                  CLUSTER                                   AUTHINFO                                              NAMESPACE
   *      docker-desktop                                        docker-desktop                            docker-desktop
          kind-kind                                             kind-kind                                 kind-kind
          minikube                                              minikube                                  minikube                                              default
</pre></div>
</div>
<p>There can be many cluster(for example minikube, staging-cluster or local-cluster), you can switch to any cluster using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">config</span> <span class="n">use</span><span class="o">-</span><span class="n">context</span> <span class="o">&lt;</span><span class="n">cluster</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The following command checks whether the cluster nodes are ready. The following example illustrates that the <code class="docutils literal notranslate"><span class="pre">minikube</span></code> cluster is ready for deploying kubernetes resources.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl get nodes
NAME       STATUS   ROLES                  AGE   VERSION
minikube   Ready    control-plane,master   25h   v1.23.3
</pre></div>
</div>
</section>
<section id="deployment">
<h3>Deployment<a class="headerlink" href="#deployment" title="Permalink to this heading"></a></h3>
<p>After the kubernetes cluster is avaiable, Titaniam server can be deployed using one of the following ways:</p>
<ul class="simple">
<li><p>Deployment using kubernetes yaml file</p></li>
</ul>
</section>
<section id="deployment-using-kubernetes-yaml-file">
<h3>Deployment Using Kubernetes yaml File<a class="headerlink" href="#deployment-using-kubernetes-yaml-file" title="Permalink to this heading"></a></h3>
<p>You will need the following <code class="docutils literal notranslate"><span class="pre">yaml</span></code> files for deploying Titaniam Server in kubernetes</p>
<ul class="simple">
<li><p><strong>spectra-secret.yaml</strong> contains the access token encrypted in base64 format. Use this access token to pull images from Titaniam private repository.</p></li>
<li><p><strong>spectra-configmap.yaml</strong> contains the environment variables.</p></li>
<li><p><strong>spectra-deployment.yaml</strong> contains image details.</p></li>
<li><p><strong>spectra-service.yaml</strong> used for accessing the app from outside the kubernetes cluster.</p></li>
</ul>
<ol class="arabic">
<li><p>Execute the following sequence of commands on the kubernetes cluster.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">spectra</span><span class="o">-</span><span class="n">secret</span><span class="o">.</span><span class="n">yaml</span>

<span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">spectra</span><span class="o">-</span><span class="n">configmap</span><span class="o">.</span><span class="n">yaml</span>

<span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">spectra</span><span class="o">-</span><span class="n">deployment</span><span class="o">.</span><span class="n">yaml</span>

<span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">spectra</span><span class="o">-</span><span class="n">service</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Check the service list</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="n">svc</span>
</pre></div>
</div>
</div></blockquote>
<p>This command lists the IP address or DNS name to access the application through the load balancer.</p>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">172.105.45.27</span><span class="p">:</span><span class="mi">8080</span>
</pre></div>
</div>
<p>Now you must be able to access the Titaniam Server service at this URL.</p>
</li>
</ol>
</section>
<section id="checking-whether-all-kubernetes-resources-in-the-cluster-are-up-available">
<h3>Checking whether all kubernetes resources in the cluster are up/available<a class="headerlink" href="#checking-whether-all-kubernetes-resources-in-the-cluster-are-up-available" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="nb">all</span>
</pre></div>
</div>
<p>Output</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span>                                      <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">pod</span><span class="o">/</span><span class="n">spectra</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="mi">57468</span><span class="n">f8586</span><span class="o">-</span><span class="n">fvbvg</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">19</span><span class="n">s</span>
<span class="n">pod</span><span class="o">/</span><span class="n">spectra</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="mi">57468</span><span class="n">f8586</span><span class="o">-</span><span class="n">ws8mm</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">19</span><span class="n">s</span>
<span class="n">pod</span><span class="o">/</span><span class="n">spectra</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="mi">57468</span><span class="n">f8586</span><span class="o">-</span><span class="n">xdbqw</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">19</span><span class="n">s</span>

<span class="n">NAME</span>                      <span class="n">TYPE</span>           <span class="n">CLUSTER</span><span class="o">-</span><span class="n">IP</span>      <span class="n">EXTERNAL</span><span class="o">-</span><span class="n">IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>          <span class="n">AGE</span>
<span class="n">service</span><span class="o">/</span><span class="n">kubernetes</span>        <span class="n">ClusterIP</span>      <span class="mf">10.96.0.1</span>       <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">443</span><span class="o">/</span><span class="n">TCP</span>          <span class="mi">7</span><span class="n">h3m</span>
<span class="n">service</span><span class="o">/</span><span class="n">spectra</span><span class="o">-</span><span class="n">service</span>   <span class="n">LoadBalancer</span>   <span class="mf">10.101.205.25</span>   <span class="o">&lt;</span><span class="n">pending</span><span class="o">&gt;</span>     <span class="mi">8080</span><span class="p">:</span><span class="mi">30120</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">19</span><span class="n">s</span>

<span class="n">NAME</span>                                 <span class="n">READY</span>   <span class="n">UP</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">DATE</span>   <span class="n">AVAILABLE</span>   <span class="n">AGE</span>
<span class="n">deployment</span><span class="o">.</span><span class="n">apps</span><span class="o">/</span><span class="n">spectra</span><span class="o">-</span><span class="n">deployment</span>   <span class="mi">3</span><span class="o">/</span><span class="mi">3</span>     <span class="mi">3</span>            <span class="mi">3</span>           <span class="mi">19</span><span class="n">s</span>

<span class="n">NAME</span>                                            <span class="n">DESIRED</span>   <span class="n">CURRENT</span>   <span class="n">READY</span>   <span class="n">AGE</span>
<span class="n">replicaset</span><span class="o">.</span><span class="n">apps</span><span class="o">/</span><span class="n">spectra</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="mi">57468</span><span class="n">f8586</span>   <span class="mi">3</span>         <span class="mi">3</span>         <span class="mi">3</span>       <span class="mi">19</span><span class="n">s</span>
</pre></div>
</div>
</section>
<section id="checking-the-log-of-a-running-pod">
<h3>Checking the log of a running pod<a class="headerlink" href="#checking-the-log-of-a-running-pod" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl logs pod/spectra-deployment-57468f8586-fvbvg
 _____ _ _              _
|_   _(_) |_ __ _ _ __ (_) __ _ _ __ ___
  | | | | __/ _` | &#39;_ \| |/ _` | &#39;_ ` _ \
  | | | | || (_| | | | | | (_| | | | | | |
  |_| |_|\__\__,_|_| |_|_|\__,_|_| |_| |_|

 ____                  _
/ ___| _ __   ___  ___| |_ _ __ __ _
\___ \| &#39;_ \ / _ \/ __| __| &#39;__/ _` |
 ___) | |_) |  __/ (__| |_| | | (_| |
|____/| .__/ \___|\___|\__|_|  \__,_|
      |_|
java -Xms512m -Xmx512m -DLOG_HOME=/var/log/granger -Dlogging.config=file:///usr/local/granger/logback.xml -jar /usr/local/granger/titaniam-server.jar --spring.config.location=file:///usr/local/granger/application.properties

  .   ____          _            __ _ _
 /\\ / ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | &#39;_ | &#39;_| | &#39;_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  &#39;  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v2.5.3)

09:36:43.486 [INFO ] c.t.Application: Starting Application using Java 16.0.2 on spectra-deployment-57468f8586-fvbvg with PID 30 (/usr/local/granger/titaniam-server.jar started by titaniam in /usr/local/granger)
09:36:43.530 [DEBUG] c.t.Application: Running with Spring Boot v2.5.3, Spring v5.3.9
09:36:43.534 [INFO ] c.t.Application: No active profile set, falling back to default profiles: default
09:36:56.131 [INFO ] o.s.d.r.c.RepositoryConfigurationDelegate: Bootstrapping Spring Data JPA repositories in DEFAULT mode.
09:36:57.972 [INFO ] o.s.d.r.c.RepositoryConfigurationDelegate: Finished Spring Data repository scanning in 1735 ms. Found 8 JPA repository interfaces.
09:37:02.680 [INFO ] o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker: Bean &#39;application&#39; of type [com.titaniamlabs.Application$$EnhancerBySpringCGLIB$$c1b44626] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
09:37:03.552 [INFO ] o.h.v.i.u.Version: HV000001: Hibernate Validator 6.2.0.Final
09:37:08.703 [INFO ] o.s.b.w.e.t.TomcatWebServer: Tomcat initialized with port(s): 8080 (http)
09:37:08.826 [INFO ] o.a.c.h.Http11NioProtocol: Initializing ProtocolHandler [&quot;http-nio-8080&quot;]
09:37:08.828 [INFO ] o.a.c.c.StandardService: Starting service [Tomcat]
09:37:08.832 [INFO ] o.a.c.c.StandardEngine: Starting Servlet engine: [Apache Tomcat/9.0.50]
09:37:09.322 [INFO ] o.a.c.c.C.[.[.[/]: Initializing Spring embedded WebApplicationContext
09:37:09.323 [INFO ] o.s.b.w.s.c.ServletWebServerApplicationContext: Root WebApplicationContext: initialization completed in 25268 ms
09:37:13.987 [INFO ] o.h.j.i.u.LogHelper: HHH000204: Processing PersistenceUnitInfo [name: default]
09:37:14.780 [INFO ] o.h.Version: HHH000412: Hibernate ORM core version 5.4.32.Final
09:37:15.970 [INFO ] o.h.a.c.Version: HCANN000001: Hibernate Commons Annotations {5.1.2.Final}
09:37:16.868 [INFO ] c.z.h.HikariDataSource: HikariPool-1 - Starting...
09:37:17.745 [INFO ] c.z.h.HikariDataSource: HikariPool-1 - Start completed.
09:37:18.145 [INFO ] o.h.d.Dialect: HHH000400: Using dialect: org.hibernate.dialect.PostgreSQL10Dialect
09:37:27.961 [INFO ] o.h.e.t.j.p.i.JtaPlatformInitiator: HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
09:37:28.027 [INFO ] o.s.o.j.LocalContainerEntityManagerFactoryBean: Initialized JPA EntityManagerFactory for persistence unit &#39;default&#39;
09:37:28.897 [DEBUG] c.t.a.s.AwsSeedStore: build secretsmanager
09:37:29.005 [DEBUG] c.t.a.A.Builder: end - secretsmanager created successfully
09:37:29.006 [DEBUG] c.t.a.s.AwsSeedStore: begin - build keyring using aws secretsmanager
09:37:29.014 [DEBUG] c.t.a.AwsSecretsManagerImpl: List all secrets
09:37:29.088 [DEBUG] c.t.a.AwsSecretsManagerImpl: Calling AWS SM. Iteration #: 0
09:37:30.530 [DEBUG] c.t.a.AwsSecretsManagerImpl: Calling AWS SM. Iteration #: 1
09:37:30.832 [DEBUG] c.t.a.AwsSecretsManagerImpl: Calling AWS SM. Iteration #: 2
09:37:31.114 [DEBUG] c.t.a.AwsSecretsManagerImpl: AWS SM call iterations completed. Total iterations: 3
09:37:31.115 [DEBUG] c.t.a.Utils: Fetching key: titaniam_key_ring/func-testing/func-test-001
09:37:31.116 [DEBUG] c.t.a.AwsSecretsManagerImpl: Fetching key: titaniam_key_ring/func-testing/func-test-001
09:37:31.388 [DEBUG] c.t.a.Utils: begin - Parsing value for: titaniam_key_ring/func-testing/func-test-001
09:37:31.393 [DEBUG] c.t.a.Utils: end - &#39;titaniam_key_ring/func-testing/func-test-001&#39; value parsed successfully
09:37:31.400 [DEBUG] c.t.a.Utils: Fetching key: titaniam_key_ring/func-testing/default-key-for-testing
09:37:31.401 [DEBUG] c.t.a.AwsSecretsManagerImpl: Fetching key: titaniam_key_ring/func-testing/default-key-for-testing
09:37:31.689 [DEBUG] c.t.a.Utils: begin - Parsing value for: titaniam_key_ring/func-testing/default-key-for-testing
09:37:31.693 [DEBUG] c.t.a.Utils: end - &#39;titaniam_key_ring/func-testing/default-key-for-testing&#39; value parsed successfully
09:37:31.709 [DEBUG] c.t.a.s.AwsSeedStore: SimpleKeyRing{keys=[default-key-for-testing, func-test-001], activeName=&#39;default-key-for-testing&#39;}
09:37:31.719 [DEBUG] c.t.a.s.AwsSeedStore: end - keyring successfully created using aws secretsmanager
09:37:31.906 [DEBUG] c.t.e.EventRegistry: register - com.titaniamlabs.crypto.engine.FieldLevelInitializationFactory
09:37:31.934 [DEBUG] c.t.a.A.Builder: end - secretsmanager created successfully
09:37:31.935 [DEBUG] c.t.a.AwsSecretsManagerImpl: Fetching key: titaniam.license
09:37:33.104 [INFO ] c.t.a.l.AwsLicenseLoader: Loaded license
09:37:33.109 [DEBUG] c.t.a.l.AwsLicenseLoader: Valid json license found
09:37:33.110 [DEBUG] c.t.a.l.AwsLicenseLoader: License initialization from AWS successful
09:37:41.031 [DEBUG] c.t.s.ESClient: sdss_store_prod v1.0 Schema already exists
09:37:41.171 [DEBUG] c.t.s.RestClientManager: credentials found. creating provider with: 294lgnpkis
09:37:41.187 [DEBUG] c.t.s.RestClientManager: trust store not set
09:37:41.831 [DEBUG] c.t.s.ESClient: sdss-tangle-pipeline Pipeline already exists
09:37:41.852 [DEBUG] c.t.s.ESClient: default-key-for-testing Index already exists
09:37:41.891 [DEBUG] c.t.s.ESClient: sdss_store_prod Index alias already exists for default-key-for-testing Index
09:37:49.436 [INFO ] o.s.b.a.e.w.EndpointLinksResolver: Exposing 1 endpoint(s) beneath base path &#39;/actuator&#39;
09:37:49.696 [INFO ] o.a.c.h.Http11NioProtocol: Starting ProtocolHandler [&quot;http-nio-8080&quot;]
09:37:49.815 [INFO ] o.s.b.w.e.t.TomcatWebServer: Tomcat started on port(s): 8080 (http) with context path &#39;&#39;
09:37:49.983 [INFO ] c.t.Application: Started Application in 84.307 seconds (JVM running for 88.929)
--&gt; Application Initialized &lt;--
</pre></div>
</div>
</section>
<section id="removing-the-kubernetes-resources-using-kubectl">
<h3>Removing the kubernetes resources using kubectl<a class="headerlink" href="#removing-the-kubernetes-resources-using-kubectl" title="Permalink to this heading"></a></h3>
<section id="removing-deployment">
<h4>Removing deployment<a class="headerlink" href="#removing-deployment" title="Permalink to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl delete deployment.apps/spectra-deployment
deployment.apps &quot;spectra-deployment&quot; deleted
user@host helm-chart % kubectl get all
NAME                                      READY   STATUS        RESTARTS   AGE
pod/spectra-deployment-57468f8586-29pzx   1/1     Terminating   0          13h
pod/spectra-deployment-57468f8586-2cj6s   1/1     Terminating   0          13h
pod/spectra-deployment-57468f8586-zf84x   1/1     Terminating   0          13h

NAME                      TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
service/kubernetes        ClusterIP      10.96.0.1        &lt;none&gt;        443/TCP          24h
service/spectra-service   LoadBalancer   10.107.107.188   &lt;pending&gt;     8080:30735/TCP   13h
</pre></div>
</div>
</section>
<section id="removing-service">
<h4>Removing service<a class="headerlink" href="#removing-service" title="Permalink to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl delete service/spectra-service
</pre></div>
</div>
</section>
<section id="removing-configmap">
<h4>Removing configmap<a class="headerlink" href="#removing-configmap" title="Permalink to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl delete configmap spectra-config
configmap &quot;spectra-config&quot; deleted
</pre></div>
</div>
</section>
<section id="removing-secret">
<h4>Removing secret<a class="headerlink" href="#removing-secret" title="Permalink to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl delete secret spectra-secret
secret &quot;spectra-secret&quot; deleted
</pre></div>
</div>
<blockquote>
<div></div></blockquote>
</section>
</section>
</section>
<section id="zero-day-encryption-service">
<span id="zero-day-encrypt"></span><h2>Zero-day Encryption Service<a class="headerlink" href="#zero-day-encryption-service" title="Permalink to this heading"></a></h2>
<p>Ensure that any passwords and secrets that you mention in the <code class="docutils literal notranslate"><span class="pre">titaniam.properties</span></code> file are encrypted. You must not enter PlainText values. Use the Zero-day encryption service from Titaniam to perform the encryption.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl --location --request POST ‘https://demo.titaniam.io:8080/v1/mgmt/property?type=encrypt&amp;value=&lt;value&gt;’
</pre></div>
</div>
<p>The Titaniam zero-day encryption utility returns the encrypted value.</p>
</section>
<section id="post-installation-steps">
<h2>Post-Installation Steps<a class="headerlink" href="#post-installation-steps" title="Permalink to this heading"></a></h2>
<p>This chapter describes the following:</p>
<ul class="simple">
<li><p>Accessing the Logs</p></li>
<li><p>Verifying the Installation</p></li>
</ul>
<section id="logs">
<h3>Logs<a class="headerlink" href="#logs" title="Permalink to this heading"></a></h3>
<p>All logs are handled by the docker logs. See <a class="reference external" href="https://docs.docker.com/config/containers/logging/">docker log documentation</a>.</p>
<p>Run the following command tocheck logs for your container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">logs</span> <span class="o">-</span><span class="n">f</span> <span class="o">&lt;</span><span class="n">container_name</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="verifying-the-installation-for-vault-and-translation-services">
<h3>Verifying the Installation for Vault and Translation Services<a class="headerlink" href="#verifying-the-installation-for-vault-and-translation-services" title="Permalink to this heading"></a></h3>
<p>Perform the following steps to verify that the installation is successful, send the following CURL request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">location</span> <span class="o">--</span><span class="n">request</span> <span class="n">GET</span> <span class="s1">&#39;http:/&lt;baseURL&gt;:8080/actuator/health&#39;</span>
</pre></div>
</div>
<p>You must receive a response similar to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span><span class="p">,</span>

<span class="s2">&quot;components&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span><span class="p">,</span>

<span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="s2">&quot;PostgreSQL&quot;</span><span class="p">,</span>

<span class="s2">&quot;validationQuery&quot;</span><span class="p">:</span> <span class="s2">&quot;isValid()&quot;</span>

<span class="p">}</span>

<span class="p">},</span>

<span class="s2">&quot;diskSpace&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span><span class="p">,</span>

<span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">53675536384</span><span class="p">,</span>

<span class="s2">&quot;free&quot;</span><span class="p">:</span> <span class="mi">7795793920</span><span class="p">,</span>

<span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mi">10485760</span><span class="p">,</span>

<span class="s2">&quot;exists&quot;</span><span class="p">:</span> <span class="n">true</span>

<span class="p">}</span>

<span class="p">},</span>

<span class="s2">&quot;ping&quot;</span><span class="p">:</span> <span class="p">{</span>

<span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span>

<span class="p">}</span>

<span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Titaniam, Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>